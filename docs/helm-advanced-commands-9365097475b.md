# Helm â€”é«˜çº§å‘½ä»¤

> åŸæ–‡ï¼š<https://medium.com/geekculture/helm-advanced-commands-9365097475b?source=collection_archive---------3----------------------->

## èˆµçš„ä¸€äº›é«˜çº§å‘½ä»¤

![](img/ef6ea51e3acac0795795b7822a88465c.png)

Photo by [Matt Artz](https://unsplash.com/@mattartz?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

**ä¸Šä¸€ç¯‡:** [æŒèˆµâ€”â€”åœ¨è¡ŒåŠ¨](https://faun.pub/helm-in-action-652abc10aa1c)

## å¤´ç›”-ç”Ÿæˆ-åç§°

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ **â€”ç”Ÿæˆåç§°**æ ‡å¿—åœ¨èˆµå›¾å®‰è£…è¿‡ç¨‹ä¸­è‡ªåŠ¨ç”Ÿæˆå‘å¸ƒåç§°

```
**>>** helm install bitnami/tomcat **--generate-name**
```

æˆ‘ä»¬è¿˜å¯ä»¥æä¾›ä¸€ä¸ªåç§°æ¨¡æ¿ï¼Œç”¨äºåœ¨å®‰è£…è¿‡ç¨‹ä¸­ç”Ÿæˆå‘å¸ƒåç§°

```
**>>** helm install bitnami/tomcat --generate-name \
  ** --name-template=**"myserver-{{randNumeric 3}}"
```

**æ¼”ç¤º:**

## èˆµ-æ¼”ä¹ 

åœ¨ä½¿ç”¨ helm chart åˆ›å»º Kubernetes å¯¹è±¡ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ **â€”è¯•è¿è¡Œ**å‘½ä»¤æ¥æ£€æŸ¥æ˜¯å¦ä¸€åˆ‡æ­£å¸¸ã€‚

```
**>>** helm install tomcat bitnami/tomcat \
 --values values_tomcat.yaml **--dry-run**
```

æ‰§è¡Œä¸Šè¿°å‘½ä»¤åï¼Œå®ƒå°†è¿”å›å‘è¡Œè¯´æ˜å’Œ helm å°†å‘é€åˆ° kube-API æœåŠ¡å™¨ç”¨äºåˆ›å»º k8s å¯¹è±¡çš„æ‰€æœ‰æ¸…å•æ–‡ä»¶ã€‚åœ¨æ­¤ æŸ¥çœ‹ [**çš„è¾“å‡ºã€‚**](https://gist.github.com/shamimice03/2cd5d60db59a28c0fa0e277ddc43a180)

## å¤´ç›”â€”æ¨¡æ¿

å½“æˆ‘ä»¬ä½¿ç”¨â€” **æ¨¡æ‹Ÿè¿è¡Œ**å‘½ä»¤æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»èƒ½å¤Ÿè®¿é—® k8s é›†ç¾¤ã€‚â€” **é¢„æ¼”**å‘½ä»¤å°†åœ¨ä¸ k8s é›†ç¾¤é€šä¿¡åç”Ÿæˆå‘è¡Œè¯´æ˜å’Œæ¨¡æ¿æ–‡ä»¶ã€‚å¹¶ä¸”ç”Ÿæˆçš„å®‰è£…å’Œå‡çº§çš„æ¸…å•æ–‡ä»¶ä¼šå®Œå…¨ä¸åŒã€‚**è¯•è¿è¡Œ**å‘½ä»¤çš„ä¸»è¦ç›®çš„æ˜¯åœ¨æ‰§è¡Œä¹‹å‰éªŒè¯æ‰€æœ‰å¿…è¦çš„é…ç½®ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æ— æ³•è®¿é—® k8s é›†ç¾¤ï¼Œæˆ‘ä»¬ä»ç„¶å¸Œæœ›ç”Ÿæˆ k8s å¯¹è±¡çš„æ‰€æœ‰æ¨¡æ¿æ–‡ä»¶ï¼Œè¿™äº›æ¨¡æ¿æ–‡ä»¶å°†ä½œä¸º helm ç‰ˆæœ¬çš„ä¸€éƒ¨åˆ†åˆ›å»ºã€‚åœ¨é‚£ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨**èˆµæ¨¡æ¿**å‘½ä»¤ã€‚

```
 **helm template [NAME]   [CHART]      [flags]**
**>>** helm template tomcat bitnami/tomcat --values values_tomcat.yaml
```

æ‰§è¡Œä¸Šè¿°å‘½ä»¤åï¼Œå®ƒå°†ç”Ÿæˆ k8s å¯¹è±¡çš„æ‰€æœ‰æ¨¡æ¿æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶å°†ä½œä¸º helm ç‰ˆæœ¬çš„ä¸€éƒ¨åˆ†åˆ›å»ºã€‚åœ¨ å¤„æŸ¥çœ‹ [**çš„è¾“å‡ºã€‚**](https://gist.github.com/shamimice03/db074769324de0735efcd289c65b8607)

## å¤´ç›”â€”æ‹¿

**helm get** å‘½ä»¤ç”±å¤šä¸ªå­å‘½ä»¤ç»„æˆï¼Œå¯ç”¨äºè·å–å‘å¸ƒçš„æ‰©å±•ä¿¡æ¯ï¼ŒåŒ…æ‹¬:

-ç”¨äºç”Ÿæˆå‘å¸ƒçš„å€¼
-ç”Ÿæˆçš„æ¸…å•æ–‡ä»¶
-å‘å¸ƒæœŸé—´å›¾è¡¨ç”Ÿæˆçš„æ³¨é‡Š
-ä¸å‘å¸ƒç›¸å…³è”çš„æŒ‚é’©

## èµ«å°”å§†â€”å†å²

**helm history** å‘½ä»¤å°†æ‰“å°ç»™å®šç‰ˆæœ¬çš„æ‰€æœ‰**å†å²ç‰ˆæœ¬**ã€‚

```
 **helm history [RELEASE_NAME]**
**>>** helm history  tomcat
```

## èˆµ-å›æ»š

helm çš„ä¸»è¦ä¼˜åŠ¿ä¹‹ä¸€æ˜¯èƒ½å¤Ÿ**å›æ»š**åˆ°ä»¥å‰çš„ç‰ˆæœ¬ã€‚

> è¦æŸ¥çœ‹ç»™å®šç‰ˆæœ¬çš„æ‰€æœ‰å†å²ä¿®è®¢ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ **helm history** å‘½ä»¤ã€‚

```
 **helm rollback <RELEASE> [REVISION]
>>** helm rollback  tomcat    2
--------------------------------------------------------------------
  Rollback was a success! Happy Helming!
```

rollback å‘½ä»¤çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å‘å¸ƒç‰ˆæœ¬çš„åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¿®è®¢(ç‰ˆæœ¬)å·ã€‚å¦‚æœçœç•¥ revision å‚æ•°ï¼Œå®ƒå°†å›æ»šåˆ°ä»¥å‰çš„ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ 4 ä¸ªç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¿½ç•¥äº†ç‰ˆæœ¬å·ã€‚ç„¶åå‘å¸ƒå°†**å›æ»š**åˆ°ç‰ˆæœ¬ 3ã€‚

ä¸ºäº†æ›´å¥½åœ°ç†è§£ï¼Œè¯·å‚è§ä¸‹é¢çš„æ¼”ç¤ºã€‚

## å¤´ç›”â€”å®‰è£…æˆ–å‡çº§

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨**å¤´ç›”å‡çº§**å‘½ä»¤ä»¥åŠ**å®‰è£…**é€‰é¡¹ã€‚å¦‚æœç»™å®šçš„ç‰ˆæœ¬å·²ç»å­˜åœ¨äºç³»ç»Ÿä¸­ï¼Œé‚£ä¹ˆ**å‡çº§**å‘½ä»¤å°†å‘ç”Ÿã€‚ç›¸åï¼Œå¦‚æœç»™å®šçš„ç‰ˆæœ¬ä¸å­˜åœ¨ï¼Œhelm **install** å‘½ä»¤å°†å®‰è£…è¯¥ç‰ˆæœ¬ã€‚

## å¤´ç›”â€”ç­‰å¾…å’Œè¶…æ—¶

åœ¨èˆµå›¾çš„å®‰è£…è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨**ç­‰å¾…**é€‰é¡¹ã€‚å¦‚æœæˆ‘ä»¬åœ¨å®‰è£…/å‡çº§è¿‡ç¨‹ä¸­æŒ‡å®šäº† **wait** é€‰é¡¹ï¼Œhelm å°†åœ¨å°†å‘å¸ƒæ ‡è®°ä¸ºæˆåŠŸä¹‹å‰ç­‰å¾…ï¼Œç›´åˆ°éƒ¨ç½²ã€çŠ¶æ€é›†æˆ–å¤åˆ¶é›†çš„æ‰€æœ‰ podã€PVCã€æœåŠ¡å’Œæœ€å°æ•°é‡çš„ pod éƒ½å¤„äº**å°±ç»ªçŠ¶æ€**ã€‚Helm å°†ç­‰å¾…â€”è¶…æ—¶(é»˜è®¤ä¸º 5 åˆ†é’Ÿ)

```
**>>** helm install myserver bitnami/tomcat **--wait**
```

é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦†ç›–é»˜è®¤å€¼**(5min)**ï¼›æˆ‘ä»¬å¯ä»¥ä½¿ç”¨**è¶…æ—¶**é€‰é¡¹å’Œ**ç­‰å¾…**é€‰é¡¹ã€‚

```
**>>** helm install myserver bitnami/tomcat **--wait** **--timeout 3m30s**
```

## Helm â€”åŸå­å’Œè¶…æ—¶

ä¹‹å‰ï¼Œæˆ‘ä»¬å·²ç»è®¨è®ºè¿‡**ç­‰å¾…**é€‰é¡¹ï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®**ç­‰å¾…**é€‰é¡¹ï¼Œhelm å°†**ç­‰å¾…**k8s å¯¹è±¡åœ¨å®šä¹‰çš„æ—¶é—´å†…å‡†å¤‡å°±ç»ªã€‚å¦‚æœæ‰€æœ‰ç›¸å…³ k8s å¯¹è±¡åœ¨è§„å®šæ—¶é—´å†…**æœªå¤„äºå°±ç»ªçŠ¶æ€**ï¼Œå®‰è£…å°†è¢«å£°æ˜ä¸º**å¤±è´¥**ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€” **åŸå­**é€‰é¡¹ã€‚

å¦‚æœæˆ‘ä»¬åœ¨å®‰è£…æ—¶è®¾ç½®äº†**åŸå­**é€‰é¡¹ï¼Œå®‰è£…è¿‡ç¨‹ä¼šåœ¨å¤±è´¥æ—¶åˆ é™¤å®‰è£…ã€‚å¦‚æœä½¿ç”¨ **â€”åŸå­**ï¼Œå°†è‡ªåŠ¨è®¾ç½® **â€”ç­‰å¾…**æ ‡å¿—ã€‚

```
**>>** helm **install** mysvr bitnami/tomcat -f values_tomcat.yaml **-- atomic**
```

å¦‚æœæˆ‘ä»¬åœ¨å‡çº§æ—¶è®¾ç½®äº†â€” **åŸå­**é€‰é¡¹ï¼Œé‚£ä¹ˆåœ¨**å‡çº§å¤±è´¥**çš„æƒ…å†µä¸‹ï¼Œå‡çº§è¿‡ç¨‹å°†**å›æ»š**æ‰€åšçš„æ›´æ”¹ã€‚

```
**>>** helm **upgrade** mysvr bitnami/tomcat -f values_tomcat.yaml **--atomic**
```

é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨â€” **è¶…æ—¶**é€‰é¡¹æ¥è¦†ç›–é»˜è®¤çš„**è¶…æ—¶**(5 åˆ†é’Ÿ)ã€‚

```
**>>** helm install mysvr bitnami/tomcat -f values_tomcat.yaml \
  **--atomic** **--timeout 3m30s**
```

## èˆµ-å¤±è´¥æ—¶æ¸…ç†

**å¤±è´¥æ—¶æ¸…ç†**å…è®¸åœ¨**å‡çº§å¤±è´¥**æ—¶åˆ é™¤ç›¸åº”å‡çº§ä¸­åˆ›å»ºçš„æ–°èµ„æºã€‚

```
**>>** helm **upgrade** mysvr bitnami/tomcat -f values_tomcat.yaml \
 **--cleanup-on-fail**
```

## èˆµåŠ›

å½“æˆ‘ä»¬å‘é€ä¸€ä¸ªè¯·æ±‚ç»™**å‡çº§**ä¸€ä¸ªç‰¹å®šèˆµå›¾çš„ Kubernetes å¯¹è±¡æ—¶ã€‚Kubernetes å°†é‡æ–°å¯åŠ¨é‚£äº›å€¼å·²æ›´æ”¹çš„ podï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„ podã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³è¦å¼ºåˆ¶é‡å¯æŸä¸ªå›¾è¡¨çš„æ‰€æœ‰çª—æ ¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ **â€” force** å‘½ä»¤ã€‚Helm å°†åˆ é™¤å½“å‰éƒ¨ç½²ï¼Œè€Œä¸æ˜¯ä¿®æ”¹éƒ¨ç½²ï¼Œå¹¶ä¸”å°†é‡æ–°åˆ›å»ºéƒ¨ç½²ã€‚å› æ­¤ï¼ŒKubernetes å°†åˆ é™¤æ—§çš„ pod å¹¶åˆ›å»ºæ–°çš„ podã€‚

> ***æ³¨æ„:*** *ä½¿ç”¨****â€”force****æ ‡å¿—è¿åŒ* ***å‡çº§*** *å‘½ä»¤ä¼šæœ‰ä¸€äº›åœæœºæ—¶é—´ã€‚*

```
**>>** helm **upgrade** mysvr bitnami/tomcat -f values_tomcat.yaml **--force**
```

## æ¥ä¸‹æ¥â€”

[](https://faun.pub/helm-create-your-first-chart-f3aa304c3544) [## Helm â€”åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªå›¾è¡¨

### åˆ›å»ºæ–°å›¾è¡¨

faun.pub](https://faun.pub/helm-create-your-first-chart-f3aa304c3544) 

> å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰å¸®åŠ©ï¼Œè¯·ä¸è¦å¿˜è®°ç‚¹å‡»**æŒ‰é’®**å’Œ**æŒ‰é’®**æ¥å¸®åŠ©æˆ‘å†™æ›´å¤šè¿™æ ·çš„æ–‡ç« ã€‚
> ***è°¢è°¢ğŸ–¤***

## **å‚è€ƒæ–‡çŒ®**

[](https://helm.sh/docs/helm/helm/) [## èˆµ

### Kubernetes çš„å¤´ç›”åŒ…è£…ç»ç†ã€‚Kubernetes è½¯ä»¶åŒ…ç®¡ç†å™¨å¯¹å¤´ç›”çš„å¸¸è§æ“ä½œ:å¤´ç›”æœç´¢:æœç´¢â€¦

helm.sh](https://helm.sh/docs/helm/helm/)