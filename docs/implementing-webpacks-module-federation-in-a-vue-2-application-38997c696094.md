# åœ¨ Vue 2 åº”ç”¨ç¨‹åºä¸­å®ç° Webpack çš„æ¨¡å—è”åˆã€‚

> åŸæ–‡ï¼š<https://medium.com/geekculture/implementing-webpacks-module-federation-in-a-vue-2-application-38997c696094?source=collection_archive---------1----------------------->

![](img/54849d5251a4116e6cbfe952f7c75ec8.png)

Photo by [Tim Johnson](https://unsplash.com/@mangofantasy?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) on [Unsplash](https://unsplash.com/s/photos/coupled-components?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)

# å¾®å‰ç«¯:

å¾®å‰ç«¯æ˜¯ä¸€ç§å‰ç«¯æ¶æ„ï¼Œå…¶ä¸­ç›¸åŒäº§å“/åº”ç”¨çš„æ¨¡å—å½¼æ­¤ç‹¬ç«‹åœ°æ„å»ºã€‚

è¿™ç§æ¶æ„å·²ç»è¢«è¯æ˜æ˜¯çœŸæ­£å¯æ‰©å±•çš„ï¼Œæ‰€ä»¥æˆ‘å†³å®šåœ¨æˆ‘æœ€è¿‘çš„é¡¹ç›®ä¸­ä½¿ç”¨è¿™ç§æ¶æ„ã€‚å¼€å‘å‡ å‘¨åï¼Œæˆ‘æœ‰äº†ä¸€ä¸ª vue2 åº”ç”¨ç¨‹åºå’Œä¸€ä¸ª Gridsome åº”ç”¨ç¨‹åºã€‚ç”±äºè¿™ä¸¤ä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨äº†ç›¸åŒçš„è®¾è®¡ç³»ç»Ÿï¼Œæˆ‘å¤åˆ¶/ç²˜è´´äº†ä¸¤ä¸ªåº”ç”¨ç¨‹åºå…±æœ‰çš„ç»„ä»¶ï¼Œè¿™æ˜¯ä¸å¯ç»´æŠ¤çš„ï¼Œå¤åˆ¶/ç²˜è´´ç»„ä»¶è¿èƒŒäº† [DRY åŸåˆ™ã€‚æˆ‘å†³å®šå¯»æ‰¾ä¸€ä¸ªæ›´å…·å¯æ‰©å±•æ€§çš„è§£å†³æ–¹æ¡ˆï¼Œè¿™è®©æˆ‘é€‰æ‹©äº† Webpack çš„æ¨¡å—è”ç›Ÿã€‚](https://en.wikipedia.org/wiki/Don%27t_repeat_yourself)

å¯¹äºè¿™ä¸ªæ¼”ç¤ºï¼Œæˆ‘ä»¬å°†ä»å¤´åˆ°å°¾è®¾ç½® Webpack çš„æ¨¡å—è”åˆã€‚æ‰€ä»¥ï¼Œç³»å¥½å®‰å…¨å¸¦ğŸ˜ƒã€‚

## è¦æ±‚

1.  ä¸¤ä¸ªå·²ç»å»ºç«‹äº† vue2 é¡¹ç›®:æˆ‘ä»¬ä¸ä¼šåœ¨è¿™ç¯‡åšæ–‡ä¸­è®¨è®ºè¿™ä¸ªã€‚å¦‚æœæ‚¨åœ¨è®¾ç½® vue é¡¹ç›®æ—¶é‡åˆ°é—®é¢˜ï¼Œè¯·è®¿é—® [vue æ–‡æ¡£](https://cli.vuejs.org/guide/creating-a-project.html#vue-create)ã€‚

## è£…ç½®

ä¸ºäº†æ­£ç¡®é…ç½® Webpackï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®ä¸­æ·»åŠ ä¸€äº›å¼€å‘ä¾èµ–é¡¹ã€‚é™„æ³¨:è¿™ä¸¤ä¸ªé¡¹ç›®éƒ½åº”è¯¥å®Œæˆè¿™äº›æ­¥éª¤ã€‚è¦æ·»åŠ å¼€å‘ä¾èµ–é¡¹ï¼Œæˆ‘ä»¬å°†è¿è¡Œä»¥ä¸‹å‘½ä»¤:

```
yarn add webpack webpack-cli webpack-dev-server vue-loader url-loader sass-loader mini-css-extract-plugin html-webpack-plugin dart-sass css-loader -D
```

å®Œæˆåï¼Œæˆ‘ä»¬éœ€è¦å‘ package.json æ·»åŠ ä¸€ä¸ªå¯åŠ¨è„šæœ¬ã€‚è¿™ä¸ªè„šæœ¬çš„ç›®æ ‡æ˜¯åœ¨å¯åŠ¨æœåŠ¡å™¨æ—¶ä½¿ç”¨ Webpack-CLIï¼Œè€Œä¸æ˜¯ vue-cliã€‚æˆ‘ä»¬çš„ package.json çš„è„šæœ¬éƒ¨åˆ†ç°åœ¨åº”è¯¥åŒ…å«ä¸€ä¸ªå¯åŠ¨è„šæœ¬:

```
"scripts": {"serve": "vue-cli-service serve","build": "vue-cli-service build","start": "webpack-cli serve","lint": "vue-cli-service lint"},
```

å¦‚æœæ‚¨è¿è¡Œ`yarn start`å‘½ä»¤ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°æœ‰ä¸€ä¸ªé”™è¯¯â€¦ä¸è¦çƒ¦æ¼â€¦ç„¶è€ŒğŸ˜ã€‚

## ç°åœ¨è®©æˆ‘ä»¬å¼€å§‹â€¦

åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªé¡¹ç›®ã€‚Micro-main æ˜¯éœ€è¦å…±äº«ç»„ä»¶çš„é¡¹ç›®ï¼Œweb-common æ˜¯åŒ…å«å…±äº«ç»„ä»¶çš„é¡¹ç›®ã€‚

åœ¨è¿™ä¸¤ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨æ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª`webpack.config.js`æ–‡ä»¶:

![](img/1a36be7d05c77c54e9f8130f05d51a4a.png)

The location of the webpack.config.js file in the project.

ç°åœ¨æˆ‘ä»¬å·²ç»åˆ›å»ºäº†æˆ‘ä»¬çš„`webpack.config.js`æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†ç”¨ä»¥ä¸‹å†…å®¹å¡«å……å®ƒ:

ä¸¤ä¸ªåº”ç”¨ç¨‹åºçš„`webpack.config.js`æ–‡ä»¶åº”è¯¥åŒ…å«ä¸‹é¢çš„ä»£ç **ï¼Œä½†æ˜¯è®°ä½ç»™ä¸¤ä¸ªé¡¹ç›®ä¸åŒçš„ç«¯å£å˜é‡**ã€‚ç°åœ¨ï¼Œå¦‚æœæ‚¨è¿è¡Œ`yarn start`å‘½ä»¤ï¼Œæ‚¨åº”è¯¥æœ‰ä¸€ä¸ªæ»¡æ„çš„æœåŠ¡å™¨ğŸ˜„ã€‚

ç°åœ¨è®©æˆ‘ä»¬è§£é‡Šä¸€ä¸‹è¿™é‡Œæ‰€å†™çš„é‡è¦éƒ¨åˆ†ã€‚

1.  [å…¥å£ç‚¹](https://webpack.js.org/concepts/entry-points/):å…¥å£ç‚¹æ˜¯ Webpack ç”¨ä½œèµ·ç‚¹çš„æ–‡ä»¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒWebpack ä½¿ç”¨`src/index.js`ä½œä¸ºå…¥å£ç‚¹ã€‚ä½†æ˜¯ä¸ºäº†ç¬¦åˆ Vue æ–¹æ³•ï¼Œæˆ‘ä»¬å°†å…¥å£ç‚¹è®¾ç½®ä¸º`src/main.ts`ã€‚
2.  [Output](https://webpack.js.org/concepts/output/) :è¯¥è¾“å‡ºæ˜¯æˆ‘ä»¬æŒ‡å®šåœ¨æ„å»ºä¹‹ååº”è¯¥å°†æˆ‘ä»¬çš„æ†ç»‘åº”ç”¨ç¨‹åºæ”¾åœ¨å“ªé‡Œçš„åœ°æ–¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒVue åº”ç”¨ç¨‹åºå†…ç½®åœ¨ dist ç›®å½•ä¸­ï¼Œå› æ­¤å°† Webpack æ„å»ºæ”¾åœ¨ dist æ–‡ä»¶å¤¹ä¸­æ˜¯æ­£ç¡®çš„ã€‚
3.  [è§£æ](https://webpack.js.org/configuration/resolve/#resolveextensions):è§£ææ¨¡å—è§£ææ–¹å¼çš„å˜åŒ–ã€‚å®ƒè¿˜æœ‰åŠ©äºè®¾ç½®åˆ«åã€‚åœ¨æˆ‘ä»¬çš„ç”¨ä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡åœ¨ resolve.alias ä¸­æ·»åŠ `@assets`å±æ€§æ¥æ·»åŠ èµ„äº§æ–‡ä»¶å¤¹çš„å¿«æ·æ–¹å¼
4.  [è§„åˆ™](https://webpack.js.org/concepts/loaders/):é»˜è®¤æƒ…å†µä¸‹ï¼ŒWebpack åªç†è§£ Javascript å’Œ JSON æ–‡ä»¶ã€‚è¿™å°±æ˜¯è£…è½½æœºçš„ç”¨æ­¦ä¹‹åœ°ã€‚åŠ è½½å™¨ä½¿ Webpack èƒ½å¤Ÿç†è§£å…¶ä»–æ–‡ä»¶ï¼Œå¦‚ typescriptã€Vueã€CSSã€e.t.c .åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä¸º Vueã€typescriptã€CSS å’Œ SASS æ·»åŠ äº†åŠ è½½å™¨ã€‚
5.  [æ’ä»¶](https://webpack.js.org/configuration/plugins/):æ’ä»¶ç”¨äºä»¥å¤šç§æ–¹å¼å®šåˆ¶ Webpack æ„å»ºè¿‡ç¨‹ã€‚
6.  [devServer](https://webpack.js.org/configuration/dev-server/#devserver) :å¼€å‘åº”ç”¨ç¨‹åºæ‰€éœ€çš„é…ç½®å°±æ”¾åœ¨è¿™é‡Œã€‚

å¡«å……æ‚¨çš„`webpack.config.js`åï¼Œå¯¼èˆªè‡³`http://localhost:${port}`ã€‚ä½ ä¼šæ³¨æ„åˆ°è¿™æ˜¯ä¸€ä¸ªæ²¡æœ‰åº”ç”¨ç¨‹åºå¾½æ ‡çš„ç©ºç™½é¡µé¢ï¼ŒæœåŠ¡å™¨å¯èƒ½æ­£åœ¨å“­æ³£ğŸ˜¢ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ›¿æ¢`public/index.html`ä¸­çš„åŠ¨æ€å˜é‡ï¼Œä¾‹å¦‚:

åœ¨æ­¤ä¹‹åï¼Œå¦‚æœæ‚¨ä»ç„¶æœ‰ä¸€ä¸ªç©ºç™½é¡µï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°ï¼Œæ‚¨å¯èƒ½ä¼šçœ‹åˆ°:

![](img/13ee301a492bda2c098d67d95fcda1bf.png)

An error resulting from using environment variables in the router.

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ªæ–°æ’ä»¶:

åœ¨è¿™ä¹‹åï¼Œä½ ç°åœ¨å¯ä»¥å¯¼èˆªåˆ°ä½ çš„ç½‘ç«™ï¼Œçœ‹åˆ°ä¸€ä¸ªå¿«ä¹çš„ç½‘ç«™ğŸ‘Œã€‚

## æ¨¡å—è”ç›Ÿ

æˆ‘ä»¬å®Œæˆäº† Webpack çš„è®¾ç½®ï¼Œç°åœ¨æˆ‘ä»¬æœ‰äº†æ»¡æ„çš„æœåŠ¡å™¨å’Œä¸€ä¸ªæ­£å¸¸å·¥ä½œçš„ç½‘ç«™ã€‚ç°åœ¨ï¼Œæ˜¯æˆ‘ä»¬å®ç°æ¨¡å—è”é‚¦çš„æ—¶å€™äº†ã€‚

æ¨¡å—è”ç›Ÿçš„æ‰€æœ‰é…±éƒ½åŒ…å«åœ¨`ModuleFederationPlugin`ä¸­ã€‚åœ¨è¿™éƒ¨åˆ†é…ç½®ä¸­ï¼Œä¸¤ä¸ªä»£ç åº“å…·æœ‰ä¸åŒçš„é…ç½®ã€‚

The end configuration of the web_common project.

## éœ€è¦æ³¨æ„çš„å‡ ä»¶äº‹:

1.  ModuleFederationPlugin æ˜¯ä»`require("webpack").container`è€Œä¸æ˜¯ä»`require("webpack")`å¯¼å…¥çš„ã€‚
2.  ModuleFederationPlugin çš„`exposes`å¯¹è±¡è´Ÿè´£å…±äº«é¡¹ç›®ä¸­çš„ä»£ç ã€‚å¦å¤–ï¼Œ`exposes`å¯¹è±¡çš„é”®å¿…é¡»æ˜¯`./[KEY_NAME]`çš„æ ¼å¼ã€‚
3.  æ–‡ä»¶åå¯ä»¥æ˜¯ä»»ä½•åç§°ã€‚ä½†æ˜¯`remoteEntry`æˆ–è€…`web_commonRemoteEntry`æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„åå­—ã€‚
4.  åç§°ä¹Ÿå¯ä»¥æ˜¯ä»»ä½•åç§°ï¼Œä½†æˆ‘ä¼šç»™å®ƒé¡¹ç›®çš„åç§°ã€‚

The End configuration of the main project.

## éœ€è¦æ³¨æ„çš„å‡ ä»¶äº‹:

1.  `remotes`æ˜¯æˆ‘ä»¬æ·»åŠ é¡¹ç›®è¿œç¨‹çš„åœ°æ–¹ï¼Œæˆ‘ä»¬ä»é‚£é‡Œæ¥æ”¶å…±äº«ä»£ç ã€‚
2.  `web_common`æ˜¯æˆ‘ä»¬ä»ä¸­æ¥æ”¶å…±äº«ä»£ç çš„é¡¹ç›®çš„åç§°ã€‚
3.  é¡¹ç›®å…±äº«ä»£ç çš„è¿œç¨‹å¿…é¡»æ˜¯æ ¼å¼`[PROJECT_NAME]@[PROJECT_URL]/[PROJECT_filename]`åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæ–‡ä»¶åæ˜¯ remoteEntry.js

ä¸ºäº†æµ‹è¯•å®ç°ï¼Œæˆ‘ä»¬å°†å…¨å±€å¯¼å…¥ç»„ä»¶ã€‚å³:

Global importation of the HelloWorld component

å¦‚æœæ‚¨ä½¿ç”¨ typescriptï¼Œæ‚¨å¯èƒ½éœ€è¦å°†`web_common`å£°æ˜ä¸ºä¸€ä¸ªæ¨¡å—ã€‚

ç°åœ¨ï¼ŒæœåŠ¡å™¨åº”è¯¥å¾ˆé«˜å…´äº†ã€‚

ç°åœ¨ï¼ŒHelloWorld ç»„ä»¶å¯ä»¥åœ¨ä¸»é¡¹ç›®ä¸­ä½¿ç”¨äº†ã€‚

è¿™æ˜¯ç»“æœ:

![](img/ab57e3c7507e1fb0ef440a80a443e314.png)

The HelloWorld component was imported from the web_common project to the main project.

## è¿˜æœ‰ä¸€ä¸ªé—®é¢˜â€¦

ä¸‡å²ï¼ï¼æˆ‘ä»¬å·²ç»å®Œæˆäº†æ¨¡å—è”åˆâ€¦ä½†æ˜¯æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°å¯¼èˆªåˆ°å¦ä¸€ä¸ªè·¯å¾„å¹¶é‡æ–°åŠ è½½é¡µé¢ä¼šå¯¼è‡´ä¸€ä¸ª 404 é”™è¯¯ï¼Œè¿™ä¼šå½±å“å¼€å‘äººå‘˜çš„ä½“éªŒğŸ˜¿ã€‚

ä¿®å¤æ–¹æ³•æ˜¯å°† [historyApiFallback](https://webpack.js.org/configuration/dev-server/#devserverhistoryapifallback) è®¾ç½®ä¸º trueã€‚

```
// webpack.config.js
module.exports = {
  //...
  devServer: {
    historyApiFallback: true,
  },
};
```

## ç»“è®º

åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ç»™å‡ºäº†å¦‚ä½•è®¾ç½® Webpack ä»¥åŠå¦‚ä½•æ­£ç¡®è®¾ç½®æ¨¡å—è”åˆæ’ä»¶çš„ä¸€æ­¥ä¸€æ­¥çš„æ¸…æ™°æ­¥éª¤ã€‚å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹æ‚¨çš„ç”¨ä¾‹ä¸å°½å¦‚äººæ„ï¼Œè¯·éšæ—¶è”ç³»æˆ‘ã€‚