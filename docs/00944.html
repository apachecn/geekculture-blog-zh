<html>
<head>
<title>Role-Based Access Control (RBAC) for NoSQL DB in Nodejs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Nodejsä¸­NoSQLæ•°æ®åº“çš„åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶(RBAC)</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/geekculture/role-based-access-control-rbac-for-nosql-db-in-nodejs-e72924074d13?source=collection_archive---------2-----------------------#2021-03-21">https://medium.com/geekculture/role-based-access-control-rbac-for-nosql-db-in-nodejs-e72924074d13?source=collection_archive---------2-----------------------#2021-03-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="532b" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated"><em class="hi">è®¸å¤šRBAC(åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶)çš„å®ç°å„ä¸ç›¸åŒï¼Œä½†å…¶åŸºç¡€è¢«å¹¿æ³›é‡‡ç”¨ï¼Œå› ä¸ºå®ƒæ¨¡æ‹Ÿäº†ç°å®ç”Ÿæ´»ä¸­çš„è§’è‰²(å·¥ä½œ)åˆ†é…ã€‚â€” </em> <a class="ae jh" href="https://github.com/onury" rel="noopener ugc nofollow" target="_blank">å¥¥åŠªå°”è€¶å°”å¾·å‹’å§†</a>ã€‚</p></blockquote><p id="bd34" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶(RBAC)æ˜¯ä¸€ç§åŸºäºç»„ç»‡å†…å•ä¸ªç”¨æˆ·æˆ–ç”¨æˆ·ç»„çš„è§’è‰²æ¥ä¿®æ”¹è®¿é—®å’Œæƒé™çš„æ–¹æ³•ã€‚</p><p id="1460" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">RBACå…è®¸ç»„ç»‡æˆå‘˜åªè®¿é—®ä»–ä»¬å·¥ä½œæ‰€éœ€çš„èµ„æºï¼Œå¹¶é™åˆ¶æˆ–é˜»æ­¢å¯¹ä¸å±äºä»–ä»¬çš„èµ„æºçš„æ— é™ç‰¹æƒã€‚</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es jl"><img src="../Images/cb146ab81619c85a26d6cfdabdfbb145.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6is2-qbYQGpHReHI"/></div></div></figure><h1 id="15cf" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">RBACå¯¹ABAC</h1><p id="02ef" class="pw-post-body-paragraph ii ij hi il b im kv io ip iq kw is it ji kx iw ix jj ky ja jb jk kz je jf jg hb bi translated">åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶å’ŒåŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶(ABAC)éƒ½æ˜¯è®¿é—®æ§åˆ¶æ–¹æ³•çš„ç±»å‹ï¼Œä½†æ˜¯å®ƒä»¬çš„æ–¹æ³•ä¸åŒã€‚éœ€è¦RBACç³»ç»Ÿçš„ä¸€ä¸ªç”¨ä¾‹æ˜¯ï¼Œæˆ‘ä»¬æ‰“ç®—æ ¹æ®ç”¨æˆ·çš„è§’è‰²æˆäºˆåº”ç”¨ç¨‹åºç‰¹æƒã€‚</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es la"><img src="../Images/b58dd39100cc093c091bacab72e41120.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*exep4-1OPE4b6fgC"/></div></div></figure><p id="54a4" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">è€ŒABACåŸºäºå±æ€§çš„ç»„åˆï¼Œå³ç”¨æˆ·å±æ€§ã€èµ„æºå±æ€§ã€ä¸è¦è®¿é—®çš„ç³»ç»Ÿæˆ–åº”ç”¨ç¨‹åºç›¸å…³è”çš„å±æ€§ã€ç¯å¢ƒå±æ€§ç­‰ï¼Œæ¥æˆäºˆè®¿é—®æƒã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·å±æ€§å¯èƒ½åŒ…æ‹¬ç”Ÿç‰©æ•°æ®ä¿¡æ¯ã€å”¯ä¸€æ ‡è¯†ã€è§’è‰²ã€å®‰å…¨è®¸å¯ç­‰ã€‚</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es la"><img src="../Images/2dfe45e36947e5c9fef294ad6a4ceb67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sNVfnzKsIHsjrFed"/></div></div></figure><h1 id="9d5d" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">èƒŒæ™¯æ•…äº‹</h1><p id="aad3" class="pw-post-body-paragraph ii ij hi il b im kv io ip iq kw is it ji kx iw ix jj ky ja jb jk kz je jf jg hb bi translated">åœ¨æœ€è¿‘çš„ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘çš„å›¢é˜Ÿè´Ÿè´£ä½¿ç”¨mongoose ORMæ¨¡å¼ä¸ºMongoDB(NoSQLæ•°æ®åº“)å®ç°ä¸€ä¸ªå®šåˆ¶çš„åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶æ¡†æ¶ã€‚åœ¨è¿™ä¸ªè®¿é—®æ§åˆ¶æ¡†æ¶ä¸­ï¼Œæˆ‘ä»¬å°†è€ƒè™‘3ä¸ªå®ä½“:</p><p id="5b2f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated"><strong class="il hj">å®ç°ä¸Šä¸‹æ–‡</strong></p><ul class=""><li id="864d" class="lb lc hi il b im in iq ir ji ld jj le jk lf jg lg lh li lj bi translated">ç”¨æˆ·æœ‰ä¸€ä¸ªè§’è‰²</li><li id="1a20" class="lb lc hi il b im lk iq ll ji lm jj ln jk lo jg lg lh li lj bi translated">åº”ç”¨ç¨‹åºå·²ç»å®šä¹‰äº†èµ„æºï¼Œ</li><li id="7b86" class="lb lc hi il b im lk iq ll ji lm jj ln jk lo jg lg lh li lj bi translated">è¯¥è§’è‰²æ‹¥æœ‰èµ„æºçš„ç‰¹æƒå’Œæƒé™</li></ul><p id="c0d9" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">è®©æˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„é›†åˆç¼–å†™ä¸€äº›mongooseæ¨¡å¼ğŸ˜„</p><h1 id="2bfb" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">(è®¡åˆ’æˆ–ç†è®ºçš„)çº²è¦</h1><p id="bfe4" class="pw-post-body-paragraph ii ij hi il b im kv io ip iq kw is it ji kx iw ix jj ky ja jb jk kz je jf jg hb bi translated"><strong class="il hj"> resources.models.js </strong></p><pre class="jm jn jo jp fd lp lq lr ls aw lt bi"><span id="c82d" class="lu jy hi lq b fi lv lw l lx ly">/* RBAC - role-based access control<br/> first create roles; role =[ "user", "guest", "organization",  "superadmin" "globalsuperadmin"]<br/> next, create resouuce, add their roles_id and permmissions<br/> finally create users and indcate thier roles<br/>*/</span><span id="7712" class="lu jy hi lq b fi lz lw l lx ly">const mongooseClient = app.get('mongooseClient');<br/>    const { Schema } = mongooseClient;</span><span id="3322" class="lu jy hi lq b fi lz lw l lx ly">const resources = new Schema({<br/>      name: { type: String, required: true },<br/>      slug: { type: String, required: true },<br/>      resources_roles: [{<br/>        roles_id: { type: Schema.Types.ObjectId, ref : 'Roles' },<br/>        roles_name: { type:  String },<br/>        create: { type: Boolean },<br/>        delete: { type: Boolean },<br/>        update: { type: Boolean },<br/>        read: { type: Boolean },<br/>      }]<br/>    }, {<br/>      timestamps: true<br/>    });</span><span id="5caa" class="lu jy hi lq b fi lz lw l lx ly">return mongooseClient.model('resources', resources);</span></pre><p id="9bed" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated"><strong class="il hj"> roles.models.js </strong></p><pre class="jm jn jo jp fd lp lq lr ls aw lt bi"><span id="0db3" class="lu jy hi lq b fi lv lw l lx ly">const mongooseClient = app.get('mongooseClient');<br/>    const { Schema } = mongooseClient;</span><span id="8c29" class="lu jy hi lq b fi lz lw l lx ly">module.exports = function (app) {<br/>    const mongooseClient = app.get('mongooseClient');<br/>    const { Schema } = mongooseClient;<br/>    const roles = new Schema({<br/>      name: { type: String, required: true },<br/>      slug: { type: String, required: true },<br/>    }, {<br/>      timestamps: true<br/>    });</span><span id="5947" class="lu jy hi lq b fi lz lw l lx ly">return mongooseClient.model('roles', roles);<br/>  };</span></pre><p id="2c26" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated"><strong class="il hj"> users.models.js </strong></p><pre class="jm jn jo jp fd lp lq lr ls aw lt bi"><span id="4c2c" class="lu jy hi lq b fi lv lw l lx ly">const mongooseClient = app.get('mongooseClient');<br/>    const { Schema } = mongooseClient;</span><span id="7ab4" class="lu jy hi lq b fi lz lw l lx ly">module.exports = function (app) {<br/>    const mongooseClient = app.get('mongooseClient');<br/>    const { Schema } = mongooseClient<br/>    const users = new mongooseClient.Schema({<br/>      email: {type: String, unique: true, lowercase: true},<br/>      password: { type: String },<br/>      first_name: { type: String },<br/>      last_name: { type: String },<br/>      roles: { type: Schema.Types.ObjectId, ref : 'Roles' },</span><span id="e2dd" class="lu jy hi lq b fi lz lw l lx ly">}, {<br/>      timestamps: true<br/>    });</span><span id="d601" class="lu jy hi lq b fi lz lw l lx ly">return mongooseClient.model('users', users);<br/>  };</span></pre><p id="30fc" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">ç°åœ¨ï¼Œå½“æ‚¨éœ€è¦æŸä¸ªè§’è‰²å¯¹æŸä¸ªèµ„æºçš„æƒé™æ—¶ï¼Œæ‚¨åªéœ€æŸ¥æ‰¾<code class="du ma mb mc lq b">role_id</code>å’Œ<code class="du ma mb mc lq b">resource_id</code>ï¼Œå¹¶æ£€æŸ¥åœ¨<code class="du ma mb mc lq b">resources collection</code>ä¸­å°†å“ªäº›æƒé™è®¾ç½®ä¸º<code class="du ma mb mc lq b">true</code>ã€‚</p><h1 id="f161" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">æˆæƒä¸­é—´ä»¶</h1><p id="c6fe" class="pw-post-body-paragraph ii ij hi il b im kv io ip iq kw is it ji kx iw ix jj ky ja jb jk kz je jf jg hb bi translated"><code class="du ma mb mc lq b">users.post('/', getAuth, someMethod)</code></p><p id="3c74" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">å‡è®¾æ‚¨åœ¨è¯·æ±‚ä¸Šæœ‰ä¸€ä¸ªæŸç§ä»¤ç‰Œæ¥æ ‡è¯†å‘å¸ƒå¸–å­çš„ç”¨æˆ·ï¼Œå¹¶å°†ç”¨æˆ·å®ä¾‹é™„åŠ åˆ°è¯·æ±‚å¯¹è±¡ï¼Œæ‚¨å¯ä»¥è¿™æ ·åš:</p><pre class="jm jn jo jp fd lp lq lr ls aw lt bi"><span id="8ea4" class="lu jy hi lq b fi lv lw l lx ly">// pseudo code<br/>getAuth = function (req, res, next) {<br/>  if(req.user) {</span><span id="be60" class="lu jy hi lq b fi lz lw l lx ly">// query to get the user role's  permissions for a resource<br/>    if(token){<br/>    // handle jwt token authenticity and decrypt payload</span><span id="07d3" class="lu jy hi lq b fi lz lw l lx ly">// get permission handler<br/>    db.getPerms({ role_id: req.user.role_id, resource_id: req.resource.id})<br/>    .then((perms) =&gt; {<br/>       var allow = false;<br/>       // mapping of methods to permissions<br/>       perms.forEach(function(perm){<br/>           if (req.method == "POST" &amp;&amp; perms.create) allow = true;<br/>           else if (req.method == "GET" &amp;&amp; perms.read) allow = true;<br/>           else if (req.method == "PUT" &amp;&amp; perms.write) allow = true;<br/>           else if (req.method == "DELETE" &amp;&amp; perm.delete) allow = true;</span><span id="2fd4" class="lu jy hi lq b fi lz lw l lx ly">})<br/>       if (allow) next();<br/>       else {<br/>            res.status(403).send({error: 'access denied'});<br/>        }<br/>    })<br/>    .catch((err)=&gt; {<br/>       //handle your reject and catch here<br/>    })<br/>} else{<br/>    res.status(400).send({error: 'invalid token'})<br/>}</span></pre><p id="7684" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">è¿™æ˜¯ä¸€äº›ä¼ªä»£ç ï¼Œå±•ç¤ºäº†å¦‚ä½•ç¼–å†™è®¤è¯ä¸­é—´ä»¶ã€‚</p><p id="45b0" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">è¿™ä¸æ˜¯å®ç°RBACçš„æœ€ä½³æ¡†æ¶ï¼Œæ‰€ä»¥æˆ‘æœŸå¾…æ‚¨çš„åé¦ˆğŸ˜„ï¼ï¼</p><p id="34b5" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">æ„Ÿè°¢è§‚ä¼—ï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ğŸ¤—ã€‚ä½ å¯ä»¥éšæ—¶åœ¨Githubã€T2ã€æ¨ç‰¹å’ŒT4çš„LinkedInä¸Šè”ç³»æˆ‘ã€‚ä¸€å®šè¦ç‚¹èµã€è¯„è®ºå’Œåˆ†äº«ğŸ˜Œã€‚</p></div><div class="ab cl md me gp mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="hb hc hd he hf"><p id="0466" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated"><em class="ik">æœ€åˆå‘å¸ƒäº</em><a class="ae jh" href="https://blog.nextwebb.tech/role-based-access-control-rbac-for-nosql-db-in-nodejs" rel="noopener ugc nofollow" target="_blank"><em class="ik">https://blog . next Webb . tech</em></a><em class="ik">ã€‚</em></p></div></div>    
</body>
</html>