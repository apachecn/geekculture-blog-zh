<html>
<head>
<title>Orchestrating Serverless from Serverless</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä»æ— æœåŠ¡å™¨ç¼–æ’æ— æœåŠ¡å™¨</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/geekculture/orchestrating-serverless-from-serverless-bcdb751ddd6c?source=collection_archive---------7-----------------------#2021-09-20">https://medium.com/geekculture/orchestrating-serverless-from-serverless-bcdb751ddd6c?source=collection_archive---------7-----------------------#2021-09-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="5b35" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">å°†XStateå’ŒæŒä¹…å¯¹è±¡ç”¨äºCloudflare Workers</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/159b948f30c7d9b5e6e7a45974d5183b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lsRYfaU7uh9fHVcJ7NkFEQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Diagram of the PoC</figcaption></figure><p id="c666" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">å¦‚ä»Šï¼Œæ— æœåŠ¡å™¨æ˜¯ä¸€ä¸ªä»¤äººå…´å¥‹çš„é¢†åŸŸã€‚æ¥è‡ªå¤§ã€ä¸­ã€å°ä¼ä¸šçš„ç«äº‰éå¸¸æ¿€çƒˆï¼Œè¿™ä½¿å¾—å®ƒæˆä¸ºå„ç§åº”ç”¨å’Œæ¶æ„ä¸­çš„ä¸€ä¸ªæœ‰è¶£çš„é€‰æ‹©ã€‚ä½†æ˜¯åœ¨ä¸€ä¸ªè¿è´¯çš„æµç¨‹ä¸­ç®¡ç†è®¸å¤šè¾ƒå°çš„åŠŸèƒ½ä¼šå¸¦æ¥ä¸€äº›æŒ‘æˆ˜ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘å±•ç¤ºäº†ä¸€ä¸ªæˆ‘åšçš„PoCï¼Œå…³äºå¦‚ä½•ç”¨ä¸€ä¸ªæ— æœåŠ¡å™¨åŠŸèƒ½å®ç°ç¼–æ’<em class="kj">æ¨¡å¼æ¥ç®¡ç†å…¶ä»–æ— æœåŠ¡å™¨åŠŸèƒ½çš„æµç¨‹ã€‚æˆ‘ä½¿ç”¨</em> <a class="ae kk" href="https://xstate.js.org/" rel="noopener ugc nofollow" target="_blank"> <em class="kj"> XState </em> </a> <em class="kj">æ¥ç®¡ç†æµï¼Œä½¿ç”¨</em> <a class="ae kk" href="https://developers.cloudflare.com/workers/learning/using-durable-objects" rel="noopener ugc nofollow" target="_blank"> <em class="kj"> CloudflareæŒä¹…å¯¹è±¡</em> </a> <em class="kj">æ¥ä¿æŒè°ƒç”¨ä¹‹é—´çš„çŠ¶æ€ã€‚RabbitMQç”¨ä½œæ¶ˆæ¯ä»£ç†ã€‚</em></p><p id="9b33" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><em class="kj">ç¼–æ’</em>é€šå¸¸ä¸<em class="kj">ç¼–æ’</em>ä¸€èµ·è¢«æåŠï¼Œæ˜¯ç®¡ç†å¾®æœåŠ¡æµç¨‹çš„ä¸»è¦æ¶æ„æ¨¡å¼ä¹‹ä¸€ã€‚ç¼–æ’æ˜¯è®¾è®¡å¥½çš„æœåŠ¡æµè·å–å…¶ä»–æœåŠ¡çš„å§¿æ€ï¼Œè€Œç¼–æ’æ˜¯ä¸åŒæœåŠ¡ä¹‹é—´çš„ç²¾å¿ƒæŒ‡å¯¼ï¼Œåˆ›å»ºä¸€ä¸ªæ•´ä½“ã€‚è¿™ä¸¤è€…éƒ½ä¸<a class="ae kk" href="https://microservices.io/patterns/data/saga.html" rel="noopener ugc nofollow" target="_blank"> <em class="kj">ä¼ å¥‡æ¨¡å¼</em> </a>ä¸€èµ·è¢«æåŠï¼Œä½œä¸ºåœ¨å¾®æœåŠ¡æ¶æ„ä¸­ä¿æŒæœåŠ¡é—´äº‹åŠ¡å®Œæ•´æ€§çš„ä¸€ç§æ–¹å¼ã€‚æˆ‘ä¸ä¼šåœ¨è¿™é‡Œè¯¦ç»†ä»‹ç»ï¼Œä½†æ˜¯å‡è®¾æ‚¨å¯¹è¿™ä¸ªä¸»é¢˜æ¯”è¾ƒç†Ÿæ‚‰ã€‚å¦‚æœæ²¡æœ‰ï¼Œæœ‰å¾ˆå¤šä¸œè¥¿å€¼å¾—ä¸€è¯»ã€‚æˆ‘è‡ªå·±ï¼Œæˆ‘å–œæ¬¢Burning Monkå…³äºä½•æ—¶é€‰æ‹©ç¼–æ’æˆ–ç¼–æ’çš„ç»éªŒæ³•åˆ™(<a class="ae kk" href="https://theburningmonk.com/2020/08/choreography-vs-orchestration-in-the-land-of-serverless/" rel="noopener ugc nofollow" target="_blank">https://theburningmonk . com/2020/08/Choreography-vs-Orchestration-in-the-land-of-server less/</a>)ï¼Œä»¥åŠKislayç»´å°”é©¬å…³äºç¼–æ’å’Œå·¥ä½œæµæ¨¡å¼çš„æ–‡ç« (<a class="ae kk" href="https://kislayverma.com/software-architecture/architecture-pattern-orchestration-via-workflows/" rel="noopener ugc nofollow" target="_blank">https://kislayverma . com/software-architecture/architecture-pattern-Orchestration-via-workflows/</a>)ã€‚</p><p id="961d" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨AWS Stepå‡½æ•°ã€Azure Durableå‡½æ•°æˆ–ç¬¬ä¸‰æ–¹æ‰˜ç®¡æœåŠ¡(å¦‚Camundaæˆ–Temporal.io)æ¥å®Œæˆç¼–æ’ã€‚å› æ­¤ï¼Œæ­£å¦‚æˆ‘åœ¨è¿™é‡Œæè¿°çš„é‚£æ ·ï¼Œæœ‰ä¸€äº›è‡ªè¡Œå¼€å‘çš„å˜ä½“å¯ä¾›é€‰æ‹©ï¼Œä½†è¿™æœ‰ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæ­¤å¤–ï¼Œè¿™äº›é€‰é¡¹å¯èƒ½éå¸¸æ˜‚è´µï¼Œæˆ–è€…ä¼šå°†æ‚¨é”å®šåœ¨ä¸»è¦çš„äº‘å¹³å°ä¸Šã€‚åŒæ ·é‡è¦çš„æ˜¯ï¼Œè¿›è¡Œè¿™ä¸ªPoCçš„ä¸€ä¸ªæ˜æ˜¾çš„ç»“æœæ˜¯ï¼Œæˆ‘æ€€ç–‘åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨XStateå¯èƒ½ä¸ä½¿ç”¨ä¸Šé¢çš„æ›¿ä»£æ–¹æ³•æ²¡æœ‰å¤ªå¤§çš„ä¸åŒ(ä¾‹å¦‚ï¼Œå‚è§<a class="ae kk" href="https://aws.amazon.com/blogs/compute/building-a-serverless-distributed-application-using-a-saga-orchestration-pattern/" rel="noopener ugc nofollow" target="_blank">https://AWS . Amazon . com/blogs/compute/building-a-server less-distributed-application-using-a-saga-orchestration-pattern/</a>)ã€‚</p><h1 id="4d90" class="kl km hi bd kn ko kp kq kr ks kt ku kv io kw ip kx ir ky is kz iu la iv lb lc bi translated">è­¦å‘Š</h1><p id="88c9" class="pw-post-body-paragraph jn jo hi jp b jq ld ij js jt le im jv jw lf jy jz ka lg kc kd ke lh kg kh ki hb bi translated">è¿™æ˜¯ä¸€ä¸ªæ¦‚å¿µéªŒè¯ï¼Œæ‰€ä»¥æˆ‘æ²¡æœ‰ä¸ºä¸€ä¸ªå¥å£®çš„å®ç°æ‰€éœ€è¦çš„æ•°æ®éªŒè¯ã€é”™è¯¯å¤„ç†ç­‰è€Œçƒ¦æ¼ã€‚å“åº”ä¹Ÿä¸æ˜¯é€‚å½“çš„APIå“åº”ï¼Œè€Œåªæ˜¯åŸå§‹æ•°æ®ã€‚</p><h1 id="7cd2" class="kl km hi bd kn ko kp kq kr ks kt ku kv io kw ip kx ir ky is kz iu la iv lb lc bi translated">ä½¿ç”¨æ¡ˆä¾‹å’Œè®¾ç½®</h1><p id="aa10" class="pw-post-body-paragraph jn jo hi jp b jq ld ij js jt le im jv jw lf jy jz ka lg kc kd ke lh kg kh ki hb bi translated">å‡è®¾çš„ç”¨ä¾‹æ˜¯åŸºäºæ°´æœçš„æ¯”è¨é¥¼åº—<em class="kj">çƒ­å¸¦æ¯”è¨é¥¼</em>åœ¨æ—©æœŸçš„å¦‚ä½•åšç®€å•çš„å¾®å‰ç«¯åŸå‹ä¸­å‡ºåğŸ˜‰(ã€https://itnext.io/prototyping-micro-frontends-d03397c5f770ã€‘)ã€‚è¿™äº›å¾®å‰ç«¯å–å¾—äº†å·¨å¤§çš„æˆåŠŸï¼Œæ‰€ä»¥ç°åœ¨åç«¯ä¹Ÿéœ€è¦ç°ä»£åŒ–ï¼Œä»¥æ»¡è¶³ä¸æ–­å¢é•¿çš„ä¸šåŠ¡éœ€æ±‚ã€‚å½“ç„¶ï¼Œè¿™æ„å‘³ç€æ— æœåŠ¡å™¨ã€æ¶ˆæ¯ä»£ç†å’Œæ‰€æœ‰çƒ­é—¨çš„ä¸œè¥¿ğŸ˜</p><p id="a2bb" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">æ‰€ä»¥ä½ å¯ä»¥ç‚¹ä¸€ä»½æœ‰è èã€é¦™è•‰ç­‰ä¸€åˆ‡å¤šæ±ç¾å‘³çš„æ¯”è¨ï¼Œå¹¶è®©å®ƒå®‰å…¨åœ°é€åˆ°ä½ å®¶ã€‚åŸºæœ¬çš„PoCæ¶æ„ç±»ä¼¼äºä¸Šå›¾:ä¸€ä¸ªç¼–æ’æœåŠ¡(<em class="kj">è®¢å•</em>)ç®¡ç†â€œè´­ç‰©è½¦â€å’Œç›¸å…³æœåŠ¡(<em class="kj">å¨æˆ¿</em>ï¼Œ<em class="kj">é€è´§</em>)ï¼Œè¿™æ˜¯è·å¾—å“è¶ŠæŠ«è¨ä½“éªŒæµç¨‹çš„ä¸€éƒ¨åˆ†ã€‚æ­¤å¤–ï¼Œä¸€äº›åŸºæœ¬çš„å¯è§‚å¯Ÿæ€§æ—¥å¿—ã€‚PoCä¸­çš„å®¢æˆ·ç«¯åªæ˜¯ä½¿ç”¨é‚®é€’å‘˜æˆ–ç±»ä¼¼çš„äººï¼Œ<em class="kj">è®¢å•æ—¥å¿—</em>ã€<em class="kj">å¨æˆ¿</em>å’Œ<em class="kj">é€è´§</em>æ˜¯å­˜æ ¹ï¼Œåªæ˜¯ç¡®è®¤å’Œç§»åŠ¨ç‰©æµã€‚æ‰€ä»¥æˆ‘å°†é‡ç‚¹ä»‹ç»<em class="kj">è®¢å•</em>å’Œ<em class="kj">æ¶ˆæ¯ä»£ç†</em>ã€‚</p><p id="f814" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><em class="kj">è®¢å•</em>ç¼–åˆ¶å™¨åŒ…æ‹¬:</p><ul class=""><li id="79d7" class="li lj hi jp b jq jr jt ju jw lk ka ll ke lm ki ln lo lp lq bi translated">ä¸€ä¸ª<em class="kj">æ— æœåŠ¡å™¨åŠŸèƒ½</em> (Cloudflare Worker)ï¼Œå°†æ¥è‡ª<em class="kj">å®¢æˆ·ç«¯</em>æˆ–<em class="kj">æ¶ˆæ¯ä»£ç†</em>çš„è¯·æ±‚è½¬æ¢ä¸ºå¯èƒ½è§¦å‘çŠ¶æ€æœºè½¬æ¢çš„äº‹ä»¶ã€‚</li><li id="3ab4" class="li lj hi jp b jq lr jt ls jw lt ka lu ke lv ki ln lo lp lq bi translated">ä¸€ä¸ª<em class="kj">çŠ¶æ€æœº</em>ï¼Œä½œç”¨äºäº‹ä»¶ï¼Œå¹¶å¯èƒ½åŸºäºè½¬æ¢å’ŒçŠ¶æ€å˜åŒ–è§¦å‘åŠ¨ä½œå’Œæ¶ˆæ¯ã€‚</li><li id="aeb2" class="li lj hi jp b jq lr jt ls jw lt ka lu ke lv ki ln lo lp lq bi translated">ä»¥åŠç”¨äºåœ¨è°ƒç”¨ä¹‹é—´æŒä¹…ä¿å­˜çŠ¶æ€å’Œå·¥ä½œæµæ•°æ®çš„æŒä¹…å¯¹è±¡</li></ul><p id="ff0d" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">æ‚¨é€šè¿‡å°†ç¬¬ä¸€ä¸ªæ¯”è¨é¥¼å‘é€åˆ°ä¸€ä¸ªåŸºæœ¬ç«¯ç‚¹(æˆ‘ä½¿ç”¨<a class="ae kk" href="https://www.npmjs.com/package/itty-router" rel="noopener ugc nofollow" target="_blank"> ittyè·¯ç”±å™¨</a>)æ¥åˆ›å»ºä¸€ä¸ªæ¯”è¨é¥¼è®¢å•:</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="2432" class="mb km hi lx b fi mc md l me mf">router.post('/', auth, async (request, env) =&gt; {<br/>    const eventRequest = new Request('ADD_PIZZA', {<br/>        body: request.body,<br/>        method: request.method,<br/>    });<br/>    const orderId = env.ORDER.newUniqueId();<br/>    const order = env.ORDER.get(orderId);<br/>    const response = await order.fetch(eventRequest);<br/>    return response;<br/>});</span></pre><p id="2560" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">ä¹‹åï¼Œå¯ä»¥é€šè¿‡å¼•ç”¨åˆ›å»ºçš„è®¢å•idå°†æŠ«è¨æ·»åŠ åˆ°è®¢å•ä¸­:</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="0375" class="mb km hi lx b fi mc md l me mf">router.post('/:id', auth, checkValidOrderId, async (request, env) =&gt; {<br/>    const orderId = env.ORDER.idFromString(request.params.id);<br/>    const order = env.ORDER.get(orderId);<br/>    const eventRequest = new Request('ADD_PIZZA', {<br/>        body: request.body,<br/>        method: 'POST',<br/>    });<br/>    const response = await order.fetch(eventRequest);<br/>    return response;<br/>});</span></pre><p id="23f6" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hj">å©€ã€‚ORDER </strong>æ˜¯ä¸€ä¸ªåˆ°æŒä¹…å¯¹è±¡åç§°ç©ºé—´çš„ç»‘å®šï¼Œè¯¥åç§°ç©ºé—´è¢«é…ç½®ä¸ºä½¿ç”¨ä¸Šä¼ çš„Javascriptç±»ã€‚ç”±æ­¤æˆ‘å¾—åˆ°äº†ä¸€ä¸ªç¬¦åˆè¯¥ç±»çš„å­˜æ ¹ã€‚å› æ­¤ï¼Œè·¯ç”±æ£€æŸ¥è¯·æ±‚ï¼Œå°†å…¶è½¬æ¢ä¸ºé€‚åˆçŠ¶æ€æœºçš„äº‹ä»¶è¯·æ±‚ï¼Œå¹¶å°†å…¶è½¬å‘ç»™ä¿å­˜è®¢å•çŠ¶æ€æœºçš„æŒä¹…å¯¹è±¡å®ä¾‹ã€‚å‚è§<a class="ae kk" href="https://developers.cloudflare.com/workers/runtime-apis/durable-objects" rel="noopener ugc nofollow" target="_blank">https://developers . cloud flare . com/workers/runtime-API/durable-objects</a>ã€‚</p><p id="23c5" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">XStateæœ‰ä¸€ä¸ª<em class="kj">è§£é‡Šå™¨</em>çš„æ¦‚å¿µï¼Œå®ƒä»¥å¤„ç†äº‹ä»¶ã€è½¬æ¢ã€åŠ¨ä½œç­‰çš„æœåŠ¡çš„å½¢å¼è§£é‡Šå’Œç®¡ç†çŠ¶æ€æœºã€‚åœ¨PoCä¸­ï¼Œè§£é‡Šåçš„çŠ¶æ€æœºæ˜¯ä¸‹é¢çš„<strong class="jp hj"> orderService </strong>ï¼Œå®ƒåŸºäºæˆ‘åˆ¶ä½œçš„ä¸€ä¸ªè‡ªå®šä¹‰è§£é‡Šå™¨ï¼Œè¯¥è§£é‡Šå™¨æ¯”åº“é™„å¸¦çš„æ ‡å‡†è§£é‡Šå™¨æ›´é€‚åˆæ— æœåŠ¡å™¨åœºæ™¯ã€‚å› æ­¤ï¼Œå½“æŒä¹…å¯¹è±¡è·å¾—<strong class="jp hj"> ADD_PIZZA </strong>äº‹ä»¶æ—¶ï¼Œå®ƒä¼šç»å†å¦‚ä¸‹è¿‡ç¨‹:</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="0305" class="mb km hi lx b fi mc md l me mf">//Process request and get the event type<br/>const type = new URL(request.url).pathname.substr(1);</span><span id="b415" class="mb km hi lx b fi mg md l me mf">//Get data from event/request<br/>const data = await request.json();</span><span id="14d1" class="mb km hi lx b fi mg md l me mf">//Process the transition and run associated actions based on the event type and -data<br/>const newState = await orderService.send({ type, data });</span><span id="05e8" class="mb km hi lx b fi mg md l me mf">//Update statemachine context with some workflow data<br/>const newContext = { ...newState.context, nextEvents: newState.nextEvents, currentState: newState.value };</span><span id="d70a" class="mb km hi lx b fi mg md l me mf">//Store it in the storage of the Durable Object<br/>await storage.put(newContext);</span><span id="0cbf" class="mb km hi lx b fi mg md l me mf">//Create response based on the updated context<br/>const strContext = JSON.stringify(newContext)</span><span id="c0ac" class="mb km hi lx b fi mg md l me mf">return new Response(strContext, {<br/>    status: 201,<br/>    headers: {<br/>        "content-type": "application/json;charset=UTF-8"<br/>    }<br/>});</span></pre><p id="248d" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">å¯¹äºçŠ¶æ€æœºï¼ŒåŒºåˆ†ç¦»æ•£çŠ¶æ€å’Œè¿ç»­çŠ¶æ€æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ä¾‹å¦‚:å¯¹äºäº¤é€šç¯ï¼Œçº¢ã€é»„ã€ç»¿å°†æ˜¯äº¤é€šç¯çš„ç¦»æ•£çŠ¶æ€ï¼Œè€Œç¯åœ¨ä¸€å¤©ä¸­åˆ‡æ¢å¤šå°‘æ¬¡ï¼Œå¯ä»¥æ˜¯äº¤é€šç¯çš„è¿ç»­çŠ¶æ€çš„ä¸€éƒ¨åˆ†ã€‚åœ¨XStateä¸­ï¼Œè¿ç»­çŠ¶æ€ä½œä¸ºçŠ¶æ€æœºçš„<em class="kj">ä¸Šä¸‹æ–‡</em>æ¥å¤„ç†ï¼Œå®ƒæ€»æ˜¯å¯ç”¨äºåŠ¨ä½œç­‰ã€‚å› æ­¤ï¼Œæ­£æ˜¯è¿™ä¸ªä¸Šä¸‹æ–‡è¢«æŒä¹…åŒ–åœ¨æŒä¹…å¯¹è±¡ä¸­ï¼Œå¹¶ä¿å­˜æœ‰é—®é¢˜çš„æ¯”è¨é¥¼è®¢å•çš„æ•°æ®ã€‚</p><p id="63af" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">æ‰€ä»¥ç¥å¥‡çš„äº‹æƒ…å‘ç”Ÿåœ¨<strong class="jp hj"> orderService </strong>ä¸­ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªäº‹ä»¶å¹¶æ ¹æ®çŠ¶æ€æœºè¿”å›ä¸€ä¸ªå¸¦æœ‰æ›´æ–°ä¸Šä¸‹æ–‡çš„çŠ¶æ€ã€‚PoCä¸­çš„çŠ¶æ€æœºå¯ä»¥é€šè¿‡ä»¥ä¸‹ç›´æ¥ä»ä»£ç ç”Ÿæˆçš„çŠ¶æ€å›¾æ¥å¯è§†åŒ–:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mh"><img src="../Images/726bd0b4fb05fa478e2fb69963ffb89f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jJ5OEehSAvlfrNEXoEqlig.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Statechart with the service flow visualized from the xstate code.</figcaption></figure><p id="0132" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">çŠ¶æ€å›¾æœ‰ä¸€ä¸ªå¸¦æœ‰ä¸åŒè½¬æ¢çš„<strong class="jp hj"> orderPizza </strong>çŠ¶æ€ï¼Œå¦‚<strong class="jp hj"> ADD_PIZZA </strong>:</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="2c96" class="mb km hi lx b fi mc md l me mf">states: {<br/>    orderPizza: {<br/>        entry: ['updateStatus'],<br/>        meta: {<br/>            message: 'Oh, just ordering some pizza...',<br/>        },<br/>        on: {<br/>            ADD_PIZZA: {<br/>                target: 'orderPizza',<br/>                actions: ['addPizzaToItems', 'log'],<br/>            },<br/>            REMOVE_PIZZA: {<br/>                target: 'orderPizza',<br/>                actions: ['removePizzaFromItems', 'log'],<br/>            },<br/>            CONFIRM_PIZZA: {<br/>                target: 'bakePizza',<br/>                actions: ['log'],<br/>            },<br/>        },<br/>    },</span></pre><p id="5074" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">å¯ä»¥åœ¨æ¡ç›®ä¸Šè°ƒç”¨åŠ¨ä½œ(<strong class="jp hj"> updateStatus </strong>)ï¼Œæˆ–è€…ä½œä¸ºè½¬æ¢çš„ä¸€éƒ¨åˆ†è°ƒç”¨åŠ¨ä½œ(<strong class="jp hj"> addPizzaToItems </strong>ã€<strong class="jp hj"> log </strong>)ã€‚<strong class="jp hj"> ADD_PIZZA </strong>è½¬æ¢çš„ç›®æ ‡æ˜¯åŒä¸€ä¸ªçŠ¶æ€ã€‚å³ä½¿ä¸æ”¹å˜çŠ¶æ€ï¼Œæˆ‘ä¹Ÿå‘ç°å°†æ”¹å˜ä½œä¸ºè½¬æ¢æ¥å¤„ç†æ˜¯æœ‰ç”¨çš„ï¼Œè€Œä¸æ˜¯ç›´æ¥çš„CRUDå¼çš„æ“ä½œï¼Œå› ä¸ºå®ƒè®©æˆ‘å¯¹å±äºä¸€èµ·å¹¶ä¸”ä¸ä¸åŒçŠ¶æ€ç›¸å…³çš„æ”¹å˜è¿›è¡Œå»ºæ¨¡å’Œå°è£…ã€‚<strong class="jp hj">ä¾‹å¦‚ï¼ŒaddPizzaToItems </strong>å°†ä»…åœ¨çŠ¶æ€ä¸º<strong class="jp hj"> orderPizza </strong>æ—¶è¢«è°ƒç”¨ã€‚</p><p id="e5f2" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">å› æ­¤<strong class="jp hj"> ADD_PIZZA </strong>äº‹ä»¶è§¦å‘äº†<strong class="jp hj"> addPizzaToItems </strong>åŠ¨ä½œ:</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="1ed5" class="mb km hi lx b fi mc md l me mf">addPizzaToItems: assign({<br/>    items: (context, event) =&gt; context.items.concat(event.data.pizza),<br/>}),</span></pre><p id="aa61" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">assign-methodæ˜¯ä¸€ä¸ªXState action-creatorï¼Œå…è®¸æ‚¨æ“çºµä¸Šä¸‹æ–‡ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘åªæ˜¯å°†æ¯”è¨é¥¼æ·»åŠ åˆ°è®¢å•çš„items-arrayä¸­ã€‚</p><p id="3932" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">å½“é¡¾å®¢å¯¹å¥¹é€‰æ‹©çš„æ¯”è¨é¥¼æ„Ÿåˆ°æ»¡æ„æ—¶ï¼Œå¥¹å°†ç¡®è®¤å¹¶è§¦å‘<strong class="jp hj"> CONFIRM_PIZZA </strong>äº‹ä»¶ï¼Œè¿™å°†å†æ¬¡è§¦å‘åˆ°<strong class="jp hj"> bakePizza </strong>çŠ¶æ€çš„è½¬æ¢:</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="2da5" class="mb km hi lx b fi mc md l me mf">bakePizza: {<br/>    initial: 'sendingOrderToKitchen',<br/>    states: {<br/>        sendingOrderToKitchen: {<br/>            entry: ['updateStatus'],<br/>            meta: {<br/>                message: 'Sending the order for the pizza...',<br/>            },<br/>            invoke: {<br/>                id: 'sendOrderToKitchen',<br/>                src: 'orderPizzaFromKitchen',<br/>                onDone: {<br/>                    target: 'waitingForPizzaToBeBaked',<br/>                    actions: ['setSendOrderStatus', 'log']<br/>                },<br/>                onError: {<br/>                    target: 'errorInKitchen',<br/>                    actions: ['setErrorStatus', 'log'],<br/>                },<br/>            }<br/>        },<br/>        waitingForPizzaToBeBaked: {<br/>            entry: ['updateStatus'],<br/>            meta: {<br/>                message: 'Waiting for the pizza to be baked...',<br/>            },<br/>        },<br/>        errorInKitchen: {<br/>            entry: ['updateStatus'],<br/>            meta: {<br/>                message: 'Ooops! Something got burned...',<br/>            },<br/>        },<br/>    },<br/>    on: {<br/>        PIZZA_READY: {<br/>            target: 'deliverPizza',<br/>            actions: ['log'],<br/>        },<br/>    },<br/>},<br/></span></pre><p id="c6a4" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">è¿™ç§çŠ¶æ€æ›´å¤æ‚ï¼Œæœ‰ä¸‰ä¸ªåµŒå¥—çš„å­çŠ¶æ€:</p><p id="0ae8" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><em class="kj"> sendingOrderToKitchen </em>:é€šè¿‡è°ƒç”¨XStateå®šä¹‰çš„<a class="ae kk" href="https://xstate.js.org/docs/guides/communication.html#the-invoke-property" rel="noopener ugc nofollow" target="_blank"> <em class="kj">å¯è°ƒç”¨æœåŠ¡</em> </a>å°†è®¢å•å‘é€åˆ°å¨æˆ¿çš„é»˜è®¤æœåŠ¡ã€‚å¦‚æœè°ƒç”¨<strong class="jp hj"> sendOrderToKitchen </strong>æˆåŠŸï¼Œé‚£ä¹ˆçŠ¶æ€æœºè½¬æ¢åˆ°</p><p id="07ca" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><em class="kj">waitingforpizzoteborked</em>:è¿™é‡Œå®ƒåªæ˜¯ç­‰å¾…<strong class="jp hj"> PIZZA_READY </strong>äº‹ä»¶ã€‚ä½†æ˜¯å¦‚æœ<strong class="jp hj"> sendOrderToKitchen </strong>ä¸æˆåŠŸï¼ŒçŠ¶æ€æœºè½¬æ¢åˆ°</p><p id="e4fc" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><em class="kj"> errorInKitchen </em>:è¿™æ˜¯ä¸€ç§é”™è¯¯çŠ¶æ€ï¼Œå¯ä»¥ä½œä¸ºé”™è¯¯å¤„ç†çš„èµ·ç‚¹â€”â€”é”™è¯¯å¤„ç†ä¸ä½œä¸ºæ­¤PoCçš„ä¸€éƒ¨åˆ†å®æ–½ã€‚</p><h1 id="9103" class="kl km hi bd kn ko kp kq kr ks kt ku kv io kw ip kx ir ky is kz iu la iv lb lc bi translated">æ¶ˆæ¯/äº‹ä»¶ä»£ç†</h1><p id="e374" class="pw-post-body-paragraph jn jo hi jp b jq ld ij js jt le im jv jw lf jy jz ka lg kc kd ke lh kg kh ki hb bi translated"><strong class="jp hj"> sendOrderToKitchen </strong>å’Œéšåçš„<strong class="jp hj"> PIZZA_READY </strong>äº‹ä»¶è¢«ç»‘å®šåˆ°PoCçš„æ¶ˆæ¯ä»£ç†éƒ¨åˆ†ã€‚æœ‰æ—¶æ‚¨ä¼šçœ‹åˆ°ç¼–æ’å’Œç¼–æ’ä¹‹é—´çš„åŒºåˆ«å–å†³äºå‰è€…ä¾èµ–äºåŒæ­¥è°ƒç”¨ï¼Œè€Œåè€…ä¾èµ–äºäº‹ä»¶/æ¶ˆæ¯ä¼ é€’ã€‚ä½†æ˜¯æ›´å‡†ç¡®åœ°è¯´ï¼Œç¬¬ä¸€ç§é€šå¸¸æ˜¯åŸºäºè¯·æ±‚/å“åº”æ¨¡å¼(<strong class="jp hj"> MAKE_PIZZA </strong>ï¼Œ<strong class="jp hj"> PIZZA_READY </strong>)ï¼Œè¿™ç§æ¨¡å¼æ—¢å¯ä»¥ä½¿ç”¨REST-API(æˆ‘çŸ¥é“ä¸¥æ ¼æ¥è¯´RESTè°ƒç”¨æ˜¯å¼‚æ­¥çš„ï¼Œä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä¼šé˜»å¡æµï¼Œç›´åˆ°å®ƒè·å¾—å“åº”å¹¶åŒæ­¥åŠ¨ä½œ)ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ¶ˆæ¯ä»£ç†æ¥å¼‚æ­¥å®ç°ã€‚å¼‚æ­¥æ‰§è¡Œçš„å¥½å¤„æ˜¯ï¼Œå®ƒä¸ºé•¿æ—¶é—´è¿è¡Œçš„å·¥ä½œæµå’Œæ‰‹åŠ¨æ­¥éª¤çš„å·¥ä½œæµæ‰“å¼€äº†å¤§é—¨ã€‚ä½†æ˜¯ï¼Œå½“ç„¶ï¼Œå¦‚æœæœ‰å¸®åŠ©çš„è¯ï¼Œå¯ä»¥æ··åˆä½¿ç”¨ã€‚</p><p id="5f47" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">PoCä¸­çš„æ¶ˆæ¯ä»£ç†åŸºäºRabbitMC (CloudAMPQ)ã€‚å®é™…ä¸Šï¼ŒPoCä¾èµ–äºä½¿ç”¨RabbitMQçš„REST-APIå‘é€æ¶ˆæ¯ï¼ŒåŒæ ·ä¾èµ–äºwebhooksä»RabbitMQæ¥æ”¶æ¶ˆæ¯ã€‚åœ¨PoCä¸­ï¼Œé“¾æ¥åˆ°<strong class="jp hj">sendOrderToKitchen</strong>-æœåŠ¡çš„æ–¹æ³•ä»£ç æ˜¯è¿™æ ·å®šä¹‰çš„:</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="d1ad" class="mb km hi lx b fi mc md l me mf">const orderPizzaFromKitchen = async (context, event) =&gt; {<br/>    const mqEvent = createMQEvent(mqTypes.MAKE_PIZZA, context.orderId, context.items, true);<br/>    return await postEvent(mqEvent, env)<br/>}</span></pre><p id="47b8" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hj"> createMQEvent </strong>åŠ©æ‰‹å‡½æ•°åŸºäºæ¥è‡ªçŠ¶æ€æœºä¸Šä¸‹æ–‡çš„æ•°æ®åˆ›å»ºä¸€ä¸ªæ ¼å¼æ­£ç¡®çš„æ¶ˆæ¯(æˆ‘åŸºäº<a class="ae kk" href="https://cloudevents.io/" rel="noopener ugc nofollow" target="_blank">https://cloudevents.io/</a>)ã€‚<strong class="jp hj"> MAKE_PIZZA </strong>ç±»å‹ç¡®ä¿å®ƒåœ¨è¢«å‘é€åˆ°CloudAMPQä¸Šæˆ‘çš„RabbitMQå®ä¾‹çš„exchange-endpointä¹‹ååˆ°è¾¾æ­£ç¡®çš„é˜Ÿåˆ—ã€‚ç„¶åï¼Œè¯¥é˜Ÿåˆ—çš„webhookå°†æŠŠå®ƒå§”æ‰˜ç»™åˆé€‚çš„æœåŠ¡(PoCå›¾ä¸­çš„<em class="kj">å¨æˆ¿</em>)ã€‚å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œé‚£ä¹ˆçŠ¶æ€æœºè½¬æ¢åˆ°<strong class="jp hj">waitingForPizzaToBeBaked</strong>ã€‚</p><p id="17b9" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">åœ¨æ¦‚å¿µéªŒè¯ä¸­ï¼Œ<em class="kj">å¨æˆ¿</em>æœåŠ¡åªæ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„æ— æœåŠ¡å™¨æœåŠ¡ï¼Œè®©æˆ‘å°†äº‹ä»¶å­˜å‚¨åœ¨ä¸€ä¸ªæŒä¹…å¯¹è±¡ä¸­ã€‚å®ƒè¿˜æä¾›äº†ä¸€ä¸ªç«¯ç‚¹ï¼Œè®©æˆ‘æ£€æŸ¥æ˜¯å¦æœ‰è®¢å•æ­£åœ¨å¤„ç†ï¼Œç„¶åä¸ºé˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªè®¢å•å‘å‡ºä¸€ä¸ª<strong class="jp hj"> PIZZA_READY </strong>äº‹ä»¶ã€‚ç„¶åï¼Œæˆ‘åœ¨RabbitMQå®ä¾‹ä¸Šä¸º<strong class="jp hj"> PIZZA_READY </strong>é˜Ÿåˆ—åˆ›å»ºäº†å¦ä¸€ä¸ªwebhookï¼Œå®ƒå‘½ä¸­äº†<em class="kj"> Order </em> orchestratorä¸Šçš„äº‹ä»¶ç«¯ç‚¹:</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="3412" class="mb km hi lx b fi mc md l me mf">router.post('/event', mqCheck, async (request, env) =&gt; {<br/>    const message = await request.json();<br/>    const orderid = env.ORDER.idFromString(message.subject);<br/>    const order = env.ORDER.get(orderid);<br/>    const data = JSON.stringify(message.data);</span><span id="dc25" class="mb km hi lx b fi mg md l me mf">    const eventRequest = new Request(`${message.type}`, {<br/>        body: data,<br/>        method: 'POST',<br/>    })<br/>    const response = await order.fetch(eventRequest);<br/>    return response;<br/>});</span></pre><p id="94d7" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">è¿™ä¸ªç«¯ç‚¹å°†RabbitMQä¸­çš„äº‹ä»¶è½¬æ¢æˆæŒä¹…å¯¹è±¡ä¸Šçš„çŠ¶æ€æœºå¯ä»¥è§£é‡Šçš„ä¸œè¥¿ã€‚æœ‰äº†<strong class="jp hj"> PIZZA_READY </strong>äº‹ä»¶ï¼Œå®ƒç°åœ¨å°†è½¬æ¢åˆ°<strong class="jp hj"> deliverPizza </strong>çŠ¶æ€ï¼Œå…¶è®¾ç½®æ–¹å¼ä¸<strong class="jp hj"> bakePizzaã€</strong>å’Œ<strong class="jp hj"> </strong>ç›¸åŒï¼Œè¿™å°†è§¦å‘ç±»ä¼¼çš„æµç¨‹ã€‚å®ƒå‘é€ä¸€ä¸ªå¯¹<strong class="jp hj"> DELIVER_PIZZA </strong>çš„è¯·æ±‚ï¼Œå½“å®ƒç¨åæ¥æ”¶åˆ°<strong class="jp hj"> PIZZA_DELIVERED </strong>æ—¶ï¼Œå®ƒè½¬æ¢ä¸ºdoneï¼ŒæŠ«è¨è®¢å•å®Œæˆã€‚</p><h1 id="b7ab" class="kl km hi bd kn ko kp kq kr ks kt ku kv io kw ip kx ir ky is kz iu la iv lb lc bi translated">ä½¿ç”¨websocketä¸å®¢æˆ·ç«¯è¿æ¥</h1><p id="5987" class="pw-post-body-paragraph jn jo hi jp b jq ld ij js jt le im jv jw lf jy jz ka lg kc kd ke lh kg kh ki hb bi translated">åœ¨å·¥ä½œæµç¨‹çš„ä»»ä½•æ—¶å€™ï¼Œå®¢æˆ·éƒ½å¯ä»¥ä»<em class="kj">è®¢å•</em>ç¼–åˆ¶å™¨è½®è¯¢è®¢å•çŠ¶æ€ã€‚åœ¨PoCä¸­ï¼Œå®ƒåªæ˜¯åºåˆ—åŒ–å½“å‰ä¸Šä¸‹æ–‡:</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="e8d0" class="mb km hi lx b fi mc md l me mf">if (type === 'GET_ORDER') {<br/>    return new Response(JSON.stringify(currentContext), {<br/>        status: 201,<br/>        headers: {<br/>            "Content-Type": "application/json;charset=UTF-8",<br/>        }<br/>    });<br/>}</span></pre><p id="4bf5" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">ä½†æ˜¯æ—¢ç„¶Cloudflare Workerså’ŒPostmanç°åœ¨éƒ½æ”¯æŒwebsocketsï¼Œæˆ‘æƒ³æˆ‘ä¹Ÿåº”è¯¥è¯•ç€æ·»åŠ å’Œæµ‹è¯•ä¸€ä¸‹ã€‚è¿™æ„å‘³ç€è®©æŒä¹…å¯¹è±¡å¤„ç†åœ¨å¯¹è±¡ä¸Šæ³¨å†Œå¥—æ¥å­—å¹¶è¿”å›å¥—æ¥å­—å®¢æˆ·ç«¯çš„ç‰¹æ®Šäº‹ä»¶:</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="d785" class="mb km hi lx b fi mc md l me mf">if (type.indexOf('websocket') !== -1) {</span><span id="594f" class="mb km hi lx b fi mg md l me mf">//Request is for websocket<br/>    const [client, server] = Object.values(new WebSocketPair())<br/>    server.accept()<br/>    this.sockets.push(server);<br/>    return new Response(null, {<br/>        status: 101,<br/>        webSocket: client<br/>    })<br/>}</span></pre><p id="107c" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">å› æ­¤ï¼Œåœ¨è¿”å›å¸¸è§„å“åº”ä¹‹å‰ï¼ŒæŒä¹…å¯¹è±¡å¯ä»¥å‘websocketå®¢æˆ·ç«¯å¹¿æ’­ç›¸åŒçš„æ•°æ®:</p><pre class="iy iz ja jb fd lw lx ly lz aw ma bi"><span id="cac7" class="mb km hi lx b fi mc md l me mf">//Create response based on the updated context<br/>const strContext = JSON.stringify(newContext)</span><span id="72f5" class="mb km hi lx b fi mg md l me mf">//Broadcast state changes on registered sockets<br/>this.sockets = this.sockets.filter(socket =&gt; {<br/>    try {<br/>        socket.send(strContext);<br/>        return true;<br/>    } catch (err) {<br/>        // Whoops, this connection is dead. Remove it from the list.<br/>        return false;<br/>    }<br/>});</span><span id="76df" class="mb km hi lx b fi mg md l me mf">return new Response(strContext, {<br/>    status: 201,<br/>    headers: {<br/>        "content-type": "application/json;charset=UTF-8"<br/>    }<br/>});</span></pre><p id="7ad7" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">è¿™æ„å‘³ç€å½“æ¶ˆæ¯ä»£ç†è§¦åŠäº‹ä»¶ç«¯ç‚¹å¹¶è§¦å‘è½¬æ¢/çŠ¶æ€å˜åŒ–æ—¶ï¼Œè¿™ç§å˜åŒ–å°†ç«‹å³å¹¿æ’­ç»™ç›‘å¬å®¢æˆ·ç«¯â€”â€”è¿™éå¸¸é…·ï¼</p><h1 id="3bc5" class="kl km hi bd kn ko kp kq kr ks kt ku kv io kw ip kx ir ky is kz iu la iv lb lc bi translated">ç»“æŸè¯­</h1><p id="1657" class="pw-post-body-paragraph jn jo hi jp b jq ld ij js jt le im jv jw lf jy jz ka lg kc kd ke lh kg kh ki hb bi translated">ä½¿ç”¨XStateåœ¨æ— æœåŠ¡å™¨ä¸Šè¿›è¡Œç¼–æ’æ˜¯ä¸€ç§ç§¯æçš„ä½“éªŒã€‚å®ƒå¹¶æ²¡æœ‰ä¸ºæ­¤è¿›è¡Œä¼˜åŒ–ï¼Œä½†ä»ç„¶æœ‰å¾ˆå¤šç›¸å…³çš„åŠŸèƒ½ï¼Œå¹¶ä¸”è®¾ç½®éå¸¸ç®€å•ã€‚å®ƒæœ‰ä¸€ä¸ªçµæ´»çš„æ–¹æ³•æ¥å¹³è¡¡é…ç½®å’Œä»£ç ï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°å¾—åˆ°å¯è§†åŒ–çš„çŠ¶æ€å›¾ã€‚æˆ‘å¿…é¡»åˆ¶ä½œä¸€ä¸ªè‡ªå®šä¹‰è§£é‡Šå™¨ï¼Œä»¥ä¾¿æ›´å®¹æ˜“åœ°å¯¹æ“ä½œå’ŒæœåŠ¡ä½¿ç”¨await/asyncï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›è¿™å¯ä»¥æˆä¸ºXStateæœªæ¥è¿­ä»£çš„ä¸€éƒ¨åˆ†ã€‚ä½†æ˜¯è¿™ä¹Ÿä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„é—®é¢˜ï¼Œå› ä¸ºXStateæä¾›äº†æ›´â€œä½çº§â€çš„APIã€‚</p><p id="9a7c" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">è¿™é‡Œæˆ‘æ²¡æœ‰æ¼”ç¤ºSagaæ¨¡å¼ï¼Œä½†æ˜¯ä½¿ç”¨XStateå¤„ç†Sagaåº”è¯¥ä¸éš¾ã€‚è‡³å°‘ä¸ä¼šæ¯”ä½¿ç”¨æ›¿ä»£å“æ›´å›°éš¾ã€‚çŠ¶æ€å›¾å¯ä»¥å¾ˆå¿«å˜å¾—éå¸¸å¤æ‚ï¼Œä½†è¿™æ˜¯è‡ªç„¶çš„ï¼Œä¸ä¸€å®šæ˜¯ç”±äºå®ç°ç»†èŠ‚ã€‚</p><p id="b16e" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">å¿…é¡»ä¾èµ–REST-APIå’ŒWebhooksè¿›è¡Œæ¶ˆæ¯ä»£ç†å¯èƒ½ä¼šæ’é™¤ä¸€äº›åŸºäºæ€§èƒ½çš„ç”¨ä¾‹ã€‚æˆ–è®¸æœ‰å¯èƒ½ä½¿ç”¨websocketsæ¥å»ºç«‹ä¸€äº›ä¸œè¥¿ï¼Œæ‰€ä»¥è¿™å¯èƒ½æ˜¯ä¸€ä¸ªæœªæ¥çš„å®éªŒã€‚ä½†æ˜¯æœ‰ä¸€ç§â€œæœ¬åœ°â€çš„æ–¹å¼å°†æ— æœåŠ¡å™¨ä¸æ¶ˆæ¯ä¼ é€’å’Œé˜Ÿåˆ—é›†æˆåœ¨ä¸€èµ·ï¼Œå¯¹äºèƒ½å¤Ÿæä¾›è¿™ç§æ–¹å¼çš„å¹³å°æ¥è¯´æ˜¯ä¸€ä¸ªå·¨å¤§çš„å–ç‚¹ã€‚</p></div></div>    
</body>
</html>