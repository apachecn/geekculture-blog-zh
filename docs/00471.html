<html>
<head>
<title>Testing Asynchronous Tasks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">æµ‹è¯•å¼‚æ­¥ä»»åŠ¡</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/geekculture/testing-asynchronous-tasks-ebd0dbc310ec?source=collection_archive---------2-----------------------#2021-02-15">https://medium.com/geekculture/testing-asynchronous-tasks-ebd0dbc310ec?source=collection_archive---------2-----------------------#2021-02-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/7ba44102b4c40f70a339b2462a661d6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*u_4SyP1Fo45N40DNYlbacA.jpeg"/></div><figcaption class="im in et er es io ip bd b be z dx">Photo by <a class="ae iq" href="https://www.pexels.com/@startup-stock-photos?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Startup Stock Photos</a> from <a class="ae iq" href="https://www.pexels.com/photo/man-wearing-black-and-white-stripe-shirt-looking-at-white-printer-papers-on-the-wall-212286/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Pexels</a></figcaption></figure><p id="61d8" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj">å­¦ä¹ æˆæœ</strong></p><ol class=""><li id="b2fc" class="jp jq hi it b iu iv iy iz jc jr jg js jk jt jo ju jv jw jx bi translated">å­¦ä¹ å¦‚ä½•ä½¿ç”¨<code class="du jy jz ka kb b">XCTestExpectation</code>ç±»</li><li id="9581" class="jp jq hi it b iu kc iy kd jc ke jg kf jk kg jo ju jv jw jx bi translated">åˆ©ç”¨<code class="du jy jz ka kb b">XCTestExpectation</code>ç±»æ¸…ç†æµ‹è¯•çš„æºä»£ç </li></ol><h2 id="70e4" class="kh ki hi bd kj kk kl km kn ko kp kq kr jc ks kt ku jg kv kw kx jk ky kz la lb bi translated">XCTestExpectationç±»</h2><p id="bbc5" class="pw-post-body-paragraph ir is hi it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hb bi translated">å½“æµ‹è¯•é©¾é©¶æˆ–è€…ä¸ºä¸€äº›ä»»åŠ¡ç¼–å†™æµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸æœ‰æˆ‘ä»¬çš„ç»™å®šï¼Œæˆ‘ä»¬çš„æ—¶é—´ï¼Œæœ€åæ˜¯æˆ‘ä»¬çš„æ—¶é—´ã€‚å½“æˆ‘ä»¬ä¸ºåŒæ­¥ä»»åŠ¡åˆ›å»ºæµ‹è¯•æ—¶ï¼Œè¿™å¾ˆå®¹æ˜“æè¿°ã€‚å½“æˆ‘ä»¬ä¸å¾—ä¸æµ‹è¯•è¡Œä¸ºæ–¹å¼ä¸åŒçš„é©¾é©¶ä»»åŠ¡æ—¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿå¦‚æœä¸€ä¸ªä»»åŠ¡æ˜¯å¼‚æ­¥çš„ï¼Œæˆ‘ä»¬å¦‚ä½•åœ¨æµ‹è¯•ä¸­å¾—åˆ°æˆ‘ä»¬æ–­è¨€çš„ç»“æœï¼Ÿç­”æ¡ˆç›¸å½“ç®€å•ï¼Œè‹¹æœä¸ºæˆ‘ä»¬æä¾›äº†<code class="du jy jz ka kb b">XCTestExpectation</code>ç±»ã€‚æ ¹æ®Appleæ–‡æ¡£ï¼Œè¯¥ç±»ä»£è¡¨:</p><blockquote class="lh li lj"><p id="5f70" class="ir is lk it b iu iv iw ix iy iz ja jb ll jd je jf lm jh ji jj ln jl jm jn jo hb bi translated">å¼‚æ­¥æµ‹è¯•ä¸­çš„é¢„æœŸç»“æœã€‚</p></blockquote><p id="89a0" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">ç®€è€Œè¨€ä¹‹ï¼Œè¿™ä¸ªç±»å°†å¸®åŠ©æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡æ˜¯å¦å®Œæˆæˆ–<strong class="it hj">å®Œæˆã€‚</strong>æœŸæœ›åœ¨ä»¥ä¸‹æƒ…å†µä¸‹å®ç°:</p><ol class=""><li id="1243" class="jp jq hi it b iu iv iy iz jc jr jg js jk jt jo ju jv jw jx bi translated">ä»–ä»¬ä¼šæ”¶åˆ°é€šçŸ¥ï¼Œ</li><li id="ca2c" class="jp jq hi it b iu kc iy kd jc ke jg kf jk kg jo ju jv jw jx bi translated">å®ƒä»¬æ¥æ”¶ä¸€ä¸ªç”¨è°“è¯æˆåŠŸè¯„ä¼°çš„å¯¹è±¡ï¼Œ</li><li id="8417" class="jp jq hi it b iu kc iy kd jc ke jg kf jk kg jo ju jv jw jx bi translated">ä»–ä»¬è§‚å¯Ÿä¸€ä¸ªå€¼ï¼Œç›´åˆ°å®ƒä¸æœŸæœ›å€¼ç›¸åŒ¹é…ï¼Œæˆ–è€…ï¼›</li><li id="6548" class="jp jq hi it b iu kc iy kd jc ke jg kf jk kg jo ju jv jw jx bi translated">ä½œä¸ºå¼€å‘äººå‘˜ï¼Œå½“ä½ æ˜ç¡®åœ°å®ç°å®ƒä»¬æ—¶(æˆ‘ä»¬å°†åœ¨æœ¬æ•™ç¨‹ä¸­è®¨è®ºè¿™äº›)ğŸ™‚).</li></ol><p id="3f6a" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><code class="du jy jz ka kb b">XCTestCase</code>ç±»ä¸ºæˆ‘ä»¬æä¾›äº†åˆ›å»º<code class="du jy jz ka kb b">XCTestExpectation</code>å¯¹è±¡çš„<code class="du jy jz ka kb b">expectation</code>æ–¹æ³•ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­:</p><pre class="lo lp lq lr fd ls kb lt lu aw lv bi"><span id="5c27" class="kh ki hi kb b fi lw lx l ly lz"><strong class="kb hj">func</strong> test_asyncFunction_didFulfill() {<br/>   // Given<br/>   //Any initialization</span><span id="3500" class="kh ki hi kb b fi ma lx l ly lz">   //When<br/>   <strong class="kb hj">let</strong> exp = expectation(description: "Wait for asycn function to complete")</span><span id="7fde" class="kh ki hi kb b fi ma lx l ly lz">   //Then<br/>   //Any assertion<br/>}</span></pre><p id="bfcf" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå¿…é¡»æ˜ç¡®å®ç°çš„æœŸæœ›ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºæˆ‘ä»¬åªä¼ é€’äº†<code class="du jy jz ka kb b">description</code>å‚æ•°ã€‚<code class="du jy jz ka kb b">expectation</code>æ–¹æ³•è¢«é‡è½½ä»¥æ¶µç›–æˆ‘ä»¬ä¹‹å‰è§è¿‡çš„å®ç°æœŸæœ›çš„å››ç§æ–¹å¼ã€‚</p><p id="9de6" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">ç°åœ¨ä½ å¯èƒ½æƒ³çŸ¥é“ï¼Œæ˜¾å¼å®ç°æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿè¿™æ„å‘³ç€å½“å¼‚æ­¥ä»»åŠ¡å®Œæˆæ—¶ï¼Œæ‚¨å°†è°ƒç”¨<code class="du jy jz ka kb b">fulfill</code>æ–¹æ³•ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†è®©æµ‹è¯•çŸ¥é“ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡å·²ç»å®Œæˆäº†å®ƒçš„æ‰§è¡Œã€‚</p><pre class="lo lp lq lr fd ls kb lt lu aw lv bi"><span id="2cc7" class="kh ki hi kb b fi lw lx l ly lz">exp.fulfill()</span></pre><p id="5f8a" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">ä½ å¯èƒ½ä¹Ÿæƒ³çŸ¥é“:å—¯ï¼Œæˆ‘ä»ä¸€ä¸ªåŒæ­¥å‡½æ•°è°ƒç”¨ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œå¦‚æœæˆ‘çš„å¼‚æ­¥ä»»åŠ¡éœ€è¦ä¸€æ®µæ—¶é—´ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿæˆ‘çš„æµ‹è¯•å‡½æ•°å¯ä»¥åœ¨æˆ‘çš„å¼‚æ­¥ä»»åŠ¡ä¹‹å‰ç»“æŸå—ï¼Ÿå¦‚æœæˆ‘æ²¡æœ‰æŒ‰æ—¶å¾—åˆ°å¼‚æ­¥ä»»åŠ¡ç»“æœï¼Œæˆ‘è¯¥å¦‚ä½•åšä¸€äº›æ–­è¨€ï¼Ÿè¿™ä¸ªé—®é¢˜ä¹Ÿå¯ä»¥ç”¨<code class="du jy jz ka kb b">XCTestCase</code>ç±»æä¾›çš„<code class="du jy jz ka kb b">wait</code>æ–¹æ³•æ¥è§£å†³ã€‚è¿™ä¸ªæ–¹æ³•å°†æ¥æ”¶ä¸€ä¸ªæœŸæœ›æ•°ç»„å’Œä¸€ä¸ªä»¥ç§’ä¸ºå•ä½çš„è¶…æ—¶ï¼Œè¿™æ„å‘³ç€æ‚¨çš„æµ‹è¯•å‡½æ•°å°†ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°æ‚¨ä¼ é€’çš„æœŸæœ›å¾—åˆ°æ»¡è¶³ã€‚æˆ‘ä»¬æ ¹æ®å°†è¦æ‰§è¡Œçš„ä»»åŠ¡æ¥å®šä¹‰è¶…æ—¶å€¼ã€‚å¯¹äºéœ€è¦ç½‘ç»œæ“ä½œ(å¦‚URLè¯·æ±‚)çš„å¼‚æ­¥ä»»åŠ¡ï¼Œå¯èƒ½éœ€è¦3-5ç§’ã€‚</p><pre class="lo lp lq lr fd ls kb lt lu aw lv bi"><span id="3286" class="kh ki hi kb b fi lw lx l ly lz"><strong class="kb hj">func</strong> test_asyncFunction_didFulfill() {<br/>   <strong class="kb hj">let</strong> exp1 = <br/>      expectation(description: "Wait for async function to complete")<br/>   <strong class="kb hj">let</strong> exp2 = <br/>      expectation(description: "Wait for another async function to complete")</span><span id="1998" class="kh ki hi kb b fi ma lx l ly lz">   //Async actions call</span><span id="cf4d" class="kh ki hi kb b fi ma lx l ly lz">   // Our function is on hold and waiting for the expectations to be   fulfilled when it reaches this line<br/>   <strong class="kb hj">wait</strong>(for: [exp1, exp2], timeout: 2.0)</span><span id="549d" class="kh ki hi kb b fi ma lx l ly lz">   //Once our expectations are fulfilled our function continues its execution to this block</span><span id="0449" class="kh ki hi kb b fi ma lx l ly lz">}</span></pre><p id="692e" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">å¦‚æœç”±äºä»»ä½•åŸå› ï¼Œæˆ‘ä»¬åœ¨å‰é¢çš„ä¾‹å­ä¸­å£°æ˜çš„æœŸæœ›æ²¡æœ‰å®ç°ï¼Œæˆ‘ä»¬çš„æµ‹è¯•å°†å¤±è´¥ï¼Œæˆ‘ä»¬å°†æ”¶åˆ°ä¸‹ä¸€æ¡æ¶ˆæ¯:</p><blockquote class="lh li lj"><p id="32da" class="ir is lk it b iu iv iw ix iy iz ja jb ll jd je jf lm jh ji jj ln jl jm jn jo hb bi translated">å¼‚æ­¥ç­‰å¾…å¤±è´¥:è¶…è¿‡2ç§’çš„è¶…æ—¶ï¼Œæœªè¾¾åˆ°é¢„æœŸ:â€œç­‰å¾…å¼‚æ­¥å‡½æ•°å®Œæˆâ€ã€â€œç­‰å¾…å¦ä¸€ä¸ªå¼‚æ­¥å‡½æ•°å®Œæˆâ€ã€‚</p></blockquote><p id="35de" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">å…³äºç­‰å¾…æ–¹æ³•çš„å¦ä¸€ä¸ªé‡è¦çš„äº‹æƒ…æ˜¯ï¼ŒæœŸæœ›å®ç°çš„é¡ºåºå¹¶ä¸é‡è¦ã€‚å¦‚æœæ‚¨çš„æµ‹è¯•è¦æ±‚æœŸæœ›ä»¥ç‰¹å®šé¡ºåºå®ç°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸‹ä¸€ä¸ªæ–¹æ³•é‡è½½:</p><pre class="lo lp lq lr fd ls kb lt lu aw lv bi"><span id="3efb" class="kh ki hi kb b fi lw lx l ly lz">func <strong class="kb hj">wait</strong>(for expectations: [<a class="ae iq" href="https://developer.apple.com/documentation/xctest/xctestexpectation" rel="noopener ugc nofollow" target="_blank">XCTestExpectation</a>], <br/>  timeout seconds: <a class="ae iq" href="https://developer.apple.com/documentation/foundation/timeinterval" rel="noopener ugc nofollow" target="_blank">TimeInterval</a>, <br/>enforceOrder enforceOrderOfFulfillment: <a class="ae iq" href="https://developer.apple.com/documentation/swift/bool" rel="noopener ugc nofollow" target="_blank">Bool</a>)</span></pre><h2 id="5256" class="kh ki hi bd kj kk kl km kn ko kp kq kr jc ks kt ku jg kv kw kx jk ky kz la lb bi translated">Authenticatorç±»ç¤ºä¾‹</h2><p id="ac79" class="pw-post-body-paragraph ir is hi it b iu lc iw ix iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo hb bi translated"><code class="du jy jz ka kb b">Authenticator</code>ç±»å°†å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£ä¹‹å‰æè¿°çš„åŠ¨åŠ›å­¦ã€‚æˆ‘ä»¬çš„ç±»éå¸¸ç®€å•ï¼Œå®ƒåªæœ‰ä¸€ä¸ª<code class="du jy jz ka kb b">signIn</code>æ–¹æ³•ã€‚<code class="du jy jz ka kb b">signIn</code>æ–¹æ³•å°†æ‰§è¡Œä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œå®ƒæœ‰ä¸€ä¸ªæ‚²ä¼¤è·¯å¾„å’Œä¸€ä¸ªå¿«ä¹è·¯å¾„ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å°†ä¸ºå®ƒä»¬ä¸­çš„æ¯ä¸€ä¸ªå†™ä¸€ä¸ªæµ‹è¯•ã€‚</p><pre class="lo lp lq lr fd ls kb lt lu aw lv bi"><span id="9491" class="kh ki hi kb b fi lw lx l ly lz"><strong class="kb hj">class</strong> Authenticator {</span><span id="1e22" class="kh ki hi kb b fi ma lx l ly lz"><strong class="kb hj">   enum</strong> Result: Equatable {<br/>      <strong class="kb hj">case</strong> success<br/>      <strong class="kb hj">case</strong> fail(Error)<br/>   }</span><span id="2e93" class="kh ki hi kb b fi ma lx l ly lz"><strong class="kb hj">   enum</strong> Error: Swift.Error {<br/>      <strong class="kb hj">case</strong> imcompleteData<br/>   }</span><span id="d7d6" class="kh ki hi kb b fi ma lx l ly lz"><strong class="kb hj">   func</strong> signIn(email: String, password: String, completion: <strong class="kb hj">@escaping</strong> (Result) -&gt; Void) {</span><span id="615d" class="kh ki hi kb b fi ma lx l ly lz"><strong class="kb hj">      guard</strong> !email.isEmpty, !password.isEmpty <strong class="kb hj">else</strong> {<br/>         completion(.fail(.imcompleteData))<br/>         <strong class="kb hj">return<br/>      </strong>}</span><span id="8ce5" class="kh ki hi kb b fi ma lx l ly lz">      completion(.success)<br/>   }</span><span id="9ee2" class="kh ki hi kb b fi ma lx l ly lz">}</span></pre><p id="e906" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">è®©æˆ‘ä»¬ä»sadè·¯å¾„æµ‹è¯•å¼€å§‹ï¼Œå¦‚æœç”µå­é‚®ä»¶æˆ–å¯†ç ä¸ºç©ºï¼Œ<code class="du jy jz ka kb b">signIn</code>æ–¹æ³•ä¼šäº§ç”Ÿä¸€ä¸ª<code class="du jy jz ka kb b">incompleteData</code>é”™è¯¯ã€‚</p><pre class="lo lp lq lr fd ls kb lt lu aw lv bi"><span id="2038" class="kh ki hi kb b fi lw lx l ly lz"><strong class="kb hj">func</strong> test_signIn_withEmptyEmailOrPasswordDeliversIncompleteDataError() {</span><span id="d018" class="kh ki hi kb b fi ma lx l ly lz">   //Given<br/>   <strong class="kb hj">let</strong> sut = Authenticator()<br/>   <strong class="kb hj">let</strong> email = ""<br/>   <strong class="kb hj">let</strong> password = ""</span><span id="fabd" class="kh ki hi kb b fi ma lx l ly lz">   //When<br/>   authenticator.signIn(email: email, <br/>                        password: password) { result <strong class="kb hj">in<br/>   </strong>}</span><span id="de4c" class="kh ki hi kb b fi ma lx l ly lz">}</span></pre><p id="179d" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œåˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å·²ç»ç»™å‡ºäº†æˆ‘ä»¬çš„ç»™å®šå’Œæˆ‘ä»¬çš„ä½•æ—¶ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶ç¼ºå°‘ä¸€äº›ä¸œè¥¿ã€‚æˆ‘ä»¬çš„<code class="du jy jz ka kb b">signIn</code>å‡½æ•°æ˜¯å¼‚æ­¥çš„ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªæœŸæœ›å¹¶ç­‰å¾…è¿™ä¸ªæœŸæœ›å®ç°ã€‚ç°åœ¨çš„é—®é¢˜æ˜¯:</p><ol class=""><li id="2170" class="jp jq hi it b iu iv iy iz jc jr jg js jk jt jo ju jv jw jx bi translated">æˆ‘ä»¬åœ¨å“ªé‡Œå®ç°æˆ‘ä»¬çš„æœŸæœ›ï¼Ÿå’Œ</li><li id="3343" class="jp jq hi it b iu kc iy kd jc ke jg kf jk kg jo ju jv jw jx bi translated">æˆ‘ä»¬åœ¨å“ªé‡Œç­‰å¾…æˆ‘ä»¬çš„æœŸæœ›å®Œæˆï¼Ÿ</li></ol><p id="2abd" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">æˆ‘ä»¬çŸ¥é“ï¼Œå½“æˆ‘ä»¬ä½œä¸ºå‚æ•°ä¼ é€’çš„é—­åŒ…è¢«æ‰§è¡Œæ—¶ï¼Œ<code class="du jy jz ka kb b">singIn</code>å‡½æ•°å°±å®Œæˆäº†ï¼Œå› æ­¤ï¼Œé—­åŒ…å°±æ˜¯æˆ‘ä»¬å®ç°é¢„æœŸçš„åœ°æ–¹ã€‚</p><p id="92da" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">æˆ‘ä»¬å°†é€šè¿‡è°ƒç”¨<code class="du jy jz ka kb b">wait</code>æ–¹æ³•ï¼Œåœ¨å¼‚æ­¥å‡½æ•°è°ƒç”¨ä¹‹åç«‹å³ç­‰å¾…æˆ‘ä»¬çš„æœŸæœ›å®ç°ã€‚<code class="du jy jz ka kb b">wait</code>æ–¹æ³•â€œå†»ç»“â€æˆ‘ä»¬çš„æºä»£ç ï¼Œç›´åˆ°æ‚¨ä½œä¸ºå‚æ•°ä¼ é€’çš„æœŸæœ›å®ç°ã€‚å¦‚æœæˆ‘ä»¬åœ¨å¼‚æ­¥å‡½æ•°ä¹‹å‰è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å°†åœ¨æµ‹è¯•ä¸­æ”¶åˆ°ä¸€ä¸ªè¶…æ—¶é”™è¯¯ã€‚</p><pre class="lo lp lq lr fd ls kb lt lu aw lv bi"><span id="1b72" class="kh ki hi kb b fi lw lx l ly lz"><strong class="kb hj">func</strong> test_signIn_withEmptyEmailOrPasswordDeliversIncompleteDataError() {</span><span id="82d3" class="kh ki hi kb b fi ma lx l ly lz">   <em class="lk">//Given</em><br/>   <strong class="kb hj">let</strong> sut = Authenticator()<br/>   <strong class="kb hj">let</strong> email = ""<br/>   <strong class="kb hj">let</strong> password = ""</span><span id="064e" class="kh ki hi kb b fi ma lx l ly lz">  <em class="lk"> //When<br/>   //Expectation declaration</em><br/>   <strong class="kb hj">let</strong> exp = <br/>      expectation(description: "Wait for async signIn to complete")<br/>   authenticator.signIn(email: email, <br/>                        password: password) { result <strong class="kb hj">in<br/>      </strong><em class="lk">//Fulfill expectation from signIn completion block</em><strong class="kb hj"><br/>      </strong>exp.fulfill()<br/>   }</span><span id="a319" class="kh ki hi kb b fi ma lx l ly lz">   <em class="lk">//Freeze the function execution until we fulfill our expectation<br/>   //This could take a second or less</em><strong class="kb hj"><em class="lk"><br/>   </em></strong>wait(for: [exp], timeout: 1.0)<br/>}</span></pre><p id="c45a" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">å¤ªå¥½äº†ï¼æˆ‘ä»¬æœ‰ä¸€ä¸ªé€šè¿‡æµ‹è¯•ï¼Œæˆ‘ä»¬ç¡®ä¿æˆ‘ä»¬ä¸ä¼šå¾—åˆ°ä»»ä½•è¶…æ—¶é”™è¯¯ï¼Œå› ä¸ºæˆ‘ä»¬æ­£åœ¨æ»¡è¶³æˆ‘ä»¬çš„æœŸæœ›ã€‚æˆ‘ä»¬ä»ç„¶ç¼ºå°‘æˆ‘ä»¬çš„æ–­è¨€æ¥ç¡®ä¿æˆ‘ä»¬æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„æµ‹è¯•ã€‚æˆ‘ä»¬å°†åœ¨<code class="du jy jz ka kb b">singIn</code>å®Œæˆå—ä¸­æ·»åŠ æ–­è¨€(ç›®å‰å¯ä»¥å·¥ä½œ)ğŸ™‚).</p><pre class="lo lp lq lr fd ls kb lt lu aw lv bi"><span id="472f" class="kh ki hi kb b fi lw lx l ly lz"><strong class="kb hj">func</strong> test_signIn_withEmptyEmailOrPasswordDeliversIncompleteDataError() {</span><span id="bd6b" class="kh ki hi kb b fi ma lx l ly lz">   <em class="lk">//Given</em><br/>   <strong class="kb hj">let</strong> sut = Authenticator()<br/>   <strong class="kb hj">let</strong> email = ""<br/>   <strong class="kb hj">let</strong> password = ""</span><span id="fb18" class="kh ki hi kb b fi ma lx l ly lz">   <em class="lk">//When</em><br/>   <strong class="kb hj">let</strong> exp = <br/>      expectation(description: "Wait for async signIn to complete")<br/>   authenticator.signIn(email: email, <br/>                        password: password) { result <strong class="kb hj">in<br/>      </strong><em class="lk">//Then</em><br/>      XCTAssertEqual(result, .fail(.imcompleteData))</span><span id="c106" class="kh ki hi kb b fi ma lx l ly lz">      exp.fulfill()<br/>   }</span><span id="5f76" class="kh ki hi kb b fi ma lx l ly lz">   wait(for: [exp], timeout: 1.0)<br/>}</span></pre><p id="a73f" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">å¤ªå¥½äº†ï¼æˆ‘ä»¬ç”¨è¿™ä¸ªæµ‹è¯•è¦†ç›–äº†æ‚²ä¼¤çš„é“è·¯ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæµ‹è¯•æ¥è¦†ç›–å¹¸ç¦ä¹‹è·¯ã€‚</p><pre class="lo lp lq lr fd ls kb lt lu aw lv bi"><span id="492b" class="kh ki hi kb b fi lw lx l ly lz"><strong class="kb hj">func</strong> test_signIn_withEmailAndPasswordAuthenticatesTheUser() {<br/>   <strong class="kb hj">//Given<br/>   let</strong> sut = Authenticator()<br/>   <strong class="kb hj">let</strong> email = "my-email@my-domain.com"<br/>   <strong class="kb hj">let</strong> password = "my-password"</span><span id="7943" class="kh ki hi kb b fi ma lx l ly lz"><strong class="kb hj">   //When<br/>   let</strong> exp = <br/>      expectation(description: "Wait for async signIn to complete")<br/>   authenticator.signIn(email: email, <br/>                        password: password) { result <strong class="kb hj">in<br/>      </strong>//Then<br/>      XCTAssertEqual(result, .success)</span><span id="1e35" class="kh ki hi kb b fi ma lx l ly lz">      exp.fulfill()<br/>   }</span><span id="cccd" class="kh ki hi kb b fi ma lx l ly lz">   wait(for: [exp], timeout: 1.0)<br/>}</span></pre><p id="4d5b" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">å¤ªå¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»é€šè¿‡äº†ä¸¤æ¡è·¯å¾„çš„æµ‹è¯•ï¼ä½†åœ¨æˆ‘çœ‹æ¥ï¼Œæˆ‘ä»¬åœ¨é‡å¤è‡ªå·±ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹è¿›è¿™ä¸¤é¡¹æµ‹è¯•ã€‚å¦‚æ‚¨æ‰€è§ï¼Œä¸¤ä¸ªæµ‹è¯•å‡½æ•°éƒ½æ˜¯:</p><ol class=""><li id="c685" class="jp jq hi it b iu iv iy iz jc jr jg js jk jt jo ju jv jw jx bi translated">å®£å¸ƒä¸€ä¸ªæœŸæœ›ï¼Œ</li><li id="3d94" class="jp jq hi it b iu kc iy kd jc ke jg kf jk kg jo ju jv jw jx bi translated">è°ƒç”¨<code class="du jy jz ka kb b">signIn</code>æ–¹æ³•ï¼Œ</li><li id="51a1" class="jp jq hi it b iu kc iy kd jc ke jg kf jk kg jo ju jv jw jx bi translated">ç­‰å¾…æœŸæœ›çš„å®ç°ï¼Œæœ€åï¼Œ</li><li id="1e80" class="jp jq hi it b iu kc iy kd jc ke jg kf jk kg jo ju jv jw jx bi translated">åšä¸€äº›æ–­è¨€ã€‚</li></ol><p id="b9f3" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ä¸­æå–æ‰€æœ‰è¿™äº›ä»»åŠ¡ã€‚æˆ‘ä»¬çš„å‡½æ•°å°†æ¥æ”¶æˆ‘ä»¬çš„SUT(è¢«æµ‹ç³»ç»Ÿ)ï¼Œåœ¨æœ¬ä¾‹ä¸­æ˜¯ä¸€ä¸ª<code class="du jy jz ka kb b">Authenticator</code>å®ä¾‹ã€<code class="du jy jz ka kb b">email</code>ã€<code class="du jy jz ka kb b">password</code>ï¼Œæœ€åæ˜¯é¢„æœŸçš„ç»“æœã€‚ç”±äºæˆ‘ä»¬å°†åœ¨è¿™ä¸ªå‡½æ•°ä¸­åšä¸€äº›æ–­è¨€ï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»ä¼ é€’<code class="du jy jz ka kb b">file</code>å’Œ<code class="du jy jz ka kb b">line</code>ï¼Œä»¥ä¾¿XCodeå‘æˆ‘ä»¬æ˜¾ç¤ºå¯èƒ½å¤±è´¥çš„æ­£ç¡®è¡Œã€‚</p><pre class="lo lp lq lr fd ls kb lt lu aw lv bi"><span id="ee00" class="kh ki hi kb b fi lw lx l ly lz"><strong class="kb hj">func</strong> test_signIn_withEmailAndPasswordAuthenticatesTheUser() {<br/>   <strong class="kb hj">let</strong> email = "my-email@my-domain.com"<br/>   <strong class="kb hj">let</strong> password = "my-password"</span><span id="5c2a" class="kh ki hi kb b fi ma lx l ly lz">   expect(Authenticator(), <br/>          email: email, <br/>          password: password,   <br/>          toCompleteWith: .success)<br/>}</span><span id="ffd4" class="kh ki hi kb b fi ma lx l ly lz"><strong class="kb hj">func</strong> test_signIn_withEmptyEmailOrPasswordDeliversIncompleteDataError() {<br/>   <strong class="kb hj">let</strong> email = ""<br/>   <strong class="kb hj">let</strong> password = ""</span><span id="2c26" class="kh ki hi kb b fi ma lx l ly lz">   expect(Authenticator(), <br/>          email: email, <br/>          password: password, <br/>          toCompleteWith: .fail(.imcompleteData))<br/>}</span><span id="2216" class="kh ki hi kb b fi ma lx l ly lz">// MARK:<strong class="kb hj"> - Helper</strong></span><span id="4c56" class="kh ki hi kb b fi ma lx l ly lz"><strong class="kb hj">private</strong> <strong class="kb hj">func</strong> expect(<strong class="kb hj">_</strong> sut: Authenticator, <br/>                    email: String, <br/>                    password: String, <br/>                    toCompleteWith expectedResult: Authenticator.Result, <br/>                    file: StaticString = <strong class="kb hj">#filePath</strong>, <br/>                    line: UInt = <strong class="kb hj">#line</strong>) {</span><span id="221a" class="kh ki hi kb b fi ma lx l ly lz"><strong class="kb hj">   let</strong> exp = <br/>      expectation(description: "Wait for async signIn to complete")<br/>   sut.signIn(email: email, password: password) { receivedResult <strong class="kb hj">in<br/>      </strong>XCTAssertEqual(expectedResult, <br/>                     receivedResult, <br/>                     "Expecting \(expectedResult) got \(receivedResult) instead", <br/>                     file: file, <br/>                     line: line)</span><span id="5677" class="kh ki hi kb b fi ma lx l ly lz">      exp.fulfill()<br/>   }</span><span id="672a" class="kh ki hi kb b fi ma lx l ly lz">   wait(for: [exp], timeout: 1.0)<br/>}</span></pre><p id="d8b9" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">ç°åœ¨æˆ‘ä»¬çš„æµ‹è¯•æ›´å¹²å‡€ï¼Œæ›´å®¹æ˜“ç†è§£ä»–ä»¬åœ¨åšä»€ä¹ˆï¼</p><p id="b1dc" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">æˆ‘ä»¬è¿˜å¯ä»¥éµå¾ªå¦ä¸€ç§æ–¹æ³•ã€‚å‡è®¾æˆ‘ä»¬æƒ³ä»æµ‹è¯•å‡½æ•°ä¸­å¾—åˆ°æ–­è¨€ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªåŠ©æ‰‹æ–¹æ³•æ¥è¿”å›<code class="du jy jz ka kb b">signIn</code>ç»“æœã€‚è¿™å¬èµ·æ¥åƒæ˜¯ä¸€ä¸ªä¸å¯èƒ½çš„ä»»åŠ¡ï¼Œä¸æ˜¯å—ï¼Ÿè°ƒç”¨å¼‚æ­¥å‡½æ•°ï¼Œç„¶åè¿”å›å®ƒçš„å€¼ã€‚ä½ è¿˜è®°å¾—æˆ‘ä»¬æåˆ°è¿‡è°ƒç”¨<code class="du jy jz ka kb b">wait</code>æ–¹æ³•ä¼šå†»ç»“ä½ çš„ä»£ç å—ï¼Ÿè¿™å°†å¸®åŠ©æˆ‘ä»¬è·å¾—<code class="du jy jz ka kb b">signIn</code>ç»“æœå¹¶è¿”å›å®ƒã€‚</p><pre class="lo lp lq lr fd ls kb lt lu aw lv bi"><span id="e12f" class="kh ki hi kb b fi lw lx l ly lz"><strong class="kb hj">func</strong> test_signIn_withEmailAndPasswordAuthenticatesTheUser() {<br/>   <strong class="kb hj">let</strong> email = "my-email@my-domain.com"<br/>   <strong class="kb hj">let</strong> password = "my-password"</span><span id="5673" class="kh ki hi kb b fi ma lx l ly lz"><strong class="kb hj">   let</strong> receivedResult = <br/>      resultFor(Authenticator(), email: email, password: password)</span><span id="904c" class="kh ki hi kb b fi ma lx l ly lz">   XCTAssertEqual(receivedResult, .success)<br/>}</span><span id="f72e" class="kh ki hi kb b fi ma lx l ly lz"><strong class="kb hj">func</strong> test_signIn_withEmptyEmailOrPasswordDeliversIncompleteDataError() {<br/>   <strong class="kb hj">let</strong> email = ""<br/>   <strong class="kb hj">let</strong> password = ""</span><span id="29c8" class="kh ki hi kb b fi ma lx l ly lz"><strong class="kb hj">   let</strong> receivedResult = <br/>      resultFor(Authenticator(), email: email, password: password)</span><span id="8497" class="kh ki hi kb b fi ma lx l ly lz">   XCTAssertEqual(receivedResult, .fail(.imcompleteData))<br/>}</span><span id="e6c6" class="kh ki hi kb b fi ma lx l ly lz">// MARK:<strong class="kb hj"> - Helper</strong></span><span id="ed28" class="kh ki hi kb b fi ma lx l ly lz"><strong class="kb hj">private</strong> <strong class="kb hj">func</strong> resultFor(<strong class="kb hj">_</strong> sut: Authenticator,<br/>                       email: String,<br/>                       password: String) -&gt; Authenticator.Result? {</span><span id="9ea0" class="kh ki hi kb b fi ma lx l ly lz"><strong class="kb hj">   let</strong> exp = <br/>      expectation(description: "Wait for async signIn to complete")</span><span id="d30d" class="kh ki hi kb b fi ma lx l ly lz"><strong class="kb hj">   var</strong> result: Authenticator.Result?<br/>   sut.signIn(email: email, password: password) { receivedResult <strong class="kb hj">in<br/>      </strong>result = receivedResult<br/>      exp.fulfill()<br/>   }</span><span id="484e" class="kh ki hi kb b fi ma lx l ly lz">   wait(for: [exp], timeout: 1.0)</span><span id="2e5e" class="kh ki hi kb b fi ma lx l ly lz"><strong class="kb hj">   return</strong> result</span><span id="e639" class="kh ki hi kb b fi ma lx l ly lz">}</span></pre><p id="1055" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">æˆ‘ä»¬ä»ç„¶é€šè¿‡äº†ä¸¤æ¡è·¯å¾„çš„æµ‹è¯•ï¼å¦‚æ‚¨æ‰€è§,<code class="du jy jz ka kb b">resultFor</code>å‡½æ•°è°ƒç”¨<code class="du jy jz ka kb b">singIn</code>å‡½æ•°ï¼Œç„¶åç­‰å¾…æœŸæœ›å®ç°ã€‚ä¸€æ—¦æœŸæœ›å®ç°ï¼Œå‡½æ•°å¯ä»¥ç»§ç»­æ‰§è¡Œåˆ°<code class="du jy jz ka kb b">return result</code>è¡Œã€‚</p><p id="0c1e" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">è¿™ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥æœ‰æ•ˆåœ°ä½¿ç”¨ï¼Œå¹¶å¸®åŠ©æˆ‘ä»¬ä¿æŒæµ‹è¯•æºä»£ç çš„æ•´æ´ã€‚</p></div></div>    
</body>
</html>