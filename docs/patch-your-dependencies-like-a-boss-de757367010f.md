# åƒè€æ¿ä¸€æ ·ä¿®è¡¥ä½ çš„ä¾èµ–

> åŸæ–‡ï¼š<https://medium.com/geekculture/patch-your-dependencies-like-a-boss-de757367010f?source=collection_archive---------5----------------------->

![](img/d8e08260032b9a64a3d95c5c95ab1fe6.png)

Photo by [Pixabay](https://www.pexels.com/@pixabay?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels) from [Pexels](https://www.pexels.com/photo/battle-black-blur-board-game-260024/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)

# ä»€ä¹ˆæ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•&ä¸ºä»€ä¹ˆä½ éœ€è¦å®ƒï¼Ÿ

æ— è®ºä½•æ—¶ä½ åœ¨ç¼–å†™ä¸€ä¸ª python åº”ç”¨ç¨‹åºï¼Œæ— è®ºæ˜¯ä¸€ä¸ª web åº”ç”¨ç¨‹åºï¼Œä¸€ä¸ªåº“ï¼Œä¸€ä¸ªæœºå™¨å­¦ä¹ ç®—æ³•ç­‰ç­‰ã€‚ä½ æœ€ç»ˆä¼šæµ‹è¯•ä½ çš„ä»£ç ï¼Œæˆ‘ä¸æ˜¯åœ¨è¯´æ‰‹å·¥æµ‹è¯•ï¼Œä¼™è®¡ï¼›æˆ‘ä»¬æ­£åœ¨åšè‡ªåŠ¨åŒ–æµ‹è¯•é£æ ¼å“Ÿï¼

è‡ªåŠ¨åŒ–æµ‹è¯•ä½¿æœªæ¥çš„å˜åŒ–æ›´æ˜“äºç®¡ç†ï¼Œå°±ç›®å‰ä¸ºæ­¢å·²ç»ç ´åçš„å†…å®¹è€Œè¨€ã€‚å®ƒè¿˜ä½¿å¼€ç®±å³ç”¨çš„ä»£ç æ–‡æ¡£å˜å¾—æ¸…æ™°ã€‚å¦‚æœä½ ä¸æ»¡æ„ä¸ºä»€ä¹ˆè‡ªåŠ¨åŒ–æµ‹è¯•å¯¹ä½ æœ‰å¥½å¤„ï¼Œæ£€æŸ¥ä¸€ä¸‹[è¿™ä¸ªé“¾æ¥](https://www.testim.io/blog/test-automation-benefits/)å’Œæˆ‘åœ¨æœ¬æ–‡æœ«å°¾æä¾›ç»™ä½ çš„é“¾æ¥ã€‚

ç°åœ¨æˆ‘ä»¬åœ¨è‡ªåŠ¨åŒ–æµ‹è¯•æ˜¯ä»¤äººæ•¬ç•çš„è¿™ä¸€ç‚¹ä¸Šè¾¾æˆäº†ä¸€è‡´(æˆ‘ä»¬æ˜¯ï¼Œä¸æ˜¯å—ï¼Ÿ)ï¼Œè®©æˆ‘ä»¬æ·±å…¥ç ”ç©¶æ›´é‡è¦çš„ä¸œè¥¿ã€‚å…¶ä¸­ä¹‹ä¸€æ˜¯å¦‚ä½•ä¿®è¡¥å•å…ƒæµ‹è¯•ä¸­çš„ä¾èµ–å…³ç³»ã€‚

> [å•å…ƒæµ‹è¯•æ˜¯ä½ è‡ªåŠ¨åŒ–æµ‹è¯•çš„ç¬¬ä¸€æ­¥](https://www.testim.io/blog/test-automation-pyramid-a-simple-strategy-for-your-tests/)ï¼Œæœ‰ä¸€äº›å…³äºâ€œæˆ‘ä»¬æ˜¯å¦åº”è¯¥è·³è¿‡å®ƒä»¬å¹¶è·³åˆ°é›†æˆæµ‹è¯•â€çš„äº‰è®ºï¼Œä½†è¿™ä¸æ˜¯æœ¬æ–‡çš„ä¸»é¢˜ï¼Œä½ å¯ä»¥ä½¿ç”¨æœ¬é¡µåº•éƒ¨æä¾›çš„é“¾æ¥è‡ªè¡Œè§£å†³ã€‚

![](img/c54a18289619661f61495f9ec130d682.png)

Photo by [Wes Hicks](https://unsplash.com/@sickhews?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) on [Unsplash](https://unsplash.com/s/photos/learning?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)

# é‚£ä¹ˆä»€ä¹ˆæ˜¯â€œä¿®è¡¥â€å‘¢ï¼ŸğŸ¤”

åˆ†äº«ä¸€ç‚¹ä¸ªäººç»éªŒï¼Œæˆ‘ä¸å¾—ä¸è¯´ï¼Œä¿®è¡¥ä¾èµ–å…³ç³»æ˜¯æˆ‘é•¿æœŸä»¥æ¥çš„ä¸»è¦å…³æ³¨ç‚¹ï¼Œç°åœ¨æˆ‘ç»ˆäºæ‰¾åˆ°äº†ä¸€ç§ä¼˜é›…çš„æ–¹æ³•æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æ„Ÿåˆ°éå¸¸å…´å¥‹ï¼›æˆ‘åœ¨è¿™é‡Œå¼€å§‹å†™å®ƒçš„ä¸»è¦åŸå› ã€‚

ç°åœ¨ï¼Œä¸ºäº†æ„Ÿå—ä¸€ä¸‹æˆ‘ä»¬åœ¨è¿™é‡Œè¯•å›¾è§£å†³çš„é—®é¢˜ï¼Œå‡è®¾æ‚¨æœ‰ä¸€ä¸ªæœåŠ¡ï¼Œå®ƒæ¥æ”¶æ¥è‡ªç”¨æˆ·çš„è¾“å…¥ï¼Œè¿›è¡Œä¸€äº›å¤–éƒ¨ API è°ƒç”¨&åœ¨è¿›è¡Œä¸€äº›å¤„ç†ä¹‹åï¼Œè¿”å›æœ€ç»ˆç»“æœã€‚

åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œä¸ºäº†æµ‹è¯•æ‚¨çš„åº”ç”¨ç¨‹åºï¼Œæ¯å½“æ‚¨çš„æµ‹è¯•åœ¨æœ¬åœ°æˆ–è€…åœ¨æ‚¨çš„[ç®¡é“](https://phoenixnap.com/blog/what-is-ci-cd)ä¸­è¿è¡Œæ—¶ï¼Œå¤–éƒ¨ API è°ƒç”¨å¿…é¡»æ˜¯å¯ç”¨çš„ã€‚

ä½†æ˜¯å¦‚æœä½ çš„ç½‘ç»œè¿æ¥å¤ªæ…¢æ€ä¹ˆåŠï¼Ÿæˆ–è€…ï¼Œå¦‚æœè¿è¡Œæ‚¨çš„æµ‹è¯•çš„æœºå™¨ä¸èƒ½è®¿é—®äº’è”ç½‘å‘¢ï¼Ÿè¿˜æœ‰ä¸€ç§å¯èƒ½æ€§æ˜¯ï¼Œç›®æ ‡ç½‘ç«™å¯èƒ½å·²ç»å…³é—­[ï¼Œæ— æ³•è®¿é—®](https://www.javatpoint.com/software-engineering-software-failure-mechanisms)ã€‚

åŒæ ·çš„ä¾‹å­ä¹Ÿé€‚ç”¨äºä¸æ•°æ®åº“çš„äº¤äº’ã€‚æ¯æ¬¡ä½ éœ€è¦æµ‹è¯•ä½ çš„åº”ç”¨ç¨‹åºçš„æ—¶å€™å»ºç«‹ä¸€ä¸ªæ•°æ®åº“æœåŠ¡å™¨å¯èƒ½æˆæœ¬å¤ªé«˜ã€‚

é™¤éä½ æ­£åœ¨è¿è¡Œ[é›†æˆæµ‹è¯•](https://www.testingxperts.com/blog/what-is-integration-testing)ï¼Œè¿™è¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ï¼Œç°åœ¨æ˜¯å€ŸåŠ©è¡¥ä¸è§£å†³[å•å…ƒæµ‹è¯•çš„å¥½æ—¶æœºã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†æ¨¡æ‹Ÿä¸€ä¸ªæ¥è‡ªç›®æ ‡çš„ç»“æœï¼Œä½¿å®ƒçœ‹èµ·æ¥åƒæ˜¯ä¾èµ–å…³ç³»æ­£åœ¨è¿”å›æ‚¨æƒ³è¦çš„ç»“æœï¼›è¿™ä½¿å¾—ç”¨è¡¥ä¸ç»“æœæµ‹è¯•å®é™…åº”ç”¨ç¨‹åºæˆä¸ºå¯èƒ½ã€‚](https://www.geeksforgeeks.org/python-unit-test-objects-patching-set-1/)

> [æ‰“è¡¥ä¸](https://docs.python.org/3/library/unittest.mock.html#the-patchers)æ˜¯æ¨¡ä»¿å¤–éƒ¨ä¾èµ–çš„è¡Œä¸ºï¼Œæ¯”å¦‚æ•°æ®åº“ã€äº’è”ç½‘ä¸Šçš„ API è°ƒç”¨ï¼Œç”šè‡³æ˜¯åº“è°ƒç”¨ï¼Œä½¿å®ƒçœ‹èµ·æ¥åƒæ˜¯è¿”å›äº†æˆ‘ä»¬ç»™å®ƒçš„ä¸œè¥¿ã€‚

# ç©ºè°ˆæ˜¯å»‰ä»·çš„ï¼Œç»™æˆ‘çœ‹çœ‹ä»£ç ğŸ˜¶

å¦‚æœä¸Šé¢çš„ä»‹ç»æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œè¯·è€å¿ƒç­‰å¾…ï¼Œå› ä¸ºæˆ‘ä»¬å°†åœ¨ä¸‹é¢å¾—åˆ°å‡ ä¸ªä¾‹å­ï¼Œä»¥ç¡®ä¿ä¸€åˆ‡éƒ½æ­£ç¡®æ— è¯¯ã€‚

æ­£å¦‚ä½ ä»ä¸Šé¢çœ‹åˆ°çš„ï¼Œæˆ‘éœ€è¦æ¨¡ä»¿ä¸€ä¸ªå¤–éƒ¨åº“ã€‚è¿™ä½¿æˆ‘èƒ½å¤Ÿç»•è¿‡é€šè¿‡äº’è”ç½‘ä¼ è¾“çš„å®é™…è¯·æ±‚ï¼Œç»“æœï¼Œæˆ‘åªæµ‹è¯•äº†åº”ç”¨ç¨‹åºï¼›è¿™å¯¹æˆ‘æ¥è¯´éå¸¸é‡è¦ï¼Œå› ä¸ºæˆ‘å¸Œæœ›ç¡®ä¿æˆ‘çš„åº”ç”¨ç¨‹åºæ­£å¸¸å·¥ä½œ*ï¼Œå¦‚æœæ‰€æœ‰å¤–éƒ¨åº“éƒ½æ— ç¼è¿è¡Œ*ã€‚

å®ƒä¹Ÿä½¿ä½ èƒ½å¤Ÿ[æµ‹é‡ä½ çš„è¦†ç›–èŒƒå›´](https://coverage.readthedocs.io/)ä»¥æŸ¥çœ‹æ˜¯å¦å­˜åœ¨[æ­»ä»£ç ](https://en.wikipedia.org/wiki/Dead_code)ã€‚

æµ‹è¯•æ–¹æ³•çš„å‚æ•°`monkeypatch`æ˜¯ä¸€ä¸ª`pytest`å†…ç½®çš„å¤¹å…·ï¼Œå¦‚æœä½ éœ€è¦çš„è¯ï¼Œä½ å¯ä»¥åœ¨ä½ çš„æ¯ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ä¸­ä½¿ç”¨å®ƒã€‚å®ƒæœ‰å¾ˆå¤šéå¸¸æœ‰ç”¨çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å°†åœ¨æœ¬æ–‡ä¸­è®¨è®ºã€‚å…¶ä¸­æœ€æœ‰ç”¨çš„æ˜¯`setattr`ï¼›å®ƒä½¿å¾—å¯¹ç±»å®ä¾‹æˆ–ç±»æ–¹æ³•çš„ä»»ä½•è®¿é—®éƒ½è¢«é‡å®šå‘åˆ°å®Œå…¨å¯å®šåˆ¶çš„ä¸œè¥¿ã€‚

åœ¨ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘å‡è£…æ›¿æ¢äº†`requests.get`æ¥è¿”å›ä¸€ä¸ªè‡ªå®šä¹‰å¯¹è±¡(`MockStatus`)ã€‚è¿™ä¸ªè‡ªå®šä¹‰å¯¹è±¡æœ‰ä¸€ä¸ªæˆ‘åœ¨ä»£ç `status_code`ä¸­éœ€è¦çš„å®ä¾‹å±æ€§ã€‚å› æ­¤å½“æˆ‘è°ƒç”¨`requests.get(URL).status_code`æ—¶ï¼Œå®ƒå®é™…ä¸Šä¸æ˜¯çœŸæ­£çš„åº“`requests.Response.status_code`ï¼Œè€Œæ˜¯`MockStatus.status_code`ã€‚å¾ˆç¾ï¼Œä¸æ˜¯å—ï¼ŸğŸ˜»

ä»¥ä¸‹æ˜¯æ¥è‡ª[æ–‡æ¡£](https://docs.pytest.org/en/stable/monkeypatch.html)æœ¬èº«çš„å¯ç”¨æ–¹æ³•åˆ—è¡¨:

```
monkeypatch.setattr(obj, name, value, raising=**True**)
monkeypatch.delattr(obj, name, raising=**True**)
monkeypatch.setitem(mapping, name, value)
monkeypatch.delitem(obj, name, raising=**True**)
monkeypatch.setenv(name, value, prepend=**False**)
monkeypatch.delenv(name, raising=**True**)
monkeypatch.syspath_prepend(path)
monkeypatch.chdir(path)
```

**æ³¨æ„** : `setattr`å®ä¾‹æ–¹æ³•æœ‰ä¸¤ä¸ªç­¾å[æ¥æº](https://github.com/pytest-dev/pytest/blob/main/src/_pytest/monkeypatch.py#L158:L224):

1.  ç¬¬ä¸€ä¸ªå’Œæˆ‘ä»¬ä¸Šé¢ä½¿ç”¨çš„ä¸€æ ·ï¼Œä½¿ç”¨ç‚¹åˆ†éš”çš„`modulename.classname.atttibutename`ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œåœ¨ç¬¬äºŒä¸ªå‚æ•°ä¸­ä½¿ç”¨è‡ªå®šä¹‰å€¼ã€‚
2.  ç¬¬äºŒä¸ªæ˜¯ä¼ é€’ä¸€ä¸ªå…·ä½“çš„`object`(è®°ä½ï¼Œ[python ä¸­çš„ä¸€åˆ‡éƒ½æ˜¯å¯¹è±¡](/swlh/everything-is-an-object-in-python-learn-to-use-functions-as-objects-ace7f30e283e))ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¼ é€’è¯¥å¯¹è±¡çš„ä¸€ä¸ªåŒå¼•å·å±æ€§å(`str`)ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œä¼ é€’ä¸€ä¸ªè‡ªå®šä¹‰å€¼ä½œä¸ºæœ€åä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªå‚æ•°ã€‚

æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ä¸ªä¾‹å­ä¸­ä½¿ç”¨è¿™ä¸¤ç§æ–¹æ³•ã€‚æ‰€ä»¥ä¿æŒå†·é™ï¼Œâ€œæ„¿ç†è§£çš„ä¸Šå¸æŒ‡å¼•æˆ‘ä»¬â€ã€‚ğŸ®

# è®©æˆ‘ä»¬è®¤çœŸç‚¹ï¼Œåšç‚¹å®é™…çš„äº‹æƒ…ğŸ˜ƒ

ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹å…¶ä»–çš„ä¾‹å­ã€‚è¿™ä¸€æ¬¡ï¼Œè®©æˆ‘ä»¬è®¤çœŸä¸€ç‚¹ï¼Œåšä¸€äº›æ›´æœ‰ç”¨çš„äº‹æƒ…ã€‚æˆ‘ä»¬èµ°å§ã€‚

æˆ‘åº”è¯¥æé†’ä½ ï¼Œä¸‹ä¸€ä¸ªä¾‹å­æœ‰ç‚¹é•¿ï¼Œä½ å¯èƒ½ä¼šåœ¨ä¸­é—´æ„Ÿåˆ°åŒçƒ¦ã€‚ä½†æ˜¯åœ¨è¿™é‡Œè¯·åŸè°…æˆ‘ï¼Œå› ä¸ºæœ‰ä¸€äº›å®è´µçš„æ•™è®­æ˜¯æˆ‘èŠ±äº†å¾ˆé•¿æ—¶é—´æ‰æ„è¯†åˆ°çš„ã€‚

æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªå…¨åŠŸèƒ½çš„åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨äº†æˆ‘æœ€å–œæ¬¢çš„æ¡†æ¶ã€‚

ä½†æ˜¯é™¤äº†é‚£äº›æ²¡å®Œæ²¡äº†çš„â€œæˆ‘çš„æ¡†æ¶æ¯”ä½ çš„å¥½â€ä¹‹å¤–ï¼Œè®©æˆ‘ä»¬å¸å–æ•™è®­ï¼Œç»§ç»­å‰è¿›ã€‚

æˆ‘è®¤ä¸ºæºä»£ç éå¸¸æ˜æ˜¾ï¼Œä¸éœ€è¦æˆ‘è¯´å¤ªå¤šï¼Œä¹Ÿä¸éœ€è¦æˆ‘æŠŠè¿™ç¯‡æ–‡ç« å†™å¾—å¤ªé•¿ï¼Œè¿™æ ·ä¼šé™ä½æˆ‘æ‹¥æœ‰æ›´å¤šè¯»è€…çš„æœºä¼šğŸ˜ğŸ˜‰ã€‚

ä½†æ˜¯ä½œä¸ºå‚è€ƒï¼Œæˆ‘å°†æ›´æ·±å…¥åœ°ç ”ç©¶å…¶ä¸­ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹:`test_create_new_user_successfully`:

*   `client`å¯¹è±¡åªæ˜¯ FastAPI æœ¬èº«çš„ä¸€ä¸ª[æµ‹è¯•åº”ç”¨ç¨‹åºï¼Œé™¤äº†è®©å®ƒæˆä¸ºæˆ‘åœ¨è¿™ä¸ªå’Œä»»ä½•æœªæ¥ python æ¨¡å—ä¸­çš„æ‰€æœ‰æµ‹è¯•çš„ä¸€ä¸ªå…¨å±€å¯è®¿é—®çš„å¤¹å…·ä¹‹å¤–ï¼Œæˆ‘æ²¡æœ‰åšä»»ä½•ä¿®æ”¹ã€‚](https://fastapi.tiangolo.com/tutorial/testing/)
*   å¦‚å‰æ‰€è¿°ï¼Œ`monkeypatch`æ˜¯ä¸€ä¸ªé™¤äº†`pytest`æœ¬èº«ä¹‹å¤–ä¸éœ€è¦é¢å¤–å®‰è£…çš„å›ºå®šè£…ç½®ã€‚æŸ¥çœ‹æ–‡æ¡£ä»¥è·å¾—å®Œæ•´çš„ API å‚è€ƒã€‚æ‰€ä»¥åœ¨æ¯ä¸ªæµ‹è¯•æ¡ˆä¾‹ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°æˆ‘åœ¨æ¨¡ä»¿æ•°æ®åº“ï¼Œè®©å®ƒâ€œçœ‹èµ·æ¥â€æ•°æ®åº“å·²ç»å‘åº”ç”¨ç¨‹åºè¿”å›äº†ä¸€äº›ä¸œè¥¿ï¼Œå¹¶æµ‹è¯•æºä»£ç æ˜¯å¦å¯ä»¥å®é™…å¤„ç†è¢«æ¨¡ä»¿çš„å¯¹è±¡ã€‚
*   é¦–å…ˆï¼Œæˆ‘æ­£åœ¨ä¿®è¡¥ SQLAlchemy `Query`å¯¹è±¡çš„`first`æ–¹æ³•ï¼›`Query.first`æ˜¯å¦ç­‰åŒäº[ç±»ä¼¼äºè¿™ä¸ª](https://docs.sqlalchemy.org/en/14/orm/query.html#sqlalchemy.orm.Query.first) : `SELECT â€¦ FROM â€¦ LIMIT 1`ã€‚é€šè¿‡æ‰“è¿™ä¸ªè¡¥ä¸ï¼Œæˆ‘ä»¬å‘Šè¯‰è§£é‡Šå™¨â€œå‡è®¾æ•°æ®åº“æ­£åœ¨ç»™ä½ è¿™ä¸ªã€‚*è¿™ä¸ª*ï¼Œåœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œå…¶å®å°±æ˜¯`None`ï¼Œå› ä¸ºæˆ‘ä¸æƒ³å¾—åˆ°è¿™ä¸ªé”™è¯¯:`Email already registered`ã€‚
*   åœ¨ä¸‹ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘å°†éå†éšæœºç”Ÿæˆçš„ç”¨æˆ·çš„æ¯ä¸€ä¸ªé”®-å€¼å¯¹ï¼Œå†æ¬¡å‘Šè¯‰è§£é‡Šå™¨ç”¨æˆ‘ä»¬ç»™å‡ºçš„é”®-å€¼å¯¹ ORM ä¸­çš„æ‰€æœ‰å†…å®¹è¿›è¡Œä¼ªæ›¿æ¢ï¼Œè¿™æ ·å¯¹ä»»ä½•å®ä¾‹å±æ€§çš„æ¯æ¬¡è®¿é—®éƒ½å°†è¿”å›æˆ‘ä»¬æä¾›çš„å€¼ã€‚
*   `Session.commit`å’Œ`Session.refresh`ä¹Ÿè¢«æ¨¡ä»¿ï¼Œè¿™ä¼¼ä¹æ˜¯ä¸€ä»¶ä¸å¿…è¦çš„äº‹æƒ…ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»åœ¨`Query.first`ä¸­å¾—åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„ï¼Œä½†æ˜¯è¿™æ ·åšå°†åˆ é™¤ä»»ä½•å®é™…çš„æ•°æ®åº“äº¤äº’ï¼Œå¦åˆ™å°†éœ€è¦ä¸€ä¸ªå¯åŠ¨å¹¶è¿è¡Œçš„æ•°æ®åº“ã€‚
*   æµ‹è¯•ç”¨ä¾‹çš„å…¶ä½™éƒ¨åˆ†åªæ˜¯è°ƒç”¨ç«¯ç‚¹ï¼Œè·å–ç»“æœï¼Œå¹¶ç¡®ä¿æˆ‘ä»¬æ”¶åˆ°çš„ä¸æˆ‘ä»¬é¢„æœŸçš„å®Œå…¨ä¸€æ ·ï¼›æˆ‘ç›¸ä¿¡ä½ å¾ˆæœ‰èƒ½åŠ›è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æˆ‘ä¸æƒ³å†’æ˜§ã€‚

![](img/525d1165b4a9af48852caeff314a8edc.png)

Photo by [cottonbro](https://www.pexels.com/@cottonbro?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels) from [Pexels](https://www.pexels.com/photo/man-in-blue-dress-shirt-beside-woman-in-red-and-white-stripe-shirt-4835467/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)

# ç»™æˆ‘çœ‹æ›´å¤šï¼Œç»™æˆ‘çœ‹æ›´å¤šï¼Œæˆ‘ç­‰ä¸åŠäº†ğŸ˜‹

å¥½äº†ã€‚ä½ è§‰å¾—è¿™å·²ç»è¶³å¤Ÿäº†å—ï¼Ÿæˆ–è€…æˆ‘ä»¬åº”è¯¥å†æ¥ä¸€è½®ï¼Ÿæˆ‘è§‰å¾—ä½ æ‡‚äº†ï¼Œä½†ä½ çŸ¥é“ä»–ä»¬è¯´ä»€ä¹ˆå—ï¼Ÿ

> ç¬¬ä¸‰æ¬¡æ˜¯é­…åŠ›æ‰€åœ¨ã€‚ğŸ¤™

è¿™é‡Œæ²¡ä»€ä¹ˆç‰¹åˆ«çš„ã€‚åªæ˜¯æƒ³çœ‹çœ‹`setenv`å’Œ`delenv`æ˜¯å¦åœ¨åšä»–ä»¬åº”è¯¥åšçš„äº‹æƒ…ã€‚è¯·è®°ä½ï¼Œåœ¨ç¬¬äºŒä¸ªæµ‹è¯•ç”¨ä¾‹ä¸­åš`delenv`å®é™…ä¸Šæ˜¯ä¸å¿…è¦çš„ï¼Œé™¤éæŸäº›ä½œæ¶è€…æ­£åœ¨ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¿è¡Œæ‚¨çš„æµ‹è¯•:

```
DATABASE_URI=i_am_not_empty pytest patch_environment.py
```

å¦‚æœä½ æ²¡æœ‰é‚£ä¸ª`delenv`ï¼Œå®ƒå°±ä¼šå¤±è´¥ã€‚æˆ‘ä»¬è¿˜æ·»åŠ äº†`raising=False`ï¼Œå®ƒå¯ä»¥é¿å…è¯¥é”®çš„ç©ºå€¼å¼•å‘`KeyError`ã€‚

æˆ‘çŸ¥é“å·²ç»å¤Ÿäº†ï¼Œä½†è¿™æ˜¯æœ€åä¸€è½®ã€‚æˆ‘ä¿è¯ğŸ¤ã€‚

å¥½å§ã€‚é€‚å¯è€Œæ­¢ã€‚æˆ‘çŸ¥é“ä½ å·²ç»çœ‹å¤Ÿäº†æ‰€æœ‰çš„æµ‹è¯•å’Œä¸€åˆ‡ã€‚å½“æˆ‘ç¬¬ä¸€æ¬¡å‘ç°æœ‰è¿™ç§ä¸œè¥¿å­˜åœ¨æ—¶ï¼Œæˆ‘éå¸¸å…´å¥‹ï¼Œè¿™ç¯‡æ–‡ç« æ˜¯æˆ‘å¯¹å¤–ç•Œçš„ä¸€ç§æ¬£èµã€‚

![](img/206e6e13d902bc6e078d765cd8ca9a26.png)

Photo by [Ketut Subiyanto](https://www.pexels.com/@ketut-subiyanto?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels) from [Pexels](https://www.pexels.com/photo/cheerful-ethnic-mother-saying-goodbye-to-son-with-food-backpack-4473407/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)

# å†è§äº†ï¼ŒğŸ¥²

æˆ‘æ˜¯æµ‹è¯•çš„ç‹‚çƒ­çˆ±å¥½è€…ï¼Œæ‰€ä»¥æˆ‘åšäº†ä¸€ç‚¹è‡ªæˆ‘å®£ä¼ ï¼Œå¹¶å‘Šè¯‰ä½ ä»¬ä¹Ÿæ¥çœ‹çœ‹æˆ‘çš„å…¶ä»–ç›¸å…³æ–‡ç« ï¼Œè¿™ä¸ä¼šä¸åˆé€‚ğŸ˜ğŸ‘»ï¼š

[](https://python.plainenglish.io/how-to-write-tests-for-your-python-web-app-f6c6993abe36) [## å¦‚ä½•ä¸ºæ‚¨çš„ Python Web åº”ç”¨ç¨‹åºç¼–å†™æµ‹è¯•

### å‘é¡¹ç›®æ·»åŠ æµ‹è¯•å’Œè¦†ç›–ç‡çš„å®ç”¨æŒ‡å—

python .å¹³åŸè‹±è¯­. io](https://python.plainenglish.io/how-to-write-tests-for-your-python-web-app-f6c6993abe36) 

å°±è¿™æ ·å§ã€‚éå¸¸æ„Ÿè°¢ä½ çš„æ”¯æŒå’Œé˜…è¯»ã€‚å¸Œæœ›ä½ å–œæ¬¢å®ƒï¼Œå¹¶ä»ä¸­è·å¾—ä¸€äº›æœ‰ç”¨çš„ä¸œè¥¿ã€‚æˆ‘å¸Œæœ›ä½ åœ¨å‘ç°è¿™ä¸ª`monkeypatch`çš„äº‹æƒ…åå’Œæˆ‘ä¸€æ ·å…´å¥‹(ç”šè‡³æ›´å…´å¥‹),å› ä¸ºæˆ‘ç›´åˆ°ç°åœ¨æ‰çŸ¥é“è¿™ä»¶äº‹ã€‚

è¯·åœ¨ä¸‹é¢çš„è¯„è®ºä¸­ç•™ä¸‹ä½ çš„æƒ³æ³•æˆ–ä»»ä½•ç–‘é—®ã€‚æˆ‘å¾ˆä¹æ„å°±è¿™äº›æœ‰è¶£çš„å·¥å…·è¿›è¡Œäº¤æµã€‚ä½ ä¹Ÿå¯ä»¥æå‡ºä»»ä½•å…³äºä½ æƒ³å­¦çš„æ–°è¯é¢˜çš„æƒ³æ³•ï¼Œæˆ‘ä¹Ÿä¼šå¾ˆä¹æ„èŠ±æ—¶é—´ä¸ºæ­¤å†™ä¸€ç¯‡æ–‡ç« ã€‚åˆ«æ‹…å¿ƒï¼Œé™¤éæˆ‘è‡ªå·±å…ˆæŒæ¡å®ƒï¼Œå¦åˆ™æˆ‘ä¸ä¼šå¼€å§‹ğŸ˜…ã€‚

å¦‚æœä½ æƒ³æ›´æ·±å…¥åœ°æŒ–æ˜ï¼Œè¿™é‡Œæœ‰ä½ å¯èƒ½éœ€è¦çš„é“¾æ¥ã€‚

## è‡ªåŠ¨åŒ–æµ‹è¯•

[](https://www.testim.io/blog/test-automation-pyramid-a-simple-strategy-for-your-tests/) [## æµ‹è¯•è‡ªåŠ¨åŒ–é‡‘å­—å¡”:ä¸€ä¸ªç®€å•çš„æµ‹è¯•ç­–ç•¥â€”â€”äººå·¥æ™ºèƒ½é©±åŠ¨çš„ E2E è‡ªåŠ¨åŒ–

### ä½ çš„å¼€å‘å›¢é˜Ÿæ˜¯å¦èŠ±äº†å¤ªå¤šæ—¶é—´ç­‰å¾…ä»–ä»¬çš„æµ‹è¯•å¥—ä»¶è¿è¡Œï¼Ÿä»–ä»¬æ˜¯å¦ç»å¸¸é‡æ–°è¿›è¡Œæµ‹è¯•â€¦

www.testim.io](https://www.testim.io/blog/test-automation-pyramid-a-simple-strategy-for-your-tests/) [](https://www.testim.io/blog/test-automation-benefits/) [## æµ‹è¯•è‡ªåŠ¨åŒ–çš„å¥½å¤„:2020 å¹´è‡ªåŠ¨åŒ–çš„ 12 ä¸ªç†ç”±

### æ¯ä¸ªå¼€å‘äº§å“çš„å…¬å¸éƒ½åº”è¯¥æœ‰æµ‹è¯•ã€‚æµ‹è¯•æ˜¯äº§å“å¼€å‘çš„é‡è¦éƒ¨åˆ†â€¦

www.testim.io](https://www.testim.io/blog/test-automation-benefits/) [](https://www.guru99.com/automation-testing.html) [## è‡ªåŠ¨åŒ–æµ‹è¯•æ•™ç¨‹:ä»€ä¹ˆæ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Ÿ

### è‡ªåŠ¨åŒ–æµ‹è¯•æˆ–æµ‹è¯•è‡ªåŠ¨åŒ–æ˜¯ä¸€ç§è½¯ä»¶æµ‹è¯•æŠ€æœ¯ï¼Œå®ƒä½¿ç”¨ç‰¹æ®Šçš„è‡ªåŠ¨åŒ–æµ‹è¯•â€¦

www.guru99.com](https://www.guru99.com/automation-testing.html) [](https://softwaretestingfundamentals.com/unit-testing/) [## å•å…ƒæµ‹è¯•-è½¯ä»¶æµ‹è¯•åŸºç¡€

### å•å…ƒæµ‹è¯•ï¼Œä¹Ÿç§°ä¸ºç»„ä»¶æµ‹è¯•ï¼Œæ˜¯è½¯ä»¶æµ‹è¯•çš„ä¸€ä¸ªå±‚æ¬¡ï¼Œåœ¨è¿™ä¸ªå±‚æ¬¡ä¸Šï¼Œä¸€ä¸ªè½¯ä»¶çš„å•ä¸ªå•å…ƒ/ç»„ä»¶â€¦

softwaretestingfundamentals.com](https://softwaretestingfundamentals.com/unit-testing/) 

## æ¨¡æ‹Ÿå’Œè¡¥ä¸

 [## æ¨¡æ‹Ÿå¯¹è±¡åº“- Python 3.9.4 æ–‡æ¡£

### æºä»£ç :Lib/unittest/mock.py æ˜¯ä¸€ä¸ªç”¨äº Python ä¸­æµ‹è¯•çš„åº“ã€‚å®ƒå…è®¸æ‚¨æ›´æ¢ç³»ç»Ÿçš„éƒ¨ä»¶â€¦

docs.python.org](https://docs.python.org/3/library/unittest.mock.html) [](https://www.geeksforgeeks.org/python-unit-test-objects-patching-set-1/) [## Python |å•å…ƒæµ‹è¯•å¯¹è±¡ä¿®è¡¥| Set-1 - GeeksforGeeks

### Python |å•å…ƒæµ‹è¯•å¯¹è±¡ä¿®è¡¥| Set-1 é—®é¢˜æ˜¯ç¼–å†™å•å…ƒæµ‹è¯•ï¼Œéœ€è¦å°†ä¿®è¡¥ç¨‹åºåº”ç”¨åˆ°é€‰å®šçš„â€¦

www.geeksforgeeks.org](https://www.geeksforgeeks.org/python-unit-test-objects-patching-set-1/) 

## Pytest

[](https://docs.pytest.org/) [## å¸®åŠ©ä½ ç¼–å†™æ›´å¥½çš„ç¨‹åº

### pytest å’Œæ•°ä»¥åƒè®¡çš„å…¶ä»–è½¯ä»¶åŒ…çš„ç»´æŠ¤è€…æ­£åœ¨ä¸ Tidelift åˆä½œï¼Œä»¥æä¾›å•†ä¸šæ”¯æŒå’Œâ€¦

docs.pytest.org](https://docs.pytest.org/) 

## FastAPI

[](https://fastapi.tiangolo.com) [## FastAPI

### FastAPI æ¡†æ¶ï¼Œé«˜æ€§èƒ½ï¼Œç®€å•æ˜“å­¦ï¼Œå¿«é€Ÿç¼–ç ï¼Œå‡†å¤‡ç”Ÿäº§æ–‡æ¡£â€¦

fastapi.tiangolo.com](https://fastapi.tiangolo.com)  [## pydantic

### ç‰ˆæœ¬æ–‡æ¡£:1.8.1 ä½¿ç”¨ python ç±»å‹æ³¨é‡Šçš„æ•°æ®éªŒè¯å’Œè®¾ç½®ç®¡ç†ã€‚pydanticâ€¦

pydantic-docs.helpmanual.io](https://pydantic-docs.helpmanual.io) 

## æˆ‘ä»¥å‰çš„å†…å®¹

[](/amerandish/a-tmux-a-beginners-guide-7c129733148) [## Tmux:åˆå­¦è€…æŒ‡å—

### å°†æ‚¨çš„å•ä¸ªç»ˆç«¯å˜æˆå¤šä¸ªç»ˆç«¯ã€‚

medium.com](/amerandish/a-tmux-a-beginners-guide-7c129733148) [](/skilluped/10-tips-on-writing-a-proper-dockerfile-13956ceb435f) [## å†™ä¸€ä»½åˆé€‚çš„æ–‡æ¡£çš„ 10 ä¸ªæŠ€å·§

### ç¼–å†™ä¸€ä¸ªåˆé€‚çš„ docker æ–‡ä»¶å¹¶ä¸å¤ªéš¾

medium.com](/skilluped/10-tips-on-writing-a-proper-dockerfile-13956ceb435f) [](/skilluped/stop-writing-mediocre-docker-compose-files-26b7b4c9bd14) [## åœæ­¢ç¼–å†™å¹³åº¸çš„ Docker-Compose æ–‡ä»¶

### å¸¦æœ‰å¯æ“ä½œæç¤ºçš„å¤‡å¿˜å•

medium.com](/skilluped/stop-writing-mediocre-docker-compose-files-26b7b4c9bd14) [](https://meysam81.medium.com/what-is-haproxy-how-to-get-the-most-from-of-it-a9009b67f618) [## ä»€ä¹ˆæ˜¯ HAProxy &å¦‚ä½•å……åˆ†åˆ©ç”¨å®ƒï¼Ÿ

### è´Ÿè½½å¹³è¡¡ã€SSL/TLSã€ç¼“å­˜ç­‰ç­‰ã€‚

meysam81.medium.com](https://meysam81.medium.com/what-is-haproxy-how-to-get-the-most-from-of-it-a9009b67f618)