# åœ¨ Windows ä¸Šè®­ç»ƒè‡ªå®šä¹‰ YOLOv4 å¯¹è±¡æ£€æµ‹å™¨

> åŸæ–‡ï¼š<https://medium.com/geekculture/train-a-custom-yolov4-object-detector-on-windows-fe5332b0ca95?source=collection_archive---------5----------------------->

## (åˆå­¦è€…æ•™ç¨‹)

# æˆ‘åœ¨ YouTube ä¸Šçš„è§†é¢‘ï¼

# åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ YOLOv4 å’Œ Darknet åœ¨æˆ‘ä»¬çš„ Windows ç³»ç»Ÿä¸Šè®­ç»ƒä¸€ä¸ªç”¨äºé®ç½©æ£€æµ‹çš„è‡ªå®šä¹‰å¯¹è±¡æ£€æµ‹å™¨

![](img/aad06281903a5e3cf39c526992276179.png)

# æŒ‰ç…§è¿™ 10 ä¸ªæ­¥éª¤ä½¿ç”¨ YOLOv4 è®­ç»ƒä¸€ä¸ªç‰©ä½“æ£€æµ‹å™¨

(ä½†é¦–å…ˆâœ…Subscribe åˆ°æˆ‘çš„ YouTube é¢‘é“ğŸ‘‰ğŸ»[https://bit.ly/3Ap3sdi](https://bit.ly/3Ap3sdi)ğŸ˜ğŸ˜œ)

1.  [åœ¨æ¡Œé¢ä¸Šåˆ›å»º ***yolov4*** å’Œ ***è®­ç»ƒ*** æ–‡ä»¶å¤¹](#a863)
2.  [æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ï¼Œå¯¼èˆªåˆ°â€œ **yolov4** â€æ–‡ä»¶å¤¹](#4b62)
3.  [åˆ›å»ºå¹¶å¤åˆ¶**darknet.exe**æ–‡ä»¶](#fcad)
4.  [åˆ›å»º&å°†æˆ‘ä»¬è®­ç»ƒéœ€è¦çš„æ–‡ä»¶(å³ **obj** æ•°æ®é›†ã€ **yolov4-custom.cfg** ã€ **obj.data** ã€ **obj.names** ã€ **process.py** )å¤åˆ¶åˆ°ä½ çš„***yolov 4***dir](#4e42)
5.  [å°† ***yolov4*** ç›®å½•ä¸‹çš„â€œ **yolov4-custom.cfg** â€ã€â€œ **obj.data** â€ã€â€œ **obj.names** â€ã€â€œ **process.py** â€æ–‡ä»¶å’Œ**obj**æ–‡ä»¶å¤¹ä»***yolov 4***ç›®å½•ä¸‹å¤åˆ¶åˆ° ***darknet*** ç›®å½•ä¸‹ã€T55](#3531)
6.  [è¿è¡Œ **process.py** python è„šæœ¬åˆ›å»º**train . txt**&**test . txt**æ–‡ä»¶](#e074)
7.  [ä¸‹è½½é¢„å…ˆè®­ç»ƒå¥½çš„ **YOLOv4** é‡é‡](#b7d5)
8.  [è®­ç»ƒæ¢æµ‹å™¨](#acc4)
9.  [æ£€æŸ¥æ€§èƒ½](#bc40)
10.  [æµ‹è¯•æ‚¨çš„è‡ªå®šä¹‰å¯¹è±¡æ£€æµ‹å™¨](#23a6)

# ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~å¼€å§‹å§ï¼ï¼~~~~~~~~~~~~~~

![](img/d40eb91af7c30e483b314e4a277f086d.png)

# 1)åˆ›å»ºâ€œyolov4â€å’Œâ€œtrainingâ€æ–‡ä»¶å¤¹

åœ¨æ¡Œé¢ä¸Šåˆ›å»ºä¸€ä¸ªåä¸º ***yolov4*** çš„æ–‡ä»¶å¤¹ã€‚æ¥ä¸‹æ¥ï¼Œåœ¨ ***yolov4*** æ–‡ä»¶å¤¹å†…åˆ›å»ºå¦ä¸€ä¸ªåä¸º***training****çš„æ–‡ä»¶å¤¹ã€‚è¿™æ˜¯æˆ‘ä»¬å°†ä¿å­˜æˆ‘ä»¬è®­ç»ƒè¿‡çš„æƒé‡çš„åœ°æ–¹(è¿™ä¸ªè·¯å¾„åœ¨æˆ‘ä»¬ç¨åå°†ä¸Šä¼ çš„ ***obj.data*** æ–‡ä»¶ä¸­æåˆ°)*

![](img/b72c7fbb8f6185259c6d9483a92b3ff7.png)

# 2)æ‰“å¼€å‘½ä»¤æç¤ºç¬¦å¹¶å¯¼èˆªåˆ°â€œyolov4â€æ–‡ä»¶å¤¹

```
**Navigate to C:\Users\zizou\Desktop\yolov4 folder**. 
**NOTE:** Replace zizou here with your Username**cd C:\Users\zizou\Desktop\yolov4**
```

![](img/224384c73b5abfe8578654770b08b2be.png)

# 3)åˆ›å»ºå¹¶å¤åˆ¶ darknet.exe æ–‡ä»¶

åˆ›å»ºä½ çš„ ***darknet*** æ–‡ä»¶å¤¹ï¼ŒåŒ…å«ã€darknet.exeã€‘æ–‡ä»¶åˆ° ***yolov4*** æ–‡ä»¶å¤¹ã€‚è¦äº†è§£å¦‚ä½•ä½¿ç”¨ CMake åˆ›å»ºåŒ…å« darknet.exe æ–‡ä»¶çš„ darknet æ–‡ä»¶å¤¹ï¼Œè¯·è®¿é—® [**æœ¬åšå®¢**](https://techzizou007.medium.com/yolov4-darknet-installation-and-usage-on-your-system-windows-linux-8dec2cea6e81) ã€‚æŒ‰ç…§æ‰€æœ‰çš„æ­¥éª¤åœ¨ Windows ä¸Šå®‰è£… YOLOã€‚

è¿™ä¸€æ­¥å¯èƒ½æœ‰ç‚¹ä¹å‘³ï¼Œä½†è¿™æ˜¯æ•´ä¸ªè¿‡ç¨‹ä¸­æœ€å›°éš¾çš„éƒ¨åˆ†ã€‚ä¸‹é¢å‰©ä¸‹çš„è®­ç»ƒè¿‡ç¨‹ç›¸å½“ç®€å•ã€‚å› æ­¤ï¼Œè¯·ç¡®ä¿æ‚¨ä»”ç»†æŒ‰ç…§ä¸Šé¢æ–‡ç« ä¸­çš„æ‰€æœ‰æ­¥éª¤æ¥åˆ›å»º darknetï¼Œå¹¶åœ¨æ‚¨çš„ç³»ç»Ÿä¸Šå®‰è£…å’Œé…ç½® CUDA å’Œ cuDNNã€‚ä½ ä¼šåœ¨ä¸Šé¢æåˆ°çš„åšå®¢çš„ A éƒ¨åˆ†æ‰¾åˆ°è¯¦ç»†è§£é‡Šçš„æ‰€æœ‰æ­¥éª¤ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨ä¸Šé¢æåˆ°çš„åšå®¢çš„ YouTube è§†é¢‘éƒ¨åˆ†ä¸‹é¢æŸ¥çœ‹æˆ‘çš„ YOLO Windows å®‰è£…è§†é¢‘ã€‚

ä¸Šè¿°è¿‡ç¨‹å®Œæˆåï¼Œå°†æˆ‘ä»¬ä»ä¸­è·å–çš„***darknet-master***æ–‡ä»¶å¤¹å¤åˆ¶åˆ°ä½ æ¡Œé¢ä¸Šçš„ ***yolov4*** æ–‡ä»¶å¤¹ã€‚ä¸ºç®€å•èµ·è§ï¼Œå°†***darknet-master***æ–‡ä»¶å¤¹é‡å‘½åä¸º ***darknet*** ã€‚

![](img/1b69da7c6493e610faed5a01881f1e59.png)

# 4)åˆ›å»ºå¹¶å¤åˆ¶ä»¥ä¸‹æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦è¿™äº›æ–‡ä»¶æ¥è®­ç»ƒè‡ªå®šä¹‰æ£€æµ‹å™¨

```
**a. Labeled Custom Dataset
b. Custom cfg file
c. obj.data and obj.names files
d. process.py file (to create train.txt and test.txt files for training)**I have uploaded my custom files for mask detection on my [**GitHub**](https://github.com/techzizou/yolov4-custom-training_LOCAL)**.** I am working with 2 classes i.e. â€œwith_maskâ€ and â€œwithout_maskâ€.
```

## æ ‡æ³¨æ•°æ®é›†

è¾“å…¥å›¾åƒç¤ºä¾‹(**Image1.jpg**)

![](img/39cc6515e2117ccb47da9af5d416fcc9.png)

æ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•è½¯ä»¶è¿›è¡Œè´´æ ‡ï¼Œå¦‚ [**è´´æ ‡æœº**](https://github.com/tzutalin/labelImg#labelimg) å·¥å…·ã€‚

![](img/f0315f038959fd7bd8e9b9c98bb78984.png)

æˆ‘ä½¿ç”¨ä¸€ä¸ªå«åš **OpenLabeling** çš„å¼€æºæ ‡ç­¾å·¥å…·ï¼Œå®ƒæœ‰ä¸€ä¸ªéå¸¸ç®€å•çš„ UIã€‚

![](img/b28063e85253c8c588b1a80e1abb7eff.png)

ç‚¹å‡»ä¸‹é¢çš„é“¾æ¥ï¼Œäº†è§£æ›´å¤šå…³äºè´´æ ‡è¿‡ç¨‹å’Œå…¶ä»–è½¯ä»¶çš„ä¿¡æ¯:

[**å½±åƒæ•°æ®é›†æ ‡æ³¨æ¡**](/analytics-vidhya/image-dataset-labeling-annotation-bec3390eda2d)

**æ³¨:**åƒåœ¾è¿›=åƒåœ¾å‡ºã€‚é€‰æ‹©å’Œæ ‡è®°å›¾åƒæ˜¯æœ€é‡è¦çš„éƒ¨åˆ†ã€‚å°½é‡æ‰¾è´¨é‡å¥½çš„å›¾ç‰‡ã€‚æ•°æ®çš„è´¨é‡åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå†³å®šäº†ç»“æœçš„è´¨é‡ã€‚

æ ‡æœ‰ file çš„è¾“å‡º YOLO æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚

![](img/e38db0220adfb965eb4f39d690b76f7c.png)

# 4(a)åˆ›å»ºå¸¦æ ‡ç­¾çš„è‡ªå®šä¹‰æ•°æ®é›†â€œobjâ€æ–‡ä»¶å¤¹ï¼Œå¹¶å°†å…¶å¤åˆ¶åˆ°â€œyolov4â€æ–‡ä»¶å¤¹

æŠŠæ‰€æœ‰è¾“å…¥çš„å›¾åƒâ€ã€‚jpg "æ–‡ä»¶åŠå…¶å¯¹åº”çš„ YOLO æ ¼å¼æ ‡æ³¨"ã€‚txt "æ–‡ä»¶æ”¾åœ¨åä¸º **obj** çš„æ–‡ä»¶å¤¹ä¸­ã€‚å°†å…¶å¤åˆ¶åˆ° ***yolov4*** æ–‡ä»¶å¤¹ä¸­ã€‚

![](img/3277c537fff7403fb9e23657bb0489d5.png)

# 4(b)åˆ›å»ºæ‚¨çš„è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œå¹¶å°†å…¶å¤åˆ¶åˆ°â€œyolov4â€æ–‡ä»¶å¤¹ä¸­

ä» ***darknet/cfg*** ç›®å½•*ï¼Œ*ä¸‹è½½***yolov 4-custom . CFG***æ–‡ä»¶ï¼Œå¹¶å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œå¤åˆ¶åˆ° ***yolov4*** ç›®å½•ã€‚

ä½ ä¹Ÿå¯ä»¥ä»å®˜æ–¹ [AlexeyAB Github](https://www.github.com/AlexeyAB/darknet) ä¸‹è½½å®šåˆ¶é…ç½®æ–‡ä»¶ã€‚

**æ‚¨éœ€è¦åœ¨æ‚¨çš„è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œä»¥ä¸‹æ›´æ”¹:**

![](img/6b206bc68297ec482dbc51f1fe047b2e.png)

*   å°†è¡Œæ‰¹æ›´æ”¹ä¸ºæ‰¹=64
*   å°†çº¿ç»†åˆ†æ”¹ä¸ºç»†åˆ†=16 **æˆ–**ç»†åˆ†=32 **æˆ–**ç»†åˆ†=64(é˜…è¯»æœ¬èŠ‚åçš„æ³¨é‡Šä»¥äº†è§£æ›´å¤šå…³äºè¿™äº›å€¼çš„ä¿¡æ¯)
*   è®¾ç½®ç½‘ç»œå¤§å°å®½åº¦=416 é«˜åº¦=416 æˆ– 32 çš„ä»»æ„å€æ•°
*   å°†è¡Œ max_batches æ›´æ”¹ä¸º(ç±»*2000ï¼Œä½†ä¸å°äºè®­ç»ƒå›¾åƒæ•°ï¼Œä¸”ä¸å°äº 6000)ï¼Œä¾‹å¦‚ï¼Œå¦‚æœè®­ç»ƒ 3 ä¸ªç±»ï¼Œmax_batches=6000
*   å°†ç”Ÿäº§çº¿æ­¥éª¤æ›´æ”¹ä¸º max_batches çš„ 80%å’Œ 90%ï¼Œå³æ­¥éª¤=4800ï¼Œ5400

![](img/feee88e6bbe49278329dfa367ac3150a.png)

*   åœ¨æ¯ä¸ª[yolo]å±‚ä¹‹å‰çš„ **3** **ã€å·ç§¯ã€‘**ä¸­ï¼Œå°†[filters=255]æ›´æ”¹ä¸º filters=(classes + 5)x3ï¼Œè¯·è®°ä½ï¼Œå®ƒåªéœ€æ˜¯æ¯ä¸ª[yolo]å±‚ä¹‹å‰çš„æœ€åä¸€ä¸ª[å·ç§¯]ã€‚
*   åœ¨æ¯ä¸ª**3ã€yoloã€‘**å±‚ä¸­ï¼Œå°†çº¿æ¡ç±»åˆ«=80 æ”¹ä¸ºä½ çš„å¯¹è±¡æ•°é‡ã€‚

å› æ­¤ï¼Œå¦‚æœ classes=1ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥æ˜¯ filters=18ã€‚å¦‚æœ classes=2ï¼Œåˆ™ç¼–å†™ filters=21ã€‚

ä¸€æ—¦ä½ ç†è§£äº†è®­ç»ƒè¿‡ç¨‹çš„åŸºæœ¬åŸç†ï¼Œä½ ä¹Ÿå¯ä»¥è°ƒæ•´å…¶ä»–å‚æ•°å€¼ï¼Œå¦‚å­¦ä¹ ç‡ã€è§’åº¦ã€é¥±å’Œåº¦ã€æ›å…‰å’Œè‰²è°ƒã€‚å¯¹äºæ–°æ‰‹æ¥è¯´ï¼Œä»¥ä¸Šæ”¹åŠ¨åº”è¯¥è¶³å¤Ÿäº†ã€‚

## æ³¨æ„:ä»€ä¹ˆæ˜¯ç»†åˆ†ï¼Ÿ

*   è¿™æ˜¯æˆ‘ä»¬åˆ†æˆçš„è®¸å¤šå°æ‰¹é‡çš„æ•°é‡ã€‚
*   Batch=64 ->ä¸€æ¬¡è¿­ä»£åŠ è½½ 64 å¹…å›¾åƒã€‚
*   ç»†åˆ†=8 ->å°†æ‰¹æ¬¡åˆ†ä¸º 8 ä¸ªå°æ‰¹æ¬¡ï¼Œå› æ­¤æ¯ä¸ªå°æ‰¹æ¬¡æœ‰ 64/8 = 8 ä¸ªå›¾åƒï¼Œè¿™ 8 ä¸ªå›¾åƒè¢«å‘é€è¿›è¡Œå¤„ç†ã€‚è¯¥è¿‡ç¨‹å°†è¢«æ‰§è¡Œ 8 æ¬¡ï¼Œç›´åˆ°è¯¥æ‰¹å®Œæˆï¼Œå¹¶ä¸”æ–°çš„è¿­ä»£å°†ä» 64 ä¸ªæ–°å›¾åƒå¼€å§‹ã€‚
*   å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ä½å†…å­˜çš„ GPUï¼Œè¯·ä¸ºç»†åˆ†è®¾ç½®ä¸€ä¸ªè¾ƒé«˜çš„å€¼(32 æˆ– 64)ã€‚è¿™æ˜¾ç„¶éœ€è¦æ›´é•¿çš„æ—¶é—´æ¥è®­ç»ƒï¼Œå› ä¸ºæˆ‘ä»¬æ­£åœ¨å‡å°‘åŠ è½½çš„å›¾åƒæ•°é‡ä»¥åŠå°æ‰¹é‡çš„æ•°é‡ã€‚
*   å¦‚æœæ‚¨æœ‰ä¸€ä¸ªé«˜å†…å­˜çš„ GPUï¼Œè®¾ç½®ä¸€ä¸ªè¾ƒä½çš„ç»†åˆ†å€¼(16 æˆ– 8)ã€‚è¿™å°†åŠ é€Ÿè®­ç»ƒè¿‡ç¨‹ï¼Œå› ä¸ºæ¯æ¬¡è¿­ä»£åŠ è½½æ›´å¤šçš„å›¾åƒã€‚

# 4(c)åˆ›å»ºä½ çš„â€œobj.dataâ€å’Œâ€œobj.namesâ€æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬å¤åˆ¶åˆ° yolov4 æ–‡ä»¶å¤¹ä¸­

## å¯¹è±¡æ•°æ®

***obj.data*** æ–‡ä»¶æœ‰:

*   ç­çº§çš„æ•°é‡ã€‚
*   æˆ‘ä»¬åé¢è¦åˆ›å»ºçš„ ***train.txt*** å’Œ ***test.txt*** æ–‡ä»¶çš„è·¯å¾„ã€‚
*   è·¯å¾„ä¸º"*obj . names "æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†ç±»çš„åç§°ã€‚*
*   *ä¿å­˜è®­ç»ƒæƒé‡çš„ ***è®­ç»ƒ*** æ–‡ä»¶å¤¹çš„è·¯å¾„ã€‚*

```
***classes = 2
train = data/train.txt
valid = data/test.txt
names = data/obj.names
backup = ../training***
```

## *å¯¹è±¡åç§°*

*åŒ…å«å¯¹è±¡çš„åç§°ï¼Œæ¯ä¸ªåç§°å ä¸€è¡Œã€‚ç¡®ä¿åˆ†ç±»çš„é¡ºåºä¸æ ‡è®°å›¾åƒæ—¶ä½¿ç”¨çš„ class_list.txt æ–‡ä»¶ä¸­çš„é¡ºåºç›¸åŒï¼Œä»¥ä¾¿æ¯ä¸ªåˆ†ç±»çš„ç´¢å¼• id ä¸æ ‡è®°çš„ YOLO æ–‡æœ¬æ–‡ä»¶ä¸­æåˆ°çš„ç›¸åŒã€‚*

*![](img/9d741dec56ecd95365438e5661eb9cb6.png)*

# *4(d)å°†<process.py>è„šæœ¬æ–‡ä»¶å¤åˆ¶åˆ°ä½ çš„ yolov4 æ–‡ä»¶å¤¹</process.py>*

*(å°†æ‰€æœ‰å›¾åƒæ–‡ä»¶åˆ†æˆ 2 éƒ¨åˆ†ã€‚90%ç”¨äºè®­ç»ƒï¼Œ10%ç”¨äºæµ‹è¯•)*

*è¿™ä¸ª ***process.py*** è„šæœ¬åˆ›å»ºäº†æ–‡ä»¶***train . txt***&***test . txt***å…¶ä¸­ ***train.txt*** æ–‡ä»¶å…·æœ‰æŒ‡å‘ 90%å›¾åƒçš„è·¯å¾„ï¼Œè€Œ ***test.txt*** å…·æœ‰æŒ‡å‘ 10%å›¾åƒçš„è·¯å¾„ã€‚*

*å¯ä»¥ä»æˆ‘çš„ [**GitHub**](https://github.com/techzizou/yolov4-custom-training_LOCAL) **ä¸‹è½½ ***process.py*** è„šæœ¬ã€‚***

**** *é‡è¦æç¤º:â€œ*process . pyâ€*è„šæœ¬åªæœ‰ã€‚jpg "æ ¼å¼å†™åœ¨é‡Œé¢ï¼Œæ‰€ä»¥å…¶ä»–æ ¼å¼å¦‚"ã€‚pngâ€œï¼Œâ€ã€‚jpegâ€ï¼Œç”šè‡³æ˜¯â€ã€‚JPGâ€(å¤§å†™)ä¸ä¼šè¢«æ‰¿è®¤ã€‚å¦‚æœæ‚¨ä½¿ç”¨ä»»ä½•å…¶ä»–æ ¼å¼ï¼Œè¯·åœ¨ *process.py* è„šæœ¬ä¸­è¿›è¡Œç›¸åº”çš„æ›´æ”¹ã€‚***

*ç°åœ¨æˆ‘ä»¬å·²ç»ä¸Šä¼ äº†æ‰€æœ‰çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬æ¡Œé¢ä¸Šçš„ ***yolov4*** æ–‡ä»¶å¤¹åº”è¯¥æ˜¯è¿™æ ·çš„:*

*![](img/6604b2457fd1383c596d9cd60e628528.png)*

# *5)å°†æ‰€æœ‰æ–‡ä»¶ä»'`yolov4'`ç›®å½•å¤åˆ¶åˆ°' yolov4/darknet 'ç›®å½•*

*ä½ å¯ä»¥é€šè¿‡æ–‡ä»¶æµè§ˆå™¨æ‰‹åŠ¨å®Œæˆæ‰€æœ‰è¿™äº›æ­¥éª¤ã€‚*

*é¦–å…ˆï¼Œæ¸…ç† ***æ•°æ®*** å’Œ ***cfg*** æ–‡ä»¶å¤¹ï¼Œé™¤äº†*æ–‡ä»¶å¤¹å†…çš„**æ ‡ç­¾**æ–‡ä»¶å¤¹ï¼Œè¿™æ˜¯åœ¨æ£€æµ‹ç›’ä¸Šå†™æ ‡ç­¾åç§°æ‰€éœ€è¦çš„ã€‚å› æ­¤ï¼Œåªéœ€ä» ***data*** æ–‡ä»¶å¤¹ä¸­åˆ é™¤é™¤ ***labels*** æ–‡ä»¶å¤¹ä¹‹å¤–çš„æ‰€æœ‰æ–‡ä»¶ï¼Œç„¶åï¼Œå®Œå…¨æ¸…ç† ***cfg*** æ–‡ä»¶å¤¹ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»åœ¨ ***yolov4*** ä¸»æ–‡ä»¶å¤¹ä¸­æœ‰äº†æˆ‘ä»¬çš„è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ã€‚**

**æ¥ä¸‹æ¥ï¼Œå¤åˆ¶æ‰€æœ‰æ–‡ä»¶:**

*   **å°† **yolov4-custom.cfg** å¤åˆ¶åˆ° ***darknet/cfg*** ç›®å½•ä¸‹ã€‚**
*   **å°† **obj.names** ã€ **obj.data** å’Œ **obj** æ–‡ä»¶å¤¹å¤åˆ¶åˆ° ***darknet/data*** ç›®å½•ä¸‹ã€‚**
*   **å°† **process.py** å¤åˆ¶åˆ° ***darknet*** ç›®å½•ä¸‹ã€‚**

**![](img/e63d996d61910ffd8f37272b67176bcf.png)**

****æˆ–****

**ä½¿ç”¨å‘½ä»¤æç¤ºç¬¦å’Œä»¥ä¸‹å‘½ä»¤æ¥å®Œæˆæ­¤æ“ä½œã€‚å½“å‰å·¥ä½œç›®å½•æ˜¯**C:\ Users \ zizou \ Desktop \ yolov 4 \ darknet****

****æ¸…ç†*æ•°æ®*å’Œ *cfg* æ–‡ä»¶å¤¹ã€‚****

```
**#change dir to data folder and clean it. Delete all files and folders except the labels folder 
**cd data/ 
FOR %I IN (*) DO IF NOT %I == labels DEL %I 
cd ..** #delete the cfg dir 
**rmdir /s cfg** 
#Are you sure (Y/N)? press y and enter #create a new cfg folder 
**mkdir cfg****
```

**5(a)å¤åˆ¶ ***obj*** æ–‡ä»¶å¤¹ï¼Œä½¿å…¶ç°åœ¨ä½äº **/darknet/data/** æ–‡ä»¶å¤¹ä¸­**

```
****xcopy ..\obj data\obj**# In the following prompt, press D for Directory**
```

*****åœ¨æç¤ºç¬¦ä¸‹ï¼ŒæŒ‰ D é”®è¿›å…¥ç›®å½•****

**5(b)å¤åˆ¶æ‚¨çš„***yolov 4-custom . CFG***æ–‡ä»¶ï¼Œä½¿å…¶ç°åœ¨ä½äº **/darknet/cfg/** æ–‡ä»¶å¤¹ä¸­**

```
****copy ..\yolov4-custom.cfg cfg**5(c) Copy the ***obj.names*** and ***obj.data*** files so that they are now in **/darknet/data/** folder**
```

**5(c)å¤åˆ¶ ***obj.names*** å’Œ ***obj.data*** æ–‡ä»¶ï¼Œä½¿å®ƒä»¬ç°åœ¨ä½äº **/darknet/data/** æ–‡ä»¶å¤¹ä¸­**

```
****copy ..\obj.names data
copy ..\obj.data  data****
```

**5(d)å°† ***process.py*** æ–‡ä»¶å¤åˆ¶åˆ°å½“å‰ ***darknet*** ç›®å½•ä¸‹**

```
****copy ..\process.py .****
```

# **6)è¿è¡Œ process.py python è„šæœ¬ï¼Œåœ¨æ•°æ®æ–‡ä»¶å¤¹ä¸­åˆ›å»º train.txt & test.txt æ–‡ä»¶**

**å½“å‰å·¥ä½œç›®å½•æ˜¯**C:\ Users \ zizou \ Desktop \ yolov 4 \ darknet****

```
****python process.py****
```

**åˆ—å‡º ***æ•°æ®*** æ–‡ä»¶å¤¹çš„å†…å®¹ï¼Œæ£€æŸ¥**train . txt**&**test . txt**æ–‡ä»¶æ˜¯å¦å·²ç»åˆ›å»ºã€‚**

```
****dir data****
```

**ä¸Šé¢çš„ **process.py** è„šæœ¬åˆ›å»ºäº†ä¸¤ä¸ªæ–‡ä»¶ **train.txt** å’Œ **test.txt** ï¼Œå…¶ä¸­ **train.txt** æœ‰æŒ‡å‘ 90%å›¾åƒçš„è·¯å¾„ï¼Œè€Œ **test.txt** æœ‰æŒ‡å‘ 10%å›¾åƒçš„è·¯å¾„ã€‚è¿™äº›æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºã€‚**

**![](img/776b6d48198c847266cd2b404ff35233.png)**

# **7)å°†é¢„å…ˆè®­ç»ƒå¥½çš„ YOLOv4 æƒé‡ä¸‹è½½å¤åˆ¶åˆ°â€œyolov4\darknetâ€ç›®å½•ä¸‹ã€‚**

**å½“å‰å·¥ä½œç›®å½•æ˜¯**C:\ Users \ zizou \ Desktop \ yolov 4 \ darknet****

**è¿™é‡Œæˆ‘ä»¬ç”¨è¿ç§»å­¦ä¹ ã€‚æˆ‘ä»¬æ²¡æœ‰ä»å¤´å¼€å§‹è®­ç»ƒæ¨¡å‹ï¼Œè€Œæ˜¯ä½¿ç”¨é¢„å…ˆè®­ç»ƒçš„ YOLOv4 æƒé‡ï¼Œè¿™äº›æƒé‡å·²ç»è¢«è®­ç»ƒåˆ° 137 ä¸ªå·ç§¯å±‚ã€‚ä»è¿™é‡Œ ä¸‹è½½ YOLOv4 é¢„è®­ç»ƒæƒé‡æ–‡ä»¶ [**ï¼Œå¹¶å°†å…¶å¤åˆ¶åˆ°æ‚¨çš„ ***darknet*** æ–‡ä»¶å¤¹ä¸­ã€‚**](https://github.com/AlexeyAB/darknet/releases/download/darknet_yolo_v3_optimal/yolov4.conv.137)**

**[**yolov4.conv.137 é¢„è®­ç»ƒæƒé‡æ–‡ä»¶**](https://github.com/AlexeyAB/darknet/releases/download/darknet_yolo_v3_optimal/yolov4.conv.137)**

# **8)åŸ¹è®­**

## **è®­ç»ƒæ‚¨çš„å®šåˆ¶æ£€æµ‹å™¨**

**å½“å‰å·¥ä½œç›®å½•æ˜¯**C:\ Users \ zizou \ Desktop \ yolov 4 \ darknet****

**ä¸ºäº†è·å¾—æœ€ä½³ç»“æœï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œå½“å¹³å‡æŸå¤±å°äº 0.05 æˆ–è€…è‡³å°‘æŒç»­ä½äº 0.3 æ—¶ï¼Œåº”è¯¥åœæ­¢è®­ç»ƒï¼Œå¦åˆ™è®­ç»ƒæ¨¡å‹ï¼Œç›´åˆ°å¹³å‡æŸå¤±æš‚æ—¶æ²¡æœ‰ä»»ä½•æ˜¾è‘—å˜åŒ–ã€‚**

```
****darknet.exe detector train data/obj.data cfg/yolov4-custom.cfg yolov4.conv.137 -dont_show -map**#The **map** parameter here gives us the **M**ean **A**verage **P**recision. The higher the **mAP** the better it is for object detection. You can remove the **-dont_show** parameter to see the progress chart of mAP-loss against iterations.**
```

**ä½ å¯ä»¥è®¿é—®å®˜æ–¹çš„ AlexeyAB Github é¡µé¢ï¼Œå®ƒç»™å‡ºäº†å…³äºä½•æ—¶åœæ­¢è®­ç»ƒçš„è¯¦ç»†è§£é‡Šã€‚ç‚¹å‡»ä¸‹é¢çš„é“¾æ¥è·³è½¬åˆ°è¯¥éƒ¨åˆ†ã€‚**

**[AlexeyAB GitHub ä»€ä¹ˆæ—¶å€™åœæ­¢è®­ç»ƒï¼Ÿ](https://github.com/AlexeyAB/darknet/#user-content-when-should-i-stop-training)**

## **é‡æ–°å¼€å§‹è®­ç»ƒ(ä»¥é˜²è®­ç»ƒæ²¡æœ‰ç»“æŸï¼Œè®­ç»ƒè¿‡ç¨‹ä¸­æ–­)**

**![](img/ccd49581fd59ea0dc0dac49e63c43220.png)**

**å¦‚æœè®­ç»ƒè¿‡ç¨‹å› æŸç§åŸå› ä¸­æ–­æˆ–åœæ­¢ï¼Œæ‚¨ä¸å¿…å†æ¬¡ä»å¤´å¼€å§‹è®­ç»ƒæ‚¨çš„æ¨¡å‹ã€‚ä½ å¯ä»¥ä»ä½ åœæ­¢çš„åœ°æ–¹é‡æ–°å¼€å§‹è®­ç»ƒã€‚ä½¿ç”¨ä¸Šæ¬¡ä¿å­˜çš„é‡é‡ã€‚åœ¨ ***yolov4*** dir å†…çš„ **training** æ–‡ä»¶å¤¹ä¸­ï¼Œæ¯ 100 æ¬¡è¿­ä»£å°†æƒé‡ä¿å­˜ä¸º**yolov 4-custom _ last . weights***ã€‚(æˆ‘ä»¬åœ¨â€œobj.dataâ€æ–‡ä»¶ä¸­ä½œä¸ºå¤‡ä»½ç»™å‡ºçš„è·¯å¾„)ã€‚***

****å› æ­¤ï¼Œè¦é‡æ–°å¼€å§‹è®­ç»ƒï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤:****

```
****darknet.exe detector train data/obj.data cfg/yolov4-custom.cfg ../training/yolov4-custom_last.weights -dont_show -map****
```

# **9)æ£€æŸ¥æ€§èƒ½**

## **æŸ¥çœ‹åŸ¹è®­å›¾è¡¨**

**æ‚¨å¯ä»¥é€šè¿‡æŸ¥çœ‹ chart.png æ–‡ä»¶ä¸­çš„ ***æ¥æ£€æŸ¥æ‰€æœ‰è®­ç»ƒè¿‡çš„ç ç çš„æ€§èƒ½ã€‚ç„¶è€Œï¼Œ***chart.png***æ–‡ä»¶ä»…åœ¨è®­ç»ƒæ²¡æœ‰ä¸­æ–­çš„æƒ…å†µä¸‹æ˜¾ç¤ºç»“æœï¼Œå³ï¼Œå¦‚æœæ‚¨æ²¡æœ‰æ–­å¼€è¿æ¥æˆ–ä¸¢å¤±ä¼šè¯ã€‚å¦‚æœä»ä¿å­˜çš„ç‚¹é‡æ–°å¼€å§‹è®­ç»ƒï¼Œè¿™å°†ä¸èµ·ä½œç”¨ã€‚*****

*æ‰“å¼€ ***æš—ç½‘*** ç›®å½•ä¸‹çš„**chart.png**æ–‡ä»¶ã€‚*

*å¦‚æœè¿™ä¸èµ·ä½œç”¨ï¼Œè¿˜æœ‰å…¶ä»–æ–¹æ³•æ¥æ£€æŸ¥ä½ çš„è¡¨ç°ã€‚å…¶ä¸­ä¹‹ä¸€æ˜¯é€šè¿‡æ£€æŸ¥è®­ç»ƒæƒé‡çš„åœ°å›¾ã€‚*

## *æ£€æŸ¥åœ°å›¾(å¹³å‡ç²¾åº¦)*

*æ‚¨å¯ä»¥æ£€æŸ¥æ¯ 1000 æ¬¡è¿­ä»£ä¿å­˜çš„æ‰€æœ‰æƒé‡çš„è´´å›¾ï¼Œä¾‹å¦‚:- yolov4-custom_4000.weightsã€yolov4-custom_5000.weightsã€yolov4-custom_6000.weights ç­‰ç­‰ã€‚è¿™æ ·ï¼Œæ‚¨å¯ä»¥æ‰¾å‡ºå“ªä¸ªæƒé‡æ–‡ä»¶ç»™ä½ æœ€å¥½çš„ç»“æœã€‚åœ°å›¾è¶Šé«˜è¶Šå¥½ã€‚*

*è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥ç‰¹å®šå·²ä¿å­˜æƒé‡æ–‡ä»¶çš„æ˜ å°„ï¼Œå…¶ä¸­ **xxxx** æ˜¯å…¶è¿­ä»£ç¼–å·ã€‚(ä¾‹å¦‚:- 4000ï¼Œ5000ï¼Œ6000ï¼Œâ€¦)*

```
***darknet.exe detector map data/obj.data cfg/yolov4-custom.cfg ../training/yolov4-custom_xxxx.weights -points 0***
```

# *10)æµ‹è¯•æ‚¨çš„è‡ªå®šä¹‰å¯¹è±¡æ£€æµ‹å™¨*

## *å¯¹è‡ªå®šä¹‰é…ç½®æ–‡ä»¶è¿›è¡Œæ›´æ”¹ï¼Œå°†å…¶è®¾ç½®ä¸ºæµ‹è¯•æ¨¡å¼*

*   *å°†è¡Œæ‰¹æ›´æ”¹ä¸ºæ‰¹=1*
*   *å°†çº¿ç»†åˆ†æ”¹ä¸ºç»†åˆ†=1*

*æ‚¨å¯ä»¥æ‰‹åŠ¨å®Œæˆï¼Œä¹Ÿå¯ä»¥ç®€å•åœ°è¿è¡Œä¸‹é¢çš„ä»£ç *

```
***cd cfg
sed -i 's/batch=64/batch=1/' yolov4-custom.cfg
sed -i 's/subdivisions=32/subdivisions=1/' yolov4-custom.cfg
cd ..***
```

***æ³¨æ„:**æ ¹æ®æ‚¨åœ¨ cfg æ–‡ä»¶ä¸­çš„è®¾ç½®ï¼Œåœ¨ä¸Šé¢çš„å‘½ä»¤ä¸­å°†ç¬¬ä¸€ä¸ªç»†åˆ†å€¼è®¾ç½®ä¸º 16 / 32 / 64ã€‚æ­¤å¤–ï¼Œè¦åœ¨ Windows ä¸­ä½¿ç”¨â€œsedâ€æˆ–å…¶ä»– Unix å‘½ä»¤ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ Cygwin æˆ– GnuWin32 å®‰è£…å®ƒä»¬ã€‚*

## *å¯¹å›¾åƒè¿è¡Œæ£€æµ‹å™¨*

*å°†å›¾åƒä¸Šä¼ åˆ°æ¡Œé¢ä¸Šåä¸º ***mask_test_images*** çš„æ–‡ä»¶å¤¹ä¸­ã€‚*

*ä½¿ç”¨æ­¤å‘½ä»¤å¯¹å›¾åƒè¿è¡Œæ‚¨çš„è‡ªå®šä¹‰æ£€æµ‹å™¨ã€‚(é˜ˆå€¼æ ‡å¿—è®¾ç½®å¯¹è±¡æ£€æµ‹æ‰€éœ€çš„æœ€ä½ç²¾åº¦)*

```
***darknet.exe detector test data/obj.data cfg/yolov4-custom.cfg ../training/yolov4-custom_best.weights ../../mask_test_images/image1.jpg -thresh 0.3***
```

*å…¶è¾“å‡ºä¿å­˜ä¸º ***darknet*** æ–‡ä»¶å¤¹ä¸­çš„**predictions.jpg**ã€‚æ‚¨å¯ä»¥å°†å…¶å¤åˆ¶åˆ°ä»»ä½•è¾“å‡ºæ–‡ä»¶å¤¹ï¼Œå¹¶ç”¨ä¸åŒçš„åç§°ä¿å­˜ã€‚æˆ‘å°†å®ƒä½œä¸º **output_image.jpg** ä¿å­˜åœ¨***mask _ test _ images***æ–‡ä»¶å¤¹æœ¬èº«ä¸­ã€‚*

```
***copy predictions.jpg ..\..\mask_test_images\output_image.jpg***
```

*![](img/2abecff971deb50e3fe178df7c5d4413.png)*

## *å¯¹è§†é¢‘è¿è¡Œæ£€æµ‹å™¨*

*å°†è§†é¢‘ä¸Šä¼ åˆ°æ¡Œé¢ä¸Šåä¸º***mask _ test _ videos***çš„æ–‡ä»¶å¤¹ä¸­ã€‚*

*ä½¿ç”¨æ­¤å‘½ä»¤å¯¹è§†é¢‘è¿è¡Œæ‚¨çš„è‡ªå®šä¹‰æ£€æµ‹å™¨ã€‚(thresh æ ‡å¿—è®¾ç½®å¯¹è±¡æ£€æµ‹æ‰€éœ€çš„æœ€ä½ç²¾åº¦)ã€‚è¿™ä¼šå°†è¾“å‡ºè§†é¢‘ä¿å­˜åœ¨ä¸â€œ **output.avi** â€ç›¸åŒçš„æ–‡ä»¶å¤¹ä¸­ã€‚*

```
***darknet.exe detector demo data/obj.data cfg/yolov4-custom.cfg ../training/yolov4-custom_best.weights ../../mask_test_videos/test.mp4 -thresh 0.5 -i 0 -out_filename ../../mask_test_videos/output.avi***
```

*![](img/ed06fe44c05df3f06f63051d080d3dd3.png)*

## *åœ¨å®æ—¶ç½‘ç»œæ‘„åƒå¤´ä¸Šè¿è¡Œæ£€æµ‹å™¨*

*è¿è¡Œä¸‹é¢çš„ä»£ç ã€‚*

```
***darknet.exe detector demo data/obj.data cfg/yolov4-custom.cfg ../training/yolov4-custom_best.weights -thresh 0.5***
```

*![](img/effa9dacfa73d9a1a62ac05bc64e54f1.png)*

# *æ³¨æ„:*

*æˆ‘æ”¶é›†çš„ç”¨äºé®ç½©æ£€æµ‹çš„æ•°æ®é›†ä¸»è¦åŒ…å«ç‰¹å†™å›¾åƒã€‚ä½ å¯ä»¥åœ¨ç½‘ä¸Šæœç´¢æ›´å¤šçš„é•¿é•œå¤´å›¾ç‰‡ã€‚æœ‰å¾ˆå¤šç½‘ç«™å¯ä»¥ä¸‹è½½æœ‰æ ‡ç­¾å’Œæ— æ ‡ç­¾çš„æ•°æ®é›†ã€‚æˆ‘åœ¨æ•°æ®é›†æ¥æºä¸‹é¢ç»™å‡ºäº†ä¸€äº›é“¾æ¥ã€‚æˆ‘ä¹Ÿç»™å‡ºäº†ä¸€äº›æ©è†œæ•°æ®é›†çš„é“¾æ¥ã€‚å…¶ä¸­ä¸€äº›æœ‰è¶…è¿‡ 10ï¼Œ000 å¼ å›¾ç‰‡ã€‚*

*è™½ç„¶æˆ‘ä»¬å¯ä»¥å¯¹æˆ‘ä»¬çš„è®­ç»ƒé…ç½®æ–‡ä»¶è¿›è¡ŒæŸäº›è°ƒæ•´å’Œæ›´æ”¹ï¼Œæˆ–è€…é€šè¿‡å¢å¼ºä¸ºæ¯ç§ç±»å‹çš„å¯¹è±¡ç±»å‘æ•°æ®é›†æ·»åŠ æ›´å¤šå›¾åƒï¼Œä½†æˆ‘ä»¬å¿…é¡»å°å¿ƒï¼Œä»¥å…å¯¼è‡´è¿‡åº¦æ‹Ÿåˆï¼Œä»è€Œå½±å“æ¨¡å‹çš„å‡†ç¡®æ€§ã€‚*

*å¯¹äºåˆå­¦è€…ï¼Œä½ å¯ä»¥ç®€å•åœ°ä½¿ç”¨æˆ‘ä¸Šä¼ åˆ° GitHub ä¸Šçš„é…ç½®æ–‡ä»¶ã€‚æˆ‘è¿˜ä¸Šä¼ äº†æˆ‘çš„æ©æ¨¡å›¾åƒæ•°æ®é›†å’Œ YOLO æ ¼å¼çš„æ–‡æœ¬æ–‡ä»¶ï¼Œè¿™å¯èƒ½ä¸æ˜¯æœ€å¥½çš„ï¼Œä½†ä¼šç»™ä½ ä¸€ä¸ªå¦‚ä½•ä½¿ç”¨ YOLO è®­ç»ƒä½ è‡ªå·±çš„è‡ªå®šä¹‰æ¢æµ‹å™¨æ¨¡å‹çš„è‰¯å¥½å¼€ç«¯ã€‚ä½ å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªè´¨é‡æ›´å¥½çš„å¸¦æ ‡ç­¾çš„æ•°æ®é›†æˆ–è€…ä¸€ä¸ªä¸å¸¦æ ‡ç­¾çš„æ•°æ®é›†ï¼Œä»¥åè‡ªå·±æ ‡æ³¨ã€‚*

*![](img/1f52e2396dc2672f835f6d527a16a50d.png)*

# *GitHub é“¾æ¥*

*æˆ‘å·²ç»åœ¨ä¸‹é¢çš„ GitHub é“¾æ¥ä¸Šä¼ äº†åœ¨ Windows ä¸­è®­ç»ƒä¸€ä¸ªå®šåˆ¶çš„ YOLOv4 æ¢æµ‹å™¨æ‰€éœ€çš„æ‰€æœ‰æ–‡ä»¶ã€‚*

*[yolov 4-custom-training _ LOCAL _ MACHINE](https://github.com/techzizou/yolov4-custom-training_LOCAL)*

# *å¸¦æ ‡ç­¾çš„æ•°æ®é›†(obj.zip)*

*[æ ‡è®°çš„å±è”½æ•°æ®é›†](https://www.kaggle.com/techzizou/labeled-mask-dataset-yolo-darknet)*

# *å…³äºè¿™ä¸ªçš„ YouTube è§†é¢‘ï¼*

# *ä¿¡ç”¨*

## *å‚è€ƒ*

*   *[Alexey AB GitHub](https://github.com/AlexeyAB/darknet)*
*   *[pjreddie Github](https://github.com/pjreddie/darknet)*
*   *[ä»£ç  Github](https://github.com/theAIGuysCode/YOLOv4-Cloud-Tutorial)*
*   *[çº¸è´¨ YOLOv4](https://arxiv.org/abs/2004.10934)*
*   *[pjreddie ç«™ç‚¹](https://pjreddie.com/darknet/yolo/)*

## *æ•°æ®é›†æº*

*æ‚¨å¯ä»¥ä»ä¸‹é¢æåˆ°çš„ç½‘ç«™ä¸‹è½½è®¸å¤šå¯¹è±¡çš„æ•°æ®é›†ã€‚è¿™äº›ç½‘ç«™è¿˜åŒ…å«è®¸å¤šç§ç±»çš„å¯¹è±¡çš„å›¾åƒä»¥åŠå®ƒä»¬çš„å¤šç§æ ¼å¼çš„æ³¨é‡Š/æ ‡ç­¾ï¼Œä¾‹å¦‚ YOLO _ é»‘æš—ç½‘æ–‡æœ¬æ–‡ä»¶å’Œå¸•æ–¯å¡ _VOC XML æ–‡ä»¶ã€‚*

*   *[é€šè¿‡è°·æ­Œæ‰“å¼€å›¾åƒæ•°æ®é›†](https://storage.googleapis.com/openimages/web/index.html)*
*   *[Kaggle æ•°æ®é›†](https://www.kaggle.com/datasets)*
*   *[Roboflow å…¬å…±æ•°æ®é›†](https://public.roboflow.com/)*
*   *[å¯è§†åŒ–æ•°æ®æ•°æ®é›†](https://www.visualdata.io/discovery)*

## *å±è”½æ•°æ®é›†æº*

*æˆ‘å°†è¿™ 3 ä¸ªæ•°æ®é›†ç”¨äºæˆ‘çš„æ ‡è®°æ•°æ®é›†:*

*   *[èˆ¬è‹¥ Github](https://github.com/prajnasb/observations)*
*   *çº¦ç‘Ÿå¤«Â·å°¼å°”æ£®Â·ç½—åšå¼—æ´›*
*   *[X-å¼ æ´‹ Github](https://github.com/X-zhangyang/Real-World-Masked-Face-Dataset)*

## *æ›´å¤šæ©è†œæ•°æ®é›†*

*   *Prasoonkottarathil ka ggle(20000 å¼ å›¾ç‰‡)*
*   *ashishjangra 27 ka ggle(12000 å¼ å›¾ç‰‡)*
*   *å®‰å¾·é²Â·å¡æ ¼å°”*

## *è§†é¢‘æº*

*   *[https://www.pexels.com/](https://www.pexels.com/)*

*![](img/3415a54ec7dafa33ad3014ea170e2c29.png)*