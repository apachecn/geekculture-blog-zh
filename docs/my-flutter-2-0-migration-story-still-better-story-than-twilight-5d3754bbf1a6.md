# æˆ‘çš„ flutter 2.0 è¿ç§»æ•…äº‹:æ¯”ã€Šæš®å…‰ä¹‹åŸã€‹æ›´å¥½çš„æ•…äº‹ğŸ”®

> åŸæ–‡ï¼š<https://medium.com/geekculture/my-flutter-2-0-migration-story-still-better-story-than-twilight-5d3754bbf1a6?source=collection_archive---------24----------------------->

## å°† flutter å’Œ dart ç‰ˆæœ¬å‡çº§åˆ° 2.0ï¼Œå¹¶å°†ç°æœ‰é¡¹ç›®è¿ç§»åˆ°æ–°çš„æ›´æ–°å¼€å‘ç¯å¢ƒ

![](img/0e5240e142c484529e0259fa64011965.png)

å…è´£å£°æ˜:åœ¨å¼€å§‹è¿ç§»è¿‡ç¨‹ä¹‹å‰ï¼Œè¯·åŠ¡å¿…è¿›è¡Œå®Œæ•´çš„å¤‡ä»½ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå»ºè®®ä½ è‡³å°‘æ‹¥æœ‰é«˜äºå¹³å‡æ°´å¹³çš„ flutter æˆ–ç¼–ç¨‹æŠ€èƒ½ğŸ‘ï¼Œå¦‚æœæ‚¨æœ‰ä»»ä½•æœªè§£å†³çš„ä¾èµ–å…³ç³»ã€‚æˆ‘ä¸å»ºè®®è¿ç§»æ‚¨çš„å¼€å‘ç¯å¢ƒï¼Œé™¤éæ‚¨éœ€è¦æ•´åˆ flutter 2.0 çš„ç‰¹æ€§ã€‚å…ˆè¯´æ•…äº‹ã€‚

## æ—¥æœŸæ˜¯ 7 æœˆ 27 æ—¥ï¼Œé¢¤æŒ¯åº”ç”¨ç¨‹åºâ€¦éœ€è¦å‡çº§â€¦ğŸ¤­

å¯¹äºå–œæ¬¢æ„å»ºåŸç”Ÿåº”ç”¨ç¨‹åºçš„å¼€å‘äººå‘˜æ¥è¯´ï¼Œflutter 2.0 å¸¦æ¥äº†ä»€ä¹ˆæ–°çš„ä¸œè¥¿ï¼Ÿæœ€é‡è¦çš„ç‰¹æ€§æ˜¯ç©ºå®‰å…¨æ€§ï¼Œå®ƒé€šè¿‡åŒºåˆ†å¯ç©ºç±»å‹å’Œä¸å¯ç©ºç±»å‹è¿›ä¸€æ­¥å¢å¼ºäº† Dartï¼Œè¿™æœ‰åŠ©äºé˜²æ­¢ç©ºå´©æºƒï¼Œè¿™æ˜¯åº”ç”¨ç¨‹åºå´©æºƒçš„å¸¸è§åŸå› ğŸ˜µâ€ğŸ’«ã€‚çœ‹èµ·æ¥å¾ˆæ¼‚äº®çš„è°·æ­Œç§»åŠ¨å¹¿å‘Šå’Œ iOS çš„æ–° Cupertino ææ–™ç»„ä»¶æ˜¯æˆ‘çš„æœ€çˆ±ã€‚

é¦–å…ˆï¼Œä½ å¿…é¡»å‡çº§ä½ çš„é¢¤æŒ¯å’Œé£é•–ç‰ˆæœ¬ã€‚ä½ å¯ä»¥åœ¨ä½ çš„ç»ˆç«¯ä¸Šè¿è¡Œ flutter--upgradeã€‚å¦‚æœè¿™ä¸ªå‘½ä»¤ä¸èµ·ä½œç”¨ï¼Œè¿™æ„å‘³ç€å·²ç»å¯¹æ‚¨çš„ flutter SDK è¿›è¡Œäº†ä¿®æ”¹ï¼Œå› æ­¤æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æ¥å¼ºåˆ¶å‡çº§ã€‚ä¹‹åï¼Œæ‚¨å¯ä»¥è¿è¡Œ flutter a doctor æ¥éªŒè¯ç”¨äºæ£€æŸ¥æ‚¨çš„ flutter å®‰è£…çš„å¾…åŠäº‹é¡¹åˆ—è¡¨ã€‚

## èµ·åˆä¸€åˆ‡éƒ½æ˜¯å½©è™¹å’Œç‹¬è§’å…½ğŸ¦„

è®©æˆ‘ä»¬ç»§ç»­å°†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè¿ç§»åˆ°æœ€æ–°çš„ SDK ç‰ˆæœ¬ï¼Œä½†æ˜¯é¦–å…ˆå¤‡ä»½æ‚¨çš„ flutter a é¡¹ç›®ï¼Œå› ä¸ºä¸æ˜¯æ‰€æœ‰çš„ flutter é¡¹ç›®éƒ½å¯ä»¥è¿ç§»ã€‚å¯¹äºå¯è§£æçš„åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ã€‚

```
flutter pub outdated --mode=null-safety
```

![](img/f19c3d4b02347314cc35afe47675167b.png)

Package checking

å¦‚æœæ‚¨æ³¨æ„åˆ°æœ€å³è¾¹å¸¦æœ‰â€œxâ€çš„ä¾èµ–é¡¹ï¼Œè¿™äº›æ˜¯æ— æ³•è§£å†³çš„ï¼Œå¦‚æœå®ƒä»¬æä¾›äº†åŠŸèƒ½æ€§çš„å¯èƒ½æ€§ï¼Œæ‚¨åº”è¯¥ç­‰åˆ°å®ƒä»¬è¢«è§£å†³ã€‚æœ‰è®°å·çš„æ˜¯å¤´å¥–ï¼›æ‚¨å¯ä»¥å¤åˆ¶è¿™äº›ç‰ˆæœ¬ï¼Œç„¶åå°†å®ƒä»¬ç²˜è´´åˆ°æ‚¨çš„â€œpubspec.ymlâ€æ–‡ä»¶ä¸­ã€‚

![](img/759230cef9e02cc6d5ee9acc17dae3f7.png)

Find alternatives if packages are for Aesthetics

ç°åœ¨æ˜¯æœªè§£å†³çš„é—®é¢˜ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰æä¾›åƒçŠ¶æ€ç®¡ç†ã€API å¤„ç†æˆ–ä¼šè¯å­˜å‚¨è¿™æ ·çš„åŠŸèƒ½å‰æ™¯ã€‚æˆ‘é€‰æ‹©æ”¾å¼ƒå…¶ä¸­çš„ä¸€äº›ï¼Œå¹¶åœ¨é…’å§å¼€å‘ç½‘ç«™ä¸Šå¯»æ‰¾æ›¿ä»£å“ã€‚æ£€æŸ¥å‘å¸ƒå¼€å‘ä¸­æœªè§£æçš„åŒ…ï¼›æ‚¨å¯èƒ½ä»ç„¶ä¼šå‘ç°è®¸å¤šæ”¯æŒé›¶å®‰å…¨çš„æ›¿ä»£æ–¹æ¡ˆã€‚ä¾‹å¦‚ï¼Œæˆ‘æ²¡æœ‰ä½¿ç”¨ SplashScreenï¼Œè€Œæ˜¯ä½¿ç”¨äº† flutter native splash: 1.2.0ï¼Œå®ƒæä¾›äº† null å®‰å…¨æ€§ã€‚æˆ‘å°†å¯¹å‰©ä¸‹çš„ä¸‰ä¸ªåŒ…é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬ä¸å†æœ‰ä»»ä½•åŒ…çš„é—®é¢˜ã€‚å¦‚æœä½ æ³¨æ„åˆ°ä¸€æ³¢é”™è¯¯ï¼Œä¸è¦æƒŠæ…Œï¼›ä¸€åˆ‡éƒ½ä¼šæ¢å¤æ­£å¸¸ï¼Œå¸Œæœ›æ˜¯ğŸ¥².

æ£€æŸ¥æ‚¨çš„ dart ç‰ˆæœ¬æ˜¯å¦è‡³å°‘æ˜¯ 2.12ã€‚å¦‚æœä¸æ˜¯ï¼Œè¯·ä½¿ç”¨å‘½ä»¤" dart- -version "æ¥æ£€æŸ¥æ‚¨çš„ dart ç‰ˆæœ¬ã€‚å®ƒé€šå¸¸ä¼šéšç€ä½ çš„ flutter åŒ…æ›´æ–°ã€‚

## è®©æˆ‘ä»¬ä¸ºäº†ç§‘å­¦è€Œè¿™æ ·åšğŸš€

æ‚¨å¯ä»¥è·³åˆ°ä¸‹ä¸€éƒ¨åˆ†ï¼Œæ— éœ€æ‰‹åŠ¨ä¿®å¤ã€‚å‡çº§åæˆ‘åœ¨ pubspec æ–‡ä»¶é‡ŒæŠŠ flutter SDK ç‰ˆæœ¬æ”¹æˆäº† 2.12.0 3ã€‚é›¶å®‰å…¨çš„æ ‡å‡†ç›¸å½“ç®€å•ã€‚è®©æˆ‘ä»¬é€šè¿‡æ·»åŠ æœ€è¿‘çš„å…³é”®å­—æ¥ä¿®å¤ç©ºå˜é‡ï¼Œå¹¶å‡ºäºç§‘å­¦çš„ç›®çš„åšä¸€äº›æ‰‹å·¥åŠ³åŠ¨æ¥è§‚å¯Ÿå‘ç”Ÿäº†ä»€ä¹ˆå˜åŒ–ã€‚ç¤ºä¾‹â€œ@ from @requiredâ€

![](img/c81ffe07f82924d72582db5b5eac961e.png)

ï¼å°†å¯ç©ºç±»å‹è½¬æ¢ä¸ºä¸å¯ç©ºç±»å‹ï¼Œæ¯”å¦‚åœ¨ snackbar ä¸­æ”¾ç½®ç©ºæ£€æŸ¥ï¼Œä»¥åŠè®¸å¤šå…¶ä»–è§„åˆ™å¹¸è¿çš„æ˜¯ï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªæ¼”ç»ƒï¼Œæˆ‘å°†åœ¨å‚è€ƒèµ„æ–™éƒ¨åˆ†æä¾›ã€‚

```
_scaffoldKey.currentState!.showSnackBar(snackbar);_formKey.currentState!.reset();}
```

![](img/dc7caa19585d2c1873322d81ae0b5b4e.png)

Using the Late keyword for undefined placeholders

ç°åœ¨ï¼Œåœ¨æ›´æ–°äº†å˜é‡å¹¶ä¿®å¤äº† 150+ä¸ªå¯ç©ºçº¦æŸä¹‹åï¼Œæˆ‘ä»ç„¶æœ‰å‡ ä¸ªé—®é¢˜ï¼Œä¸‹é¢æåˆ°äº†å…¶ä¸­çš„ä¸€äº›ï¼Œæˆ‘å°†æ‰‹åŠ¨çº æ­£å®ƒä»¬ï¼Œå› ä¸ºï¼Œä½ çŒœå¯¹äº†ï¼ä¸ºäº†ç§‘å­¦ï¼ğŸ§‘â€ğŸ”¬ä½ è®¤ä¸ºæˆ‘ä¿®å¤ 23 ä¸ªé”™è¯¯éœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿæ›´æ–°:ä¿®å¤å®ƒä»¬èŠ±äº†ä¸€ä¸ªå°æ—¶ã€‚

```
error â€¢ A value of type 'Color?' can't be assigned to a variable of type 'Color' at lib/configuration.dart:3:21 â€¢ (invalid_assignment)
  error â€¢ The argument type 'Color?' can't be assigned to the parameter type 'Color' at lib/configuration.dart:6:13 â€¢ (argument_type_not_assignable)
  error â€¢ The argument type 'Null' can't be assigned to the parameter type 'Key' at lib/.dart:595:27 â€¢ (argument_type_not_assignable)
  error â€¢ The named parameter 'onInit' is required, but there's no corresponding argument at lib/.dart:46:16 â€¢ (missing_required_argument)
  error â€¢ The named parameter 'key' is required, but there's no corresponding argument at lib/pages/.dart:27:14 â€¢ (missing_required_argument)
  error â€¢ The argument type 'void Function(String)' can't be assigned to the parameter type 'void Function(String?)?' at lib/pages/cart.dart:324:15 â€¢ (argument_type_not_assignable)
  error â€¢ The named parameter 'user' is required, but there's no corresponding argument at lib/pages/.dart:194:15 â€¢ (missing_required_argument)
  error â€¢ The named parameter 'key' is required, but there's no corresponding argument at lib/pages/.dart:195:15 â€¢ 
  error â€¢ The named parameter 'user' is required, but there's no corresponding argument at lib/pages/.dart:216:15 â€¢ (missing_required_argument)
  error â€¢ Undefined name 'user' at lib/redux/.dart:24:33 â€¢ (undefined_identifier)
  error â€¢ The default 'List' constructor isn't available when null safety is enabled at lib/redux/.dart:156:42 â€¢ (default_list_constructor)
  error â€¢ The named parameter 'store' is required, but there's no corresponding argument at test/widget_test.dart:16:29 â€¢ (missing_required_argument)
```

*é¼“è§’è‰²* ğŸ¥æˆåŠŸåœ°æ›´æ”¹ä¸ºç©ºå®‰å…¨ï¼Œä½†è®©æˆ‘ä»¬çœ‹çœ‹åº”ç”¨ç¨‹åºæ˜¯å¦å†æ¬¡å·¥ä½œï¼Œå› ä¸ºæˆ‘æƒ³è‡ªå·±å­¦ä¹ æ‰€æœ‰çš„è½¬æ¢ã€‚æ‰‹æŒ‡äº¤å‰ã€‚è¿™æ¬¾åº”ç”¨ç¡®å®æ¨å‡ºäº†ï¼Œä½†ä¸€äº›åŠŸèƒ½è¢«ç ´åäº†ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»å®Œæˆäº†å®éªŒï¼Œè®©æˆ‘ä»¬è¯•è¯• dart è¿ç§»å·¥å…·ã€‚

## ä½ è¿·å¤±äº†æ–¹å‘â€¦ä½ çš„èµ·ç‚¹åœ¨è¿™é‡Œã€‚ğŸ¤—

æˆ‘å›æ»šåˆ°å¼€å§‹ï¼Œä¿ç•™äº†è¿ç§»æ–‡ä»¶ä¸­çš„ pub æ–‡ä»¶ï¼Œåˆ é™¤äº†æœªæ»¡è¶³ä¾èµ–å…³ç³»çš„å®ä¾‹ï¼Œå¹¶æ‰§è¡Œäº† **dart è¿ç§»ã€‚**

![](img/e7e4f360652ed32f82e344a3e0de4da8.png)

Dart migrate success

æ­¤æ—¶ï¼Œæˆ‘æƒ³å¯¹ Flutter å’Œ Dart å›¢é˜Ÿè¡¨ç¤ºæ„Ÿè°¢ï¼Œæ„Ÿè°¢ä»–ä»¬è®©æ‰‹åŠ¨è¿ç§»é¢„è§ˆå˜å¾—ä¿¡æ¯ä¸°å¯ŒğŸ‘ï¼Œé€šè¿‡è§†è§‰äº®ç‚¹å‘æ‚¨å±•ç¤ºè¿ç§»çš„å˜åŒ–ï¼Œè¿™å¤ªæ£’äº†ã€‚æˆ‘äº²è‡ªæ£€æŸ¥äº†æ‰€æœ‰æè®®çš„ä¿®æ”¹å¹¶å‘ç°äº†å®ƒä»¬ã€‚åœ¨ç‚¹å‡»è¿ç§»ä¹‹å‰ï¼Œæˆ‘æˆåŠŸåœ°å®Œæˆäº†å…¶ä¸­çš„ 85%ä»¥ä¸Šã€‚ç‚¹å‡» migrate flutter åï¼Œæ›´æ”¹ä¼šè‡ªåŠ¨è¿›è¡Œï¼Œä½ ä¸å¿…æ‹…å¿ƒğŸ¤©ã€‚

![](img/a1f04ab54d790005c4c3b795b6858bb1.png)

Null safety changes proposed by the migration tool

ç„¶åæˆ‘å°è¯•äº†é¢¤æŒ¯è¿è¡Œå‘½ä»¤ã€‚æ˜¯çš„ï¼Œè¿™ä¼¼ä¹æ²¡æœ‰å·¥ä½œï¼Œæ‰€ä»¥æˆ‘å°è¯•äº†ä¸¤ä¸ªæ¨¡æ‹Ÿå™¨åªæ˜¯ä¸ºäº†ç¡®å®šï¼Œä½†æ²¡æœ‰ï¼Œæ‰€ä»¥æˆ‘æ²¡æœ‰é¢¤æŒ¯å¹²å‡€å’Œé¢¤æŒ¯é…’å§å¾—åˆ°ä»£æ›¿ã€‚æ²¡æœ‰è¿æ°”ä»ç„¶åœç•™åœ¨ç©ºç™½å±å¹•ä¸Š

![](img/67d12e6b3a96b84cd720d035ce2b90cf.png)

Flutter Migration blank screen result

è®©æˆ‘çœ‹çœ‹ï¼Œå½“æˆ‘æ‰‹åŠ¨æ‰§è¡Œæ—¶ï¼Œåªæœ‰å‡ ä¸ªåŠŸèƒ½åäº†ï¼Œä½†å…¶ä»–åŠŸèƒ½éƒ½æ­£å¸¸ã€‚æˆ‘èƒ½å¤Ÿæµè§ˆæ‰€æœ‰çš„é¢æ¿ï¼ŒçŠ¶æ€ç®¡ç†çœ‹èµ·æ¥æ˜¯å¯æ“ä½œçš„ã€‚ç”±äºæˆ‘è¿›è¡Œäº†æ‰‹åŠ¨è¿ç§»å¹¶äº†è§£äº†å“ªé‡Œæœ€æœ‰å¯èƒ½å‡ºé”™ï¼Œæˆ‘åšäº†å¿…è¦çš„ä¿®æ”¹ï¼Œç„¶å,*é¼“ç‚¹* ğŸ¥ ï¼Œå®ƒåœ¨ğŸ¥³.æˆåŠŸäº†

![](img/2a613910c3ec1b84448a359e2536ac1a.png)

Worked ğŸ¥³

ä»åŠŸèƒ½åˆ°å¸ƒå±€çš„ä¸€åˆ‡ç°åœ¨éƒ½å¯ä»¥åˆ©ç”¨æ–°çš„é¢¤æŒ¯ V2 åŠŸèƒ½ã€‚æˆ‘å°†è¿›ä¸€æ­¥æµ‹è¯•æˆ‘çš„åº”ç”¨ç¨‹åºæ˜¯å¦æœ‰ä»»ä½•é”™è¯¯ï¼Œç§‘å­¦åˆä¸€æ¬¡æ‹¯æ•‘äº†æˆ‘ä»¬ï¼è¿™å°±æ˜¯æˆ‘é£˜å¿½ä¸å®šçš„è¿å¾™æ•…äº‹ã€‚æˆ‘å°†åˆ—å‡ºä¸€äº›å¯¹æˆ‘çœŸæ­£æœ‰å¸®åŠ©çš„èµ„æºï¼Œå®ƒä»¬æ˜¯çº¯ç²¹çš„å¹¸ç¦ã€‚çœ‹çœ‹é‚£äº›ä¼Ÿå¤§çš„å¼€å‘è€…ï¼Œç»™ä»–ä»¬ä½ çš„æ”¯æŒã€‚å¿«ä¹ç¼–ç âœ¨