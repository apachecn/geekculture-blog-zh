<html>
<head>
<title>Trigger pipe via slack command</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">é€šè¿‡æ¾å¼›å‘½ä»¤è§¦å‘ç®¡é“</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/geekculture/trigger-pipe-via-slack-command-8990fe707609?source=collection_archive---------41-----------------------#2021-05-25">https://medium.com/geekculture/trigger-pipe-via-slack-command-8990fe707609?source=collection_archive---------41-----------------------#2021-05-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f51dc892d74a54f58549ffb842c7c6a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NynqNgVmsChLwNt31WsmRw.jpeg"/></div></div></figure><p id="f6d6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">å› æ­¤ï¼Œè¿™å°†æ˜¯æˆ‘çš„æœ‰è¶£æ–‡ç« åˆ—è¡¨çš„å¼€å§‹ï¼Œå› ä¸ºæˆ‘å¤„äºéƒ¨åˆ†å¤±ä¸šçŠ¶æ€ğŸ»</p><p id="90af" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">ä»Šå¤©æˆ‘ä»¬å°†åˆ¶ä½œä¸€ä¸ªå¿«é€Ÿæ–œæ å‘½ä»¤ï¼Œå®ƒå°†è§¦å‘ä¸€ä¸ªè‡ªå®šä¹‰ç®¡é“å¹¶è¿è¡Œå®ƒã€‚</p><h1 id="f5bb" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">ä¸ºä»€ä¹ˆï¼Ÿ</h1><p id="76cb" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">è€å®è¯´ï¼Œå½“æˆ‘æ²¡æœ‰å¿ƒæƒ…æ—¶ï¼Œæˆ‘å–œæ¬¢ç©è¿™æ ·çš„ä¸œè¥¿ï¼Œè€Œä¸”åœ¨æˆ‘çš„å·¥ä½œä¸­ï¼Œä¼¼ä¹å¼€å‘äººå‘˜å¤ªæ‡’äº†ï¼Œä»¥è‡³äºæ— æ³•åœ¨bitbucketä¸­è¿è¡Œè‡ªå®šä¹‰ç®¡é“æˆ–æ‰‹åŠ¨ç®¡é“</p><h1 id="91ff" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">å¦‚ä½•ï¼Ÿ</strong></h1><p id="72dd" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">è¿™æ˜¯éå¸¸ç®€å•çš„pipsï¼Œæˆ‘æƒ³åœ¨slackä¸Šé”®å…¥/deploy2uatï¼Œå®ƒä¼šåœ¨bitbucketç®¡é“ä¸­è§¦å‘ä¸€ä¸ªè‡ªå®šä¹‰ç®¡é“</p><blockquote class="kr ks kt"><p id="a892" class="iq ir ku is b it iu iv iw ix iy iz ja kv jc jd je kw jg jh ji kx jk jl jm jn hb bi translated">/deploy2uat:è¡¨ç¤ºæ¾å¼›API</p><p id="da48" class="iq ir ku is b it iu iv iw ix iy iz ja kv jc jd je kw jg jh ji kx jk jl jm jn hb bi translated">è§¦å‘ä½æ¡¶ç®¡é“:è¡¨ç¤ºä½æ¡¶API</p></blockquote><p id="29b2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">ç¬¬ä¸€å—æ‹¼å›¾æ˜¯æ¾å¼›çš„</p><p id="d29e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªslackåº”ç”¨ç¨‹åº</strong></p><ol class=""><li id="bb11" class="ky kz hi is b it iu ix iy jb la jf lb jj lc jn ld le lf lg bi translated">åˆ°è¿™é‡Œã€https://api.slack.com/apps/ T4ã€‘å¹¶è¾“å…¥ä½ çš„åº”ç”¨ç¨‹åºåå’Œä½ æƒ³è¦å‘½ä»¤æ‰§è¡Œçš„å·¥ä½œç©ºé—´</li></ol><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/9711f03c8e2a5f524ed887e839bc4547.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FbIOwQxupVYq5L8QOu0CKg.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx">create slack application</figcaption></figure><p id="5935" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.å•å‡»æ–œæ å‘½ä»¤å¹¶åˆ›å»ºä¸€ä¸ª</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/2b491930afbb0007a0b5150bd4dccc5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cuOPwLw-DToLw9fyeBw3Ew.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx">Slash commands interface</figcaption></figure><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/ab6c7ec8e1f7fe46f58bff2ba5a56763.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M9iMRnIX8P9EgVHcFcUUQQ.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx">3.Create slash command</figcaption></figure><p id="491b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">åªéœ€é”®å…¥å‘½ä»¤çš„åç§°ï¼Œè¯·æ±‚URLæ˜¯æ‚¨çš„åç«¯APIæ­£åœ¨è¿è¡Œçš„åœ°æ–¹ï¼Œè¿™æ„å‘³ç€IPåœ°å€æˆ–ç«¯ç‚¹åç§°...å‰©ä¸‹çš„å°±æ˜¯ä½ çš„å‘½ä»¤è¦åšä»€ä¹ˆäº†ã€‚</p><p id="7b58" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">æ‹¼å›¾çš„ç¬¬äºŒå—æ˜¯bitbucket API</p><p id="08be" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">è®©æˆ‘ä»¬çœ‹çœ‹bitbucket API </strong></p><p id="31f0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">æˆ‘ä»¬å°†æ‰“å¼€<a class="ae lh" href="https://developer.atlassian.com/bitbucket/api/2/reference/resource/repositories/%7Bworkspace%7D/%7Brepo_slug%7D/pipelines/" rel="noopener ugc nofollow" target="_blank"> APIæ–‡æ¡£</a>ï¼Œå¦‚ä½ æ‰€è§ï¼Œcurlå‘½ä»¤æ“ä½œèµ·æ¥éå¸¸ç®€å•</p><pre class="lj lk ll lm fd lt lu lv lw aw lx bi"><span id="158d" class="ly jp hi lu b fi lz ma l mb mc">curl -X POST -is -u username:apppassword \<br/>  -H 'Content-Type: application/json' \<br/> https://api.bitbucket.org/2.0/repositories/usernameororg/repo/pipelines/ \<br/>  -d '<br/>  {<br/>    "target": {<br/>      "ref_type": "branch",<br/>      "type": "pipeline_ref_target",<br/>      "ref_name": "master"<br/>    }<br/>  }'</span></pre><p id="d60f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">æˆ‘å°†æŠŠè¿™ä¸ªå‘½ä»¤ç¿»è¯‘æˆä¸€ä¸ªåŸå§‹çš„python flaskåº”ç”¨ç¨‹åº(ğŸ˜œä¸å°½ç„¶)</p><pre class="lj lk ll lm fd lt lu lv lw aw lx bi"><span id="b21d" class="ly jp hi lu b fi lz ma l mb mc">import requests</span><span id="97b5" class="ly jp hi lu b fi md ma l mb mc">import os</span><span id="43cc" class="ly jp hi lu b fi md ma l mb mc">from flask import Flask, jsonify</span><span id="7baa" class="ly jp hi lu b fi md ma l mb mc">app = Flask(__name__)</span><span id="b5d2" class="ly jp hi lu b fi md ma l mb mc"># The route of the application </span><span id="5751" class="ly jp hi lu b fi md ma l mb mc">@app.route('/deploy-2-uat', methods=['POST'])</span><span id="0c9f" class="ly jp hi lu b fi md ma l mb mc">def testmedium():</span><span id="e520" class="ly jp hi lu b fi md ma l mb mc"># pattern is the name of your custom pipe</span><span id="c56a" class="ly jp hi lu b fi md ma l mb mc">data = ' { "target": { "ref_type": "branch", "type": "pipeline_ref_target", "ref_name": "master", "selector": { "type": "custom", "pattern": patternName } } }'</span><span id="8a5d" class="ly jp hi lu b fi md ma l mb mc">response = requests.post('https://api.bitbucket.org/2.0/repositories/username/reponame/pipelines/', headers={'Content-Type': 'application/json',}, data=data, auth=(username, appapssword))</span><span id="006a" class="ly jp hi lu b fi md ma l mb mc">return jsonify(</span><span id="db57" class="ly jp hi lu b fi md ma l mb mc">text='It is deployed',</span><span id="de20" class="ly jp hi lu b fi md ma l mb mc">)</span><span id="5a02" class="ly jp hi lu b fi md ma l mb mc">if __name__ == '__main__':</span><span id="101b" class="ly jp hi lu b fi md ma l mb mc">app.run()</span></pre><p id="cf99" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">æˆ‘ä»¬å¯ä»¥å°†ç”¨æˆ·åã€åº”ç”¨ç¨‹åºå¯†ç (å¯ä»¥åœ¨bitbucketä¸Šç”Ÿæˆ)å’Œrepo nameä½œä¸ºç¯å¢ƒå˜é‡ä¼ é€’ï¼Œå¯¹äºæ›´æ ‡å‡†çš„å‘½ä»¤ï¼Œæˆ‘å»ºè®®æ‚¨å°†è¿™äº›å˜é‡ä½œä¸ºslackå‘½ä»¤çš„å‚æ•°ä¼ é€’ã€‚(æˆ‘åªæ˜¯åœ¨è¿™é‡Œç©å¾—å¼€å¿ƒï¼Œæ‰€ä»¥æˆ‘ä¿æŒç®€å•)</p><p id="9d00" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">æœ€åä¸€æ­¥æ˜¯åœ¨æŸä¸ªæ— æœåŠ¡å™¨é€‰é¡¹ä¸Šéƒ¨ç½²è¿™ä¸ªå°è„šæœ¬ï¼Œå› ä¸ºæˆ‘è¯´è¿‡æˆ‘åªæ˜¯ç©ç©ï¼Œæˆ‘è¿è¡Œflaskåº”ç”¨ç¨‹åºï¼Œæˆ‘ä½¿ç”¨ngrokè·å¾—ä¸€ä¸ªå…¬å…±URLï¼Œæˆ‘ä»¬å°†åœ¨å›¾3ä¸­è¾“å…¥å®ƒä½œä¸ºè¯·æ±‚URLï¼Œç»“æœæ˜¯</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/14f435a35c8d22b506a4d00d92520535.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*AEvewBey63mNT72TvucRWA.gif"/></div></div></figure><p id="66dd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">è¿™æ˜¯ä¸€ä¸ªéå¸¸åŸºæœ¬çš„ä¾‹å­ï¼Œä½†åªæ˜¯æƒ³ä¸€æƒ³ï¼Œåƒè¿™æ ·å°å°çš„ç¬¬ä¸€æ­¥ï¼Œä½ èƒ½åšä»€ä¹ˆï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªå®Œæ•´çš„CI/CDï¼Œä¸ºä»€ä¹ˆä¸å‘¢ğŸ˜ƒ</p><p id="3556" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">æ¥è‡ªçªå°¼è¥¿äºšçš„å’Œå¹³å’ŒåŸè°…æˆ‘çš„è‹±è¯­âœŒï¸</p></div></div>    
</body>
</html>