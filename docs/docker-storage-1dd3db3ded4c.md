# ç å¤´ä»“åº“

> åŸæ–‡ï¼š<https://medium.com/geekculture/docker-storage-1dd3db3ded4c?source=collection_archive---------2----------------------->

## æ·±å…¥äº†è§£ Docker å‚¨ç‰©ä»¶

![](img/c91bd76ee219d8a740f170b5ed88f98b.png)

Photo by [Viktor SOLOMONIK](https://unsplash.com/@solomonikvik?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

## **Docker æ–‡ä»¶ç³»ç»Ÿ**

å½“ docker å®‰è£…åœ¨ç³»ç»Ÿä¸­æ—¶ï¼Œå®ƒä¼šåœ¨`/var/lib/docker`ä½ç½®åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚åœ¨`docker`æ–‡ä»¶å¤¹ä¸‹ï¼Œdocker å­˜å‚¨äº†å®ƒçš„æ‰€æœ‰æ•°æ®ã€‚

```
**Docker file system
--------------------------------------------------------------------** **/var/lib/docker
                   | containers  
                    | image        
                    | volumes      
                    | plugins
                    | network
                    | . . . .**
```

æ¯ä¸ªæ–‡ä»¶å¤¹å­˜å‚¨ä¸è¯¥æ–‡ä»¶å¤¹ç›¸å…³çš„æ•°æ®ï¼›ä¾‹å¦‚ï¼Œ`image` æ–‡ä»¶å¤¹å­˜å‚¨äº†ä¸`image`æ–‡ä»¶å¤¹ä¸­çš„å›¾åƒç›¸å…³çš„æ‰€æœ‰æ•°æ®ã€‚

åœ¨ docker ä¸­ï¼Œä¸€ä¸ªå›¾åƒå¯ä»¥è¢«å‡ ä¸ªå®¹å™¨ä½¿ç”¨ã€‚å‡è®¾ï¼Œå¦‚æœéœ€è¦ä¸¤ä¸ª nginx å®¹å™¨ï¼Œdocker å°†ä»åŒä¸€ä¸ª unlaying æ˜ åƒåˆ›å»ºä¸¤ä¸ª nginx webserversã€‚

è®©æˆ‘ä»¬ä½¿ç”¨ nginx æ˜ åƒåˆ›å»ºä¸¤ä¸ª web æœåŠ¡å™¨â€”

```
**>** docker run -d --name webserver1 nginx 
**>** docker run -d --name webserver2 nginx
```

ç°åœ¨ï¼Œæ£€æŸ¥`webserver1`å’Œ`webserver2`

![](img/f2bea62c24149d3ce96b458daf375bdc.png)

ç»è¿‡æ£€æŸ¥ï¼Œå¾ˆæ˜æ˜¾ï¼Œä¸¤ä¸ªä¸åŒçš„ web æœåŠ¡å™¨ä½¿ç”¨ç›¸åŒçš„å›¾åƒã€‚è¿™æ˜¯å¯èƒ½çš„ï¼Œå› ä¸º docker ä»¥åˆ†å±‚ç»“æ„å­˜å‚¨å›¾åƒã€‚ä½¿ç”¨å¸¦æœ‰`docker build`å‘½ä»¤çš„ dockerfile åˆ›å»ºå›¾åƒæ—¶ã€‚å®ƒåˆ›å»ºäº†ä¸€ä¸ªåªè¯»çš„åˆ†å±‚æ¶æ„ã€‚

å½“ä»å›¾åƒåˆ›å»ºå®¹å™¨æ—¶ã€‚Docker åœ¨`**Image layers**`ä¹‹ä¸Šåˆ›å»ºäº†ä¸€ä¸ªé¢å¤–çš„`**Container layer**`ã€‚`**Container layer**`æ˜¯ä¸€ä¸ªè¯»/å†™å±‚ï¼Œå­˜å‚¨è¿è¡Œæ—¶å®¹å™¨ç”Ÿæˆçš„ä»»ä½•æ•°æ®ã€‚å¦‚æœå®¹å™¨éœ€è¦ä¿®æ”¹`**Image layers**`ä¸‹çš„ä»»ä½•ä¸œè¥¿ï¼Œé‚£ä¹ˆå®ƒè¢«å¤åˆ¶åˆ°`**Container layer**`ä¸­ï¼Œä»¥ä¾¿æ ¹æ®éœ€è¦ä¿®æ”¹å›¾åƒã€‚è¯¥ç¨‹åºä¹Ÿè¢«ç§°ä¸º**å†™å…¥æ—¶å¤åˆ¶**æœºåˆ¶ã€‚ç”±äºå†™å…¥æ—¶å¤åˆ¶çš„æœºåˆ¶ï¼Œ`Image layers`æ€»æ˜¯ä¿æŒä¸å˜ã€‚å› æ­¤ï¼Œä¸€ä¸ªå›¾åƒå¯ä»¥è¢«å¤šä¸ªå®¹å™¨ä½¿ç”¨ã€‚ä¸ºäº†æ›´å¥½åœ°ç†è§£ï¼Œè¯·å‚è§ä¸‹å›¾:

![](img/69d3aec6bc52c5a431d5ed59486ce063.png)

Docker Layered Architecture

Docker ä½¿ç”¨**å­˜å‚¨é©±åŠ¨**å­˜å‚¨`**Image layers**`å¹¶å°†æ•°æ®å­˜å‚¨åœ¨å®¹å™¨çš„å¯å†™å±‚ã€‚`**Container layer**`åœ¨å®¹å™¨è¢«åˆ é™¤åå¹¶ä¸æŒä¹…ï¼Œä½†å®ƒé€‚åˆå­˜å‚¨è¿è¡Œæ—¶ç”Ÿæˆçš„çŸ­æš‚æ•°æ®ã€‚

å¯¹äº docker å®¹å™¨æ•°æ®çš„æŒä¹…å­˜å‚¨ï¼Œæœ‰ä¸¤ä¸ªé€‰é¡¹:**å·**å’Œ**ç»‘å®šæŒ‚è½½**ã€‚

> **Volumes-** åœ¨`**/var/lib/docker/volumes**`ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°å·ã€‚å¹¶åœ¨å®¹å™¨è¢«åˆ é™¤æˆ–åœæ­¢åä¿æŒå®¹å™¨æ•°æ®ã€‚
> 
> **ç»‘å®šæŒ‚è½½-** ä½¿ç”¨ç»‘å®šæŒ‚è½½ï¼Œå¯ä»¥å°†æ¥è‡ª*ä¸»æœº*çš„æ–‡ä»¶æˆ–ç›®å½•æŒ‚è½½åˆ°ä¸€ä¸ªå®¹å™¨ä¸­ã€‚

## ***å·***

**å·**æ˜¯ç”± Docker å®¹å™¨ç”Ÿæˆå’Œä½¿ç”¨çš„**æŒä¹…åŒ–æ•°æ®**çš„é¦–é€‰æœºåˆ¶ã€‚è™½ç„¶**ç»‘å®šæŒ‚è½½**ä¾èµ–äºä¸»æœºçš„ç›®å½•ç»“æ„å’Œæ“ä½œç³»ç»Ÿï¼Œä½†æ˜¯**å·**å®Œå…¨ç”± Docker ç®¡ç†ã€‚

**éŸ³é‡**ä½¿ç”¨**éŸ³é‡é©±åŠ¨å™¨ã€‚**ä½¿ç”¨å·é©±åŠ¨ç¨‹åºï¼Œå¯ä»¥åœ¨è¿œç¨‹ä¸»æœºæˆ–äº‘æä¾›å•†ä¸Šåˆ›å»ºå·ï¼Œä»¥ä¿å­˜å®¹å™¨æ•°æ®ï¼Œå¹¶åœ¨éœ€è¦æ—¶åŠ å¯†æ•°æ®ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šå·é©±åŠ¨å™¨ï¼Œdocker ä½¿ç”¨`**local**` **å·é©±åŠ¨å™¨** rã€‚
ç°åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªå·â€”

```
**>** docker volume create **<volume-name>**
**>** docker volume create newVolume01
```

åˆ—å‡ºå¯ç”¨çš„**å·** â€”

```
**host~$**  docker volume ls
-------------------------------------------------------------------**DRIVER    VOLUME NAME**
local     newVolume01
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªåä¸º`**newVolume01**`çš„å·æ˜¯ä½¿ç”¨`**local**` **å·é©±åŠ¨**åˆ›å»ºçš„ã€‚

ç°åœ¨ï¼Œå°†è¯¥å·è£…å…¥å®¹å™¨ã€‚å¯ä»¥ä½¿ç”¨`**-v**`æˆ–`**--mount**`é€‰é¡¹å°†å·å®‰è£…åˆ°å®¹å™¨ä¸­ã€‚

```
**#**Using **-v** optiondocker run -d  --name <container-name> \
**-v <source-volume-name>:<target-volume-name>** \
<image-name>:<tag>
--------------------------------------------------------------------docker run -d  --name webserver1 \
**-v newVolume01:/usr/share/nginx/html** nginx:latest**#**Using **--mount** optiondocker run -d \
 --name <container-name> \
 **--mount source=<volume-name>,target=****<target-volume-name>** \
 <image-name>:<tag>
--------------------------------------------------------------------docker run -d \
 --name webserver1 \
 **--mount source=newVolume01,target=****/usr/share/nginx/html** \
 nginx:latest
```

> **æ³¨æ„:**å¦‚æœåœ¨åˆ›å»ºå®¹å™¨çš„è¿‡ç¨‹ä¸­,`**/var/lib/docker/volumes**`ä½ç½®ä¸å­˜åœ¨æŒ‚è½½çš„å·ã€‚å®ƒå°†è¢«è‡ªåŠ¨åˆ›å»ºã€‚

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥**å·**:

```
**host~$** **docker volume inspect <volume-name>
--------------------------------------------------------------------****host~$ ** docker volume inspect newVolume01{
        "CreatedAt": "2022-08-13T12:41:02Z",
        **"Driver": "local",**
        "Labels": null,
  **      "Mountpoint": "/var/lib/docker/volumes/newVolume01/_data",**
        "Name": "newvol1",
        "Options": null,
        "Scope": "local"
    }
]
```

å¦‚æœéœ€è¦ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`**docker volume rm <volume-name>**`åˆ é™¤ä¸€ä¸ªå·

> **æ³¨æ„:**ä¸€ä¸ªå·²æŒ‚è½½çš„**å·**ä¸èƒ½è¢«åˆ é™¤ã€‚åªèƒ½åˆ é™¤å·²å¸è½½/æœªä½¿ç”¨çš„å·ã€‚

å¦‚å‰æ‰€è¿°ï¼Œä¸ºäº†åœ¨è¿œç¨‹ä¸»æœºæˆ–äº‘æä¾›å•†ä¸­åˆ›å»ºå·ï¼Œéœ€è¦ä½¿ç”¨ä¸åŒç§ç±»çš„å·é©±åŠ¨å™¨ã€‚ä¸€ä¸ªä¾‹å­æ˜¯ç”¨äºåœ¨ aws-ebs ä¸Šåˆ›å»ºå·çš„ ***rexray*** å·é©±åŠ¨ç¨‹åºã€‚ [**æ›´å¤šå…³äºè¿™ä¸ªã€‚**](https://docs.docker.com/engine/extend/EBS_volume/)

## ***ç»‘å®šæŒ‚è½½***

ä½¿ç”¨ ***ç»‘å®šæŒ‚è½½*** ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•ä» ***ä¸»æœº*** æŒ‚è½½åˆ°ä¸€ä¸ªå®¹å™¨ä¸­ã€‚æ–‡ä»¶æˆ–ç›®å½•è¢«å…¶åœ¨ ***ä¸»æœº*** ä¸Šçš„ç»å¯¹è·¯å¾„å¼•ç”¨ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œå½“ä½¿ç”¨**å·**æ—¶ï¼Œä¼šåœ¨`**/var/lib/docker/volumes**`ä½ç½®åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ã€‚è¿™æ˜¯ Docker åœ¨***ä¸»æœº*** ä¸Šçš„å­˜å‚¨ç›®å½•ï¼ŒDocker ç®¡ç†è¯¥ç›®å½•çš„å†…å®¹ã€‚

åˆ›å»ºä¸€ä¸ªæ–°çš„ç›®å½•`**mkdir var/local/data**`ï¼Œç„¶å**å°†æ–°åˆ›å»ºçš„`**data**` ç›®å½•æŒ‚è½½**åˆ°ä¸€ä¸ªå®¹å™¨ä¸­ã€‚

```
***#*** *Using* ***-v*** *option*docker run -d  --name <container-name> \
**-v <directory or file path>:<target-volume-name>** \
<image-name>:<tag>
--------------------------------------------------------------------docker run -d  --name webserver1 \
**-v /var/local/data:/usr/share/nginx/html** nginx:latest***#*** *Using* ***--mount*** *option*docker run -d \
 --name <container-name> \
 **--mount type=**bind**,source=**<directory-path>**,target=****<**target-volume-name> \
 <image-name>:<tag>
--------------------------------------------------------------------docker run -d \
 --name webserver1 \
 **--mount type=**bind**,source=**/var/local/data,**target=/usr/share**\
 nginx:latest
```

> **æ³¨æ„:**ä¸€ä¸ª**å·**ï¼Œ**ç›®å½•**å¯ä»¥æŒ‚è½½åˆ°å¤šä¸ªå®¹å™¨ä¸­ã€‚

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œdocker å®¹å™¨ä¸Šè£…è½½çš„å·æˆ–ç›®å½•é©»ç•™åœ¨è¿è¡Œå®¹å™¨çš„åŒä¸€å°ä¸»æœºä¸Šã€‚Docker è¿˜å…è®¸ç”¨æˆ·å®‰è£…é€šè¿‡ NFS è¿œç¨‹æ–‡ä»¶å…±äº«ç³»ç»Ÿå…±äº«çš„ç›®å½•ã€‚ä¸ºæ­¤åˆ›å»ºçš„å·ä½¿ç”¨ Docker è‡ªå·±çš„ NFS é©±åŠ¨ç¨‹åºï¼Œæ— éœ€åœ¨ä¸»æœºä¸Šå®‰è£… NFS ç›®å½•ã€‚

æ›´å¤šå…³äº [**docker å­˜å‚¨**](https://docs.docker.com/storage/) **ã€‚**

> æˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ æ›´æ¸…æ¥šåœ°äº†è§£ docker å­˜å‚¨ã€‚å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰å¸®åŠ©ï¼Œè¯·**ä¸è¦å¿˜è®°ç‚¹å‡»**æ‹æ‹**å’Œ**è·Ÿéš**æŒ‰é’®æ¥å¸®åŠ©æˆ‘å†™æ›´å¤šè¿™æ ·çš„æ–‡ç« ã€‚
> **è°¢è°¢ *ğŸ–¤*****

## å‚è€ƒ

[](https://docs.docker.com/storage/) [## ç®¡ç† Docker ä¸­çš„æ•°æ®

### é¢„è®¡è¯»å–æ—¶é—´:9 åˆ†é’Ÿé»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨ä¸€ä¸ªå®¹å™¨ä¸­åˆ›å»ºçš„æ‰€æœ‰æ–‡ä»¶éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªå¯å†™å®¹å™¨ä¸­â€¦

docs.docker.com](https://docs.docker.com/storage/)