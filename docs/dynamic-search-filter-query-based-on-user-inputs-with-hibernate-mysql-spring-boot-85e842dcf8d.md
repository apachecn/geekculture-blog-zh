# åŸºäºç”¨æˆ·è¾“å…¥çš„åŠ¨æ€æœç´¢/è¿‡æ»¤æŸ¥è¯¢

> åŸæ–‡ï¼š<https://medium.com/geekculture/dynamic-search-filter-query-based-on-user-inputs-with-hibernate-mysql-spring-boot-85e842dcf8d?source=collection_archive---------3----------------------->

ç¼–ç¨‹ä¹‹å‰ï¼Œæˆ‘ä¸æ‡‚åœ¨ç½‘ä¸Šç¼–ç æ¨¡å› â€¦

![](img/0ba5b54b6f53e431423e59d8c67f645b.png)

â€¦ç›´åˆ°æˆ‘æœ‰æœºä¼šå’Œä¸€ä¸ªå–œæ¬¢ä¼˜åŒ–ä»£ç çš„äººä¸€èµ·å·¥ä½œã€‚

æˆ‘ä»¬é¡¹ç›®çš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯åŸºäºå¤šä¸ªè¾“å…¥åšä¸€ä¸ªå¤æ‚çš„è¿‡æ»¤ï¼Œä»–æŠŠè¿™ä¸ªä»»åŠ¡äº¤ç»™äº†æˆ‘ã€‚

![](img/f90584598eff37e8ed8e190e0c5c8857.png)

æ‰€ä»¥åŸºæœ¬ä¸Šï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®æ ‡ç­¾ã€åˆ›å»ºæ—¶é—´è¿›è¡Œè¿‡æ»¤ï¼Œä¹Ÿå¯ä»¥æ ¹æ®æœ€æ–°/æœ€æ—©çš„å¸–å­/è¯„è®ºè¿›è¡Œæ’åºã€‚æœ‰æœ€æ–°è¯„è®ºçš„å¸–å­æ€»æ˜¯æ˜¾ç¤ºåœ¨æœ€å‰é¢ã€‚

æˆ‘ç”¨ Collections å’Œ Stream åªç”¨äº†ä¸€å¤©å°±å®Œæˆäº†ã€‚åœ¨æµ‹è¯•äº†æ‰€æœ‰åœºæ™¯ä¹‹åï¼Œå®ƒè¿è¡Œå¾—å¾ˆå¥½ï¼Œæˆ‘è‡ªä¿¡åœ°æå‡ºäº†ä¸€ä¸ªæ‹‰è¯·æ±‚ï¼Œå¹¶è®¤ä¸ºæˆ‘ä¼šç¡ä¸ªå¥½è§‰ã€‚

ç„¶è€Œï¼Œä»–åœ¨åˆå¤œç»™æˆ‘å‘äº†ä¸€æ¡æ¶ˆæ¯ï¼Œè¯´ä»–æ‹’ç»æ¥å—æˆ‘çš„æ‹‰è¯·æ±‚ï¼Œå› ä¸ºæˆ‘çš„ä»£ç ä¸å¯ä¼¸ç¼©ï¼Œæ€§èƒ½ä¹Ÿä¸å¥½ã€‚

â€œå°½é‡ç”¨ JPA å’Œ Hibernate ä»£æ›¿æ ¸å¿ƒ Javaï¼Œæ€§èƒ½æ›´å¥½ã€‚ä»–è¯´:â€œä½ å¯ä»¥åœ¨å¼—æ‹‰å¾·Â·ç±³å“ˆå°”æ°å’Œ T2Â·ç´¢æœ¬Â·è®©æ¡‘çš„åšå®¢æ–‡ç« ä¸­è¯»åˆ°æ›´å¤šã€‚â€ã€‚

å› ä¸ºä¸æ˜¯ä»å­¦æ ¡å­¦çš„ï¼Œä¸€å¼€å§‹å¾ˆä¸é€‚åº”ï¼Œä¹Ÿå¾ˆæ€€ç–‘ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå¦‚æœæˆ‘æ”¹ç”¨ä»–çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘éœ€è¦åˆ é™¤æˆ‘çš„æ•´è¡Œä»£ç ã€‚

> æˆ‘çš„é‡è¦ç»éªŒæ˜¯:åœ¨å¼€å§‹ç¼–ç ä¹‹å‰ï¼Œä¸€å®šè¦è®¨è®ºè§£å†³æ–¹æ¡ˆ

é‚£å¤©æ™šä¸Šæˆ‘æ²¡ç¡å¥½ã€‚çœ‹äº†é‚£ä¸¤ä¸ªå†¬çœ å¤§å¸ˆçš„å¸–å­ï¼Œæˆ‘æƒ³ä¹Ÿè®¸æˆ‘çš„é˜Ÿå‹æ˜¯å¯¹çš„ï¼Œæˆ‘åº”è¯¥æŒ‰ç…§ä»–çš„æ–¹å‘èµ°ã€‚

è¿™é¡¹ä»»åŠ¡æœ‰ä¸¤ä¸ªä¸»è¦æ­¥éª¤:

1.  ç¼–å†™å¤æ‚çš„ SQL æŸ¥è¯¢æ¥æŒ‰æ’åºé¡ºåºç”Ÿæˆç»“æœã€‚
2.  åŸºäºç”¨æˆ·çš„è¾“å…¥åŠ¨æ€åœ°è¿›è¡ŒæŸ¥è¯¢(ä¸ç®¡è¾“å…¥æˆ–æ’åºç±»å‹æ˜¯ä»€ä¹ˆï¼Œæˆ‘åªéœ€è¦ä¸€ä¸ªå‡½æ•°æ¥æ‰§è¡Œè¿™ä¸ªä»»åŠ¡)ã€‚

**ç¼–å†™å¤æ‚çš„ SQL æŸ¥è¯¢æ¥ç”Ÿæˆæ’åºåçš„ç»“æœã€‚**

è¿™ä¸€æ­¥æœ€æ£˜æ‰‹çš„æ˜¯è®©æœ‰è¯„è®ºçš„å¸–å­å…ˆå‡ºç°ï¼Œå¹¶æ˜¾ç¤ºä»–ä»¬æœ€æ–°çš„è¯„è®ºè€…ã€‚æ²¡æœ‰ä»»ä½•è¯„è®ºçš„å¸–å­ï¼Œå³ä½¿æ˜¯æœ€è¿‘åˆ›å»ºçš„ï¼Œä¹Ÿä¸ä¼šè¢«ä¼˜å…ˆè€ƒè™‘ã€‚

æˆ‘åˆ©ç”¨æˆ‘åœ¨è¿æ¥ã€åˆ«åè¡¨ã€æ¡ä»¶è¯­å¥æ–¹é¢çš„çŸ¥è¯†æ¥ç”Ÿæˆå¦‚ä¸‹æŸ¥è¯¢:

```
SELECT 
  * 
FROM 
  posts p 
  LEFT JOIN (
    SELECT 
      c.post_id AS belongPost, 
      MAX(created_on) AS COMMENT 
    FROM 
      comments c 
    GROUP BY 
      belongPost
  ) AS TEMP ON TEMP.belongPost = p.post_id 
WHERE 
  p.topic_id = 'Assignment_Help' 
  AND p.status = 'ACCEPTED' 
  AND p.post_tags LIKE "%%" 
  AND p.created_on >= 2020 - 12 - 31 
  AND p.created_on <= 2021 - 08 - 30 
ORDER BY 
  IF(TEMP.COMMENT IS NULL, 1, 0), 
  TEMP.COMMENT desc, 
  p.created_on desc;
```

å¦‚æ­¤åºå¤§çš„æŸ¥è¯¢ï¼ï¼ï¼

**æ ¹æ®ç”¨æˆ·çš„è¾“å…¥è¿›è¡ŒåŠ¨æ€æŸ¥è¯¢**

***ä½æ€§èƒ½æ–¹æ³•:*** å¦‚æœæˆ‘ä¸ä½¿ç”¨åŠ¨æ€æŸ¥è¯¢ï¼Œæˆ‘éœ€è¦åˆ›å»º 04 ä¸ªå…¶ä»–æŸ¥è¯¢æ¥å®Œæˆè¿™é¡¹ä»»åŠ¡(å‡åº sortByPostï¼Œé™åº sortByPostsï¼Œå‡åº sortByComments å’Œé™åº sortByComments)ã€‚

***æ›´å¥½çš„è§£å†³æ–¹æ¡ˆ:*** ä½¿ç”¨åŠ¨æ€æŸ¥è¯¢

æˆ‘åˆ›å»ºäº†å¦ä¸€ä¸ª CustomPostRepositoryï¼Œå¹¶ä¸”æˆ‘çš„ PostRepository æ‰©å±•äº† CustomPostRepositoryã€‚

```
@Repository
public interface PostRepository extends JpaRepository<Post,Integer>,CustomPostRepository{     
 // Other functions
}
```

åœ¨ CustomPostRepository ä¸­ï¼Œæˆ‘å°†å‡½æ•°çš„ç­¾åæ”¾åœ¨è¿™é‡Œ:

```
public interface CustomPostRepository { List<Post> filterPostsBasedOnKeywords(
            String topicID, 
            String tags, 
            String start, 
            String end, 
            String sortBy, 
            String order, 
            Pageable pageable);
}
```

æˆ‘å°† CustomPostRepository è®¾è®¡æˆä¸€ä¸ªåŒ…å«æ‰€æœ‰åŠ¨æ€åŠŸèƒ½/æŸ¥è¯¢çš„æ¥å£ï¼›æ‰€ä»¥æˆ‘ç”¨ PostRepository æŠŠå®ƒåˆ†å¼€äº†ã€‚å¹¶ä¸”å› ä¸º PostRepository æ‰©å±•äº† custompostportrepositoryï¼Œæ‰€ä»¥æˆ‘å¯ä»¥é€šè¿‡æ³¨å…¥çš„ PostRepository å®ä¾‹è®¿é—® custompostportrepository çš„æ–¹æ³•ã€‚è¿™ä¸ªè®¾è®¡éµå¾ªäº†æˆ‘ä»[Java reviewed](https://javarevisited.blogspot.com/#axzz759A3LTNj)é‚£é‡Œå­¦æ¥çš„ç«‹ä½“å¼€/é—­åŸç†ã€‚

æœ€åï¼Œæˆ‘åˆ›å»ºäº†å®ç° CustomPostRepositoryImpl æ¥å£çš„ custompostrepostorypl ç±»ã€‚ç¥å¥‡çš„äº‹æƒ…å‘ç”Ÿäº†:

è¿™ä¸ªæƒ³æ³•æ˜¯æ ¹æ®ç”¨æˆ·çš„è¾“å…¥(æŒ‰å‡åº/é™åºã€å¸–å­/è¯„è®ºæ’åº)ä½¿ç”¨ StringBuilder åˆ›å»ºä¸€ä¸ªåŠ¨æ€å­—ç¬¦ä¸²ã€‚ç„¶åï¼Œ

```
Query q = entityManager.createNativeQuery(sb.toString(),Post.class);
```

ä¼šå°†è¯¥å­—ç¬¦ä¸²è½¬æ¢ä¸ºåŸç”ŸæŸ¥è¯¢ï¼Œè€Œ q . get result list()ï¼›å¸®åŠ©è·å–ç»“æœåˆ—è¡¨ã€‚

æœ€åï¼Œå®ƒå¯ä»¥å·¥ä½œï¼Œå¹¶ä¸”æ¯”æˆ‘çš„æ—§ Java æ ¸å¿ƒè§£å†³æ–¹æ¡ˆå¿«ä¸€ç‚¹(æˆ‘æƒ³å¦‚æœæˆ‘çš„æ•°æ®åº“ä¸­æœ‰æ•°åƒæ¡è®°å½•ï¼Œå·®å¼‚ä¼šæ›´æ˜æ˜¾)ã€‚

é¡ºä¾¿è¯´ä¸€å¥ï¼Œæ„Ÿè°¢æˆ‘çš„é˜Ÿå‹å¯¹ä»£ç å’Œå¯¹æˆ‘çš„ä¸¥æ ¼è¦æ±‚ã€‚

æºä»£ç :ã€https://github.com/trangntt-016/seneca-forum-backend 

**å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·é¼“æŒ**ğŸ‘**å¹¶åˆ†äº«å‡ºæ¥ï¼Œè®©åˆ«äººä¹Ÿèƒ½æ‰¾åˆ°ï¼**ğŸ˜„ã€‚