# ä½¿ç”¨ Bitnami å’Œ S3 é›†æˆå’Œ Mailgun åœ¨äºšé©¬é€Š Lightsail ä¸Šå®‰è£… Ghost 4.0

> åŸæ–‡ï¼š<https://medium.com/geekculture/install-ghost-4-0-on-amazon-lightsail-using-bitnami-with-s3-integration-and-mailgun-f667d9f5e32b?source=collection_archive---------6----------------------->

æˆ‘å¤ªæ¿€åŠ¨äº†ï¼ŒGhost 4.0 ç»ˆäºæ¨å‡ºäº†ï¼æˆ‘ä¸€ç›´åœ¨ä½¿ç”¨å®‰è£…åœ¨ AWS EC2 ä¸Šçš„ Ghost CMS 2 . x-3x ç‰ˆæœ¬ï¼Œæ˜ åƒæ‰˜ç®¡åœ¨ S3 ä¸Šã€‚

Ghost CMS å·²ç»æˆä¸ºæˆ‘è‡ªå·±çš„æ–°é—»å¹³å° https://lokalx.id æœ€å–œæ¬¢çš„ CMSï¼Œæˆ‘ä¸ºä¹‹æ¿€åŠ¨ä¸å·²ï¼æˆ‘è¿˜æ”¶åˆ°äº†ä¸€äº›ä»¥å‰å®¢æˆ·çš„è¯·æ±‚ï¼Œè¦æ±‚åœ¨ä»–ä»¬è‡ªå·±çš„æœåŠ¡å™¨ä¸Šå®‰è£… Ghost CMSã€‚

å‡ å¹´å‰æˆ‘ä¹Ÿå¬è¯´è¿‡äºšé©¬é€Š Lightsailï¼Œå¯¹æ­¤æˆ‘ä¹Ÿå°è±¡æ·±åˆ»ã€‚å› ä¸ºæ¯”æœ‰ EC2 æ›´ç®€å•ï¼Œè€Œä¸”èŠ±è´¹æ›´å°‘ï¼ä½†æˆ‘ä»Šå¹´æ‰æœ‰æœºä¼šå°è¯•ä¸€ä¸‹ã€‚

> æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°å¯¹æ¯”[https://www . VPS benchmarks . com/compare/features/ec2 _ vs _ light sail](https://www.vpsbenchmarks.com/compare/features/ec2_vs_lightsail)

# åœ¨ LightSail ä¸Šåˆ›å»ºå®ä¾‹

ä¸ EC2 ç›¸æ¯”ï¼Œåœ¨ Amazon LightSail ä¸Šåˆ›å»ºå®ä¾‹è¦ç®€å•å¾—å¤šã€‚ä½ å¯ä»¥ç™»å½•ä½ çš„æ§åˆ¶å°ï¼Œè¿›å…¥ https://lightsail.aws.amazon.com/ls/webapp/home/instances çš„ï¼Œç‚¹å‡»**â€œåˆ›å»ºå®ä¾‹æŒ‰é’®â€**

è®©æˆ‘ç”¨æœ€ç®€å•çš„æ–¹å¼ç»™ä½ è§£é‡Šä¸€ä¸‹ã€‚

## 1.é€‰æ‹©æ‚¨çš„å®ä¾‹ä½ç½®

![](img/63551a180858a75aa0753c0a9d1402b9.png)

Create an instance on Amazon LightSail

ä»é‚£é‡Œï¼Œä½ å¯ä»¥é€‰æ‹©ä½ è‡ªå·±çš„åœ°åŒºã€‚è¿™é‡Œçš„åŒºåŸŸæ˜¯æŒ‡ç¦»æ‚¨çš„ç›®æ ‡å®¢æˆ·æœ€è¿‘çš„æœåŠ¡å™¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘çš„å®¢æˆ·åœ¨å°åº¦å°¼è¥¿äºšï¼Œæˆ‘å°†é€‰æ‹©æ–°åŠ å¡ä½œä¸ºåœ°åŒºï¼Œå› ä¸ºå°åº¦å°¼è¥¿äºšç¦»æ–°åŠ å¡å¾ˆè¿‘ã€‚å¦‚æœæˆ‘çš„å®¢æˆ·æ˜¯å¾·å›½äººï¼Œé‚£ä¹ˆæˆ‘å°†é€‰æ‹©æ³•å…°å…‹ç¦ä½œä¸ºåœ°åŒºã€‚

ä¸ºä»€ä¹ˆæ˜¯åœ°åŒºï¼Ÿå› ä¸ºä½ç½®è¶Šè¿‘ï¼Œæˆ‘ä»¬çš„å®¢æˆ·è®¿é—®å®ƒçš„é€Ÿåº¦å°±è¶Šå¿«ã€‚ä»–ä»¬ä¸éœ€è¦è¿œè¡Œï¼

## **2ã€‚é€‰æ‹©ä½ çš„å®ä¾‹å›¾ç‰‡**

![](img/7a5df53ed5aaf1ccde58e906fc63147d.png)

æ„Ÿè°¢ä¸Šå¸ï¼å› ä¸º**äºšé©¬é€Š** **LightSail** ä¹Ÿæ”¯æŒ**åŸºäºå®¹å™¨çš„**æ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦ä»é›¶å¼€å§‹è®¾ç½®ä¸€åˆ‡ã€‚å®ƒèŠ‚çœäº†æˆ‘ä»¬çš„æ—¶é—´å’Œç²¾åŠ›ï¼æˆ‘ä»¬ä¹Ÿä¸éœ€è¦è®¾ç½® dockerï¼ğŸ˜†ğŸ˜†ğŸ˜†

å› ä¸ºæˆ‘ä»¬æƒ³å®‰è£… **Ghost** ï¼Œæ‰€ä»¥åœ¨ **Apps + OS éƒ¨åˆ†**é€‰æ‹© Ghostã€‚è¿™ä¸ªæ¥è‡ªäºšé©¬é€Šå¸‚åœºçš„å¹½çµæ˜¯ç”± **Bitnami** è®¤è¯çš„ã€‚é‚£æ˜¯ä»€ä¹ˆï¼Ÿ

> ç”± Bitnami è®¤è¯çš„ Ghost æ˜¯ä¸€ä¸ªå¼€æºå‘å¸ƒå¹³å°ï¼Œæ—¨åœ¨åˆ›å»ºåšå®¢ã€æ‚å¿—å’Œæ–°é—»ç½‘ç«™ã€‚å®ƒåŒ…æ‹¬ä¸€ä¸ªç®€å•çš„ markdown ç¼–è¾‘å™¨ï¼Œå†…ç½®äº†é¢„è§ˆã€ä¸»é¢˜å’Œ SEO æ¥ç®€åŒ–ç¼–è¾‘ã€‚Bitnami è¯æ˜è¯¥æ˜ åƒæ˜¯å®‰å…¨çš„ã€æœ€æ–°çš„ï¼Œå¹¶ä¸”ä½¿ç”¨è¡Œä¸šæœ€ä½³å®è·µè¿›è¡Œæ‰“åŒ…ã€‚

## 3.åˆ›å»º SSH å¯†é’¥å¯¹æˆ–ä½¿ç”¨é»˜è®¤å¯†é’¥å¯¹

![](img/adfaa4befd8cf0f8610240f94df1a2a2.png)

*   å¦‚æœæ‚¨å¸Œæœ›æœ‰ä¸€äº›è‡ªåŠ¨åŒ–è¿‡ç¨‹ï¼Œæ‚¨å¯ä»¥ç¨åæ·»åŠ ä¸€ä¸ªå¯åŠ¨è„šæœ¬ã€‚
*   å¦‚æœæ‚¨æƒ³è¦åˆ›å»ºæ–°çš„å¯†é’¥å¯¹ï¼Œè¯·å•å‡»**åˆ›å»ºæ–°çš„+** ã€‚å¯¹äºæˆ‘ï¼Œæˆ‘ä¿ç•™é»˜è®¤çš„å¯†é’¥å¯¹ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°æœ¬åœ°ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥é€šè¿‡æˆ‘çš„ç»ˆç«¯ç™»å½•ã€‚

**4ã€‚é€‰æ‹©ä½ çš„å®ä¾‹è®¡åˆ’**

![](img/7658283eae7536899054460058c49385.png)

*   Amazon Lightsail æŒ‰å°æ—¶å‘æˆ‘ä»¬æ”¶è´¹ï¼Œå¦‚æœæˆ‘ä»¬çš„å®ä¾‹ä¸€ä¸ªæœˆ 24 å°æ—¶å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œä»–ä»¬è¿˜ä¼šæ˜¾ç¤ºæ¯æœˆçš„ä»·æ ¼ã€‚
*   æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©ã€‚æˆ‘é€‰æ‹© **$3.5** ï¼Œå› ä¸ºæˆ‘ä¸éœ€è¦å¤§å­˜å‚¨å’Œå¤§å†…å­˜ï¼Œå› ä¸ºæˆ‘ä½¿ç”¨ **S3** æ¥å­˜å‚¨å®ƒä»¬ã€‚æˆ‘çš„ç½‘ç«™å¹¶æ²¡æœ‰æ¶ˆè€—å¤ªå¤šçš„å†…å­˜/èµ„æºï¼Œå› ä¸ºæˆ‘ä¹Ÿä½¿ç”¨ **Cloudflare** ä½œä¸ºé˜²ç«å¢™å’Œç¼“å­˜è¯·æ±‚ï¼Œä»¥åŠæ¥è‡ª **Cloudflare** çš„ä¸€äº›æœ‰ç›Šäºç½‘ç«™çš„å¥½åŠŸèƒ½ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘çš„ç½‘ç«™å†…å®¹å¤§å°åªæœ‰ **163.6kb** ã€‚æ‰€ä»¥å¤§æ¦‚ä¸€ä¸ªæœˆ 3.5 ç¾å…ƒå°±ç»°ç»°æœ‰ä½™äº†ï¼

![](img/e0059966105ffd776250c300411e2294.png)![](img/405a467ee819917cc6a3656bfc4b7188.png)

## **4ã€‚**ç¡®å®šå¹¶åˆ›å»ºæ‚¨çš„å®ä¾‹

![](img/b56253c75802832a50962ff22f3cd1b7.png)

é€‰æ‹©å”¯ä¸€çš„åç§°ï¼Œå¹¶ä½¿ç”¨æ ‡è®°é€‰é¡¹å¯¹å®ä¾‹ç±»å‹è¿›è¡Œåˆ†ç±»ã€‚è¿™è®©æ‚¨å¯ä»¥å¾ˆå®¹æ˜“åœ°çœ‹åˆ°è¿™ä¸ªå®ä¾‹åœ¨è´¦å•ä¸­å‘æ‚¨æ”¶å–äº†å¤šå°‘è´¹ç”¨ã€‚ç„¶åï¼Œç‚¹å‡»**ã€åˆ›å»ºå®ä¾‹ã€‘**æŒ‰é’®ï¼å¹¶ç­‰å¾…å®ä¾‹è¿›ç¨‹å®Œæˆã€‚

# ç™»å½•ç³»ç»Ÿï¼Œå°† Ghost æ›´æ–°åˆ° 4.0

ä¸å¹¸çš„æ˜¯ï¼Œäºšé©¬é€Šå¸‚åœºä¸Šçš„ Bitnami æ²¡æœ‰æä¾›æ–°çš„ Ghost ç‰ˆæœ¬ï¼Œåªæœ‰ 3.x ç‰ˆæœ¬ã€‚ä½†æˆ‘å¾ˆç¡®å®šï¼Œåˆ°æ—¶å€™ä»–ä»¬ä¼šæ›´æ–°çš„ã€‚è¦è¯•ç”¨ Ghost 4.0 çš„æ–°ç‰ˆæœ¬ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ›´æ–°ã€‚

![](img/6d303898484989e1af3414cf788e31d7.png)

æˆåŠŸåˆ›å»ºå®ä¾‹åï¼Œæ‚¨å¯ä»¥å¤åˆ¶ IP å¹¶åœ¨å›¾åƒã€http://13.229.112.207[ä¸Šæ‰“å¼€æ‚¨çš„æµè§ˆå™¨ç¤ºä¾‹](http://13.229.112.207)ã€‚æ‚¨ä¹Ÿå¯ä»¥ç‚¹å‡»æ§åˆ¶å°å›¾æ ‡(> _)ç™»å½•åˆ°æµè§ˆå™¨çš„ç»ˆç«¯ã€‚

## **1ã€‚å®‰è£…åº“å¹¶æ›´æ–° CLI**

```
cd /opt/bitnami/apps/ghost/lib/
```

*   æˆ‘ä»¬éœ€è¦è½¬åˆ° ghost çš„èŠ‚ç‚¹åº“çš„å®‰è£…è·¯å¾„ã€‚æ¯æ¬¡ä½ æƒ³æ·»åŠ ä¸€ä¸ªæ’ä»¶ï¼Œä½ å¯ä»¥å»è¿™ä¸ªè·¯å¾„ï¼Œå¹¶åš npm å®‰è£…ã€‚

```
echo â€˜{}â€™ | sudo tee package.json
sudo npm i ghost-cli@latest
```

*   é¦–å…ˆï¼Œæˆ‘ä»¬å°† package.json è®¾ç½®ä¸ºç©ºï¼Œä»¥é˜²æ­¢é”™è¯¯å®‰è£…ã€‚ä¹‹åï¼Œæ›´æ–° Ghost CLIï¼Œå¦‚æœæ‚¨æƒ³å®‰è£…å¦ä¸€ä¸ªåº“ï¼Œå°±ä¸éœ€è¦å†è¿™æ ·åšäº†ã€‚

```
sudo npm i ghost-storage-adapter-s3@latest
```

*   æˆ‘ä»¬è¿˜éœ€è¦ä¸º Amazon s3 å®‰è£…ä¸€ä¸ªå­˜å‚¨é€‚é…å™¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è¿æ¥æˆ‘ä»¬çš„å­˜å‚¨ï¼Œå¹¶å°†æ‰€æœ‰å›¾åƒèµ„äº§å­˜å‚¨åˆ°äºšé©¬é€Š S3 ä¸­ã€‚æˆ‘ç”¨çš„æ˜¯[ghost-storage-adapter-S3](https://github.com/colinmeinke/ghost-storage-adapter-s3)

## 2.æ›´æ–°å¹½çµ

```
cd /opt/bitnami/apps/ghost/htdocs/
```

*   æˆ‘ä»¬èµ°è¿™æ¡è·¯ï¼Œå› ä¸ºè¿™æ˜¯æˆ‘ä»¬çš„å¹½çµ CMS çš„ä¸»è¦è·¯å¾„ã€‚

```
ghost update v3
```

*   æˆ‘ä»¬éœ€è¦å°†å…¶æ›´æ–°åˆ° Ghost CMS çš„æœ€æ–°ç‰ˆæœ¬ 3ï¼Œå› ä¸ºæˆ‘ä»¬ä¸èƒ½å®Œå…¨è·³åˆ° v4ã€‚

```
ghost update
```

![](img/fb341d6fb4a7f4a5ba2e7d466f8dfb18.png)![](img/1b8f44bcbe0f06ed110626c32d13b4ab.png)

æŠ“ä½ä½ äº†ã€‚æˆ‘ä»¬ç»ˆäºæˆåŠŸåœ°å°†æˆ‘ä»¬çš„ Ghost æ›´æ–°åˆ°äº† 4.2.0ï¼

# è®¾ç½® S3 é€‚é…å™¨å’Œå–·æª

```
cp -rf config.production.json backup.json
nano config.production.json
```

*   é¦–å…ˆå¤‡ä»½ä½ çš„é…ç½®ï¼Œä»¥é˜²å‡ºé”™ã€‚ç„¶åä¹‹åå°±å¯ä»¥ç¼–è¾‘ **config.production.json** å…³æ³¨ä¸‹é¢æˆ‘çš„é…ç½®ã€‚

*   ä½ åªéœ€è¦ç¼–è¾‘ 3 ä»¶äº‹:**ç½‘å€ï¼Œé‚®ä»¶ï¼Œå’Œå­˜å‚¨ã€‚**
*   **ç½‘å€:**æ›¿æ¢ä½ çš„åŸŸåç½‘å€ï¼Œå¹¶ç¡®ä¿è®¾ç½®æ·»åŠ è®°å½•ï¼Œå¹¶æŒ‡å‘ä½ çš„åŸŸåä¸»æœºã€‚
*   æ›´å¤šå…³äº**é‚®ä»¶**çš„ä¿¡æ¯ï¼Œä½ å¯ä»¥é˜…è¯»è¿™ç¯‡[https://ghost.org/docs/config/#mail](https://ghost.org/docs/config/#mail)
*   æœ‰å…³**å­˜å‚¨**çš„æ›´å¤šä¿¡æ¯ï¼Œæ‚¨å¯ä»¥é˜…è¯»æ­¤[https://ghost.org/docs/config/#storage-adapters](https://ghost.org/docs/config/#storage-adapters)

```
cp -rf /opt/bitnami/apps/ghost/lib/node_modules/ghost-storage-adapter-s3 /opt/bitnami/apps/ghost/htdocs/versions/4.2.0/core/server/adapters/storage/s3
```

*   æˆ‘ä»¬éœ€è¦å°†æ¨¡å—å¤åˆ¶åˆ°æˆ‘ä»¬çš„å­˜å‚¨é€‚é…å™¨ä¸­ã€‚ç”¨ Ghost CMS ç‰ˆæœ¬æ›¿æ¢ 4.2.0ã€‚

```
sudo /opt/bitnami/ctlscript.sh restart
```

[é‡å¯æœåŠ¡å™¨](https://docs.bitnami.com/ibm/apps/ghost/administration/control-services/)ï¼Œæ­å–œä½ ï¼Œæˆ‘ä»¬ç»ˆäºå®Œæˆäº†äºšé©¬é€Š S3 å’Œç”µå­é‚®ä»¶çš„è®¾ç½®ï¼ğŸ»ğŸ‰ğŸ‰ğŸ‰

![](img/6ec4e14c31adb963e50067e38586fc98.png)![](img/878b52357017da5279cb311f4c9ef032.png)

é‚£ä¹ˆæˆ‘å¦‚ä½•ç™»å½•å‘¢ï¼Ÿï¼ŸğŸ˜‚ ğŸ˜‚ğŸ˜‚

```
sudo cat /home/bitnami/bitnami_credentials
```

*   åœ¨ç»ˆç«¯ä¸Šè¿è¡Œï¼Œä½ ä¼šçœ‹åˆ°ä½ çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•ï¼

# **é™„åŠ **

*   å¦‚æœä½ ä¸æƒ³çœ‹åˆ° Bitnami çš„æ ‡å¿—ã€‚åªéœ€è¿è¡Œè¿™ä¸ªå‘½ä»¤ã€‚

```
sudo /opt/bitnami/apps/ghost/bnconfig --disable_banner 1
```

*   å¦‚æœç”±äºæœªçŸ¥é”™è¯¯å¯¼è‡´å¯¼å…¥å†…å®¹å¤±è´¥ã€‚åˆ«å¿˜äº†å…ˆä¸Šä¼ ä½ çš„æ¨¡æ¿ï¼Œ[å¡æ–¯ç€](https://github.com/TryGhost/Casper)æˆ–[åˆ©å¸ƒæ—](https://ghost.org/themes/liebling/)ï¼Œç„¶åé‡æ–°å¯åŠ¨ã€‚

```
sudo /opt/bitnami/ctlscript.sh restart
```

*   æ‚¨å¯ä»¥åœ¨æ­¤è·¯å¾„ä¸­ç¼–è¾‘æ¨¡æ¿ã€‚åªè¦é€‰æ‹©ä½ çš„ä¸»é¢˜ï¼

```
/opt/bitnami/apps/ghost/htdocs/content/themes
```

# å¥–é‡‘

è¿™é‡Œæ˜¯æ‰€æœ‰å‘½ä»¤çš„åˆ—è¡¨ï¼Œä»¥é˜²æ‚¨éœ€è¦å®ƒä»¬æ¥éªŒè¯æ‚¨çš„å‘½ä»¤ã€‚

# 2021 å¹´ 7 æœˆ 22 æ—¥æ›´æ–°

æˆ‘åœ¨å®‰è£…æ–°ç‰ˆ Ghost CMS æ—¶é‡åˆ°äº†ä¸€äº›é—®é¢˜ã€‚å› æ­¤ï¼Œæˆ‘å°†å°è¯•åœ¨è¿™é‡Œé‡è¿°å®ƒã€‚

## æ¶ˆæ¯:Ghost v4.10.0 ä¸å½“å‰èŠ‚ç‚¹ç‰ˆæœ¬ä¸å…¼å®¹ã€‚

æ‚¨å¯èƒ½éœ€è¦å°† NodeJS ç‰ˆæœ¬æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚

```
sudo npm install -g n
sudo n stable
```

ä¹‹åï¼Œä½ éœ€è¦æ›´æ–°ä½ çš„**ã€‚bashrc**

```
nano ~/.bashrcFind and replace **/opt/bitnami/nodejs/bin/node** with **/usr/local/bin/node**
```

ç„¶åé€šè¿‡ä»¥ä¸‹æ–¹å¼æ›´æ–°æ‚¨çš„ ghost

```
ghost update
```

## æ¶ˆæ¯:æ— æ•ˆçš„é‚®ä»¶æœåŠ¡
é…ç½®å¯†é’¥:mail.options.service

è¿™å¾ˆå¥‡æ€ªï¼Œå› ä¸ºä½ å¯ä»¥ ghost stop å’Œ ghost startï¼Œè€Œä½ åªéœ€è¦ä½¿ç”¨ **ghost restartã€‚**

## åœ¨ Bitnami ä¸Šå¯ç”¨ apache2 HTTP/2 æ”¯æŒ

æ‰“å¼€ httpd.conf

```
nano /opt/bitnami/apache2/conf/httpd.conf
```

æ³¨é‡Šæ‰ä¸‹é¢ä¸€è¡Œ

```
LoadModule mpm_event_module modules/mod_mpm_event.so
# LoadModule mpm_prefork_module modules/mod_mpm_prefork.so
LoadModule http2_module modules/mod_http2.so
```

æ‰“å¼€ bitnami.conf

```
sudo nano /opt/bitnami/apache2/conf/bitnami/bitnami.conf
```

æ·»åŠ ä»¥ä¸‹ä¸€è¡Œ

```
<VirtualHost _default_:80>
....
 Protocols h2 h2c http/1.1
 H2Direct on
</VirtualHost><VirtualHost _default_:443>
....
Protocols h2 h2c http/1.1
H2Direct on
</VirtualHost>
```

ç„¶åé‡å¯

```
sudo /opt/bitnami/ctlscript.sh restart apache
```

ä½ å¿˜è®° ghost ç®¡ç†å‘˜å¯†ç äº†å—ï¼Ÿ
ä½ å¤§æ¦‚æƒ³çœ‹è¿™ç¯‡æ–‡ç« [https://www.geekinsta.com/how-to-reset-ghost-password/](https://www.geekinsta.com/how-to-reset-ghost-password/)

å¸Œæœ›è¿™æœ‰å¸®åŠ©ï¼è¯·[ç»™æˆ‘](mailto:hi@rahmatramadhan.com)ä¸€äº›åé¦ˆï¼