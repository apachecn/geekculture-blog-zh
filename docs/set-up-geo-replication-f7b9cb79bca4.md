# è®¾ç½®åœ°ç†å¤åˆ¶

> åŸæ–‡ï¼š<https://medium.com/geekculture/set-up-geo-replication-f7b9cb79bca4?source=collection_archive---------7----------------------->

![](img/efaa655d3c7d55ca3a73416e83afeb72.png)

Geo-replication

åœ¨ä¸Šä¸€ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†åœ°ç†å¤åˆ¶çš„åŸºç¡€çŸ¥è¯†åŠå…¶ä¸åŒçš„éƒ¨ç½²æœåŠ¡ã€‚åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†ä¸€æ­¥ä¸€æ­¥åœ°è¿›è¡Œè®¾ç½®ã€‚ğŸš¶

# å…ˆå†³æ¡ä»¶ğŸ‘·

æ‚¨è‡³å°‘æœ‰ 2 å°è™šæ‹Ÿæœºã€‚å…¶ä¸­ä¸€ä¸ªå°†å®¹çº³ä¸»éŸ³é‡ğŸ’¾è€Œå¦ä¸€ä¸ªå°†æŒæœ‰**äºŒçº§å·ğŸ’¾**ã€‚æˆ‘ä»¬å°†åªåœ¨è¿™ä¸¤ä¸ªå·ä¸Šè®¾ç½®åœ°ç†å¤åˆ¶ã€‚

è®©æˆ‘ä»¬ç°åœ¨å¼€å§‹è®¾ç½®ğŸ˜„

# è®¾ç½®ğŸ”§

1.  åˆ›å»º 2 ä¸ªå·ã€‚å¦‚æœæ‚¨æƒ³çŸ¥é“å¦‚ä½•è®¾ç½®å·ï¼Œè¯·å‚è€ƒæœ¬æ–‡

[](/dev-genius/replica-volume-in-glusterfs-b05324ce1b6f) [## glusterfs ä¸­çš„å‰¯æœ¬å·

### è¿™æ˜¯å»ºç«‹ glusterfs å·¥ä½œç¯å¢ƒæ•…äº‹çš„å»¶ç»­ã€‚

medium.com](/dev-genius/replica-volume-in-glusterfs-b05324ce1b6f) 

è¿™æ˜¯å‰¯æœ¬å·ã€‚åªæœ‰ 2 å°æœåŠ¡å™¨æ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ 2 ä¸ªåˆ†å¸ƒå¼å·ï¼Œæ¯ä¸ªå·æœ‰ 1 å°æœåŠ¡å™¨ã€‚å¯ä»¥å‚è€ƒä¹‹åçš„[ã€‚](https://docs.gluster.org/en/latest/Administrator-Guide/Setting-Up-Volumes/#creating-distributed-volumes)

2.å¼€å§‹ğŸš²ç¬¬ 2 å·ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘å°†è¿™ä¸¤å·çœ‹ä½œæ˜¯ **geom** (ä¸»å·)å’Œ **geos** (å‰¯å·)

```
# gluster vol start geom
# gluster vol start geos
```

ä»¥ä¸‹ä¸¤ä¸ªå‘½ä»¤å¿…é¡»æˆåŠŸï¼Œå¦åˆ™å·ä¸ä¼šå¯åŠ¨ã€‚

3.å¦‚æœæ‚¨çš„ä¸»ç¾¤é›†:

*   è‡³å°‘æœ‰ 2 ä¸ªèŠ‚ç‚¹çš„**ç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¹¶ç›´æ¥è½¬åˆ°**æ­¥éª¤ 8****

```
# gluster vol set all cluster.enable-shared-storage enable
```

*   ä»**æ­¥éª¤ 4** å¼€å§‹ï¼Œé›†ç¾¤ä¸­æœ‰**ä¸ªèŠ‚ç‚¹**ã€‚

4.æ‚¨éœ€è¦åœ¨ä¸»æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªå…±äº«å­˜å‚¨å·ã€‚(æ‚¨å¯ä»¥ç”¨ IP åœ°å€æ›¿æ¢ä¸»æœºå)

```
# gluster vol create gluster_shared_storage replica 3 servera:/data/glusterfs/avol/brick1/b11 servera:/data/glusterfs/avol/brick1/b12 servera:/data/glusterfs/avol/brick1/b13 force
```

ä¸ºä»€ä¹ˆ**é€¼**ï¼ŸğŸ˜ˆ

è¿™æ˜¯å› ä¸ºå®ƒä¼šç»™å‡ºè­¦å‘ŠğŸ˜·å› ä¸ºæ‚¨å°è¯•åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šä½¿ç”¨ä¸‰å—ç –åˆ›å»ºå¤åˆ¶å‰¯æœ¬å·ï¼Œå› æ­¤ä¼šå¤±è´¥ã€‚å¦‚æœä½ ä¸å¸Œæœ›è¿™ç§æƒ…å†µå‘ç”Ÿï¼Œæœ€ç»ˆæœ‰å¿…è¦å¢åŠ åŠ›é‡ã€‚

5.å¼€å§‹ğŸš²æ‚¨ç°åœ¨åˆ›å»ºçš„å…±äº«å·

```
# gluster vol start gluster_shared_storage
```

6.ç°åœ¨æ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªå…±äº«å­˜å‚¨ç›®å½•ã€‚ğŸ’¾è¿™å°†ç”¨ä½œå…±äº«å­˜å‚¨çš„è£…è½½ç‚¹ã€‚

```
# mkdir -p /var/run/gluster/shared_storage
```

> åœ¨ **mkdir** - **p** å‘½ä»¤çš„å¸®åŠ©ä¸‹ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªç›®å½•çš„å­ç›®å½•ã€‚å¦‚æœçˆ¶ç›®å½•ä¸å­˜åœ¨ï¼Œå®ƒå°†é¦–å…ˆåˆ›å»ºçˆ¶ç›®å½•ã€‚ä½†æ˜¯ï¼Œå¦‚æœå®ƒå·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆå®ƒå°†ä¸ä¼šæ‰“å°é”™è¯¯æ¶ˆæ¯ï¼Œå¹¶å°†è¿›ä¸€æ­¥åˆ›å»ºå­ç›®å½•ã€‚

7.æŒ‚è½½å…±äº«å·ğŸ’¾åœ¨åˆšåˆšåˆ›å»ºçš„ç›®å½•ä¸­ã€‚

```
# mount -t glusterfs servera:gluster_shared_storage /var/run/gluster/shared_storage
```

> å½“æ‚¨â€œæŒ‚è½½â€æŸä¸ªä¸œè¥¿æ—¶ï¼Œæ‚¨å°†å¯¹å…¶ä¸­åŒ…å«çš„æ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æƒæ”¾åœ¨äº†æ‚¨çš„æ ¹æ–‡ä»¶ç³»ç»Ÿç»“æ„ä¸Šã€‚æœ‰æ•ˆåœ°ç»™å‡ºæ–‡ä»¶çš„ä½ç½®ã€‚

è¦äº†è§£æ›´å¤šå…³äºåéª‘çš„ä¿¡æ¯ï¼Œè¯·å‚è€ƒ[æœ¬](https://askubuntu.com/questions/20680/what-does-it-mean-to-mount-something)ã€‚

8.**æ— å¯†ç  ssh è®¾ç½®:**

åœ¨ä»»ä¸€å°ä¸»æœåŠ¡å™¨ä¸Šç”Ÿæˆ ssh-keyğŸ”‘

```
# ssh-keygen
```

å°† ssh-key å¤åˆ¶åˆ°ä»»ä½•ä¸€ä¸ªè¾…åŠ©æœåŠ¡å™¨ä¸Š

```
# ssh-copy-id root@serverb 
```

æ‚¨å¯ä»¥ç”¨ IP åœ°å€æ›¿æ¢ä¸»æœºåã€‚

9.åˆ›å»º ssh å¯†é’¥

```
# gluster system:: execute gsec_create 
```

è¯¥å‘½ä»¤æ‰§è¡Œä»¥ä¸‹æ“ä½œ:

*   å®ƒåˆ›å»ºäº†ä¸¤å¯¹ ssh å¯†é’¥(ç§æœ‰å’Œå…¬å…±)ï¼Œä¸€å¯¹ç”¨äºé›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„â€œtar over ssg â€,å¦ä¸€å¯¹ç”¨äºâ€œgsyncd shellâ€ã€‚
*   å®ƒåœ¨ ssh å…¬é’¥å‰é¢åˆ†åˆ«åŠ ä¸Š COMMAND = " tar $ { SSH _ ORIGINAL _ COMMAND # * } "å’Œ' COMMAND = "/usr/lib exec/glusterfs/gsyncd " 'ä½œä¸º' tar 'å’Œ gsyncd ssh å…¬é’¥çš„å‰ç¼€ã€‚
*   å®ƒå°†æ¥è‡ªé›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹çš„ä¸Šè¿°å¸¦å‰ç¼€çš„ ssh å…¬é’¥èšåˆåˆ°ä½äºâ€œ/var/lib/glusterd/geo-replication/common-secret . PEM . pubâ€çš„å•ä¸ªæ–‡ä»¶ä¸­

10.åˆ›å»ºä¼šè¯å¹¶å°† ssh å¯†é’¥æ¨é€åˆ°æ‰€æœ‰è¾…åŠ©é›†ç¾¤èŠ‚ç‚¹ã€‚

```
# gluster vol geo-rep geom serverb::geos create push-pem
```

11.æ‚¨éœ€è¦ä¸ºåœ°ç†æŠ¥å‘Šå¯ç”¨`gluster_shared_storage`ã€‚å°½ç®¡å¦‚æœä¸»å·ä¸æ˜¯å¤åˆ¶å·/ EC å·ï¼Œå¯ä»¥å¿½ç•¥æ­¤æ­¥éª¤ã€‚

```
# gluster vol geo-rep geom serverb::geos config use_meta_volume true
```

åœ°ç†ä»£è¡¨ä½¿ç”¨å…±äº«å­˜å‚¨å·æ¥å†³å®šå“ªä¸ªå·¥ä½œè€…å¿…é¡»æ˜¯æ´»åŠ¨çš„ã€‚å®ƒä¸ºæ¯ä¸ªå‰¯æœ¬åˆ›å»ºå…¬å…±æ–‡ä»¶ï¼Œå¹¶ä¸”å·¥äººè·å¾—å…¶ä¸Šçš„ fcntl é”ï¼Œæ— è®ºè°èµ¢éƒ½å°†æˆä¸ºæ´»åŠ¨çš„ã€‚

12.é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥åœ°ç†ä»£è¡¨çš„çŠ¶æ€ã€‚

```
# gluster vol geo-rep geom serverb::geos status
```

æ‚¨å°†çœ‹åˆ°ä¸€ä¸ªè¡¨æ ¼ï¼Œå…¶ä¸­æ˜¾ç¤ºäº†åœ°ç†ä»£è¡¨å·¥ä½œäººå‘˜çš„çŠ¶æ€ã€‚å®ƒåº”è¯¥æ˜¾ç¤º**åˆ›å»ºäº†**ã€‚

13.æ‚¨éœ€è¦å¯åŠ¨åœ°ç†ä»£è¡¨å¹¶å†æ¬¡æ£€æŸ¥çŠ¶æ€ã€‚

```
# gluster vol geo-rep geom serverb::geos start
# gluster vol geo-rep geom serverb::geos status
```

æ‰€æœ‰ geo-rep worker çš„çŠ¶æ€éƒ½åº”è¯¥è½¬åˆ°**åˆå§‹åŒ–**ï¼Œç„¶åè½¬åˆ°**å†å²æŠ“å–**å†è½¬åˆ°**å˜æ›´æ—¥å¿—æŠ“å–**ã€‚

## å’Œ**å®ŒæˆğŸ˜ƒğŸŠ**

# å‚è€ƒ

 [## Gluster æ–‡æ¡£

### GlusterFS æ˜¯ä¸€ä¸ªå¯æ‰©å±•çš„ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼Œé€‚ç”¨äºæ•°æ®å¯†é›†å‹ä»»åŠ¡ï¼Œå¦‚äº‘å­˜å‚¨å’Œåª’ä½“æµâ€¦

docs.gluster.org](https://docs.gluster.org/en/latest/) 

# å¦å¤–ï¼Œé˜…è¯»

[](https://ujjwal-msrit.medium.com/gluster-directory-quotas-ebdf95bbfef6) [## Gluster â€”ç›®å½•é…é¢

### ä»€ä¹ˆæ˜¯é…é¢ï¼Ÿ

ujjwal-msrit.medium.com](https://ujjwal-msrit.medium.com/gluster-directory-quotas-ebdf95bbfef6) [](/geekculture/compiling-rpms-36ac24970f0e) [## ç¼–è¯‘ rpm

### å†…å®¹ğŸ“‘

medium.com](/geekculture/compiling-rpms-36ac24970f0e)