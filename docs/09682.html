<html>
<head>
<title>Implementing JSON Web Token (JWT) Authentication using Spring Security | A Detailed Walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨Spring Securityå®ç°JSON Web Token (JWT)èº«ä»½éªŒè¯|è¯¦ç»†æ¼”ç»ƒ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/geekculture/implementing-json-web-token-jwt-authentication-using-spring-security-detailed-walkthrough-1ac480a8d970?source=collection_archive---------0-----------------------#2021-12-23">https://medium.com/geekculture/implementing-json-web-token-jwt-authentication-using-spring-security-detailed-walkthrough-1ac480a8d970?source=collection_archive---------0-----------------------#2021-12-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/bfbfc805c327e20b436bce950532c027.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_zKqjikwDHSSSVZD"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Photo by <a class="ae iu" href="https://unsplash.com/@flyd2069?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">FLY:D</a> on <a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="aa50" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">ä»‹ç»</h1><p id="9417" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å­¦ä¹ ä½¿ç”¨Spring Bootå’ŒSpring Securityå®ç°Json Web Token ( JWT)è®¤è¯ã€‚é¦–å…ˆï¼Œæ‚¨å°†äº†è§£ä¸€äº›å…³äºJWTsçš„åŸºæœ¬ç†è®ºï¼Œç„¶åæ‚¨å°†åˆ‡æ¢åˆ°åŠ¨æ‰‹æ¨¡å¼ï¼Œå¹¶åœ¨æ‚¨çš„Springåº”ç”¨ç¨‹åºä¸­å®ç°å®ƒã€‚æˆ‘ä¼šè¯¦ç»†è§£é‡Šæ¯ä¸€æ­¥ï¼Œæ‰€ä»¥åšæŒåˆ°æœ€åã€‚</p><blockquote class="kr ks kt"><p id="34b1" class="jt ju ku jv b jw kv jy jz ka kw kc kd kx ky kg kh kz la kk kl lb lc ko kp kq hb bi translated"><strong class="jv hj">å¿…è¯»:</strong>å¦‚æœä½ æ˜¯JWTsæ–°æ‰‹ï¼Œé‚£å°±ç»§ç»­è¯»ä¸‹å»ã€‚ç„¶è€Œï¼Œå¦‚æœä½ å·²ç»ä½¿ç”¨è¿‡jwtæˆ–è€…å¯¹å®ƒä»¬æœ‰æ‰€äº†è§£ï¼Œå¹¶ä¸”æƒ³è¦å¼€å§‹å®ç°ï¼Œé‚£ä¹ˆç‚¹å‡»<a class="ae iu" href="#b0bf" rel="noopener ugc nofollow">è¿™é‡Œ</a>ã€‚</p></blockquote><figure class="le lf lg lh fd ij er es paragraph-image"><div class="er es ld"><img src="../Images/20a04054d7ffad8ebf0c1c975961cf36.png" data-original-src="https://miro.medium.com/v2/resize:fit:608/0*TLC36VtogEVQs-8N"/></div></figure><h1 id="cf90" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated"><span class="l li lj lk bm ll lm ln lo lp di">W</span>JWTçš„å¸½å­æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p id="0f74" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">JSON Web Token (JWT)æ˜¯ä¸€ä¸ªå¼€æ”¾çš„äº’è”ç½‘æ ‡å‡†ï¼Œç”¨äºåœ¨åŒæ–¹ä¹‹é—´å…±äº«å®‰å…¨ä¿¡æ¯ã€‚è¿™ä¸ªä»¤ç‰ŒåŒ…å«ä¸€ä¸ªJSONâ€œæœ‰æ•ˆè´Ÿè½½â€,å®ƒä½¿ç”¨åŠ å¯†ç®—æ³•è¿›è¡Œäº†æ•°å­—ç­¾å(ä½¿ç”¨ç§æœ‰ç§˜å¯†æˆ–å…¬å…±/ç§æœ‰å¯†é’¥)ã€‚æ•°å­—ç­¾åä½¿ä»¤ç‰Œä¸ä¼šè¢«ç¯¡æ”¹ï¼Œå› ä¸ºè¢«ç¯¡æ”¹çš„ä»¤ç‰Œä¼šå¤±æ•ˆã€‚</p><p id="80d2" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">JWTçœ‹èµ·æ¥åƒè¿™æ ·</p><p id="50bd" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated"><strong class="jv hj">eyjhbgcioijiuzi 1 NII SINR 5 CCI 6 ikpxvcj 9 . eyjzdwiiixmjm 0 nty 3 odkwiiwibmftzsi 6 ikpvag 4g rg 9 liiwiawf 0 ijo xnte 2 mjm 5 mdiyfq . fgk 5 PCL 49k 3 jfncq 6 wztn 6t-ug 9 dv 4 hoyim 55 xtux8w</strong></p><p id="01b1" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">ä¸€æ®µä»¤äººç•æƒ§çš„æ–‡å­—ï¼Œæ˜¯å§ï¼Ÿ</p><p id="3a8b" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">å¦‚æœä½ ä»”ç»†è§‚å¯Ÿï¼Œä½ ä¼šæ³¨æ„åˆ°ä¸¤ä¸ªå¥å·(ã€‚)JWTä¸­çš„ç¬¦å·ã€‚è¿™äº›å‘¨æœŸç¬¦å·å°†JWTåˆ†æˆä¸‰ä¸ªéƒ¨åˆ†â€” <strong class="jv hj">æŠ¥å¤´ã€æœ‰æ•ˆè½½è·å’Œç­¾å</strong>ã€‚</p><p id="caa6" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">JWTçš„ä¸€èˆ¬å½¢å¼æ˜¯-&gt;<strong class="jv hj">header . payload . signature .</strong></p><h2 id="f0d0" class="lq iw hi bd ix lr ls lt jb lu lv lw jf ke lx ly jj ki lz ma jn km mb mc jr md bi translated">é¡µçœ‰</h2><p id="0cc8" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">ä»¤ç‰Œçš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œå¤´æ˜¯ä¸€ä¸ªJSONå¯¹è±¡ï¼ŒåŒ…å«ä¸¤ä¸ªå±æ€§ï¼Œ<strong class="jv hj"> typ </strong>(è¡¨ç¤ºä»¤ç‰Œçš„ç±»å‹ï¼Œå³JWT)å’Œ<strong class="jv hj"> alg </strong>(ç”¨äºç­¾åçš„ç®—æ³•)ã€‚</p><pre class="le lf lg lh fd me mf mg mh aw mi bi"><span id="3389" class="lq iw hi mf b fi mj mk l ml mm">{<br/>"typ": "JWT",<br/>"alg": "HS256"<br/>}</span></pre><p id="c3fd" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">è¿™ä¸ªJSONå¯¹è±¡æ˜¯Base64Urlç¼–ç çš„ï¼Œæ„æˆå­—ç¬¦ä¸²çš„ç¬¬ä¸€éƒ¨åˆ†ã€‚</p><h2 id="b152" class="lq iw hi bd ix lr ls lt jb lu lv lw jf ke lx ly jj ki lz ma jn km mb mc jr md bi translated">æœ‰æ•ˆè½½è·</h2><p id="ae36" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">ä»¤ç‰Œçš„ç¬¬äºŒéƒ¨åˆ†ï¼Œå³æœ‰æ•ˆè½½è·ï¼ŒåŒ…å«æ‚¨å¸Œæœ›ä½¿ç”¨æ­¤JWTä¼ è¾“çš„æ•°æ®æˆ–â€œå£°æ˜â€ã€‚æœ‰ä¸€äº›æ˜ç¡®çš„å£°æ˜ï¼Œå¦‚</p><ul class=""><li id="958f" class="mn mo hi jv b jw kv ka kw ke mp ki mq km mr kq ms mt mu mv bi translated"><strong class="jv hj">å­</strong> â€”ä»¤ç‰Œçš„ä¸»é¢˜</li><li id="8be4" class="mn mo hi jv b jw mw ka mx ke my ki mz km na kq ms mt mu mv bi translated"><strong class="jv hj"> iss </strong> â€”ä»¤ç‰Œçš„å‘è¡Œè€…</li><li id="9d1e" class="mn mo hi jv b jw mw ka mx ke my ki mz km na kq ms mt mu mv bi translated"><strong class="jv hj"> exp </strong> â€”ä»¤ç‰Œçš„åˆ°æœŸæ—¶é—´</li><li id="35db" class="mn mo hi jv b jw mw ka mx ke my ki mz km na kq ms mt mu mv bi translated"><strong class="jv hj"> aud </strong> â€”ä»£å¸çš„å—ä¼—</li></ul><p id="d467" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">æ‚¨è¿˜å¯ä»¥æ·»åŠ ä¸¤ç«¯éƒ½åŒæ„çš„è‡ªå®šä¹‰å£°æ˜ï¼Œå¹¶æä¾›æœ‰å…³ä»¤ç‰Œçš„å…±äº«é¢å¤–ä¿¡æ¯ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œâ€œè§’è‰²â€æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰å£°æ˜ã€‚</p><pre class="le lf lg lh fd me mf mg mh aw mi bi"><span id="68b3" class="lq iw hi mf b fi mj mk l ml mm">{   <br/>  "sub": "john.doe@gmail.com",   <br/>  "iss": "ABC Pvt Ltd",   <br/>  "role": "ADMIN"<br/>}</span></pre><h2 id="d71e" class="lq iw hi bd ix lr ls lt jb lu lv lw jf ke lx ly jj ki lz ma jn km mb mc jr md bi translated">ç­¾å</h2><p id="8184" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">ç­¾åæ˜¯é€šè¿‡è·å–å‰ä¸¤éƒ¨åˆ†çš„ç¼–ç å­—ç¬¦ä¸²å¹¶å°†å…¶ä¸æ‚¨çš„ç§˜å¯†ä¸€èµ·ä¼ é€’ç»™ç­¾åç®—æ³•æ¥åˆ›å»ºçš„ã€‚</p><pre class="le lf lg lh fd me mf mg mh aw mi bi"><span id="37d7" class="lq iw hi mf b fi mj mk l ml mm">HMACSHA256(   <br/> base64UrlEncode(header) + "." + base64UrlEncode(payload),   <br/> secret<br/>)</span></pre><p id="0975" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">è¾“å‡ºæ˜¯æ‚¨ä¹‹å‰çœ‹åˆ°çš„JWT</p><h1 id="b0bf" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">JWTè®¤è¯æµç¨‹</h1><p id="90f6" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">ä¸‹å›¾æ˜¾ç¤ºäº†JWTè®¤è¯çš„æµç¨‹ã€‚æ­£å¦‚æ‚¨åœ¨ä¸‹å›¾ä¸­çœ‹åˆ°çš„ï¼ŒæœåŠ¡å™¨ç«¯æ²¡æœ‰å­˜å‚¨ä»»ä½•ä¸œè¥¿ã€‚</p><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nb"><img src="../Images/df8a130cab1f8f9c2bbc8844a92391d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hkxbBKA58IAPVdiqm2A2ug.png"/></div></div></figure><h1 id="8986" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">è¡ŒåŠ¨ï¼ˆæˆ–æ´»åŠ¨ã€è¢­å‡»ï¼‰è®¡åˆ’</h1><p id="7371" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">æ‚¨å°†æ„å»ºä¸€ä¸ªå…¬å¼€ä¸‰ä¸ªç«¯ç‚¹çš„REST API</p><ol class=""><li id="ae14" class="mn mo hi jv b jw kv ka kw ke mp ki mq km mr kq nc mt mu mv bi translated"><code class="du nd ne nf mf b"><strong class="jv hj">/api/auth/register</strong></code> â€”åˆ›å»ºå¹¶ä¿å­˜ä¸€ä¸ª<code class="du nd ne nf mf b">User</code>å®ä½“å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨ä½¿ç”¨è¯¥å®ä½“æ„å»ºçš„JWTè¿›è¡Œå“åº”ã€‚</li><li id="5734" class="mn mo hi jv b jw mw ka mx ke my ki mz km na kq nc mt mu mv bi translated"><code class="du nd ne nf mf b"><strong class="jv hj">/api/auth/login</strong></code> â€”éªŒè¯ç”¨æˆ·å‡­è¯å¹¶ç”ŸæˆJWT</li><li id="75c9" class="mn mo hi jv b jw mw ka mx ke my ki mz km na kq nc mt mu mv bi translated"><code class="du nd ne nf mf b"><strong class="jv hj">/api/user/info</strong></code> â€”å—ä¿æŠ¤çš„è·¯ç”±ï¼Œä¸ºè®¤è¯ç”¨æˆ·å“åº”ç”¨æˆ·ä¿¡æ¯</li></ol><blockquote class="kr ks kt"><p id="86d4" class="jt ju ku jv b jw kv jy jz ka kw kc kd kx ky kg kh kz la kk kl lb lc ko kp kq hb bi translated"><strong class="jv hj">å¿…è¯»:åœ¨è¿™é‡Œ</strong>  <strong class="jv hj">å¯ä»¥æ‰¾åˆ°è¿™ä¸ªGitHubèµ„æºåº“ä¸­å®Œæ•´çš„æ–‡æ¡£åŒ–ä»£ç - &gt; </strong> <a class="ae iu" href="https://github.com/senshiii/Spring-Security-JWT-Authentication" rel="noopener ugc nofollow" target="_blank"> <strong class="jv hj">ã€‚æˆ‘å»ºè®®æ‚¨ä¸‹è½½è¯¥é¡¹ç›®ï¼Œå¹¶ä»”ç»†é˜…è¯»å‡ ä¹ä¸æ¯ä¸€è¡Œç›¸å…³çš„æ³¨é‡Šï¼Œå› ä¸ºè¿™äº›æ³¨é‡Šæä¾›äº†â€œä¸€åˆ‡â€çš„è¯¦ç»†è§£é‡Š(åŒ…æ‹¬ä½œä¸ºå…ˆå†³æ¡ä»¶æ‚¨åº”è¯¥çŸ¥é“çš„åŸºæœ¬å†…å®¹)ã€‚ä½ å¯ä»¥åœ¨ä¸Šé¢åˆ†äº«çš„GitHubé“¾æ¥ä¸­æ‰¾åˆ°ä¸‹è½½å’Œä½¿ç”¨æºä»£ç çš„è¯´æ˜ã€‚</strong></a></p></blockquote><h1 id="c2be" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">è®¾ç½®é¡¹ç›®</h1><p id="33e4" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">æ˜¯æ—¶å€™åŠ¨æ‰‹åšä¸€äº›äº‹æƒ…äº†ï¼Œçœ‹çœ‹æ‰€æœ‰è¿™äº›éƒ½æ˜¯å¦‚ä½•æ“ä½œçš„ã€‚è¦è®¾ç½®æ‚¨çš„Spring Booté¡¹ç›®ï¼Œè¯·è®¿é—®<a class="ae iu" href="https://start.spring.io/" rel="noopener ugc nofollow" target="_blank">å…¥é—¨ç½‘ç«™</a>ã€‚ç¡®ä¿æ‚¨å·²ç»é€‰æ‹©äº†<strong class="jv hj"> Maven </strong>é¡¹ç›®å’Œæœ€æ–°ç‰ˆæœ¬çš„Spring Boot(æ²¡æœ‰å¿«ç…§)ã€‚</p><p id="f396" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">æ·»åŠ ä»¥ä¸‹ä¾èµ–é¡¹:-</p><ol class=""><li id="5329" class="mn mo hi jv b jw kv ka kw ke mp ki mq km mr kq nc mt mu mv bi translated"><strong class="jv hj"> Spring Web </strong>:ç”¨äºæ„å»ºWebåº”ç”¨</li></ol><p id="42ac" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">2.<strong class="jv hj"> Spring Security </strong>:ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºå¢åŠ å®‰å…¨æ€§</p><p id="25e5" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">3.æ˜¥å­£æ•°æ®JPA :æŒç»­æ€§</p><p id="992e" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">4.<strong class="jv hj"> H2æ•°æ®åº“</strong>:å†…å­˜æ•°æ®åº“ï¼Œç”¨äºå­˜å‚¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ•°æ®</p><p id="cce4" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">5.<strong class="jv hj"> Lombok </strong>:ä½¿ç”¨æ³¨é‡Šå¸®åŠ©å‡å°‘æ ·æ¿ä»£ç </p><p id="060e" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">æ‚¨å¯ä»¥éšæ„å¡«å†™<strong class="jv hj">ç¥å™¨</strong>ã€<strong class="jv hj">åç§°</strong>å’Œ<strong class="jv hj">æè¿°</strong>å­—æ®µã€‚æœ€åï¼Œå®ƒåº”è¯¥çœ‹èµ·æ¥åƒè¿™æ ·ã€‚</p><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ng"><img src="../Images/eb864c817260e18af5c387d86505a556.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xq1u5i-rg_DylyXIWFgjDA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Setting up Spring Boot project</figcaption></figure><p id="a518" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">ç‚¹å‡»Generateï¼Œå®ƒä¼šä¸‹è½½ä¸€ä¸ªåŒ…å«å¯åŠ¨æ–‡ä»¶çš„æ¡£æ¡ˆã€‚æå–æ–‡ä»¶ï¼Œå¹¶åœ¨æ‚¨å–œæ¬¢çš„IDEä¸­æ‰“å¼€å®ƒä»¬ã€‚è¿™å°†æ˜¯é¡¹ç›®çš„æ–‡ä»¶ç»“æ„</p><pre class="le lf lg lh fd me mf mg mh aw mi bi"><span id="2863" class="lq iw hi mf b fi mj mk l ml mm">com<br/>    â””â”€â”€â”€example<br/>        â””â”€â”€â”€springsecurityjwttutorial<br/>            â”‚   SpringSecurityJwtTutorialApplication.java<br/>            â”‚<br/>            â”œâ”€â”€â”€controllers<br/>            â”‚       AuthController.java<br/>            â”‚       UserController.java<br/>            â”‚<br/>            â”œâ”€â”€â”€entity<br/>            â”‚       User.java<br/>            â”‚<br/>            â”œâ”€â”€â”€models<br/>            â”‚       LoginCredentials.java<br/>            â”‚<br/>            â”œâ”€â”€â”€repository<br/>            â”‚       UserRepo.java<br/>            â”‚<br/>            â””â”€â”€â”€security<br/>                    JWTFilter.java<br/>                    JWTUtil.java<br/>                    MyUserDetailsService.java<br/>                    SecurityConfig.java</span></pre><h1 id="e264" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">è®¡åˆ’çš„æ‰§è¡Œ</h1><h2 id="4f25" class="lq iw hi bd ix lr ls lt jb lu lv lw jf ke lx ly jj ki lz ma jn km mb mc jr md bi translated">å®ä½“</h2><p id="b1fe" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">é¦–å…ˆè®©æˆ‘ä»¬åˆ›å»ºæˆ‘ä»¬çš„ç”¨æˆ·å®ä½“ã€‚åˆ›å»ºä¸€ä¸ªæ–°çš„åŒ…<code class="du nd ne nf mf b"><strong class="jv hj">entity</strong></code>å’Œä¸€ä¸ªç±»<code class="du nd ne nf mf b"><strong class="jv hj">User</strong></code>ã€‚è¿™ä¸ªç±»ç”¨idã€emailå’Œå¯†ç å­—æ®µå®šä¹‰äº†<code class="du nd ne nf mf b"><strong class="jv hj">User</strong></code> POJOã€‚<code class="du nd ne nf mf b"><strong class="jv hj">@Entity</strong></code>æ³¨é‡Šå°†è¯¥ç±»æ ‡è®°ä¸ºä¸€ä¸ªå®ä½“ï¼Œå…¶ä»–æ³¨é‡Šæ˜¯Lombokæ³¨é‡Šï¼Œä»¥å‡å°‘æ ·æ¿ä»£ç (ä¾‹å¦‚æ·»åŠ gettersã€settersã€constructorsç­‰ã€‚).</p><blockquote class="kr ks kt"><p id="795e" class="jt ju ku jv b jw kv jy jz ka kw kc kd kx ky kg kh kz la kk kl lb lc ko kp kq hb bi translated"><strong class="jv hj">æ³¨æ„:</strong><code class="du nd ne nf mf b"><strong class="jv hj">@JsonProperty(access = JsonProperty.Access.WRITE<em class="hi">_ONLY</em>)</strong></code><strong class="jv hj"/>é˜²æ­¢å¯†ç å­—æ®µåŒ…å«åœ¨JSONå“åº”ä¸­ã€‚</p></blockquote><pre class="le lf lg lh fd me mf mg mh aw mi bi"><span id="8f20" class="lq iw hi mf b fi mj mk l ml mm">package com.example.springsecurityjwttutorial.entity;<br/><br/>import com.fasterxml.jackson.annotation.JsonProperty;<br/>import lombok.Getter;<br/>import lombok.NoArgsConstructor;<br/>import lombok.Setter;<br/>import lombok.ToString;<br/><br/>import javax.persistence.Entity;<br/>import javax.persistence.GeneratedValue;<br/>import javax.persistence.GenerationType;<br/>import javax.persistence.Id;<br/><br/>@Entity<br/>@Getter<br/>@Setter<br/>@ToString<br/>@NoArgsConstructor<br/>public class User {<br/><br/>    @Id<br/>    @GeneratedValue(strategy = GenerationType.<em class="ku">AUTO</em>)<br/>    private Long id;<br/><br/>    private String email;<br/><br/>    @JsonProperty(access = JsonProperty.Access.WRITE<em class="ku">_ONLY</em>)<br/>    private String password;<br/><br/>}</span></pre><h2 id="9b85" class="lq iw hi bd ix lr ls lt jb lu lv lw jf ke lx ly jj ki lz ma jn km mb mc jr md bi translated">è´®è—å®¤ËŒä»“åº“</h2><p id="3a71" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">ç°åœ¨æˆ‘ä»¬æœ‰äº†å®ä½“ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæŒä¹…åŒ–å®ƒçš„æ–¹æ³•ã€‚æ–°å»ºä¸€ä¸ª<code class="du nd ne nf mf b"><strong class="jv hj">repository</strong></code> <strong class="jv hj"> </strong>åŒ…ï¼Œæ–°å»ºä¸€ä¸ª<code class="du nd ne nf mf b"><strong class="jv hj">UserRepo</strong></code> <strong class="jv hj">æ¥å£ã€‚</strong>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªè‡ªå®šä¹‰æ–¹æ³•<code class="du nd ne nf mf b"><strong class="jv hj">findByEmail(String email)</strong></code> <strong class="jv hj"> </strong>ï¼Œå®ƒæ ¹æ®ç”¨æˆ·çš„ç”µå­é‚®ä»¶æ¥æ£€ç´¢ç”¨æˆ·å®ä½“ã€‚(æœ‰ç‚¹ä¸è¨€è‡ªæ˜ï¼Œå—¯ï¼Ÿ\_(*.*)_/ )</p><pre class="le lf lg lh fd me mf mg mh aw mi bi"><span id="f2ad" class="lq iw hi mf b fi mj mk l ml mm">package com.example.springsecurityjwttutorial.repository;<br/><br/>import com.example.springsecurityjwttutorial.entity.User;<br/>import org.springframework.data.jpa.repository.JpaRepository;<br/><br/>import java.util.Optional;<br/><br/>public interface UserRepo extends JpaRepository&lt;User, Long&gt; {<br/>    public Optional&lt;User&gt; findByEmail(String email);<br/>}</span></pre><p id="54fa" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">ç°åœ¨è®©æˆ‘ä»¬è½¬åˆ°æœ€é‡è¦çš„éƒ¨åˆ†â€”å®‰å…¨æ€§</p><h2 id="8bf1" class="lq iw hi bd ix lr ls lt jb lu lv lw jf ke lx ly jj ki lz ma jn km mb mc jr md bi translated">å®‰å…¨æ€§</h2><p id="18c7" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">åœ¨æˆ‘ä»¬åšä»»ä½•ä¸å®‰å…¨ç›¸å…³çš„äº‹æƒ…ä¹‹å‰ï¼Œè®©æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªç±»æ¥å¤„ç†jwtçš„åˆ›å»ºå’ŒéªŒè¯ã€‚åˆ›å»ºä¸€ä¸ª<code class="du nd ne nf mf b"><strong class="jv hj">security</strong></code> <strong class="jv hj"> </strong>åŒ…ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ª<code class="du nd ne nf mf b"><strong class="jv hj">JWTUtil</strong></code> <strong class="jv hj"> </strong>ç±»ã€‚è¦æ‰§è¡Œä¸JWTç›¸å…³çš„æ“ä½œï¼Œæˆ‘æ¨èæ‚¨ä½¿ç”¨<strong class="jv hj"> java-jwt </strong>åŒ…ã€‚è¦å°†åŒ…åŒ…å«åœ¨æ‚¨çš„é¡¹ç›®ä¸­ï¼Œè¯·å°†ä»¥ä¸‹ä¾èµ–é¡¹æ·»åŠ åˆ°æ‚¨çš„<code class="du nd ne nf mf b"><strong class="jv hj">pom.xml</strong></code>æ–‡ä»¶ä¸­ï¼Œç„¶åé‡æ–°æ„å»ºé¡¹ç›®ã€‚</p><pre class="le lf lg lh fd me mf mg mh aw mi bi"><span id="e230" class="lq iw hi mf b fi mj mk l ml mm">&lt;dependency&gt;<br/>    &lt;groupId&gt;com.auth0&lt;/groupId&gt;<br/>    &lt;artifactId&gt;java-jwt&lt;/artifactId&gt;<br/>    &lt;version&gt;3.18.2&lt;/version&gt;<br/>&lt;/dependency&gt;</span></pre><blockquote class="kr ks kt"><p id="6f7d" class="jt ju ku jv b jw kv jy jz ka kw kc kd kx ky kg kh kz la kk kl lb lc ko kp kq hb bi translated"><strong class="jv hj">æ³¨æ„:</strong>æœ€å¥½ä»githubç«™ç‚¹å¤åˆ¶ä¾èµ–é¡¹ï¼Œå› ä¸ºåœ¨æ‚¨é˜…è¯»æœ¬æ–‡æ—¶ï¼Œæœ€æ–°ç‰ˆæœ¬å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œ  <strong class="jv hj">æ‰¾åˆ°åŒ…<a class="ae iu" href="https://github.com/auth0/java-jwt" rel="noopener ugc nofollow" target="_blank"> <strong class="jv hj">çš„githubç«™ç‚¹ã€‚</strong></a></strong></p></blockquote><pre class="le lf lg lh fd me mf mg mh aw mi bi"><span id="971f" class="lq iw hi mf b fi mj mk l ml mm">package com.example.springsecurityjwttutorial.security;<br/><br/>import com.auth0.jwt.JWT;<br/>import com.auth0.jwt.JWTVerifier;<br/>import com.auth0.jwt.algorithms.Algorithm;<br/>import com.auth0.jwt.exceptions.JWTCreationException;<br/>import com.auth0.jwt.exceptions.JWTVerificationException;<br/>import com.auth0.jwt.interfaces.DecodedJWT;<br/>import org.springframework.beans.factory.annotation.Value;<br/>import org.springframework.stereotype.Component;<br/><br/>import java.util.Date;<br/><br/>@Component<br/>public class JWTUtil {<br/><br/>    @Value("${jwt_secret}")<br/>    private String secret;<br/><br/>    public String generateToken(String email) throws IllegalArgumentException, JWTCreationException {<br/>        return JWT.<em class="ku">create</em>()<br/>                .withSubject("User Details")<br/>                .withClaim("email", email)<br/>                .withIssuedAt(new Date())<br/>                .withIssuer("YOUR APPLICATION/PROJECT/COMPANY NAME")<br/>                .sign(Algorithm.<em class="ku">HMAC256</em>(secret));<br/>    }<br/><br/>    public String validateTokenAndRetrieveSubject(String token)throws JWTVerificationException {<br/>        JWTVerifier verifier = JWT.<em class="ku">require</em>(Algorithm.<em class="ku">HMAC256</em>(secret))<br/>                .withSubject("User Details")<br/>                .withIssuer("YOUR APPLICATION/PROJECT/COMPANY NAME")<br/>                .build();<br/>        DecodedJWT jwt = verifier.verify(token);<br/>        return jwt.getClaim("email").asString();<br/>    }<br/><br/>}</span></pre><p id="0ae7" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated"><code class="du nd ne nf mf b"><strong class="jv hj">generateToken</strong></code>æ–¹æ³•åˆ›å»ºä¸€ä¸ªå¸¦æœ‰ä¸»é¢˜ã€å‘å¸ƒè€…ã€å‘å¸ƒæ—¶é—´å’Œè‡ªå®šä¹‰å£°æ˜â€œç”µå­é‚®ä»¶â€çš„ä»¤ç‰Œï¼Œç¬¬äºŒç§æ–¹æ³•éªŒè¯è¯¥ä»¤ç‰Œå¹¶æå–ç”µå­é‚®ä»¶ã€‚ä¸ºäº†è®©è¿™ä¸ªå·¥ä½œï¼Œä½ éœ€è¦æä¾›ä¸€ä¸ªç§˜å¯†ã€‚ç§˜å¯†æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²(ä¸“ç”¨äºæ‚¨çš„é¡¹ç›®/å›¢é˜Ÿ/å…¬å¸),ç”¨äºç­¾ç½²æ‚¨çš„ä»¤ç‰Œã€‚æ°¸è¿œä¸è¦åˆ†äº«ä½ çš„ç§˜å¯†ã€‚æ‰“å¼€<code class="du nd ne nf mf b"><strong class="jv hj">resources/application.properties</strong></code>æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å±æ€§ã€‚</p><pre class="le lf lg lh fd me mf mg mh aw mi bi"><span id="b237" class="lq iw hi mf b fi mj mk l ml mm">jwt_secret=REPLACE_THIS_WITH_YOUR_SECRET</span></pre><p id="4ad8" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">ç¡®ä¿æ‚¨é€‰æ‹©ä¸€ä¸ªéšæœºçš„é•¿å­—ç¬¦ä¸²ä½œä¸ºæ‚¨çš„å¯†ç ï¼Œä»¥ç¡®ä¿æ‚¨çš„ä»¤ç‰Œçš„å®‰å…¨ã€‚ä¸€ä¸ªè¡Œä¹‹æœ‰æ•ˆçš„æ–¹æ³•æ˜¯è®©ä½ çš„çŒ«åœ¨é”®ç›˜ä¸Šè·‘(å¼€ä¸ªç©ç¬‘ï¼›p)</p><p id="1a32" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºç”¨æˆ·è¯¦ç»†ä¿¡æ¯æœåŠ¡ã€‚ä½¿ç”¨ä¸€ä¸ª<code class="du nd ne nf mf b"><strong class="jv hj">UserDetailsService</strong></code>æ¥æä¾›å®šåˆ¶çš„å®ç°ï¼Œä»¥è·å–è¯•å›¾åœ¨åº”ç”¨ç¨‹åºä¸­è¿›è¡Œèº«ä»½éªŒè¯çš„ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ã€‚è¿™åœ¨<code class="du nd ne nf mf b"><strong class="jv hj">loadUserByUsername</strong></code>æ–¹æ³•ä¸­å®Œæˆã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¿™æ ·çš„ç”¨æˆ·ï¼Œå°±ä¼šæŠ›å‡ºä¸€ä¸ª<code class="du nd ne nf mf b"><strong class="jv hj">UsernameNotFoundException</strong></code>ã€‚åˆ›å»ºä¸€ä¸ªç±»<code class="du nd ne nf mf b"><strong class="jv hj">MyUserDetailsService</strong></code> <strong class="jv hj"> </strong>ï¼Œå®ƒå°†å®ç°<code class="du nd ne nf mf b"><strong class="jv hj">UserDetailsService</strong></code> <strong class="jv hj"> </strong>æ¥å£ã€‚</p><pre class="le lf lg lh fd me mf mg mh aw mi bi"><span id="564c" class="lq iw hi mf b fi mj mk l ml mm">package com.example.springsecurityjwttutorial.security;<br/><br/>import com.example.springsecurityjwttutorial.entity.User;<br/>import com.example.springsecurityjwttutorial.repository.UserRepo;<br/>import org.springframework.beans.factory.annotation.Autowired;<br/>import org.springframework.security.core.authority.SimpleGrantedAuthority;<br/>import org.springframework.security.core.userdetails.UserDetails;<br/>import org.springframework.security.core.userdetails.UserDetailsService;<br/>import org.springframework.security.core.userdetails.UsernameNotFoundException;<br/>import org.springframework.stereotype.Component;<br/><br/>import java.util.Collections;<br/>import java.util.Optional;<br/><br/>@Component<br/>public class MyUserDetailsService implements UserDetailsService {<br/><br/>    @Autowired private UserRepo userRepo;<br/><br/>    @Override<br/>    public UserDetails loadUserByUsername(String email) throws UsernameNotFoundException {<br/>        Optional&lt;User&gt; userRes = userRepo.findByEmail(email);<br/>        if(userRes.isEmpty())<br/>            throw new UsernameNotFoundException("Could not findUser with email = " + email);<br/>        User user = userRes.get();<br/>        return new org.springframework.security.core.userdetails.User(<br/>                email,<br/>                user.getPassword(),<br/>                Collections.<em class="ku">singletonList</em>(new SimpleGrantedAuthority("ROLE_USER")));<br/>    }<br/>}</span></pre><p id="afdd" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äº<code class="du nd ne nf mf b"><strong class="jv hj">UserDetailsService</strong></code>æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä»¥åŠSpring Securityä¸­çš„ä¸€èˆ¬èº«ä»½éªŒè¯æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè¯·æŸ¥çœ‹è¿™é‡Œçš„&gt;<a class="ae iu" rel="noopener" href="/geekculture/spring-security-authentication-process-authentication-flow-behind-the-scenes-d56da63f04fa"/>ã€‚</p><p id="ea98" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">æ¥ä¸‹æ¥è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª<code class="du nd ne nf mf b"><strong class="jv hj">JWTFilter</strong></code>ã€‚é€šè¿‡å®ç°<code class="du nd ne nf mf b"><strong class="jv hj">OncePerRequestFilter</strong></code>æ¥å£ï¼Œ<code class="du nd ne nf mf b"><strong class="jv hj">JWTFilter</strong></code>å°†ä¸ºæ¯ä¸ªè¯·æ±‚è¿è¡Œï¼Œå¹¶æ£€æŸ¥æˆæƒå¤´ä¸­æ˜¯å¦å­˜åœ¨æ‰¿è½½ä»¤ç‰Œã€‚å¦‚æœä»¤ç‰Œå­˜åœ¨ï¼Œå°†éªŒè¯ä»¤ç‰Œï¼Œå¹¶é€šè¿‡ä½¿ç”¨<code class="du nd ne nf mf b"><strong class="jv hj">SecurityContextHolder</strong></code> <strong class="jv hj"> </strong>è®¾ç½®<code class="du nd ne nf mf b"><strong class="jv hj">SecurityContext</strong></code> <strong class="jv hj"> </strong>çš„è®¤è¯å±æ€§ï¼Œä¸ºè¯¥è¯·æ±‚çš„ç”¨æˆ·è®¾ç½®è®¤è¯æ•°æ®ã€‚è¿™å°±æ˜¯JWTå‘æŒ¥ä½œç”¨çš„åœ°æ–¹ï¼Œå®ƒç¡®ä¿æ‚¨å·²ç»è¿‡èº«ä»½éªŒè¯ï¼Œå¹¶ä¸”å¯ä»¥è®¿é—®éœ€è¦æ‚¨ç™»å½•/èº«ä»½éªŒè¯çš„å—ä¿æŠ¤èµ„æºã€‚</p><pre class="le lf lg lh fd me mf mg mh aw mi bi"><span id="51ba" class="lq iw hi mf b fi mj mk l ml mm">package com.example.springsecurityjwttutorial.security;<br/><br/>import com.auth0.jwt.exceptions.JWTVerificationException;<br/>import org.springframework.beans.factory.annotation.Autowired;<br/>import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;<br/>import org.springframework.security.core.context.SecurityContextHolder;<br/>import org.springframework.security.core.userdetails.UserDetails;<br/>import org.springframework.stereotype.Component;<br/>import org.springframework.web.filter.OncePerRequestFilter;<br/><br/>import javax.servlet.FilterChain;<br/>import javax.servlet.ServletException;<br/>import javax.servlet.http.HttpServletRequest;<br/>import javax.servlet.http.HttpServletResponse;<br/>import java.io.IOException;<br/><br/>@Component<br/>public class JWTFilter extends OncePerRequestFilter {<br/><br/>    @Autowired private MyUserDetailsService userDetailsService;<br/>    @Autowired private JWTUtil jwtUtil;<br/><br/>    @Override<br/>    protected void doFilterInternal(HttpServletRequest request,<br/>                                    HttpServletResponse response,<br/>                                    FilterChain filterChain) throws ServletException, IOException {<br/>        String authHeader = request.getHeader("Authorization");<br/>        if(authHeader != null &amp;&amp; !authHeader.isBlank() &amp;&amp; authHeader.startsWith("Bearer ")){<br/>            String jwt = authHeader.substring(7);<br/>            if(jwt == null || jwt.isBlank()){<br/>                response.sendError(HttpServletResponse.<em class="ku">SC_BAD_REQUEST</em>, "Invalid JWT Token in Bearer Header");<br/>            }else {<br/>                try{<br/>                    String email = jwtUtil.validateTokenAndRetrieveSubject(jwt);<br/>                    UserDetails userDetails = userDetailsService.loadUserByUsername(email);<br/>                    UsernamePasswordAuthenticationToken authToken =<br/>                            new UsernamePasswordAuthenticationToken(email, userDetails.getPassword(), userDetails.getAuthorities());<br/>                    if(SecurityContextHolder.<em class="ku">getContext</em>().getAuthentication() == null){<br/>                        SecurityContextHolder.<em class="ku">getContext</em>().setAuthentication(authToken);<br/>                    }<br/>                }catch(JWTVerificationException exc){<br/>                    response.sendError(HttpServletResponse.<em class="ku">SC_BAD_REQUEST</em>, "Invalid JWT Token");<br/>                }<br/>            }<br/>        }<br/><br/>        filterChain.doFilter(request, response);<br/>    }<br/>}</span></pre><p id="0687" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">è¦å°†è¿™äº›æ”¾åœ¨ä¸€èµ·å¹¶é…ç½®åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ï¼Œåˆ›å»ºä¸€ä¸ªç±»<code class="du nd ne nf mf b"><strong class="jv hj">SecurityConfig</strong></code></p><pre class="le lf lg lh fd me mf mg mh aw mi bi"><span id="33ac" class="lq iw hi mf b fi mj mk l ml mm">package com.example.springsecurityjwttutorial.security;<br/><br/>import com.example.springsecurityjwttutorial.repository.UserRepo;<br/>import org.springframework.beans.factory.annotation.Autowired;<br/>import org.springframework.context.annotation.Bean;<br/>import org.springframework.context.annotation.Configuration;<br/>import org.springframework.security.authentication.AuthenticationManager;<br/>import org.springframework.security.config.annotation.web.builders.HttpSecurity;<br/>import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;<br/>import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;<br/>import org.springframework.security.config.http.SessionCreationPolicy;<br/>import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;<br/>import org.springframework.security.crypto.password.PasswordEncoder;<br/>import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;<br/><br/>import javax.servlet.http.HttpServletResponse;<br/><br/>@Configuration<br/>@EnableWebSecurity<br/>public class SecurityConfig extends WebSecurityConfigurerAdapter {<br/><br/>    @Autowired private UserRepo userRepo;<br/>    @Autowired private JWTFilter filter;<br/>    @Autowired private MyUserDetailsService uds;<br/><br/>    @Override<br/>    protected void configure(HttpSecurity http) throws Exception {<br/>        http.csrf().disable()<br/>                .httpBasic().disable()<br/>                .cors()<br/>                .and()<br/>                .authorizeHttpRequests()<br/>                .antMatchers("/api/auth/**").permitAll()<br/>                .antMatchers("/api/user/**").hasRole("USER")<br/>                .and()<br/>                .userDetailsService(uds)<br/>                .exceptionHandling()<br/>                    .authenticationEntryPoint(<br/>                            (request, response, authException) -&gt;<br/>                                    response.sendError(HttpServletResponse.<em class="ku">SC_UNAUTHORIZED</em>, "Unauthorized")<br/>                    )<br/>                .and()<br/>                .sessionManagement()<br/>                .sessionCreationPolicy(SessionCreationPolicy.<em class="ku">STATELESS</em>);<br/><br/>        http.addFilterBefore(filter, UsernamePasswordAuthenticationFilter.class);<br/>    }<br/><br/>    @Bean<br/>    public PasswordEncoder passwordEncoder() {<br/>        return new BCryptPasswordEncoder();<br/>    }<br/><br/>    @Bean<br/>    @Override<br/>    public AuthenticationManager authenticationManagerBean() throws Exception {<br/>        return super.authenticationManagerBean();<br/>    }<br/>}</span></pre><p id="bd9d" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">åœ¨é…ç½®ä¸­ï¼Œéœ€è¦æ³¨æ„çš„é‡è¦éƒ¨åˆ†æ˜¯</p><ul class=""><li id="97be" class="mn mo hi jv b jw kv ka kw ke mp ki mq km mr kq ms mt mu mv bi translated">â€œauthâ€è·¯ç”±è¯·æ±‚è¢«æ‰€æœ‰äººæˆäºˆè®¿é—®æƒ(è¿™æ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œå› ä¸ºæ‚¨éœ€è¦è®¿é—®ç™»å½•å’Œæ³¨å†Œè·¯ç”±)</li><li id="04aa" class="mn mo hi jv b jw mw ka mx ke my ki mz km na kq ms mt mu mv bi translated">â€œç”¨æˆ·â€è·¯ç”±è¯·æ±‚åªèƒ½ç”±<code class="du nd ne nf mf b"><strong class="jv hj">MyUserDetailsService</strong></code>ä¸­è®¾ç½®çš„â€œç”¨æˆ·â€è§’è‰²çš„è®¤è¯ç”¨æˆ·è®¿é—®</li><li id="782c" class="mn mo hi jv b jw mw ka mx ke my ki mz km na kq ms mt mu mv bi translated">UserDetailsServiceæ˜¯ç”¨å®šåˆ¶çš„<code class="du nd ne nf mf b"><strong class="jv hj">MyUserDetailsService</strong></code> beané…ç½®çš„</li><li id="6d2f" class="mn mo hi jv b jw mw ka mx ke my ki mz km na kq ms mt mu mv bi translated">æœåŠ¡å™¨è¢«é…ç½®ä¸ºåœ¨åˆ°è¾¾å…¥å£ç‚¹æ—¶ä»¥æœªæˆæƒä¸ºç”±æ‹’ç»è¯·æ±‚ã€‚å¦‚æœè¾¾åˆ°è¿™ä¸€ç‚¹ï¼Œåˆ™æ„å‘³ç€å½“å‰è¯·æ±‚éœ€è¦èº«ä»½éªŒè¯ï¼Œå¹¶ä¸”æ²¡æœ‰å‘ç°é™„åŠ åˆ°å½“å‰è¯·æ±‚çš„æˆæƒå¤´çš„JWTä»¤ç‰Œã€‚</li><li id="cebf" class="mn mo hi jv b jw mw ka mx ke my ki mz km na kq ms mt mu mv bi translated">JWTFilterè¢«æ·»åŠ åˆ°è¿‡æ»¤å™¨é“¾ä¸­ï¼Œä»¥ä¾¿å¤„ç†ä¼ å…¥çš„è¯·æ±‚ã€‚</li><li id="5a76" class="mn mo hi jv b jw mw ka mx ke my ki mz km na kq ms mt mu mv bi translated">ä¸ºå¯†ç ç¼–ç å™¨åˆ›å»ºbean</li><li id="0f53" class="mn mo hi jv b jw mw ka mx ke my ki mz km na kq ms mt mu mv bi translated">åœ¨<code class="du nd ne nf mf b"><strong class="jv hj">AuthController</strong></code>ä¸­æš´éœ²å°†ç”¨äºè¿è¡Œè®¤è¯è¿‡ç¨‹çš„è®¤è¯ç®¡ç†å™¨çš„bean</li></ul><h2 id="6750" class="lq iw hi bd ix lr ls lt jb lu lv lw jf ke lx ly jj ki lz ma jn km mb mc jr md bi translated">æ¨¡å‹</h2><p id="75b3" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">åˆ›å»ºä¸€ä¸ªåŒ…<code class="du nd ne nf mf b"><strong class="jv hj">models</strong></code> <strong class="jv hj"> </strong>å’Œåˆ›å»ºä¸€ä¸ªç±»<code class="du nd ne nf mf b"><strong class="jv hj">LoginCredentials</strong></code> <strong class="jv hj"> </strong>ã€‚è¯¥ç±»å°†ç”¨äºæ¥å—æ¥è‡ªè¯·æ±‚ä¸»ä½“çš„ç™»å½•æ•°æ®ã€‚è¿™ä¸ªç±»æœ‰ä¸¤ä¸ªç®€å•çš„å±æ€§â€”â€”emailå’Œpasswordä»¥åŠç›¸å…³çš„Lombokæ³¨é‡Šã€‚</p><pre class="le lf lg lh fd me mf mg mh aw mi bi"><span id="6e6a" class="lq iw hi mf b fi mj mk l ml mm">package com.example.springsecurityjwttutorial.models;<br/><br/>import lombok.*;<br/><br/>@Getter<br/>@Setter<br/>@AllArgsConstructor<br/>@NoArgsConstructor<br/>@ToString<br/>public class LoginCredentials {<br/><br/>    private String email;<br/>    private String password;<br/><br/>}</span></pre><p id="87ac" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">æœ€åï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ã€‚åˆ›å»ºä¸€ä¸ª<code class="du nd ne nf mf b"><strong class="jv hj">controllers</strong></code> <strong class="jv hj"> </strong>åŒ…ã€‚åœ¨åŒ…ä¸­ï¼Œåˆ›å»ºä¸¤ä¸ªç±»</p><ul class=""><li id="c705" class="mn mo hi jv b jw kv ka kw ke mp ki mq km mr kq ms mt mu mv bi translated"><code class="du nd ne nf mf b"><strong class="jv hj">AuthController</strong></code> â€”å¤„ç†æˆæƒè·¯ç”±æ³¨å†Œå’Œç™»å½•ã€‚</li></ul><pre class="le lf lg lh fd me mf mg mh aw mi bi"><span id="3302" class="lq iw hi mf b fi mj mk l ml mm">package com.example.springsecurityjwttutorial.controllers;<br/><br/>import com.example.springsecurityjwttutorial.entity.User;<br/>import com.example.springsecurityjwttutorial.models.LoginCredentials;<br/>import com.example.springsecurityjwttutorial.repository.UserRepo;<br/>import com.example.springsecurityjwttutorial.security.JWTUtil;<br/>import org.springframework.beans.factory.annotation.Autowired;<br/>import org.springframework.security.authentication.AuthenticationManager;<br/>import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;<br/>import org.springframework.security.core.AuthenticationException;<br/>import org.springframework.security.crypto.password.PasswordEncoder;<br/>import org.springframework.web.bind.annotation.PostMapping;<br/>import org.springframework.web.bind.annotation.RequestBody;<br/>import org.springframework.web.bind.annotation.RequestMapping;<br/>import org.springframework.web.bind.annotation.RestController;<br/><br/>import java.util.Collections;<br/>import java.util.Map;<br/><br/>@RestController<br/>@RequestMapping("/api/auth")<br/>public class AuthController {<br/><br/>    @Autowired private UserRepo userRepo;<br/>    @Autowired private JWTUtil jwtUtil;<br/>    @Autowired private AuthenticationManager authManager;<br/>    @Autowired private PasswordEncoder passwordEncoder;<br/><br/>    @PostMapping("/register")<br/>    public Map&lt;String, Object&gt; registerHandler(@RequestBody User user){<br/>        String encodedPass = passwordEncoder.encode(user.getPassword());<br/>        user.setPassword(encodedPass);<br/>        user = userRepo.save(user);<br/>        String token = jwtUtil.generateToken(user.getEmail());<br/>        return Collections.<em class="ku">singletonMap</em>("jwt-token", token);<br/>    }<br/><br/>    @PostMapping("/login")<br/>    public Map&lt;String, Object&gt; loginHandler(@RequestBody LoginCredentials body){<br/>        try {<br/>            UsernamePasswordAuthenticationToken authInputToken =<br/>                    new UsernamePasswordAuthenticationToken(body.getEmail(), body.getPassword());<br/><br/>            authManager.authenticate(authInputToken);<br/><br/>            String token = jwtUtil.generateToken(body.getEmail());<br/><br/>            return Collections.<em class="ku">singletonMap</em>("jwt-token", token);<br/>        }catch (AuthenticationException authExc){<br/>            throw new RuntimeException("Invalid Login Credentials");<br/>        }<br/>    }<br/><br/><br/>}</span></pre><p id="987f" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated"><code class="du nd ne nf mf b"><strong class="jv hj">register</strong></code> <strong class="jv hj"> </strong>æ–¹æ³•æŒä¹…åŒ–å®ä½“ï¼Œç„¶åç”¨JWTå“åº”ï¼Œ<code class="du nd ne nf mf b"><strong class="jv hj">login</strong></code> <strong class="jv hj"> </strong>æ–¹æ³•éªŒè¯ç™»å½•å‡­è¯ï¼Œç„¶åç”¨JWTå“åº”ã€‚</p><ul class=""><li id="874b" class="mn mo hi jv b jw kv ka kw ke mp ki mq km mr kq ms mt mu mv bi translated"><code class="du nd ne nf mf b"><strong class="jv hj">UserController</strong></code> â€”å¤„ç†ç”¨æˆ·è·¯çº¿</li></ul><pre class="le lf lg lh fd me mf mg mh aw mi bi"><span id="120c" class="lq iw hi mf b fi mj mk l ml mm">package com.example.springsecurityjwttutorial.controllers;<br/><br/>import com.example.springsecurityjwttutorial.entity.User;<br/>import com.example.springsecurityjwttutorial.repository.UserRepo;<br/>import org.springframework.beans.factory.annotation.Autowired;<br/>import org.springframework.security.core.context.SecurityContextHolder;<br/>import org.springframework.web.bind.annotation.GetMapping;<br/>import org.springframework.web.bind.annotation.RequestMapping;<br/>import org.springframework.web.bind.annotation.RestController;<br/><br/><br/>@RestController<br/>@RequestMapping("/api/user")<br/>public class UserController {<br/><br/>    @Autowired private UserRepo userRepo;<br/><br/>    @GetMapping("/info")<br/>    public User getUserDetails(){<br/>        String email = (String) SecurityContextHolder.<em class="ku">getContext</em>().getAuthentication().getPrincipal();<br/>        return userRepo.findByEmail(email).get();<br/>    }<br/><br/><br/>}</span></pre><p id="9130" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">è¯·æ³¨æ„ï¼Œç”¨æˆ·çš„ç”µå­é‚®ä»¶ä¸ä½œä¸ºè¾“å…¥ã€‚ä»<code class="du nd ne nf mf b"><strong class="jv hj">SecurityContext</strong></code> <strong class="jv hj"> </strong>ä¸­æå–ï¼Œä½œä¸º<code class="du nd ne nf mf b"><strong class="jv hj">JWTFilter</strong></code>ä¸­è®¾ç½®çš„é‚®ä»¶</p><h1 id="c848" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">æ‰§è¡Œæ—¶é—´</h1><figure class="le lf lg lh fd ij er es paragraph-image"><div class="er es nh"><img src="../Images/3eddf5c8dda3f93b77f344f8bbe683af.png" data-original-src="https://miro.medium.com/v2/resize:fit:470/format:webp/1*aef_brfFSjE_3M5VP4QnwQ.jpeg"/></div></figure><p id="df4a" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">åœ¨<a class="ae iu" href="https://www.jetbrains.com/idea/" rel="noopener ugc nofollow" target="_blank"> <strong class="jv hj">ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºæ—¶ï¼ŒIntelliJ IDEA </strong> </a>ï¼Œè¿™æ˜¯æˆ‘å¾—åˆ°çš„è¾“å‡ºã€‚çœ‹èµ·æ¥ä¸€åˆ‡éƒ½å¾ˆå¥½ã€‚</p><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ni"><img src="../Images/4a46f5afdbeba4643ea0e9ec093be924.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8ypE7PJ8YyenJXNni5W4BA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">Starting the Spring Boot App</figcaption></figure><p id="f470" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">ç°åœ¨è®©æˆ‘ä»¬æä¸€äº›è¦æ±‚ã€‚ä¸ºäº†å‘å‡ºè¯·æ±‚ï¼Œæˆ‘å°†ä½¿ç”¨<a class="ae iu" href="https://www.postman.com/downloads/?utm_source=postman-home" rel="noopener ugc nofollow" target="_blank"> <strong class="jv hj">é‚®é€’å‘˜</strong> </a>ã€‚</p><p id="5441" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">é¦–å…ˆï¼Œè®©æˆ‘ä»¬èµ°ç™»è®°è·¯çº¿ã€‚</p><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nj"><img src="../Images/fa326d3bf6b0496514c24d3e779e9e5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eVb8PedoWgwPOX7RTzbojQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx">HTTP Request for Registering a User and generating JWT</figcaption></figure><p id="33a1" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated"><strong class="jv hj">ä¸‡å²ï¼ï¼æ‚¨åˆšåˆšä½¿ç”¨Spring Securityç”Ÿæˆäº†æ‚¨çš„ç¬¬ä¸€ä¸ªJWTã€‚ç°åœ¨è®©æˆ‘ä»¬æµ‹è¯•å—ä¿æŠ¤çš„ç«¯ç‚¹- &gt;ç”¨æˆ·ç«¯ç‚¹ã€‚å¤åˆ¶è¿™ä¸ªä»¤ç‰Œï¼Œå› ä¸ºä½ å¾ˆå¿«å°±ä¼šéœ€è¦å®ƒã€‚</strong></p><p id="49c7" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">è®©æˆ‘ä»¬åœ¨ä¸€ä¸ªæ–°çš„é€‰é¡¹å¡ä¸­åˆ›å»ºä¸€ä¸ªå¯¹ç”¨æˆ·ç«¯ç‚¹çš„è¯·æ±‚ï¼Œè€Œä¸æ·»åŠ ä»¤ç‰Œã€‚</p><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nk"><img src="../Images/42b6e74d8d5fa0e34070c7894196dec3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tjiti5Utx_q9LVnTz_lDSA.png"/></div></div></figure><p id="4a93" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">å¦‚æ‚¨æ‰€è§ï¼Œè¯·æ±‚è¢«æ‹’ç»ï¼ŒçŠ¶æ€ä¸ºâ€œ<strong class="jv hj">æœªæˆæƒ</strong>â€ã€‚</p><p id="d259" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">ç°åœ¨è®©æˆ‘ä»¬æ·»åŠ ä»¤ç‰Œã€‚ä¸ºæ­¤ï¼Œè¯·è½¬åˆ°â€œæˆæƒâ€é€‰é¡¹å¡ï¼Œä»ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹©â€œä¸è®°åä»¤ç‰Œâ€,ç„¶åå°†å¤åˆ¶çš„ä»¤ç‰Œç²˜è´´åˆ°æä¾›çš„æ¡†ä¸­ã€‚</p><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nl"><img src="../Images/1b2280dbcebaaf76575bf7628bafb1a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JFViKYqM7foml1Vi7D86pw.png"/></div></div></figure><p id="a669" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">ç°åœ¨ï¼Œå¦‚æœæ‚¨å†æ¬¡å‘é€è¯·æ±‚ï¼Œæ‚¨å°†çœ‹åˆ°ä»¥ä¸‹å†…å®¹</p><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nm"><img src="../Images/03549f325ea0bcd34f33f289ae6e1e7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c1O3UddJXRCyJM9TnQIdTw.png"/></div></div></figure><p id="2b48" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke ky kg kh ki la kk kl km lc ko kp kq hb bi translated">ç§å§ï¼ï¼ç°åœ¨ä½ å¾—åˆ°äº†ç”¨æˆ·æ•°æ®ã€‚å¯ä»¥è‡ªè¡Œæµ‹è¯•ç™»å½•è·¯å¾„ã€‚</p><h1 id="ea1d" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">ç»“è®º</h1><p id="9c73" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated"><strong class="jv hj">åŸæ¥å¦‚æ­¤</strong>ã€‚ç°åœ¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Spring Bootå®‰å…¨æ€§å’ŒSpring Bootå®Œå…¨å®ç°JWTè®¤è¯æµç¨‹ã€‚</p><h1 id="1476" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">æ”¯æŒ</h1><p id="4bc9" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·è·Ÿéšå¹¶é¼“æŒğŸ‘ğŸ»å› æ­¤ï¼Œå¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œè¯·è€ƒè™‘ç»™æˆ‘ä¹°æ¯å’–å•¡æ¥æ”¯æŒæˆ‘ã€‚è¿™å°†å¸®åŠ©æˆ‘å†™æ›´å¤šä¸æŠ€æœ¯å’Œç¼–ç ç›¸å…³çš„æ–‡ç« ï¼Œå¹¶å°½æˆ‘æ‰€èƒ½å›é¦ˆç¤¾åŒºã€‚</p><h1 id="0b8c" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">é‚£ä¹ˆâ€¦å†è§â€¦ä¸‹æ¬¡è§ï¼ï¼ğŸ™‹ğŸ»â€â™‚ï¸</h1><h1 id="60b1" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">æˆ‘çš„æ›´å¤šæ–‡ç« </h1><ol class=""><li id="be73" class="mn mo hi jv b jw jx ka kb ke nn ki no km np kq nc mt mu mv bi translated"><a class="ae iu" rel="noopener" href="/swlh/demystifying-the-folder-structure-of-a-react-app-c60b29d90836">æ­ç§˜Reactåº”ç”¨çš„æ–‡ä»¶å¤¹ç»“æ„</a> ( 58k+è§†å›¾)</li><li id="4a00" class="mn mo hi jv b jw mw ka mx ke my ki mz km na kq nc mt mu mv bi translated"><a class="ae iu" rel="noopener" href="/geekculture/spring-security-authentication-process-authentication-flow-behind-the-scenes-d56da63f04fa"> Springå®‰å…¨è®¤è¯æµç¨‹</a></li><li id="83cb" class="mn mo hi jv b jw mw ka mx ke my ki mz km na kq nc mt mu mv bi translated"><a class="ae iu" href="https://javascript.plainenglish.io/react-redux-deep-dive-state-management-in-react-with-redux-b9af8b039bcc" rel="noopener ugc nofollow" target="_blank"> React Reduxæ·±æ½œ</a></li></ol></div></div>    
</body>
</html>