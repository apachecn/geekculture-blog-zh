<html>
<head>
<title>YOLOv4 inference using OpenCV-DNN-CUDA on Linux</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Linuxä¸‹åŸºäºOpenCV-DNN-CUDAçš„YOLOv4æ¨ç†</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/geekculture/yolov4-inference-using-opencv-dnn-cuda-on-linux-904c16d2aea7?source=collection_archive---------13-----------------------#2022-05-26">https://medium.com/geekculture/yolov4-inference-using-opencv-dnn-cuda-on-linux-904c16d2aea7?source=collection_archive---------13-----------------------#2022-05-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d881b6825f340ae6d0fe80b4d4b09463.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*njB0QOcKbrhpyDY17PW0cw.png"/></div></div></figure><h1 id="e27d" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">åœ¨Linuxä¸Šä½¿ç”¨OpenCV-DNN-CUDAæ¨¡å—è¿è¡ŒYOLOv4æ¨ç†ã€‚</h1><p id="590e" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">åœ¨ä¹‹å‰çš„åšå®¢<a class="ae km" href="https://techzizou.com/?p=3766" rel="noopener ugc nofollow" target="_blank">â€œè®¾ç½®æ”¯æŒCUDAåç«¯çš„OpenCV-DNNæ¨¡å—(é’ˆå¯¹Linux)â€</a>ä¸­ï¼Œæˆ‘ä»¬åœ¨Linuxä¸Šæ„å»ºäº†æ”¯æŒCUDAåç«¯çš„OpenCV-DNNæ¨¡å—ã€‚(æˆ‘æœ‰Ubuntu 18.04)ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªOpenCVæ¨¡å—åœ¨å¯¹è±¡æ£€æµ‹æ¨¡å‹ä¸Šè¿è¡Œæ¨ç†ã€‚ä¸æ²¡æœ‰CUDAåç«¯çš„OpenCVç›¸æ¯”ï¼Œä½¿ç”¨CUDAåç«¯æ”¯æŒæ„å»ºçš„OpenCV-DNNæ¨¡å—ç»™å‡ºäº†æ›´å¿«çš„æ¨æ–­ã€‚æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å°†ä¸‹é¢ä¸¤è¡Œä»£ç æ·»åŠ åˆ°æˆ‘ä»¬çš„ä»£ç ä¸­ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥æ¨æ–­æ¨¡å‹ã€‚</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="2596" class="kw ir hi ks b fi kx ky l kz la">net.setPreferableBackend(cv2.dnn.DNN_BACKEND_CUDA)<br/>net.setPreferableTarget(cv2.dnn.DNN_TARGET_CUDA)</span></pre><p id="df86" class="pw-post-body-paragraph jo jp hi jq b jr lb jt ju jv lc jx jy jz ld kb kc kd le kf kg kh lf kj kk kl hb bi translated">ä¸ä¸æ”¯æŒCUDAåç«¯çš„OpenCVç›¸æ¯”ï¼Œæ”¯æŒCUDAåç«¯çš„OpenCV-DNNæ¨¡å—å¯ä»¥æ›´å¿«åœ°è¿›è¡Œæ¨ç†ã€‚</p><p id="2910" class="pw-post-body-paragraph jo jp hi jq b jr lb jt ju jv lc jx jy jz ld kb kc kd le kf kg kh lf kj kk kl hb bi translated">æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ï¼Œä½¿ç”¨æˆ‘ä»¬å®‰è£…çš„OpenCV-DNNæ¨¡å—è¿è¡Œæ¨ç†:</p><ul class=""><li id="6802" class="lg lh hi jq b jr lb jv lc jz li kd lj kh lk kl ll lm ln lo bi translated">é¦–å…ˆï¼Œæ‰“å¼€Anacondaæç¤ºç¬¦å¹¶æ¿€æ´»æ‚¨ç”¨æ¥å®‰è£…OpenCV-DNNæ¨¡å—çš„è™šæ‹Ÿç¯å¢ƒã€‚</li><li id="f732" class="lg lh hi jq b jr lp jv lq jz lr kd ls kh lt kl ll lm ln lo bi translated">æ¥ä¸‹æ¥ï¼Œä¸‹è½½ä¸‹é¢çš„python <em class="lu"> opencv_dnn.py </em>è„šæœ¬å¹¶ä½¿ç”¨pythonè¿è¡Œå®ƒã€‚è¯·æ³¨æ„ï¼Œè¿™ä½¿ç”¨äº†yolov4æ¨¡å‹æƒé‡å’Œé…ç½®æ–‡ä»¶ã€‚ä»<a class="ae km" href="https://github.com/AlexeyAB/darknet" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œ</a>ä¸‹è½½ã€‚</li></ul><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="200d" class="kw ir hi ks b fi kx ky l kz la">import cv2<br/>import time</span><span id="7ba9" class="kw ir hi ks b fi lv ky l kz la">CONFIDENCE_THRESHOLD = 0.2<br/>NMS_THRESHOLD = 0.4<br/>COLORS = [(0, 255, 255), (255, 255, 0), (0, 255, 0), (255, 0, 0)]</span><span id="52bf" class="kw ir hi ks b fi lv ky l kz la">class_names = []<br/>with open("classes.txt", "r") as f:<br/>    class_names = [cname.strip() for cname in f.readlines()]</span><span id="4c6e" class="kw ir hi ks b fi lv ky l kz la">cap = cv2.VideoCapture("video.mp4")</span><span id="310c" class="kw ir hi ks b fi lv ky l kz la">net = cv2.dnn.readNet("yolov4.weights", "yolov4.cfg")<br/>net.setPreferableBackend(cv2.dnn.DNN_BACKEND_CUDA)<br/>net.setPreferableTarget(cv2.dnn.DNN_TARGET_CUDA_FP16)</span><span id="2265" class="kw ir hi ks b fi lv ky l kz la">model = cv2.dnn_DetectionModel(net)<br/>model.setInputParams(size=(416, 416), scale=1/255, swapRB=True)</span><span id="de06" class="kw ir hi ks b fi lv ky l kz la">while cv2.waitKey(1) &lt; 1:<br/>    (grabbed, frame) = cap.read()<br/>    if not grabbed:<br/>        exit()</span><span id="6210" class="kw ir hi ks b fi lv ky l kz la">    start = time.time()<br/>    classes, scores, boxes = model.detect(frame, CONFIDENCE_THRESHOLD, NMS_THRESHOLD)<br/>    end = time.time()</span><span id="23be" class="kw ir hi ks b fi lv ky l kz la">    for (classid, score, box) in zip(classes, scores, boxes):<br/>        color = COLORS[int(classid) % len(COLORS)]<br/>        label = "%s : %f" % (class_names[classid[0]], score)<br/>        cv2.rectangle(frame, box, color, 2)<br/>        cv2.putText(frame, label, (box[0], box[1]-5), cv2.FONT_HERSHEY_SIMPLEX, 0.5, color, 2)<br/>    <br/>    fps = "FPS: %.2f " % (1 / (end - start))<br/>    cv2.putText(frame, fps, (0, 25), cv2.FONT_HERSHEY_SIMPLEX, 1, (255, 0, 255), 2)<br/>    cv2.imshow("output", frame)</span></pre><p id="b810" class="pw-post-body-paragraph jo jp hi jq b jr lb jt ju jv lc jx jy jz ld kb kc kd le kf kg kh lf kj kk kl hb bi translated">æ‚¨ä¹Ÿå¯ä»¥ä¸‹è½½ä¸Šé¢çš„pythonä»£ç æ¥æµ‹è¯•OpenCV-DNNæ¨ç†ã€‚</p><p id="3f82" class="pw-post-body-paragraph jo jp hi jq b jr lb jt ju jv lc jx jy jz ld kb kc kd le kf kg kh lf kj kk kl hb bi translated"><a class="ae km" href="https://techzizou.com/yolov4-inference-using-opencv-dnn-cuda-on-linux/#opencv_dnn_linux" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">ä¸‹è½½opencv_dnn.py </strong> </a></p><p id="4c04" class="pw-post-body-paragraph jo jp hi jq b jr lb jt ju jv lc jx jy jz ld kb kc kd le kf kg kh lf kj kk kl hb bi translated"><strong class="jq hj">é‡è¦æç¤º:</strong>OpenCV-DNN-CUDAæ¨¡å—åªæ”¯æŒæ¨ç†ã€‚å› æ­¤ï¼Œè™½ç„¶ä½ ä¼šä»ä¸­è·å¾—æ›´å¿«çš„æ¨ç†ï¼Œä½†è®­ç»ƒå°†ä¸æˆ‘ä»¬åœ¨æ²¡æœ‰CUDAåç«¯æ”¯æŒçš„æƒ…å†µä¸‹è®¾ç½®çš„OpenCVç›¸åŒã€‚</p><p id="c3c2" class="pw-post-body-paragraph jo jp hi jq b jr lb jt ju jv lc jx jy jz ld kb kc kd le kf kg kh lf kj kk kl hb bi translated">æ‚¨è¿˜å¯ä»¥ä½¿ç”¨OpenCV-DNN-CUDAæ¨¡å—å¯¹æ¥è‡ªTensorFlowã€PyTorchç­‰å„ç§å…¶ä»–æ¡†æ¶çš„æ¨¡å‹è¿›è¡Œæ¨ç†ã€‚</p></div><div class="ab cl lw lx gp ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="hb hc hd he hf"><h1 id="b301" class="iq ir hi bd is it md iv iw ix me iz ja jb mf jd je jf mg jh ji jj mh jl jm jn bi translated">æˆ‘åœ¨YouTubeä¸Šçš„è§†é¢‘ï¼</h1><figure class="kn ko kp kq fd ij"><div class="bz dy l di"><div class="mi mj l"/></div></figure></div><div class="ab cl lw lx gp ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="hb hc hd he hf"><h1 id="a293" class="iq ir hi bd is it md iv iw ix me iz ja jb mf jd je jf mg jh ji jj mh jl jm jn bi translated">ä¹‹å‰çš„æ•™ç¨‹:</h1><h2 id="ab49" class="kw ir hi bd is mk ml mm iw mn mo mp ja jz mq mr je kd ms mt ji kh mu mv jm mw bi translated">ä½¿ç”¨CUDAåç«¯æ”¯æŒè®¾ç½®OpenCV-DNNæ¨¡å—(é€‚ç”¨äºLinux)</h2><div class="mx my ez fb mz na"><a href="https://techzizou007.medium.com/setup-opencv-dnn-module-with-cuda-backend-support-for-linux-1677c627f3bd" rel="noopener follow" target="_blank"><div class="nb ab dw"><div class="nc ab nd cl cj ne"><h2 class="bd hj fi z dy nf ea eb ng ed ef hh bi translated">ä½¿ç”¨CUDAåç«¯æ”¯æŒè®¾ç½®OpenCV-DNNæ¨¡å—(é€‚ç”¨äºLinux)</h2><div class="nh l"><h3 class="bd b fi z dy nf ea eb ng ed ef dx translated">åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨CUDAåç«¯æ”¯æŒä»æºä»£ç æ„å»ºOpenCV(OpenCV-DNN-CUDAæ¨¡å—)ã€‚</h3></div><div class="ni l"><p class="bd b fp z dy nf ea eb ng ed ef dx translated">techzizou007.medium.com</p></div></div><div class="nj l"><div class="nk l nl nm nn nj no io na"/></div></div></a></div></div><div class="ab cl lw lx gp ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="hb hc hd he hf"><h2 id="de0a" class="kw ir hi bd is mk ml mm iw mn mo mp ja jz mq mr je kd ms mt ji kh mu mv jm mw bi translated">åˆ«å¿˜äº†ç•™ä¸‹ğŸ‘</h2><h2 id="c756" class="kw ir hi bd is mk ml mm iw mn mo mp ja jz mq mr je kd ms mt ji kh mu mv jm mw bi translated">ç¥æ‚¨æ„‰å¿«ï¼ï¼ï¼âœŒ</h2><h1 id="363d" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">â™•Â·ç‰¹å¥‡ä½Â·â™•</h1></div></div>    
</body>
</html>