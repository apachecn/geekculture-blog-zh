<html>
<head>
<title>Conftest | kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">åº“ä¼¯å†…ç‰¹æ–¯</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/geekculture/conftest-kubernetes-9a064c302d43?source=collection_archive---------5-----------------------#2022-12-02">https://medium.com/geekculture/conftest-kubernetes-9a064c302d43?source=collection_archive---------5-----------------------#2022-12-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="15d4" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">Kubernetesä¸­Conftestçš„ç”¨æ³•</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/1cd3e9a13c9e78b83458ec5c4cc4a060.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5LdcOMT4TgWYDezP"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">Photo by <a class="ae jn" href="https://unsplash.com/ja/@clintadair?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Clint Adair</a> on <a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="a533" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><a class="ae jn" href="https://www.conftest.dev/" rel="noopener ugc nofollow" target="_blank"><strong class="jq hj"/></a>æ˜¯ä¸€ä¸ªé’ˆå¯¹kubernetesé…ç½®çš„å•å…ƒæµ‹è¯•æ¡†æ¶ã€‚å®ƒä½¿ç”¨<a class="ae jn" href="https://www.openpolicyagent.org/docs/latest/policy-language/" rel="noopener ugc nofollow" target="_blank"> regoè¯­è¨€</a>æ¥ç¼–å†™æ”¿ç­–ã€‚å¹¶å¸®åŠ©æˆ‘ä»¬é’ˆå¯¹ç»“æ„åŒ–çš„é…ç½®æ•°æ®ç¼–å†™æµ‹è¯•ã€‚</p><h2 id="1036" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">å®‰è£…â€” Linux</h2><pre class="iy iz ja jb fd lf lg lh bn li lj bi"><span id="b4fa" class="lk kl hi lg b be ll lm l ln lo">LATEST_VERSION=$(wget -O - "https://api.github.com/repos/open-policy-agent/conftest/releases/latest" | grep '"tag_name":' | sed -E 's/.*"([^"]+)".*/\1/' | cut -c 2-)<br/>wget "https://github.com/open-policy-agent/conftest/releases/download/v${LATEST_VERSION}/conftest_${LATEST_VERSION}_Linux_x86_64.tar.gz"<br/>tar xzf conftest_${LATEST_VERSION}_Linux_x86_64.tar.gz<br/>sudo mv conftest /usr/local/bin</span></pre><p id="8b29" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">å…¶ä»–æ“ä½œç³»ç»Ÿçš„å®‰è£…è¿‡ç¨‹â€” <a class="ae jn" href="https://www.conftest.dev/install/" rel="noopener ugc nofollow" target="_blank">å®‰è£…è¿‡ç¨‹</a></p><h2 id="d5c9" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">æ”¿ç­–:</h2><p id="d257" class="pw-post-body-paragraph jo jp hi jq b jr lp ij jt ju lq im jw jx lr jz ka kb ls kd ke kf lt kh ki kj hb bi translated">è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç›®å½•æ¥å­˜å‚¨ç­–ç•¥ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<strong class="jq hj"> conftest </strong>åœ¨<strong class="jq hj"> /root/policy </strong>ç›®å½•ä¸‹æŸ¥æ‰¾ç­–ç•¥ã€‚ä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ç­–ç•¥å­˜å‚¨åœ¨ä¸åŒçš„ç›®å½•ä¸­ï¼Œç„¶ååœ¨è¿è¡Œconftestæ—¶ä¼ é€’ç›®å½•è·¯å¾„ã€‚</p><pre class="iy iz ja jb fd lf lg lh bn li lj bi"><span id="bfac" class="lk kl hi lg b be ll lm l ln lo"># Create new directory to srore policies<br/>&gt;&gt; mkdir -p conftest/policy</span></pre><p id="d12c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">å‡è®¾æˆ‘ä»¬æƒ³è¦æ‹’ç»kubernetesé›†ç¾¤ä¸Šçš„"<strong class="jq hj"> NodePort </strong>"ç±»å‹æœåŠ¡ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹regoç­–ç•¥:</p><pre class="iy iz ja jb fd lf lg lh bn li lj bi"><span id="6931" class="lk kl hi lg b be ll lm l ln lo"># /conftest/policy/nodeport-service-deny.rego<br/><br/>package main<br/><br/>deny[msg] {<br/>  input.kind = "Service"<br/>  input.spec.type = "NodePort"<br/>  msg = "NodePort Service is not Allowed"<br/>}</span></pre><h2 id="3588" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">k8s-æ¸…å•</h2><p id="51f2" class="pw-post-body-paragraph jo jp hi jq b jr lp ij jt ju lq im jw jx lr jz ka kb ls kd ke kf lt kh ki kj hb bi translated">ä¸‹é¢æ˜¯æˆ‘ä»¬è¦æµ‹è¯•çš„æœåŠ¡æ¸…å•æ–‡ä»¶:</p><pre class="iy iz ja jb fd lf lg lh bn li lj bi"><span id="c600" class="lk kl hi lg b be ll lm l ln lo"># k8s/srv-test.yaml<br/><br/>apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  labels:<br/>    app: test<br/>  name: srv-test<br/>spec: <br/>  type: NodePort<br/>  selector:<br/>    app: test<br/>  ports:<br/>  - port: 80<br/>    protocol: TCP<br/>    targetPort: 80<br/>    nodePort: 32000</span></pre><h2 id="9b28" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">è¯•éªŒ</h2><p id="6ab4" class="pw-post-body-paragraph jo jp hi jq b jr lp ij jt ju lq im jw jx lr jz ka kb ls kd ke kf lt kh ki kj hb bi translated">ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä¸ºä¸Šé¢å®šä¹‰çš„æœåŠ¡æ¸…å•æ–‡ä»¶è¿è¡Œconftest:</p><pre class="iy iz ja jb fd lf lg lh bn li lj bi"><span id="4b06" class="lk kl hi lg b be ll lm l ln lo">#                  [Policy Path]      [K8s Manifest]<br/>&gt;&gt; conftest test -p conftest/policy/  k8s/srv-test.yaml <br/><br/>FAIL - k8s/srv-test.yaml - main - NodePort Service is not Allowed<br/><br/>1 test, 0 passed, 0 warnings, 1 failure, 0 exceptions</span></pre><p id="e18f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">åœ¨ä¸Šé¢çš„æ¼”ç¤ºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æµ‹è¯•<strong class="jq hj">å¤±è´¥</strong>ã€‚å› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº†â€œ<strong class="jq hj">èŠ‚ç‚¹ç«¯å£</strong>â€ç±»å‹çš„æœåŠ¡ã€‚ç°åœ¨è®©æˆ‘ä»¬å°†â€œ<strong class="jq hj">èŠ‚ç‚¹ç«¯å£</strong>â€æœåŠ¡æ”¹ä¸ºâ€œ<strong class="jq hj">è´Ÿè½½å¹³è¡¡å™¨</strong>â€ï¼Œçœ‹çœ‹æˆ‘ä»¬çš„ç­–ç•¥å¦‚ä½•ååº”ã€‚</p><pre class="iy iz ja jb fd lf lg lh bn li lj bi"><span id="537f" class="lk kl hi lg b be ll lm l ln lo"># k8s/srv-test.yaml<br/><br/>apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  labels:<br/>    app: test<br/>  name: srv-test<br/>spec: <br/>  type: LoadBalancer   #&lt;-----<br/>  selector:<br/>    app: test<br/>  ports:<br/>  - port: 80<br/>    protocol: TCP<br/>    targetPort: 80<br/>    nodePort: 32000</span></pre><p id="8fc3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">ç°åœ¨ï¼Œè®©æˆ‘ä»¬å†åšä¸€æ¬¡æµ‹è¯•:</p><pre class="iy iz ja jb fd lf lg lh bn li lj bi"><span id="deb9" class="lk kl hi lg b be ll lm l ln lo">#                  [Policy Path]      [K8s Manifest]<br/>&gt;&gt; conftest test -p conftest/policy/ k8s/srv-test.yaml <br/><br/>1 test, 1 passed, 0 warnings, 0 failures, 0 exceptions</span></pre><p id="bd53" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">å¤ªå¥½äº†ï¼</strong>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸€æ¬¡k8sæœåŠ¡æ¸…å•æ–‡ä»¶å·²ç»é€šè¿‡äº†conftestæµ‹è¯•ã€‚</p><p id="d051" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">å…³äºè¿™äº›æ”¿ç­–çš„æ›´å¤šç¤ºä¾‹å¯åœ¨æ­¤å¤„æ‰¾åˆ°â€” <a class="ae jn" href="https://github.com/open-policy-agent/conftest/tree/master/examples/kubernetes" rel="noopener ugc nofollow" target="_blank">å¸¸è§ç¤ºä¾‹</a></p></div><div class="ab cl lu lv gp lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="hb hc hd he hf"><blockquote class="mb mc md"><p id="459b" class="jo jp me jq b jr js ij jt ju jv im jw mf jy jz ka mg kc kd ke mh kg kh ki kj hb bi translated"><em class="hi">å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¾ˆæœ‰å¸®åŠ©ï¼Œè¯·ç‚¹å‡»</em> <strong class="jq hj"> <em class="hi">å…³æ³¨</em> </strong> <em class="hi">ğŸ‘‰</em><strong class="jq hj"><em class="hi"/></strong><em class="hi"/><strong class="jq hj"><em class="hi">æ‹æ‰‹</em> </strong> <em class="hi">ğŸ‘</em> <strong class="jq hj"> <em class="hi"> </em> </strong> <em class="hi">æŒ‰é’®å¸®åŠ©æˆ‘å†™æ›´å¤šè¿™æ ·çš„æ–‡ç« ã€‚<br/>è°¢è°¢ğŸ–¤ </em></p></blockquote></div><div class="ab cl lu lv gp lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="hb hc hd he hf"><h2 id="7b98" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">ğŸš€ğŸ‘‰å…³äºKubernetesçš„æ‰€æœ‰æ–‡ç« </h2><div class="mi mj ez fb mk"><div role="button" tabindex="0" class="ab bv ff cb dy ml mm bn mn jh mo"><div class="mp l"><div class="ab q"><div class="l di"><img alt="Md Shamim" class="l de bw mq mr du" src="../Images/b46bdc53005abde6c6cb3e8ff0c200c3.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*Hqd8Xz1WHsoL1s2To3awnA.png"/><div class="dr bw l mq mr ds n aw dt"/></div><div class="gg l dw"><p class="bd b fp z dy dz ea eb ec ed ee ef dx translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" rel="noopener follow" target="_top" href="/@shamimice03?source=post_page-----9a064c302d43--------------------------------"> Mdæ²™ç±³å§†</a></p></div></div><div class="mu mv fg l"><h2 class="bd hj si sj dy sk ea eb sl ed ef hh bi translated">å…³äºKubernetesçš„æ‰€æœ‰æ–‡ç« </h2></div><div class="ab q"><div class="l dw"><a class="bd b be z bi sm au sn so sp pl sq an fx fy sr ss st gb gc gd de bk ge" rel="noopener follow" target="_top" href="/@shamimice03/list/all-articles-on-kubernetes-7ae1a0f96f3b?source=post_page-----9a064c302d43--------------------------------">View list</a></div><div class="su l dw"><span class="bd b fp z dx">24 stories</span></div></div></div><div class="nh dh ni dy ab nj dw di"><div class="di mz bv na nb"><div class="dh l"><img alt="" class="dh" src="../Images/f1050aa27a3ef03122558b1ba1de1f58.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*7DhVxBWLKw_5M_jP"/></div></div><div class="di mz bv nc nd ne"><div class="dh l"><img alt="" class="dh" src="../Images/f1c4131e92176033bce05392de197205.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*AkrEbqlA_j76u2I5Tm8npg.png"/></div></div><div class="di bv nf ng ne"><div class="dh l"><img alt="" class="dh" src="../Images/27d4385154af67764cf37713dbbdc38e.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*98RmgcHgM1cyOobu"/></div></div></div></div></div></div></div>    
</body>
</html>