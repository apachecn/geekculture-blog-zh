<html>
<head>
<title>Push Notification for Order Placed Using Observable Design Pattern with Spring Boot, WebSocket, Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨Spring Bootã€WebSocketå’ŒAngularçš„å¯è§‚å¯Ÿè®¾è®¡æ¨¡å¼æ¨é€è®¢å•é€šçŸ¥</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/geekculture/push-notification-for-order-placed-using-observable-design-pattern-with-spring-boot-websocket-9203874f3ebb?source=collection_archive---------1-----------------------#2021-09-03">https://medium.com/geekculture/push-notification-for-order-placed-using-observable-design-pattern-with-spring-boot-websocket-9203874f3ebb?source=collection_archive---------1-----------------------#2021-09-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="654a" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">è€å®è¯´ï¼Œæˆ‘æ­£å‡†å¤‡æ”¾å¼ƒåšè¿™ä¸ªç‰¹æ€§ï¼Œå› ä¸ºä¸€ä½é«˜çº§Javaå¼€å‘äººå‘˜å‘Šè¯‰æˆ‘,â€œå¯è§‚å¯Ÿæ¨¡å¼â€ä¸»è¦é€‚ç”¨äºç§»åŠ¨å’ŒåµŒå…¥å¼åº”ç”¨ç¨‹åºï¼Œä¸é€‚ç”¨äºwebï¼Œwebç¯å¢ƒæ˜¯æ— çŠ¶æ€çš„ã€‚ä½†åœ¨å®ŒæˆèŠå¤©åŠŸèƒ½åï¼Œè¿™ç»™äº†æˆ‘ä¸€äº›ä¿¡å¿ƒï¼Œæˆ‘åœ¨Observable pattern + WebSocketä¸Šåˆè¯•äº†ä¸€æ¬¡ï¼Œå¹¸è¿çš„æ˜¯å®ƒæˆåŠŸäº†..</p></blockquote><figure class="ji jj jk jl fd jm er es paragraph-image"><div class="er es jh"><img src="../Images/6d117f533dc552222c1660d344f2f0dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*XJxA_IA9--szLIGLuj0Vag.jpeg"/></div></figure><p id="c530" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jp iv iw ix jq iz ja jb jr jd je jf jg hb bi translated">è¿™ä¸ªåŠŸèƒ½åœ¨æˆ‘çš„è‚¡ç¥¨äº¤æ˜“é¡¹ç›®ä¸­ï¼Œå½“å¦ä¸€ä¸ªäº¤æ˜“è€…åˆšåˆšè´­ä¹°äº†ä¸€åªè‚¡ç¥¨æ—¶ï¼Œå®ƒä¼šé€šçŸ¥äº¤æ˜“è€…ã€‚</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="er es js"><img src="../Images/204ac1fc192e88e01c986474e4e80535.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*kqj7J5JJXXWAswwRYFdJHw.gif"/></div></div></figure><p id="fb61" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jp iv iw ix jq iz ja jb jr jd je jf jg hb bi translated">æˆ‘åœ¨è€ƒè™‘ä¸¤ç§æ–¹æ³•æ¥åˆ¶ä½œè¿™ä¸ªåŠŸèƒ½:</p><ul class=""><li id="1aa8" class="jx jy hi il b im in iq ir jp jz jq ka jr kb jg kc kd ke kf bi translated"><strong class="il hj">çŸ­è½®è¯¢</strong>:åˆ›å»ºä¸€ç»„æ–°ä¹°å…¥çš„è‚¡ç¥¨ï¼Œå­˜å‚¨åœ¨åç«¯ã€‚å‰ç«¯å°†é€šè¿‡ä½¿ç”¨setInterval()æ¯éš”05åˆ†é’Ÿå‘åç«¯å‘é€è¯·æ±‚æ¥è·å¾—è¿™ä¸ªæ›´æ–°çš„é›†åˆã€‚</li><li id="23c6" class="jx jy hi il b im kg iq kh jp ki jq kj jr kk jg kc kd ke kf bi translated"><strong class="il hj">å¯è§‚å¯Ÿæ¨¡å¼+ WebSocket: </strong>ä½¿ç”¨å¯è§‚å¯Ÿæ¨¡å¼è§‚å¯Ÿä»»ä½•æ–°è®¢å•ï¼Œå¹¶ä½¿ç”¨WebSocketè‡ªåŠ¨ä»æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€é€šçŸ¥ï¼Œè€Œæ— éœ€è°ƒç”¨HTTPè¯·æ±‚ã€‚</li></ul><p id="a6f5" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jp iv iw ix jq iz ja jb jr jd je jf jg hb bi translated"><strong class="il hj">çŸ­æœŸæŠ•ç¥¨:</strong>è¿™ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ–¹æ³•ã€‚è¿™æ ·åšæœ‰å‡ ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹:å¤§é‡çš„è¯·æ±‚ä¼šæ¶ˆè€—æœåŠ¡å™¨èµ„æºï¼Œå¦‚æœæ•°æ®ä¸ç»å¸¸æ›´æ–°ï¼Œå¤§å¤šæ•°è¯·æ±‚ä¼šè¿”å›ç©ºå€¼ã€‚</p><p id="9404" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jp iv iw ix jq iz ja jb jr jd je jf jg hb bi translated"><strong class="il hj">å¯è§‚å¯Ÿæ¨¡å¼+ WebSocket: </strong>è¿™å°±æ˜¯æˆ‘è¦æ‰¾çš„ï¼Œæˆ‘ä¼šåœ¨æœ¬å¸–ä¸­è§£é‡Šã€‚</p><p id="ca45" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jp iv iw ix jq iz ja jb jr jd je jf jg hb bi translated">é¦–å…ˆï¼Œæˆ‘å°†åˆ›å»ºä¸€ä¸ªPropertyChangedEventArgs <t>:</t></p><pre class="ji jj jk jl fd kl km kn ko aw kp bi"><span id="f862" class="kq kr hi km b fi ks kt l ku kv">@AllArgsConstructor<br/>public class PropertyChangedEventArgs&lt;T&gt;{<br/>    public T source; (1)<br/>    public String userId; (2)<br/>    public String symbol; (3)<br/>}</span></pre><p id="14ed" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jp iv iw ix jq iz ja jb jr jd je jf jg hb bi translated">(1):å¯¹æºçš„å¼•ç”¨<br/> (2)ï¼Œ(3):æ­£åœ¨è¢«æ”¹å˜çš„ä¿¡æ¯</p><p id="1370" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jp iv iw ix jq iz ja jb jr jd je jf jg hb bi translated">è¿™åŒ…å«äº†ä¸€äº›å…³äºç‰¹å®šå±æ€§æ›´æ”¹çš„ä¿¡æ¯ï¼Œå®ƒæ˜¯åœ¨Tç±»å‹çš„å¯¹è±¡ä¸Šï¼Œåœ¨æˆ‘çš„ä¾‹å­ä¸­Tæ˜¯ä¸€ä¸ªæ§åˆ¶å™¨(OrderControllerImpl)ã€‚æˆ‘ä¹‹æ‰€ä»¥ä½¿ç”¨æ³›å‹ï¼Œæ˜¯å› ä¸ºæˆ‘æƒ³è®©å®ƒå°½å¯èƒ½çµæ´»ã€‚</p><p id="2d9e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jp iv iw ix jq iz ja jb jr jd je jf jg hb bi translated">ç„¶åæˆ‘éœ€è¦åˆ›å»ºä¸€ä¸ªè§‚å¯Ÿè€…ç•Œé¢</p><pre class="ji jj jk jl fd kl km kn ko aw kp bi"><span id="52fa" class="kq kr hi km b fi ks kt l ku kv">public interface Observer&lt;T&gt; {<br/>    void handle (PropertyChangedEventArgs&lt;T&gt; args);<br/>}</span></pre><p id="3a05" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jp iv iw ix jq iz ja jb jr jd je jf jg hb bi translated">â€œObserverâ€æ˜¯ä¸€ä¸ªå¸Œæœ›ç”±ä»»ä½•å¯¹è§‚å¯Ÿtç±»å‹å¯¹è±¡æ„Ÿå…´è¶£çš„äººå®ç°çš„æ¥å£ã€‚åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œæ˜¯OrderWSControllerå®ç°äº†Observeræ¥å£æ¥è§‚å¯ŸOrderControllerImplä¸­çš„å˜åŒ–(åˆ›å»ºäº†ä¸€ä¸ªæ–°è®¢å•)ã€‚</p><p id="fd04" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jp iv iw ix jq iz ja jb jr jd je jf jg hb bi translated">ä¸ºä»€ä¹ˆOrderWSControlleræ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…è€Œä¸æ˜¯å¦ä¸€ä¸ªç±»ï¼Ÿæ˜¯å› ä¸ºOrderWSControllerè´Ÿè´£ä½¿ç”¨WebSocketè€Œä¸æ˜¯HTTPè¯·æ±‚ä»æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€æ•°æ®(é€šçŸ¥)ã€‚</p><p id="ab66" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jp iv iw ix jq iz ja jb jr jd je jf jg hb bi translated">ä¸‹é¢æ˜¯æˆ‘å®ç°è§‚å¯Ÿè€…æ¥å£çš„æ–¹æ³•:</p><pre class="ji jj jk jl fd kl km kn ko aw kp bi"><span id="f418" class="kq kr hi km b fi ks kt l ku kv">@Controller<br/>public class OrderWSController implements Observer&lt;OrderControllerImpl&gt; {<br/>    private final SimpMessagingTemplate simpMessagingTemplate;<br/><br/>    @Autowired<br/>    DailyService dailyService;<br/><br/>    @Autowired<br/>    OrderService orderService;<br/><br/>    OrderControllerImpl orderController;<br/><br/><br/>    public OrderWSController(SimpMessagingTemplate simpMessagingTemplate, OrderControllerImpl orderController){<br/>        this.simpMessagingTemplate = simpMessagingTemplate;<br/>        this.orderController = orderController;<br/>        this.orderController.subscribe(this); (1)<br/>    };<br/><br/>   @Override  (2)<br/>    public void handle(PropertyChangedEventArgs&lt;OrderControllerImpl&gt; args) {<br/>        String message = args.userId + " has just purchased " + args.symbol;<br/>        this.simpMessagingTemplate.convertAndSend("/queue/new-order", message);<br/>    } <br/>}</span></pre><p id="acd4" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jp iv iw ix jq iz ja jb jr jd je jf jg hb bi translated">(2)æ¯å½“æœ‰äººå®é™…æ‰§è¡Œä¸€äº›æ›´æ”¹(åˆ›å»ºè®¢å•/è´­ä¹°è‚¡ç¥¨)æ—¶ï¼Œå®ƒå°†ä»PropertyChangedEventArgs(userIdï¼Œsymbol name)è·å–æ›´æ”¹ä¿¡æ¯ï¼Œç„¶åç«‹å³å°†å…¶å‘é€ç»™è®¢é˜…â€œ/queue/new-orderâ€ç«¯ç‚¹çš„å®¢æˆ·ç«¯ã€‚</p><p id="f78a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jp iv iw ix jq iz ja jb jr jd je jf jg hb bi translated">(1) OrderWSControllerå°†OrderControllerImplæ³¨å…¥åˆ°å®ƒçš„ç±»ä¸­ï¼Œå¹¶è®©OrderControllerImplä½¿ç”¨subscribe()å°†OrderWSControlleræ·»åŠ ä¸ºå®ƒçš„ä¸€ä¸ªè§‚å¯Ÿè€…ã€‚ä¸‹é¢çš„è¯¾ç¨‹å°†è¯¦ç»†è§£é‡Šè¿™ä¸ªæƒ³æ³•ã€‚</p><p id="187f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jp iv iw ix jq iz ja jb jr jd je jf jg hb bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘å°†åˆ›å»ºä¸€ä¸ªå¯è§‚å¯Ÿçš„ç±»</p><pre class="ji jj jk jl fd kl km kn ko aw kp bi"><span id="1c4c" class="kq kr hi km b fi ks kt l ku kv">public class Observable&lt;T&gt;{<br/><br/>   (1) public List&lt;Observer&lt;T&gt;&gt; observers = new ArrayList&lt;&gt;(); <br/><br/>   (2) public void subscribe(Observer&lt;T&gt; observer) {<br/>        this.observers.add(observer); <br/>    }<br/><br/>   (3) protected void notifyObservers(T source, String userId, String symbol) {<br/>        for (Observer&lt;T&gt; o : observers) {<br/>            o.handle(new PropertyChangedEventArgs&lt;T&gt;(source, userId, symbol));<br/>        }<br/>    } <br/>}</span></pre><p id="fee1" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jp iv iw ix jq iz ja jb jr jd je jf jg hb bi translated">(1)æ­£åœ¨è§‚å¯Ÿå˜åŒ–çš„æ‰€æœ‰Tå‹è§‚å¯Ÿè€…çš„åˆ—è¡¨ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒæ˜¯OrderWSControllerã€‚<br/> (2)åœ¨å½“å‰è§‚å¯Ÿè€…åˆ—è¡¨ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„è§‚å¯Ÿè€…ã€‚æˆ‘åœ¨å‰é¢è¿˜è§£é‡Šäº†å¦‚ä½•å°†OrderWSControlleræ·»åŠ åˆ°å½“å‰è§‚å¯Ÿè€…åˆ—è¡¨ä¸­<br/> (3)é€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…å…³äºå˜æ›´çš„ä¿¡æ¯ã€‚</p><p id="460d" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jp iv iw ix jq iz ja jb jr jd je jf jg hb bi translated">ä¸‹é¢æ˜¯å¦‚ä½•åœ¨OrderControllerImplä¸­ä½¿ç”¨è¿™ä¸ªå¯è§‚å¯Ÿçš„ç±»:</p><pre class="ji jj jk jl fd kl km kn ko aw kp bi"><span id="e8d5" class="kq kr hi km b fi ks kt l ku kv">@RestController<br/>@RequestMapping("/order")<br/><strong class="km hj">public class OrderControllerImpl extends Observable&lt;OrderControllerImpl&gt;</strong> implements OrderController {<br/>    @Autowired<br/>    private OrderService orderService;<br/><br/>    @Autowired<br/>    private ResponseFactory responseFactory;<br/><br/>    @PostMapping<br/>    public ResponseEntity&lt;?&gt; createNewOrder(@RequestBody OrderDto order) {<br/>        try{<br/>            Order saved = orderService.save(order);<br/><br/><strong class="km hj">            if(saved.getOrderSide().name() =="BUY"){<br/>                notifyObservers(this, saved.getUser().getUserId(), saved.getSymbol().getSymbol()); </strong><br/>            }<br/><br/>            return responseFactory.success(saved);<br/>        }<br/>        catch(IllegalArgumentException ex){<br/>            throw new BadRequestException(ex.getMessage());<br/>        }<br/>        catch(Exception ex){<br/>            throw new InternalServerException("Unable to create new order.");<br/>        }<br/>    }<br/>}</span></pre><p id="d924" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jp iv iw ix jq iz ja jb jr jd je jf jg hb bi translated">æœ€åï¼Œåœ¨æˆ‘çš„Angularåº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘éœ€è¦è®¢é˜…ç«¯ç‚¹ï¼Œå¹¶åœ¨æœ‰æ–°è®¢å•æ—¶é€šçŸ¥ç”¨æˆ·ã€‚</p><pre class="ji jj jk jl fd kl km kn ko aw kp bi"><span id="14b8" class="kq kr hi km b fi ks kt l ku kv">ngOnInit(): void {<br/>  this.initializeWebSocketConnection();<br/>}<br/><br/>initializeWebSocketConnection(): any {<br/>  <strong class="km hj"><em class="ik">console</em></strong>.log('connected to ws ...');<br/><br/>  const ws = new SockJS(this.serverUrl);<br/><br/>  this.stompClient = Stomp.over(ws);<br/><br/>  const that = this;<br/><br/>  this.stompClient.connect({}, (frame) =&gt; {<br/>    that.stompClient.subscribe(`/queue/new-order`, (order) =&gt; {<br/>      let userId = order.body.split(" ")[0];<br/>      if (this.auth.readToken().userId != userId) {<br/>        this.snackBar.open(order.body, "", {<br/>          duration: 3000,<br/>          verticalPosition: "top",<br/>          horizontalPosition: "center"<br/>        });<br/>      }<br/>    });<br/>  }, (err) =&gt; {<br/>    <strong class="km hj"><em class="ik">console</em></strong>.log(err);<br/>  });<br/>}</span></pre><p id="8e78" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jp iv iw ix jq iz ja jb jr jd je jf jg hb bi translated">ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æˆ‘çš„æºä»£ç <a class="ae kw" href="https://github.com/trangntt-016/stocktrading" rel="noopener ugc nofollow" target="_blank"/>ã€‚</p><p id="fd99" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jp iv iw ix jq iz ja jb jr jd je jf jg hb bi translated">ç„¶è€Œï¼Œæˆ‘ä»ç„¶ä¸ç¡®å®šè¿™æ˜¯å¦æ˜¯ä¸€ä¸ªæœ€ä¼˜è§£ã€‚è¯·éšæ—¶ç»™æˆ‘åé¦ˆï¼Œæˆ‘æ´—è€³æ­å¬ã€‚</p><p id="22e0" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jp iv iw ix jq iz ja jb jr jd je jf jg hb bi translated"><strong class="il hj">å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·é¼“æŒ</strong>ğŸ‘<strong class="il hj">å¹¶åˆ†äº«å‡ºæ¥ï¼Œè®©åˆ«äººä¹Ÿèƒ½æ‰¾åˆ°ï¼</strong>ğŸ˜„ã€‚</p></div></div>    
</body>
</html>