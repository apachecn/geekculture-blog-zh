<html>
<head>
<title>Motion Detection in Unity with OpenCV</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">OpenCVä¸­çš„Unityè¿åŠ¨æ£€æµ‹</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/geekculture/motion-detection-in-unity-with-opencv-299b1720eac9?source=collection_archive---------16-----------------------#2021-08-02">https://medium.com/geekculture/motion-detection-in-unity-with-opencv-299b1720eac9?source=collection_archive---------16-----------------------#2021-08-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="c3e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿åŠ¨æ£€æµ‹æ˜¯æ£€æµ‹ç‰©ä½“ç›¸å¯¹äºå…¶å‘¨å›´ç¯å¢ƒçš„ä½ç½®å˜åŒ–çš„èƒ½åŠ›ã€‚è¿™åœ¨è®¸å¤šåº”ç”¨ä¸­å¯èƒ½æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ¦‚å¿µï¼Œå°¤å…¶æ˜¯åœ¨æ™ºèƒ½CCTVæ‘„åƒæœºä¸­ï¼Œå½“å®ƒæ£€æµ‹åˆ°è¿åŠ¨æ—¶å°±ä¼šå¼€å§‹è®°å½•ã€‚</p><p id="feaa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸ºäº†æ£€æµ‹æ‘„åƒæœºè§†é‡å†…æ˜¯å¦æœ‰ä»»ä½•ç‰©ä½“çš„è¿åŠ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å·®åˆ†å›¾åƒæŠ€æœ¯æ¥å®ç°æˆ‘ä»¬çš„ç›®æ ‡ã€‚é¦–å…ˆï¼Œæˆ‘åº”è¯¥æåˆ°çš„æ˜¯ï¼Œæˆ‘æ˜¯ä»<a class="ae jd" rel="noopener" href="/@deepakkumar1984/motion-detection-with-open-cv-and-c-88cdad521c15">è¿™ç¯‡</a>åšå®¢ä¸­å‘ç°è¿™ç§æŠ€æœ¯çš„ï¼Œä½œè€…å·²ç»ä½¿ç”¨OpenCVç”¨C#å®ç°äº†è¿™ç§æŠ€æœ¯ã€‚</p><p id="8b36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘è¦åšçš„æ˜¯ä½¿ç”¨ç›¸åŒçš„æŠ€æœ¯(å’Œæ¥è‡ªåŒä¸€åšå®¢çš„ä¸€äº›ä»£ç )åœ¨unityä¸­å®ç°è¿åŠ¨æ£€æµ‹ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å°†æ£€æµ‹è¿åŠ¨å¹¶ç‚¹äº®ä¸€ä¸ªçº¢è‰²ç¯æ³¡(åªæ˜¯æ”¹å˜å›¾åƒçš„é¢œè‰²å’Œalphaå€¼ğŸ˜…)åŸºäºè¿åŠ¨çš„å¼ºåº¦ã€‚å¦‚æœæ‚¨æƒ³äº†è§£æˆ‘ä»¬æœ€ç»ˆçš„åº”ç”¨ç»“æœï¼Œè¯·è·³åˆ°æ•…äº‹çš„ç»“å°¾ã€‚</p><p id="d05e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">å¾®åˆ†å›¾åƒæ¦‚å¿µ</strong></p><p id="b82c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å·®åˆ†å›¾åƒæ¦‚å¿µçš„æ€æƒ³æ˜¯ï¼Œå½“ä¸€ä¸ªç‰©ä½“ç§»åŠ¨æ—¶ï¼Œå®ƒçš„ä½ç½®åœ¨ä¸¤ä¸ªè¿ç»­çš„å¸§ä¸­å°†æ˜¯ä¸åŒçš„ï¼Œä½†æ˜¯å‘¨å›´çš„ç¯å¢ƒå°†ä¿æŒä¸å˜ã€‚æ‰€ä»¥ï¼Œé€šè¿‡å‡å»è¿™ä¸¤å¸§ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç‰©ä½“çš„è¿åŠ¨ã€‚</p><p id="2489" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿™é‡Œï¼Œæˆ‘ä»¬å°†ä½¿ç”¨3ä¸ªè¿ç»­çš„å¸§æ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼Œå› ä¸ºä½¿ç”¨3ä¸ªå¸§çš„ä¼˜ç‚¹æ˜¯å¯ä»¥æ¶ˆé™¤é™æ­¢çš„ç¯å¢ƒã€‚æˆ‘ä¹Ÿæ˜¯ä»æˆ‘ä¹‹å‰æåˆ°çš„åŒä¸€ç¯‡<a class="ae jd" rel="noopener" href="/@deepakkumar1984/motion-detection-with-open-cv-and-c-88cdad521c15">æ–‡ç« </a>ä¸­è·å¾—è¿™ä¸ªæƒ³æ³•çš„ã€‚å‚è€ƒä¸€ä¸‹å¯ä»¥æ›´å¥½çš„ç†è§£è¿™ä¸ªæ¦‚å¿µã€‚</p><p id="791d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ‰§è¡Œä¸Šè¿°æ­¥éª¤åè·å¾—çš„å¸§å¦‚ä¸‹æ‰€ç¤º:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/dd30642c16a68136c9879d0570343611.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jXUNpi4eJvN4P04Fdlgk6Q.jpeg"/></div></div></figure><h1 id="d0fb" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak">å®ç°</strong></h1><p id="871e" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">å› æ­¤ï¼Œè®©æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªunityé¡¹ç›®(2Dæˆ–3Dæ— å…³ç´§è¦)ï¼Œå¹¶ä¸ºunityå¯¼å…¥OpenCVèµ„äº§ã€‚</p><p id="85b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¯¥èµ„äº§å¯åœ¨ä»¥ä¸‹ä½ç½®æ‰¾åˆ°:</p><p id="e5de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://assetstore.unity.com/packages/tools/integration/opencv-for-unity-21088" rel="noopener ugc nofollow" target="_blank">OpenCV for Unity | Integration | Unity Asset Store</a></p><p id="02c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç„¶ååˆ›å»ºä¸€ä¸ªç”»å¸ƒï¼Œåœ¨ç”»å¸ƒä¸­åˆ›å»ºä¸‰ä¸ªRawImagesï¼Œåˆ†åˆ«å‘½åä¸ºCameraViewã€DetectionViewå’ŒBulbï¼Œä¿å­˜åœºæ™¯ã€‚æˆ‘å·²ç»å°†æ¸¸æˆçª—å£ä¸­çš„ç”»å¸ƒå¤§å°ä»è‡ªç”±çºµæ¨ªæ¯”æ›´æ”¹ä¸º4:3ã€‚</p><p id="57c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç›¸æœºè§†å›¾â€”æ˜¾ç¤ºåŸå§‹ç›¸æœºé¦ˆé€</p><p id="13b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ£€æµ‹è§†å›¾â€”æ˜¾ç¤ºè¿åŠ¨æ£€æµ‹é¦ˆé€</p><p id="2beb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç¯æ³¡â€”æ˜¾ç¤ºè¿åŠ¨çš„å¼ºåº¦</p><p id="3d5b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(è¦åˆ›å»ºcanvas/RawImage:å³é”®å•å‡»å±‚æ¬¡éƒ¨åˆ†-&gt; UI -&gt; Canvas/RawImage)</p><p id="9685" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ­¤å¤–ï¼Œåˆ›å»ºä¸€ä¸ªç©ºçš„æ¸¸æˆå¯¹è±¡ï¼Œå¹¶å°†å…¶å‘½åä¸ºâ€œScriptHandlerâ€ã€‚(æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¸¸æˆå¯¹è±¡æ¥é™„åŠ è„šæœ¬ï¼Œè¿™æ ·ä¼šå¾ˆæ–¹ä¾¿)ã€‚</p><p id="7273" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ¥ä¸‹æ¥ï¼Œä¸‹è½½ä»»ä½•å›¾åƒï¼Œå¹¶å°†å…¶å¯¼å…¥unity assetséƒ¨åˆ†ã€‚(æˆ‘ä»<a class="ae jd" href="https://www.clipartmax.com/middle/m2i8d3A0A0m2m2A0_yes-sign-clip-art-at-clker-red-circle-no-background/" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œ</a>ä¸‹è½½äº†ä¸€ä¸ªå‰ªè´´ç”»ã€‚)ä¹‹åï¼Œé€‰æ‹©ç¯æ³¡RawImageï¼Œåœ¨æ£€æŸ¥å™¨çª—å£ä¸­ï¼Œæ‚¨ä¼šåœ¨Raw Imageéƒ¨åˆ†çœ‹åˆ°â€œçº¹ç†â€ã€‚ä»é‚£é‡Œï¼Œæ‰“å¼€é€‰æ‹©çª—å£ï¼Œé€‰æ‹©ä½ åˆšæ‰å¯¼å…¥çš„å›¾åƒçš„çº¹ç†ã€‚</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es kt"><img src="../Images/11c97e951d070d8ba9ef840380332e38.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/1*14DD9xga-4HCWbxkN_B72A.png"/></div></figure><p id="35f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç„¶åï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´å¯¹è±¡çš„å¤§å°å’Œä½ç½®ã€‚</p><p id="8faa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å®Œæˆåï¼Œæ‚¨çš„é¡¹ç›®ç»“æ„åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ku"><img src="../Images/c2e25d2f18357f505d074991f5baa11e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TJ3WLlBPi5m1Bj1DUfdYEA.jpeg"/></div></div></figure><p id="6555" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ¥ä¸‹æ¥è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸ºâ€œdetectionâ€(æˆ–ä»»ä½•åç§°)çš„C#è„šæœ¬æ¥å¼€å§‹ç¼–ç ã€‚</p><p id="c30e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(å³é”®å•å‡»é¡¹ç›®çª—å£ä¸­çš„èµ„äº§éƒ¨åˆ†-&gt;åˆ›å»º-&gt; C#è„šæœ¬)</p><p id="0b57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è®©æˆ‘ä»¬åœ¨Visual Studioä¸­æ‰“å¼€C#è„šæœ¬ã€‚</p><p id="f3b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">é¦–å…ˆæ·»åŠ ä»¥ä¸‹å¯¼å…¥ã€‚</p><pre class="jf jg jh ji fd kv kw kx ky aw kz bi"><span id="d5de" class="la jr hi kw b fi lb lc l ld le">using OpenCVForUnity.CoreModule;<br/>using OpenCVForUnity.ImgprocModule;<br/>using OpenCVForUnity.UnityUtils;<br/>using System;<br/>using System.Collections;<br/>using System.Collections.Generic;<br/>using UnityEngine;<br/>using UnityEngine.UI;</span></pre><p id="1d97" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºå¦‚ä¸‹4ä¸ªæˆå‘˜å˜é‡:</p><pre class="jf jg jh ji fd kv kw kx ky aw kz bi"><span id="0874" class="la jr hi kw b fi lb lc l ld le">[SerializeField] private RawImage cameraView;</span><span id="7e66" class="la jr hi kw b fi lf lc l ld le">[SerializeField] private RawImage detectionView;</span><span id="59b5" class="la jr hi kw b fi lf lc l ld le">[SerializeField] private RawImage bulb;</span><span id="0d1b" class="la jr hi kw b fi lf lc l ld le">private WebCamTexture webcamTexture;</span></pre><p id="c388" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¹‹åï¼Œè®©æˆ‘ä»¬åˆå§‹åŒ–startæ–¹æ³•æ¥æ˜¾ç¤ºæ‘„åƒæœºçš„è¾“å…¥ã€‚</p><p id="a4f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è·å¾—å¯ç”¨çš„ç›¸æœºè®¾å¤‡ï¼Œå¹¶å°†â€œcamera viewâ€raw imageçš„çº¹ç†è®¾ç½®ä¸ºwebcamTextureï¼Œç„¶åå¯åŠ¨ç½‘ç»œæ‘„åƒå¤´é¦ˆé€ã€‚</p><p id="60e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¦‚æœæ‚¨çš„è®¾å¤‡æœ‰å¤šä¸ªæ‘„åƒæœº(ä¾‹å¦‚ç§»åŠ¨ç”µè¯)ï¼Œæ‚¨å¯ä»¥é€šè¿‡æ›´æ”¹cam_devices[]æ•°ç»„ä¸­çš„å€¼æ¥æ›´æ”¹è¦è®¿é—®çš„æ‘„åƒæœºã€‚</p><p id="b3d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸‹é¢æ˜¯Start()æ–¹æ³•:</p><pre class="jf jg jh ji fd kv kw kx ky aw kz bi"><span id="8f16" class="la jr hi kw b fi lb lc l ld le">void Start()</span><span id="8674" class="la jr hi kw b fi lf lc l ld le">{<br/>  //obtain cameras avialable<br/>  WebCamDevice[] cam_devices = WebCamTexture.devices;</span><span id="54cc" class="la jr hi kw b fi lf lc l ld le">  //create camera texture<br/>  webcamTexture = new WebCamTexture(cam_devices[0].name, 480, 640, 30);</span><span id="8cdb" class="la jr hi kw b fi lf lc l ld le">  //set raw image texture to obtain feed from camera texture<br/>  cameraView.texture = webcamTexture;<br/>  cameraView.material.mainTexture = webcamTexture;</span><span id="0a18" class="la jr hi kw b fi lf lc l ld le">  //start camera<br/>  webcamTexture.Play();</span><span id="e07b" class="la jr hi kw b fi lf lc l ld le">  //start coroutine<br/>  StartCoroutine(motionDetection());<br/>}</span></pre><p id="8a04" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æœ€åä¸€è¡Œä»£ç æ˜¯å¯åŠ¨motionDetection()åç¨‹æ–¹æ³•ï¼Œæˆ‘ä»¬ç¨åå°†å®ç°è¯¥æ–¹æ³•ã€‚</p><p id="79ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬åˆ›å»ºDiffImageæ–¹æ³•æ¥è®¡ç®—ä¸‰ä¸ªè¿ç»­å¸§ä¹‹é—´çš„å·®å¼‚ã€‚æˆ‘ä»ä¹‹å‰æåˆ°çš„åŒä¸€ä¸ªåšå®¢çš„<a class="ae jd" rel="noopener" href="/@deepakkumar1984/motion-detection-with-open-cv-and-c-88cdad521c15">é‚£é‡Œè·å¾—äº†è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”æˆ‘å·²ç»ä¿®æ”¹äº†ä»£ç ä»¥é€‚åº”OpenCV for Unityã€‚</a></p><pre class="jf jg jh ji fd kv kw kx ky aw kz bi"><span id="f7a0" class="la jr hi kw b fi lb lc l ld le">Mat DiffImage(Mat t0, Mat t1, Mat t2)</span><span id="31ae" class="la jr hi kw b fi lf lc l ld le">{<br/>  Mat d1 = new Mat();<br/>  Core.absdiff(t2, t1, d1);</span><span id="dff3" class="la jr hi kw b fi lf lc l ld le">  Mat d2 = new Mat();<br/>  Core.absdiff(t1, t0, d2);</span><span id="43c7" class="la jr hi kw b fi lf lc l ld le">  Mat diff = new Mat();<br/>  Core.bitwise_and(d1, d2, diff);</span><span id="6c79" class="la jr hi kw b fi lf lc l ld le">  return diff;<br/>}</span></pre><p id="3da3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘ä»¬åœ¨è¿™é‡Œä¸»è¦åšçš„æ˜¯è·å¾—å¸§t1ã€t0å’Œt2ã€t1ä¹‹é—´çš„åƒç´ çš„ç»å¯¹å·®ï¼Œå¹¶å°†å€¼åˆ†åˆ«å­˜å‚¨åœ¨d2å’ŒD1 Matsâ€™ä¸­ã€‚(Matæ˜¯å­˜å‚¨å›¾åƒå€¼çš„OpenCVç±»)ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è·å¾—d2å’Œd1çš„æŒ‰ä½ANDè¿ç®—ã€‚</p><p id="f74f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç°åœ¨ï¼Œè®©æˆ‘ä»¬å®ç°motionDetection()æ–¹æ³•ã€‚è¿™æ˜¯ä¸€ä¸ªåç¨‹æ–¹æ³•ï¼Œå¤„ç†æˆ‘ä»¬å¤§éƒ¨åˆ†å·¥ä½œã€‚è¯¥æ–¹æ³•åŒ…å«ä¸€ä¸ªå¾ªç¯ï¼Œè¯¥å¾ªç¯å°†æ— ç»ˆæ­¢åœ°è¿è¡Œï¼Œä»¥ä¿æŒè¿åŠ¨æ£€æµ‹çš„æ‘„åƒæœºé¦ˆé€è¿ç»­åœ°æ¸²æŸ“åˆ°åŸå§‹å›¾åƒè§†å›¾ã€‚</p><pre class="jf jg jh ji fd kv kw kx ky aw kz bi"><span id="7a49" class="la jr hi kw b fi lb lc l ld le">private IEnumerator motionDetection()</span><span id="56c6" class="la jr hi kw b fi lf lc l ld le">{<br/>  while (true)<br/>  {<br/>  }<br/>}</span></pre><p id="a05b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä»è¿™é‡Œå¼€å§‹ï¼Œå°†æä¾›çš„æ‰€æœ‰ä»£ç æ·»åŠ åˆ°ä¸Šè¿°æ–¹æ³•(motionDetection()æ–¹æ³•)çš„whileå¾ªç¯ä¸­ã€‚</p><p id="333b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸‰ä¸ªOpenCV Matsæ¥å­˜å‚¨3ä¸ªè¿ç»­çš„å¸§ã€‚</p><p id="8cae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å½“è·å¾—ä¸€å¸§æ¥ä¸€å¸§çš„ç”»é¢æ—¶ï¼Œæˆ‘å¢åŠ äº†0.04ç§’çš„å»¶è¿Ÿï¼Œè¿™æ ·æˆ‘ä»¬çœ‹åˆ°çš„ç”»é¢æ›´çœŸå®ã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€è¦æ›´æ”¹è¯¥å€¼ã€‚</p><p id="e01b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘ä»¬ä½¿ç”¨webcamTextureçš„å¤§å°åˆå§‹åŒ–Matï¼Œå¹¶ä½¿ç”¨OpenCVçš„â€œwebCamTextureToMatâ€æ–¹æ³•å°†åƒç´ å€¼åŠ è½½åˆ°Matã€‚</p><p id="17e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸‹é¢ç»™å‡ºäº†è®¾ç½®è¿™ä¸‰ä¸ªå«å­çš„ä»£ç ã€‚</p><pre class="jf jg jh ji fd kv kw kx ky aw kz bi"><span id="a3b4" class="la jr hi kw b fi lb lc l ld le">  Mat t0 = new Mat(webcamTexture.height, webcamTexture.width, CvType.CV_8UC4);<br/>  Utils.webCamTextureToMat(webcamTexture, t0); //obtain fram from webcam<br/>  yield return new WaitForSeconds(0.04F);// wait for 0.04s<br/>  yield return new WaitForEndOfFrame();// wait till end of frame</span><span id="7a42" class="la jr hi kw b fi lf lc l ld le">  Mat t1 = new Mat(webcamTexture.height, webcamTexture.width, CvType.CV_8UC4);<br/>  Utils.webCamTextureToMat(webcamTexture, t1);<br/>  yield return new WaitForSeconds(0.04F);<br/>  yield return new WaitForEndOfFrame();</span><span id="7a34" class="la jr hi kw b fi lf lc l ld le">  Mat t2 = new Mat(webcamTexture.height, webcamTexture.width, CvType.CV_8UC4);<br/>  Utils.webCamTextureToMat(webcamTexture, t2);<br/>  yield return new WaitForSeconds(0.04F);<br/>  yield return new WaitForEndOfFrame();</span></pre><p id="043f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æŠŠå¸§è½¬æ¢æˆç°åº¦ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨æ£€æµ‹è¿åŠ¨æ—¶ä¸éœ€è¦é¢œè‰²ä¿¡æ¯ã€‚ä¸ºæ­¤ï¼Œè¯·å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°motionDetection()æ–¹æ³•ä¸­ã€‚</p><pre class="jf jg jh ji fd kv kw kx ky aw kz bi"><span id="4795" class="la jr hi kw b fi lb lc l ld le">Imgproc.cvtColor(t0, t0, Imgproc.COLOR_RGBA2GRAY);<br/>Imgproc.cvtColor(t1, t1, Imgproc.COLOR_RGBA2GRAY);<br/>Imgproc.cvtColor(t2, t2, Imgproc.COLOR_RGBA2GRAY);</span></pre><p id="9016" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„Matå¹¶å°†ä¸‰ä¸ªMatå¸§ä¼ é€’ç»™æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„DiffImage()æ–¹æ³•ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨æ–°çš„Matä¸­ã€‚</p><pre class="jf jg jh ji fd kv kw kx ky aw kz bi"><span id="b4a5" class="la jr hi kw b fi lb lc l ld le">Mat final = new Mat();<br/>final = DiffImage(t0, t1, t2);</span></pre><p id="f8a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªä¸â€œæœ€ç»ˆâ€Matå¤§å°ç›¸åŒçš„æ–°çº¹ç†ï¼Œç„¶åä½¿ç”¨OpenCVçš„â€œmatToTexure2Dâ€æ–¹æ³•å°†Matçš„å€¼åˆ†é…ç»™çº¹ç†ï¼Œå¹¶å°†detectionViewçº¹ç†è®¾ç½®ä¸ºè¿™ä¸ªæ–°çº¹ç†ã€‚</p><pre class="jf jg jh ji fd kv kw kx ky aw kz bi"><span id="2a44" class="la jr hi kw b fi lb lc l ld le">Texture2D texture = new Texture2D(final.cols(), final.rows(), TextureFormat.RGBA32, false);</span><span id="0ad9" class="la jr hi kw b fi lf lc l ld le">try<br/>{<br/>  Utils.matToTexture2D(final, texture);<br/>  detectionView.texture = texture;<br/>}<br/>catch (Exception)<br/>{<br/>}</span></pre><p id="caef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æœ€åï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ç¯æ³¡çš„é¢œè‰²ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä½¿ç”¨äº†ä¸€ç§ä¸å¤ªå¯é çš„æ–¹æ³•æ¥æ”¹å˜é˜¿å°”æ³•å’Œé¢œè‰²å€¼ï¼Œä½†è¿™åªæ˜¯ä¸ºäº†ç»™äººä¸€ç§è¿åŠ¨çš„å°è±¡ï¼Œæ‰€ä»¥æˆ‘è®¤ä¸ºè¿™å¾ˆå¥½ã€‚</p><p id="114e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘åœ¨è¿™é‡Œæ‰€åšçš„æ˜¯ï¼Œæˆ‘å·²ç»è·å¾—äº†â€œæœ€ç»ˆâ€Matä¸­éé›¶å€¼çš„è®¡æ•°ã€‚è¿™æ˜¯å› ä¸ºï¼Œåœ¨â€œæœ€ç»ˆâ€Matä¸­ï¼Œæˆ‘ä»¬å°†åœ¨æ²¡æœ‰è¿åŠ¨çš„åŒºåŸŸä½¿ç”¨å…¨é›¶(é»‘è‰²),è€Œåœ¨æ£€æµ‹åˆ°è¿åŠ¨çš„åŒºåŸŸä½¿ç”¨å…¶ä»–ç°åº¦å€¼ã€‚å› æ­¤ï¼Œé¦–å…ˆæˆ‘ä½¿ç”¨Debug.Logæ£€æŸ¥äº†é€šå¸¸å‡ºç°çš„éé›¶å€¼çš„èŒƒå›´(å½“ç„¶ï¼Œè¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¿è¡Œè¿™ä¸ªè„šæœ¬ä¹‹å‰åœ¨unity editorä¸­é…ç½®å…¶ä»–ä¸œè¥¿ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰è¿™æ ·åš)ã€‚æˆ‘å‘ç°é€šå¸¸è¿™ä¸ªè®¡æ•°å°äº250000(å³ä½¿æ²¡æœ‰è¿åŠ¨ï¼Œè¿™ä¸ªå€¼ä¹Ÿåœ¨80000å·¦å³ã€‚æˆ‘è§‰å¾—æ˜¯å› ä¸ºç›¸æœºçš„å™ªéŸ³)ã€‚æ‰€ä»¥æˆ‘å†³å®šå°†è¿™ä¸ªå€¼é™¤ä»¥1000ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªä»‹äº1å’Œ255ä¹‹é—´çš„å€¼ï¼Œå®ƒå¯ä»¥ç”¨ä½œé¢œè‰²(çº¢è‰²)å’Œalphaå€¼ã€‚</p><p id="0c72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿™æ˜¯å®ç°å®ƒçš„ä»£ç ã€‚</p><pre class="jf jg jh ji fd kv kw kx ky aw kz bi"><span id="5b7b" class="la jr hi kw b fi lb lc l ld le">Byte value = 0;</span><span id="20aa" class="la jr hi kw b fi lf lc l ld le">try<br/>{<br/>  value = Convert.ToByte(Core.countNonZero(final) / 1000);<br/>}<br/>catch (OverflowException)<br/>{<br/>  value = 255;<br/>}<br/>bulb.color = new Color32(value, 0, 0, value);</span></pre><p id="ebf6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿™é‡Œï¼Œæˆ‘æ·»åŠ äº†ä¸€ä¸ªtry-catchå—æ¥æ•è·ä»»ä½•æº¢å‡º(ä»¥é˜²å­—èŠ‚å€¼è¶…è¿‡255)ï¼Œå¦‚æœæœ‰æº¢å‡ºï¼Œæˆ‘å°†è¯¥å€¼è®¾ç½®ä¸ºæœ€å¤§å¯èƒ½å€¼255ã€‚</p><p id="9dbb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æœ€ç»ˆçš„motionDetection()æ–¹æ³•åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:</p><pre class="jf jg jh ji fd kv kw kx ky aw kz bi"><span id="095a" class="la jr hi kw b fi lb lc l ld le">private IEnumerator motionDetection()</span><span id="e5d5" class="la jr hi kw b fi lf lc l ld le">{<br/>  while (true)<br/>  {<br/>    //create Three Mats<br/>    Mat t0 = new Mat(webcamTexture.height, webcamTexture.width, CvType.CV_8UC4);<br/>    Utils.webCamTextureToMat(webcamTexture, t0); //obtain fram from webcam<br/>    yield return new WaitForSeconds(0.04F);// wait for 0.04s<br/>    yield return new WaitForEndOfFrame();// wait till end of frame</span><span id="4e62" class="la jr hi kw b fi lf lc l ld le">    Mat t1 = new Mat(webcamTexture.height, webcamTexture.width, CvType.CV_8UC4);<br/>    Utils.webCamTextureToMat(webcamTexture, t1);<br/>    yield return new WaitForSeconds(0.04F);<br/>    yield return new WaitForEndOfFrame();</span><span id="a204" class="la jr hi kw b fi lf lc l ld le">    Mat t2 = new Mat(webcamTexture.height, webcamTexture.width, CvType.CV_8UC4);<br/>    Utils.webCamTextureToMat(webcamTexture, t2);<br/>    yield return new WaitForSeconds(0.04F);<br/>    yield return new WaitForEndOfFrame();</span><span id="40ba" class="la jr hi kw b fi lf lc l ld le">    //Change color to greyscale<br/>    Imgproc.cvtColor(t0, t0, Imgproc.COLOR_RGBA2GRAY);<br/>    Imgproc.cvtColor(t1, t1, Imgproc.COLOR_RGBA2GRAY);<br/>    Imgproc.cvtColor(t2, t2, Imgproc.COLOR_RGBA2GRAY);</span><span id="610f" class="la jr hi kw b fi lf lc l ld le">    //obtain difference in frames<br/>    Mat final = new Mat();<br/>    final = DiffImage(t0, t1, t2);</span><span id="83b8" class="la jr hi kw b fi lf lc l ld le">//set final Mat to texture of raw image<br/>    Texture2D texture = new Texture2D(final.cols(), final.rows(), TextureFormat.RGBA32, false);<br/>    try<br/>    {<br/>      Utils.matToTexture2D(final, texture);<br/>      detectionView.texture = texture;<br/>    }<br/>    catch (Exception)<br/>    {  <br/>    }</span><span id="7bb8" class="la jr hi kw b fi lf lc l ld le">//change bulb alpha value<br/>    Byte value = 0;<br/>    try<br/>    {<br/>      value = Convert.ToByte(Core.countNonZero(final) / 1000);<br/>    }<br/>    catch (OverflowException)<br/>    {<br/>      value = 255;<br/>    }<br/>    bulb.color = new Color32(value, 0, 0, value);<br/>  }<br/>}</span></pre><p id="f549" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç°åœ¨æ‰“å¼€unityç¼–è¾‘å™¨ï¼Œå°†æˆ‘ä»¬çš„detection.csè„šæœ¬ä½œä¸ºç»„ä»¶æ·»åŠ åˆ°ScriptHandleræ¸¸æˆå¯¹è±¡ä¸­ã€‚ç„¶åä½ ä¼šçœ‹åˆ°å®ƒéœ€è¦3å¼ åŸå§‹å›¾åƒã€‚å°†æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„åŸå§‹å›¾åƒæ‹–æ”¾åˆ°ç›¸å…³çš„æ¡†ä¸­ã€‚</p><p id="4ca2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ‚¨çš„è®¾ç½®åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lg"><img src="../Images/563eb8a60418319c912ff688da694423.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ctsE9kzaq8sbNjuuXrvpeg.jpeg"/></div></div></figure><p id="027f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç°åœ¨ä¿å­˜åœºæ™¯å¹¶åœ¨ç¼–è¾‘å™¨ä¸­è¿è¡Œå®ƒã€‚</p><p id="9795" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä½ åº”è¯¥å¾—åˆ°è¿™æ ·çš„ä¸œè¥¿ã€‚</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lh"><img src="../Images/93bb2b37e2be1ea5c84da7d6d19f99fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*wvpH6IWtgKKk57rLJVbZmg.gif"/></div></div></figure><p id="7ffc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¦‚æœä½ æƒ³åœ¨æ­¤åŸºç¡€ä¸Šæ„å»ºä¸€ä¸ªandroidåº”ç”¨ï¼Œè¿›å…¥æ„å»ºè®¾ç½®ï¼Œå°†å¹³å°åˆ‡æ¢åˆ°androidï¼Œæ ¹æ®éœ€è¦è°ƒæ•´ç”»å¸ƒä¸Šå¯¹è±¡çš„å¤§å°å’Œä½ç½®ï¼Œå¹¶æ„å»ºé¡¹ç›®ä»¥è·å¾—apkæ–‡ä»¶ã€‚(æ­¤å¤–ï¼Œæ‚¨å¯èƒ½éœ€è¦ä»æ¸¸æˆçª—å£è°ƒæ•´ç”»å¸ƒçš„å¤§å°)ã€‚æ­¤å¤–ï¼Œå°†CameraViewå’ŒDetectionViewçš„æ—‹è½¬zå€¼æ›´æ”¹ä¸º'-90 'ï¼Œå› ä¸ºå‡ºäºæŸç§åŸå› ï¼Œé»˜è®¤æƒ…å†µä¸‹ç›¸æœºè¿›ç»™æ˜¯æ—‹è½¬çš„ã€‚</p><p id="e9d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸‹é¢æ˜¯å®ƒåœ¨æˆ‘çš„androidæ‰‹æœºä¸Šçš„å·¥ä½œåŸç†ã€‚</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es li"><img src="../Images/abeae23923ffa9ae5a66ed5d669c31aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/1*pXU9fCpFIScdumQX02RtwA.gif"/></div></figure><p id="d5be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿™ä¸ªé¡¹ç›®åˆ°æ­¤ä¸ºæ­¢ã€‚è¯·è®©æˆ‘çŸ¥é“ä½ çš„åé¦ˆã€‚è°¢è°¢å¤§å®¶ï¼å¹²æ¯ï¼ğŸ˜€</p></div></div>    
</body>
</html>