# ç”¨ Django Rest æ¡†æ¶åˆ¶ä½œä¸€ä¸ª API æœç´¢ç«¯ç‚¹

> åŸæ–‡ï¼š<https://medium.com/geekculture/make-an-api-search-endpoint-with-django-rest-framework-111f307747b8?source=collection_archive---------5----------------------->

![](img/925e2a1269faa12fb2364c89b77557b6.png)

Search API for sudan-art.com

## ä»‹ç»

æˆ‘æœ€è¿‘åœ¨åšä¸€ä¸ªä¸ªäººé¡¹ç›®ã€‚è¿™æ˜¯ä¸€ä¸ªå¸®åŠ©è‹ä¸¹æ”¿å˜åæŠµæŠ—è¿åŠ¨çš„ç½‘ç«™ã€‚è¿™ä¸ªæƒ³æ³•æ˜¯ï¼Œç”¨æˆ·ä¸Šä¼ æ”¯æŒé©å‘½çš„è‰ºæœ¯ä½œå“ï¼Œæ‰€æœ‰è¿™äº›éƒ½ç•™åœ¨ä¸€ä¸ªæœ‰ç”¨çš„åœ°æ–¹ã€‚å¦‚æœä½ æƒ³äº†è§£æ‰€æœ‰è¿™äº›çš„èƒŒæ™¯ï¼Œæ•´ä¸ªä»£ç åº“ä½äº[è¿™é‡Œ](https://github.com/osintalex/sudan-art)ï¼Œä¸æœ¬æ–‡ç›¸å…³çš„æ˜¯[è¿™é‡Œ](https://github.com/osintalex/sudan-art/blob/dev/sudan-art/django-backend/sudan_art/views.py)ã€‚

æˆ‘å¾ˆå¿«ä¼šå†™ä¸€ç¯‡æ›´é•¿çš„å¸–å­ï¼Œä½†ç°åœ¨æˆ‘æƒ³åˆ†äº«æˆ‘æ˜¯å¦‚ä½•ä½¿ç”¨[Django Rest Framework](https://www.django-rest-framework.org/)(DRF)åˆ›å»ºä¸€ä¸ª API æ¥æœç´¢åŒ…å«æ‰€æœ‰è‰ºæœ¯çš„æ•°æ®åº“çš„

è™½ç„¶è¿™å¹¶ä¸å¤æ‚ï¼Œå› ä¸º DRF å¾ˆæ£’ï¼Œä½†æˆ‘å‘ç°è¿™å¾ˆéš¾å¼€å§‹ï¼Œå› ä¸ºæˆ‘åœ¨ç½‘ä¸Šæ‰¾ä¸åˆ°å¾ˆå¤šå¥½çš„ä»£ç ç¤ºä¾‹ã€‚è¿™å°±æ˜¯æˆ‘æƒ³ç”¨è¿™ç¯‡åšå®¢æ¥è¡¥æ•‘çš„ğŸ˜Šã€‚

ä¸è¿‡ï¼Œå…ˆæ¥ä¸ªå¤§æ¦‚è¯´æ˜ï¼æˆ‘å°†ä¿æŒè¿™ç›¸å½“ç®€çŸ­å’Œç”œèœœï¼Œä¸è§£é‡Šå¤ªå¤šå…³äºå§œæˆˆæˆ– DRFã€‚è¿™ç¯‡æ–‡ç« çœŸæ­£é’ˆå¯¹çš„æ˜¯é‚£äº›ä¹ æƒ¯äºè®¾ç½®è¿™äº›ä¸œè¥¿ï¼Œå¹¶ä¸”çœŸçš„æƒ³æ·»åŠ ä¸€ä¸ªæœç´¢ç«¯ç‚¹çš„å¼€å‘äººå‘˜ã€‚

## å®‰å…¨æ€§

ç°åœ¨ï¼Œè¿™æ˜¯æˆ‘ä¸ºæœç´¢å®ç°çš„è§†å›¾ã€‚æˆ‘å°†åœ¨æ–‡ç« çš„å…¶ä½™éƒ¨åˆ†ä»‹ç»ä»£ç çš„ä½œç”¨ï¼Œä½ å¯ä»¥åœ¨ Github [è¿™é‡Œ](https://github.com/osintalex/sudan-art/blob/dev/sudan-art/django-backend/sudan_art/views.py)çœ‹åˆ°ã€‚

views.py for implementing a search API endpoint

å®‰å…¨ç¬¬ä¸€ï¼ç¬¬ 11â€“19 è¡Œä¸­åä¸º`ValidateQueryParams`çš„ç±»ç»§æ‰¿è‡ªå±äº`rest_framework`çš„`serializers`å¯¹è±¡ã€‚è¿™æ˜¯åœ¨ç¬¬ 6 è¡Œå¯¼å…¥çš„ã€‚ä½ è¯´çš„åºåˆ—åŒ–å™¨æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿå—¯:

> åºåˆ—åŒ–ç¨‹åºå…è®¸å°†å¤æ‚çš„æ•°æ®(å¦‚æŸ¥è¯¢é›†å’Œæ¨¡å‹å®ä¾‹)è½¬æ¢ä¸ºæœ¬åœ° Python æ•°æ®ç±»å‹

é‚£æ˜¯ç›¸å½“é«˜çš„æ°´å¹³ã€‚è¿™æ„å‘³ç€æˆ‘å¯ä»¥å¿«é€Ÿä½¿ç”¨åŒæ ·æ¥è‡ª`rest_framework`çš„`fields`å¯¹è±¡ï¼Œå› ä¸ºå®ƒæœ‰ä¸€äº›å†…ç½®çš„åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨`fields.RegexField`å’Œ`fields.DateField`æ¥éªŒè¯æ­£åˆ™è¡¨è¾¾å¼å’Œæ—¥æœŸã€‚æˆ‘è¿˜å¯ä»¥ç¡®ä¿å¯¹ API çš„è¯·æ±‚å¤±è´¥ï¼Œé™¤éæœ‰äººåŒ…å«äº†ä¸€ä¸ªæœç´¢è¯ï¼›æˆ‘å·²é€‰æ‹©å°†å…¶ä»–å­—æ®µè®¾ä¸ºå¯é€‰ã€‚

è¿™å¾ˆå·§å¦™ï¼Œå› ä¸ºå®ƒè®©æˆ‘åˆ›å»ºäº†å››ä¸ªç±»å±æ€§(searchã€artistã€date_fromã€date_to ),è¿™å››ä¸ªå±æ€§ä¸æˆ‘è®©äººä»¬ç”¨å¦‚ä¸‹è¯·æ±‚æŸ¥è¯¢ API çš„ä¸åŒæ–¹å¼ç›¸å…³:

> requests . get(" https://my site . com/APIï¼Ÿsearch=x&artist=y&date_to=z ")

ä½†åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘åªæ˜¯è®¾è®¡äº†è¿™ä¸ªç±»â€”â€”æˆ‘è¿˜æ²¡æœ‰çœŸæ­£åˆ©ç”¨å®ƒæ¥éªŒè¯æ•°æ®ã€‚è¿™å‘ç”Ÿåœ¨ç¬¬ 32â€“33 è¡Œ:

```
query_params = ValidateQueryParams(data=self.request.query_params)                                     query_params.is_valid(raise_exception=True)
```

å¦‚æœå‘é€ç»™ API çš„æ•°æ®æ— æ•ˆï¼Œè¿™å°†æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œå¹¶ç¡®ä¿å®ƒä¸ä¼šåœ¨åç«¯å¾—åˆ°å¤„ç†ã€‚

## åŸºäºç±»åˆ«çš„æœç´¢è§†å›¾

ç°åœ¨è§†å›¾æœ¬èº«å‡ºç°åœ¨ç¬¬ 22â€“44 è¡Œã€‚ç¬¬ 23 è¡Œä¸­çš„ class å±æ€§â€” `search_fields` â€”æŒ‡çš„æ˜¯æˆ‘åœ¨æ¨¡å‹ä¸­ä¸º artwork å®šä¹‰çš„å­—æ®µã€‚

```
search_fields = ["artist", "tags", "date_uploaded"]
```

æ‚¨åœ¨è¿™é‡Œæ‰€åšçš„åŸºæœ¬ä¸Šæ˜¯å®šä¹‰æ‚¨æƒ³è¦æœç´¢çš„æ¨¡å‹å±æ€§ã€‚è¿™é‡Œï¼Œæˆ‘æœ‰ä¸€ä¸ªæ ‡ç­¾å­—æ®µå’Œè‰ºæœ¯å®¶å­—æ®µï¼Œå¯ä»¥åŒ¹é… api çš„æœç´¢è¯éƒ¨åˆ†çš„å…³é”®å­—ï¼Œè€Œä¸Šä¼ æ—¥æœŸå°†æ˜ å°„åˆ°å‘é€åˆ° API çš„æ—¥æœŸã€‚

ç„¶åæˆ‘åœ¨ç¬¬ 24 è¡Œå®šä¹‰ DRF è¿‡æ»¤æœç´¢ç»“æœçš„æ–¹å¼ï¼›ä½ å¯ä»¥ä½¿ç”¨çš„å…¨éƒ¨é€‰é¡¹éƒ½åœ¨[è¿™é‡Œ](https://www.django-rest-framework.org/api-guide/filtering/)ã€‚

```
filter_backends = (filters.SearchFilter, filters.OrderingFilter)
```

æœ€ååœ¨ç¬¬ 25 è¡Œï¼Œæˆ‘åªæ˜¯ç¡®ä¿æœç´¢ç«¯ç‚¹ä½¿ç”¨äº†æˆ‘åœ¨åˆ«å¤„ä¸º artwork å®šä¹‰çš„é€šç”¨åºåˆ—åŒ–ç±»ã€‚

ä¸€æ—¦è¿™äº›ç±»å±æ€§éƒ½å®šä¹‰å¥½äº†ï¼Œä»ç¬¬ 34-44 è¡Œå¼€å§‹ï¼Œæˆ‘å¾—åˆ°äº† API è¯·æ±‚ä¸­å‘é€çš„æ‰€æœ‰`query_params`ï¼Œå°†å®ƒä»¬è§£æåˆ°ä¸€ä¸ªå­—å…¸`filter_keyword_arguments_dict`ä¸­ï¼Œå¹¶å°†å®ƒä»¬æ˜ å°„åˆ°æˆ‘æƒ³è¦æŸ¥è¯¢æ•°æ®åº“çš„ä¸åŒæ–¹å¼ä¸Šã€‚ä¾‹å¦‚ï¼Œåœ¨è¿™é‡Œ:

```
if key == "date_to":                                             filter_keyword_arguments_dict["date_uploaded__lte"] = value
```

å¦‚æœæœ‰äººå‘é€æŸ¥è¯¢æ¥æœç´¢ç‰¹å®šæ—¥æœŸï¼Œæˆ‘ä¼šç¡®ä¿ Django æŸ¥è¯¢æ•°æ®åº“ä¸­å°äºæˆ–ç­‰äºè¯¥æ—¥æœŸçš„å€¼(è¿™å°±æ˜¯`date_uploaded__lte`éƒ¨åˆ†çš„æ„æ€)ã€‚

å…³äºå¦‚ä½•æŸ¥è¯¢æ•°æ®åº“çš„æ‰€æœ‰é€‰é¡¹ï¼Œè¯·ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹ä¼˜ç§€çš„ Django queryset æ–‡æ¡£[ã€‚](https://docs.djangoproject.com/en/4.0/ref/models/querysets/)

å°±æ˜¯è¿™æ ·ï¼å¸Œæœ›æœ‰å¸®åŠ©ã€‚