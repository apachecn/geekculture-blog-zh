<html>
<head>
<title>How to run terraform script using GitLab CI/CD?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•ä½¿ç”¨GitLab CI/CDè¿è¡Œterraformè„šæœ¬ï¼Ÿ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/geekculture/how-to-run-terraform-script-using-gitlab-ci-cd-b6f448ab0232?source=collection_archive---------0-----------------------#2021-09-03">https://medium.com/geekculture/how-to-run-terraform-script-using-gitlab-ci-cd-b6f448ab0232?source=collection_archive---------0-----------------------#2021-09-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="e389" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">ä»€ä¹ˆæ˜¯GitLab CI/CDï¼Ÿ</h1><p id="7ed5" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jf hj"> GitLab CI/CD </strong>æ˜¯<strong class="jf hj">git lab</strong>çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºæ‰€æœ‰çš„<strong class="jf hj">è¿ç»­æ–¹æ³•(è¿ç»­é›†æˆã€äº¤ä»˜å’Œéƒ¨ç½²)</strong>ã€‚ä½¿ç”¨<strong class="jf hj"> GitLab CI/CD </strong>ï¼Œæ‚¨å¯ä»¥<strong class="jf hj">æµ‹è¯•</strong>ï¼Œ<strong class="jf hj">æ„å»º</strong>ï¼Œä»¥åŠ<strong class="jf hj">å‘å¸ƒ</strong>æ‚¨çš„ä»£ç ï¼Œæ— éœ€ç¬¬ä¸‰æ–¹åº”ç”¨æˆ–é›†æˆã€‚</p><p id="c4b6" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">ç‚¹å‡» é˜…è¯»æ›´å¤šå…³äº<strong class="jf hj"> GitLab CI/CD </strong> <a class="ae kg" href="https://docs.gitlab.com/ee/ci/" rel="noopener ugc nofollow" target="_blank"> <strong class="jf hj">ã€‚</strong></a></p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kh"><img src="../Images/36bc925ddae227ba98db348014bdd2cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KpZOSdvsgRNN3zA4pXtn7Q.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx">GitLab CI/CD</figcaption></figure><h1 id="5dd3" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">ä»€ä¹ˆæ˜¯Terraformï¼Ÿ</h1><p id="6e5e" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jf hj"> Terraform </strong>æ˜¯ä¸€ä¸ªå¼€æº<strong class="jf hj">åŸºç¡€è®¾æ–½ï¼Œä½œä¸ºä¸€ä¸ªä»£ç (IAC) </strong>å·¥å…·ï¼Œå…è®¸åˆ›å»ºã€ç®¡ç†&amp;éƒ¨ç½²ç”Ÿäº§å°±ç»ªç¯å¢ƒã€‚Terraformå°†äº‘APIç¼–è¯‘æˆå£°æ˜æ€§çš„é…ç½®æ–‡ä»¶ã€‚Terraformå¯ä»¥ç®¡ç†ç°æœ‰çš„æœåŠ¡æä¾›å•†å’Œå®šåˆ¶çš„å†…éƒ¨è§£å†³æ–¹æ¡ˆã€‚</p><p id="5ee5" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">ä»<a class="ae kg" href="https://www.terraform.io/intro/index.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jf hj">è¿™é‡Œ</strong> </a> <strong class="jf hj">é˜…è¯»æ›´å¤šå…³äº<strong class="jf hj"> Terraform </strong>çš„å†…å®¹ã€‚</strong></p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kx"><img src="../Images/cec0951ca498ac104d1ac34c3665a29b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DE-OEHhfqhZc9RKJ.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx">Terraform</figcaption></figure><p id="d5a2" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘å°†<strong class="jf hj"> Terraform </strong>ä¸<strong class="jf hj"> GitLab CI/CD </strong>é›†æˆåœ¨ä¸€èµ·ï¼Œå¹¶åœ¨<strong class="jf hj"> AWS </strong>ä¸Šåˆ›å»ºäº†å„ç§èµ„æºã€‚</p><figure class="ki kj kk kl fd km er es paragraph-image"><div class="er es ky"><img src="../Images/1884cfc161255261d282973f693c73ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*Chnns3B62101pTSI.png"/></div><figcaption class="kt ku et er es kv kw bd b be z dx">Terraform + GitLab CI/CD</figcaption></figure><h1 id="69f0" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">å…ˆå†³æ¡ä»¶:</h1><ul class=""><li id="ef0c" class="kz la hi jf b jg jh jk jl jo lb js lc jw ld ka le lf lg lh bi translated"><strong class="jf hj"> AWS &amp; GitLabè´¦æˆ·</strong></li><li id="f7e6" class="kz la hi jf b jg li jk lj jo lk js ll jw lm ka le lf lg lh bi translated"><a class="ae kg" href="https://docs.aws.amazon.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jf hj"> AWS </strong> </a>ï¼Œ<a class="ae kg" href="https://www.terraform.io/intro/index.html" rel="noopener ugc nofollow" target="_blank"><strong class="jf hj">terra form</strong></a><strong class="jf hj">&amp;</strong><a class="ae kg" href="https://docs.gitlab.com/ee/ci/" rel="noopener ugc nofollow" target="_blank"><strong class="jf hj">git lab CI/CD</strong></a></li><li id="41d4" class="kz la hi jf b jg li jk lj jo lk js ll jw lm ka le lf lg lh bi translated">åœ¨<strong class="jf hj"> AWS </strong>ä¸­åˆ›å»ºçš„<strong class="jf hj">è®¿é—®å¯†é’¥</strong> &amp; <strong class="jf hj">ç§˜å¯†å¯†é’¥</strong></li></ul><p id="d51f" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">è®©æˆ‘ä»¬ä»é¡¹ç›®çš„é…ç½®å¼€å§‹</p><p id="c3de" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">æ­¥éª¤1:- </strong>åˆ›å»ºä¸€ä¸ª<strong class="jf hj">å­˜å‚¨åº“</strong></p><ul class=""><li id="791d" class="kz la hi jf b jg kb jk kc jo ln js lo jw lp ka le lf lg lh bi translated">åœ¨ä½ çš„GitLabå¸æˆ·ä¸­åˆ›å»ºä¸€ä¸ªå­˜å‚¨åº“ï¼Œå¹¶ç»™å®ƒèµ·ä¸€ä¸ªä½ è‡ªå·±é€‰æ‹©çš„åå­—</li></ul><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es lq"><img src="../Images/a41359061d45842791aac6302017d0a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZIs8EO4gPod400IrjzG_uw.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx">GitLab Project</figcaption></figure><p id="4402" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">æ­¥éª¤2:- </strong>ä¸ºèµ„æºåˆ›å»ºåˆ›å»ºä¸€ä¸ª<strong class="jf hj"> terraform </strong>æ–‡ä»¶</p><ul class=""><li id="9f04" class="kz la hi jf b jg kb jk kc jo ln js lo jw lp ka le lf lg lh bi translated">åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code class="du lr ls lt lu b">.tf</code>æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­æ·»åŠ ä¸‹é¢çš„ä»£ç ã€‚</li></ul><pre class="ki kj kk kl fd lv lu lw lx aw ly bi"><span id="676e" class="lz ig hi lu b fi ma mb l mc md"># Configure and downloading plugins for aws<br/>provider "aws" {<br/>  region     = "${var.aws_region}"<br/>}<br/><br/># Creating VPC<br/>resource "aws_vpc" "demovpc" {<br/>  cidr_block       = "${var.vpc_cidr}"<br/>  instance_tenancy = "default"<br/><br/>  tags = {<br/>    Name = "Demo VPC"<br/>  }<br/>}<br/><br/># Creating Internet Gateway <br/>resource "aws_internet_gateway" "demogateway" {<br/>  vpc_id = "${aws_vpc.demovpc.id}"<br/>}<br/><br/># Grant the internet access to VPC by updating its main route table<br/>resource "aws_route" "internet_access" {<br/>  route_table_id         = "${aws_vpc.demovpc.main_route_table_id}"<br/>  destination_cidr_block = "0.0.0.0/0"<br/>  gateway_id             = "${aws_internet_gateway.demogateway.id}"<br/>}<br/><br/># Creating 1st subnet <br/>resource "aws_subnet" "demosubnet" {<br/>  vpc_id                  = "${aws_vpc.demovpc.id}"<br/>  cidr_block             = "${var.subnet_cidr}"<br/>  map_public_ip_on_launch = true<br/>  availability_zone = "us-east-1a"<br/><br/>  tags = {<br/>    Name = "Demo subnet"<br/>  }<br/>}<br/><br/># Creating 2nd subnet <br/>resource "aws_subnet" "demosubnet1" {<br/>  vpc_id                  = "${aws_vpc.demovpc.id}"<br/>  cidr_block             = "${var.subnet1_cidr}"<br/>  map_public_ip_on_launch = true<br/>  availability_zone = "us-east-1b"<br/><br/>  tags = {<br/>    Name = "Demo subnet 1"<br/>  }<br/>}<br/><br/># Creating Security Group<br/>resource "aws_security_group" "demosg" {<br/>  name        = "Demo Security Group"<br/>  description = "Demo Module"<br/>  vpc_id      = "${aws_vpc.demovpc.id}"<br/><br/>  # Inbound Rules<br/>  # HTTP access from anywhere<br/>  ingress {<br/>    from_port   = 80<br/>    to_port     = 80<br/>    protocol    = "tcp"<br/>    cidr_blocks = ["0.0.0.0/0"]<br/>  }<br/><br/>  # HTTPS access from anywhere<br/>  ingress {<br/>    from_port   = 443<br/>    to_port     = 443<br/>    protocol    = "tcp"<br/>    cidr_blocks = ["0.0.0.0/0"]<br/>  }<br/><br/>  # SSH access from anywhere<br/>  ingress {<br/>    from_port   = 22<br/>    to_port     = 22<br/>    protocol    = "tcp"<br/>    cidr_blocks = ["0.0.0.0/0"]<br/>  }<br/><br/>  # Splunk default port<br/>  ingress {<br/>    from_port   = 8000<br/>    to_port     = 8000<br/>    protocol    = "tcp"<br/>    cidr_blocks = ["0.0.0.0/0"]<br/>  }<br/>  <br/>  # Replication Port<br/>  ingress {<br/>    from_port   = 8089<br/>    to_port     = 8089<br/>    protocol    = "tcp"<br/>    cidr_blocks = ["0.0.0.0/0"]<br/>  }<br/><br/>  # Management Port<br/>  ingress {<br/>    from_port   = 4598<br/>    to_port     = 4598<br/>    protocol    = "tcp"<br/>    cidr_blocks = ["0.0.0.0/0"]<br/>  }<br/><br/>  # Ingestion Port<br/>  ingress {<br/>    from_port   = 9997<br/>    to_port     = 9997<br/>    protocol    = "tcp"<br/>    cidr_blocks = ["0.0.0.0/0"]<br/>  }<br/><br/>  # Outbound Rules<br/>  # Internet access to anywhere<br/>  egress {<br/>    from_port   = 0<br/>    to_port     = 0<br/>    protocol    = "-1"<br/>    cidr_blocks = ["0.0.0.0/0"]<br/>  }<br/>}<br/><br/># Creating key pair<br/>resource "aws_key_pair" "demokey" {<br/>  key_name   = "${var.key_name}"<br/>  public_key = "${file(var.public_key)}"<br/>}<br/>  <br/># Creating EC2 Instance<br/>resource "aws_instance" "demoinstance" {<br/><br/>  # AMI based on region <br/>  ami = "${lookup(var.ami, var.aws_region)}"<br/><br/>  # Launching instance into subnet <br/>  subnet_id = "${aws_subnet.demosubnet.id}"<br/><br/>  # Instance type <br/>  instance_type = "${var.instancetype}"<br/>  <br/>  # Count of instance<br/>  count= "${var.master_count}"<br/>  <br/>  # SSH key that we have generated above for connection<br/>  key_name = "${aws_key_pair.demokey.id}"<br/><br/>  # Attaching security group to our instance<br/>  vpc_security_group_ids = ["${aws_security_group.demosg.id}"]<br/><br/>  # Attaching Tag to Instance <br/>  tags = {<br/>    Name = "Search-Head-${count.index + 1}"<br/>  }<br/>  <br/>  # Root Block Storage<br/>  root_block_device {<br/>    volume_size = "40"<br/>    volume_type = "standard"<br/>  }<br/>  <br/>  #EBS Block Storage<br/>  ebs_block_device {<br/>    device_name = "/dev/sdb"<br/>    volume_size = "80"<br/>    volume_type = "standard"<br/>    delete_on_termination = false<br/>  }<br/>  <br/>  # SSH into instance <br/>  connection {<br/>    <br/>    # Host name<br/>    host = self.public_ip<br/>    # The default username for our AMI<br/>    user = "ec2-user"<br/>    # Private key for connection<br/>    private_key = "${file(var.private_key)}"<br/>    # Type of connection<br/>    type = "ssh"<br/>  }<br/>  <br/>  # Installing splunk on newly created instance<br/>  provisioner "remote-exec" {<br/>    inline = [<br/>      "sudo yum update -y",<br/>      "sudo amazon-linux-extras install docker -y",<br/>      "sudo service docker start",<br/>      "sudo usermod -a -G docker ec2-user",<br/>      "sudo chkconfig docker on",<br/>      "sudo yum install -y git",<br/>      "sudo chmod 666 /var/run/docker.sock",<br/>      "docker pull dhruvin30/dhsoniweb:v1",<br/>      "docker run -d -p 80:80 dhruvin30/dhsoniweb:latest"   <br/>  ]<br/> }<br/>}</span></pre><p id="dcc6" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">æ­¥éª¤3:- </strong>ä¸ºå˜é‡åˆ›å»º<strong class="jf hj"> terraform </strong>æ–‡ä»¶</p><ul class=""><li id="790e" class="kz la hi jf b jg kb jk kc jo ln js lo jw lp ka le lf lg lh bi translated">åœ¨èµ„æºåˆ›å»ºæ–‡ä»¶ä¸­ï¼Œæˆ‘ä½¿ç”¨äº†å¤šä¸ªå˜é‡ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªåŒ…å«å˜é‡å®šä¹‰çš„å˜é‡æ–‡ä»¶</li><li id="5eda" class="kz la hi jf b jg li jk lj jo lk js ll jw lm ka le lf lg lh bi translated">åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code class="du lr ls lt lu b">vars.tf</code>æ–‡ä»¶ï¼Œå¹¶å°†ä¸‹é¢çš„ä»£ç æ·»åŠ åˆ°å…¶ä¸­</li><li id="83a5" class="kz la hi jf b jg li jk lj jo lk js ll jw lm ka le lf lg lh bi translated">ä¸‹é¢çš„ä»£ç å°†åœ¨AWSä¸Šåˆ›å»ºå„ç§èµ„æºã€‚å¦‚æœä½ ä¸èƒ½ç†è§£ä»£ç ä¸­çš„ä»»ä½•å†…å®¹ï¼Œä½ å¯ä»¥ä»<a class="ae kg" href="https://devopsquare.com/how-to-create-various-aws-resources-using-terraform-dd9ad2bc374b" rel="noopener ugc nofollow" target="_blank"> <strong class="jf hj">è¿™é‡Œ</strong> </a>æ›´å¥½åœ°ç†è§£</li></ul><pre class="ki kj kk kl fd lv lu lw lx aw ly bi"><span id="d66b" class="lz ig hi lu b fi ma mb l mc md"># Defining Public Key<br/>variable "public_key" {<br/>  default = "tests.pub"<br/>}<br/><br/># Defining Private Key<br/>variable "private_key" {<br/>  default = "tests.pem"<br/>}<br/><br/># Definign Key Name for connection<br/>variable "key_name" {<br/>  default = "tests"<br/>  description = "Desired name of AWS key pair"<br/>}<br/><br/># Defining Region<br/>variable "aws_region" {<br/>  default = "us-east-1"<br/>}<br/><br/># Defining CIDR Block for VPC<br/>variable "vpc_cidr" {<br/>  default = "10.0.0.0/16"<br/>}<br/><br/># Defining CIDR Block for Subnet<br/>variable "subnet_cidr" {<br/>  default = "10.0.1.0/24"<br/>}<br/><br/># Defining CIDR Block for 2d Subnet<br/>variable "subnet1_cidr" {<br/>  default = "10.0.2.0/24"<br/>}<br/><br/># Defining AMI<br/>variable "ami" {<br/>  default = {<br/>    eu-west-1 = "ami-0ea3405d2d2522162"<br/>    us-east-1 = "ami-09d95fab7fff3776c"<br/>  }<br/>}<br/><br/># Defining Instace Type<br/>variable "instancetype" {<br/>  default = "t2.medium"<br/>}<br/><br/># Defining Master count <br/>variable "master_count" {<br/>  default = 1<br/>}</span></pre><p id="7852" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">æ­¥éª¤4:- </strong>å­˜å‚¨<strong class="jf hj"> AWS </strong> <strong class="jf hj">å¯†é’¥</strong></p><ul class=""><li id="0f38" class="kz la hi jf b jg kb jk kc jo ln js lo jw lp ka le lf lg lh bi translated">ä¸ºäº†åœ¨AWSå¸æˆ·ä¸­åˆ›å»ºèµ„æºï¼Œæˆ‘ä»¬å¿…é¡»éœ€è¦æ‹¥æœ‰<strong class="jf hj"> AWSè®¿é—®å¯†é’¥</strong> &amp; <strong class="jf hj"> AWSç§˜å¯†å¯†é’¥</strong></li><li id="ed28" class="kz la hi jf b jg li jk lj jo lk js ll jw lm ka le lf lg lh bi translated">ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å°†<strong class="jf hj"> AWSè®¿é—®å¯†é’¥</strong> &amp; <strong class="jf hj"> AWSç§˜å¯†å¯†é’¥</strong>å­˜å‚¨åœ¨å­˜å‚¨åº“çš„secretséƒ¨åˆ†</li><li id="97e3" class="kz la hi jf b jg li jk lj jo lk js ll jw lm ka le lf lg lh bi translated">è½¬åˆ°å˜é‡éƒ¨åˆ†ä¸‹çš„<strong class="jf hj">è®¾ç½®</strong>-&gt;-<strong class="jf hj">CI/CD</strong>-&gt;åˆ›å»ºä»¥ä¸‹å˜é‡å¹¶å­˜å‚¨æ‚¨çš„<strong class="jf hj"> AWSè®¿é—®å¯†é’¥</strong> &amp; <strong class="jf hj"> AWSç§˜å¯†å¯†é’¥</strong></li></ul><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es me"><img src="../Images/7229ffde597c765319d9d37ed67cdda0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XY_YVWeyztGN2gKl6L64uQ.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx">Environment Variable</figcaption></figure><p id="e759" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">ç¬¬å››æ­¥:- </strong>åˆ›å»ºä¸€ä¸ª<strong class="jf hj">å·¥ä½œæµ</strong>æ–‡ä»¶</p><ul class=""><li id="1438" class="kz la hi jf b jg kb jk kc jo ln js lo jw lp ka le lf lg lh bi translated">ç°åœ¨ä¸ºäº†è‡ªåŠ¨åˆ›å»ºterraformèµ„æºï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå·¥ä½œæµæ–‡ä»¶</li><li id="4fee" class="kz la hi jf b jg li jk lj jo lk js ll jw lm ka le lf lg lh bi translated">åˆ›å»º<code class="du lr ls lt lu b">.gitlab-ci.yml</code>æ–‡ä»¶ï¼Œå¹¶å°†ä¸‹é¢çš„ä»£ç æ·»åŠ åˆ°å…¶ä¸­</li><li id="d4f4" class="kz la hi jf b jg li jk lj jo lk js ll jw lm ka le lf lg lh bi translated">ä»¥ä¸‹ä½œä¸šå°†åœ¨ä¸»åˆ†æ”¯ä¸Šå‘ç”Ÿçš„æ¯ä¸ª<strong class="jf hj">æ¨</strong>å’Œ<strong class="jf hj">æ‹‰è¯·æ±‚</strong>ä¸Šè¿è¡Œã€‚åœ¨æ„å»ºéƒ¨åˆ†ï¼Œæˆ‘å·²ç»åœ¨è„šæœ¬éƒ¨åˆ†æŒ‡å®šäº†æ˜ åƒåç§°å’Œå‘½ä»¤ã€‚</li></ul><pre class="ki kj kk kl fd lv lu lw lx aw ly bi"><span id="f892" class="lz ig hi lu b fi ma mb l mc md">stages:<br/>  - validate<br/>  - plan<br/>  - apply</span><span id="543b" class="lz ig hi lu b fi mf mb l mc md">image:<br/>  name: hashicorp/terraform:light<br/>  entrypoint:<br/>    - '/usr/bin/env'<br/>    - 'PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'</span><span id="b0bb" class="lz ig hi lu b fi mf mb l mc md">before_script:<br/>  - export AWS_ACCESS_KEY=${AWS_ACCESS_KEY_ID}<br/>  - export AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}<br/>  - rm -rf .terraform<br/>  - terraform --version<br/>  - terraform init</span><span id="a713" class="lz ig hi lu b fi mf mb l mc md">validate:<br/>  stage: validate<br/>  script:<br/>    - terraform validate</span><span id="2c2d" class="lz ig hi lu b fi mf mb l mc md">plan:<br/>  stage: plan<br/>  script:<br/>    - terraform plan -out "planfile"<br/>  dependencies:<br/>    - validate<br/>  artifacts:<br/>    paths:<br/>      - planfile</span><span id="8ae3" class="lz ig hi lu b fi mf mb l mc md">apply:<br/>  stage: apply<br/>  script:<br/>    - terraform apply -input=false "planfile"<br/>  dependencies:<br/>    - plan<br/>  when: manual</span></pre><p id="dcb6" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">æˆ‘ä»¬æ¥ç†è§£ä¸€ä¸‹ä¸Šé¢çš„ä»£ç ã€‚</p><ul class=""><li id="709f" class="kz la hi jf b jg kb jk kc jo ln js lo jw lp ka le lf lg lh bi translated">ä¸‹é¢çš„ä»£ç ç”¨äºå£°æ˜é˜¶æ®µçš„åç§°</li></ul><pre class="ki kj kk kl fd lv lu lw lx aw ly bi"><span id="95c9" class="lz ig hi lu b fi ma mb l mc md">stages:<br/>  - validate<br/>  - plan<br/>  - apply</span></pre><ul class=""><li id="87f2" class="kz la hi jf b jg kb jk kc jo ln js lo jw lp ka le lf lg lh bi translated">æˆ‘ä»¬ä½¿ç”¨<code class="du lr ls lt lu b">terraform</code>å›¾åƒæ¥è¿è¡Œåœ°å½¢è„šæœ¬ï¼Œå¹¶è®¾ç½®åœ°å½¢è·¯å¾„çš„<code class="du lr ls lt lu b">entrypoint</code></li></ul><pre class="ki kj kk kl fd lv lu lw lx aw ly bi"><span id="da9d" class="lz ig hi lu b fi ma mb l mc md">image:<br/>  name: hashicorp/terraform:light<br/>  entrypoint:<br/>    - '/usr/bin/env'<br/>    - 'PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'</span></pre><ul class=""><li id="95f1" class="kz la hi jf b jg kb jk kc jo ln js lo jw lp ka le lf lg lh bi translated">åœ¨<code class="du lr ls lt lu b">before_script</code>éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¯¼å‡ºAWSè®¿é—®å¯†é’¥&amp;ç§˜å¯†å¯†é’¥ï¼Œæ£€æŸ¥terraformçš„ç‰ˆæœ¬ï¼Œåšä¸€äº›æ¸…ç†å·¥ä½œï¼Œå¹¶é€šè¿‡è¿è¡Œ<code class="du lr ls lt lu b">terraform init</code>åˆå§‹åŒ–å·¥ä½œç›®å½•</li></ul><pre class="ki kj kk kl fd lv lu lw lx aw ly bi"><span id="b6bc" class="lz ig hi lu b fi ma mb l mc md">before_script:<br/>  - export AWS_ACCESS_KEY=${AWS_ACCESS_KEY_ID}<br/>  - export AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}<br/>  - rm -rf .terraform<br/>  - terraform --version<br/>  - terraform init</span></pre><ul class=""><li id="e37d" class="kz la hi jf b jg kb jk kc jo ln js lo jw lp ka le lf lg lh bi translated">åœ¨<code class="du lr ls lt lu b">validate</code>éƒ¨åˆ†ï¼Œæˆ‘ä»¬æ­£åœ¨éªŒè¯åœ°å½¢è„šæœ¬</li></ul><pre class="ki kj kk kl fd lv lu lw lx aw ly bi"><span id="8cb6" class="lz ig hi lu b fi ma mb l mc md">validate:<br/>  stage: validate<br/>  script:<br/>    - terraform validate</span></pre><ul class=""><li id="9540" class="kz la hi jf b jg kb jk kc jo ln js lo jw lp ka le lf lg lh bi translated">åœ¨<code class="du lr ls lt lu b">plan</code>éƒ¨åˆ†ï¼Œæˆ‘ä»¬æ­£åœ¨ç”Ÿæˆåœ°å½¢å›¾å¹¶å­˜å‚¨åœ¨å·¥ä»¶ä¸­ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥åœ¨ä¸‹ä¸€é˜¶æ®µä½¿ç”¨å®ƒ</li></ul><pre class="ki kj kk kl fd lv lu lw lx aw ly bi"><span id="82b6" class="lz ig hi lu b fi ma mb l mc md">plan:<br/>  stage: plan<br/>  script:<br/>    - terraform plan -out "planfile"<br/>  dependencies:<br/>    - validate<br/>  artifacts:<br/>    paths:<br/>      - planfile</span></pre><ul class=""><li id="4e8c" class="kz la hi jf b jg kb jk kc jo ln js lo jw lp ka le lf lg lh bi translated">åœ¨<code class="du lr ls lt lu b">apply</code>éƒ¨åˆ†ï¼Œæˆ‘ä»¬æ­£åœ¨è¿è¡Œ<code class="du lr ls lt lu b">terraform apply</code>ï¼Œä»¥ä¾¿terraformå¯ä»¥åœ¨AWSä¸Šåˆ›å»ºèµ„æº</li><li id="846c" class="kz la hi jf b jg li jk lj jo lk js ll jw lm ka le lf lg lh bi translated"><code class="du lr ls lt lu b">dependencies</code>å°†ç¡®ä¿<code class="du lr ls lt lu b">apply</code>é˜¶æ®µä»…åœ¨<code class="du lr ls lt lu b">plan</code>é˜¶æ®µæˆåŠŸæ—¶è¿è¡Œ</li><li id="5ec2" class="kz la hi jf b jg li jk lj jo lk js ll jw lm ka le lf lg lh bi translated"><code class="du lr ls lt lu b">when: manual</code>å°†ç¡®ä¿æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è§¦å‘è¿™ä¸ªé˜¶æ®µ</li></ul><pre class="ki kj kk kl fd lv lu lw lx aw ly bi"><span id="fa72" class="lz ig hi lu b fi ma mb l mc md">apply:<br/>  stage: apply<br/>  script:<br/>    - terraform apply -input=false "planfile"<br/>  dependencies:<br/>    - plan<br/>  when: manual</span></pre><p id="dd19" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">æ­¥éª¤5:- </strong>æ£€æŸ¥<strong class="jf hj">è¾“å‡º</strong></p><ul class=""><li id="d6da" class="kz la hi jf b jg kb jk kc jo ln js lo jw lp ka le lf lg lh bi translated">ç°åœ¨ï¼Œåªè¦ä½ æäº¤ä½ çš„å·¥ä½œæµæ–‡ä»¶ï¼ŒGitLabå°±ä¼šè§¦å‘è¿™ä¸ªåŠ¨ä½œï¼Œèµ„æºå°±ä¼šåœ¨AWSå¸æˆ·ä¸Šåˆ›å»ºã€‚</li></ul><blockquote class="mg mh mi"><p id="6b2e" class="jd je mj jf b jg kb ji jj jk kc jm jn mk kd jq jr ml ke ju jv mm kf jy jz ka hb bi translated"><code class="du lr ls lt lu b">validate</code>å’Œ<code class="du lr ls lt lu b">plan</code>ä½œä¸šå°†è‡ªåŠ¨è¿è¡Œï¼Œä½†æ‚¨éœ€è¦æ‰‹åŠ¨è§¦å‘<code class="du lr ls lt lu b">apply</code>ä½œä¸š</p></blockquote><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es mn"><img src="../Images/1f089b8be0dd69f97303d77342a4d711.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GaB4LfpVVqUvGzZ3Bu07dA.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx">CI/CD Output</figcaption></figure><ul class=""><li id="0fc4" class="kz la hi jf b jg kb jk kc jo ln js lo jw lp ka le lf lg lh bi translated">è¿è¡Œä½œä¸šåï¼Œæ‚¨å°†çœ‹åˆ°æ‰€æœ‰æ­¥éª¤éƒ½è¿è¡Œè‰¯å¥½ï¼Œæ²¡æœ‰é”™è¯¯ã€‚å› æ­¤ï¼Œå½“æ¯ä¸€æ­¥å·¥ä½œæˆåŠŸæ—¶ï¼Œæ‚¨å°†æ‹¥æœ‰ç”¨ç»¿è‰²ä¹¦å†™çš„<code class="du lr ls lt lu b">passed</code>ã€‚</li></ul><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es mn"><img src="../Images/48696361e08a8c881839040b9a7dbb24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bueDHrHtr-yqzCvSLCBRUw.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx">Jobs</figcaption></figure><ul class=""><li id="eac7" class="kz la hi jf b jg kb jk kc jo ln js lo jw lp ka le lf lg lh bi translated">æ‚¨è¿˜å¯ä»¥é€šè¿‡å•å‡»æ¥æ£€æŸ¥æ¯ä¸ªæ­¥éª¤çš„è¾“å‡º</li></ul><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es mn"><img src="../Images/068fd009c8bb4f3de6282cef70444a6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O5HUVp1uACsyLUYh_WLgKw.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx">Output of Job</figcaption></figure><p id="ce88" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">æ­¥éª¤6:- </strong>æ£€æŸ¥<strong class="jf hj"> AWSä¸Šçš„èµ„æº</strong></p><ul class=""><li id="1b20" class="kz la hi jf b jg kb jk kc jo ln js lo jw lp ka le lf lg lh bi translated">ä¸€æ—¦ä½œä¸šè¿è¡Œå®Œæˆï¼Œæ‚¨å°±å¯ä»¥å¯¼èˆªåˆ°AWSå¹¶æ£€æŸ¥æ‰€æœ‰èµ„æº</li><li id="57e7" class="kz la hi jf b jg li jk lj jo lk js ll jw lm ka le lf lg lh bi translated">Terraformå°†åˆ›å»ºä»¥ä¸‹èµ„æº</li></ul><ol class=""><li id="6ab7" class="kz la hi jf b jg kb jk kc jo ln js lo jw lp ka mo lf lg lh bi translated"><strong class="jf hj"> VPC </strong></li></ol><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es mn"><img src="../Images/d5b89e5ff74c839042b68fd462ce5258.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*asedyRLvJWN8gn3NFOFixg.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx">VPC</figcaption></figure><p id="ac07" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj"> 2ã€‚å­ç½‘</strong></p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es mn"><img src="../Images/1e46515052a3838436dd7c92ba188b7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3_vivLx_BWB4YNtl1sT9bw.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx">Subnets</figcaption></figure><p id="361e" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj"> 3ã€‚äº’è”ç½‘ç½‘å…³</strong></p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es mn"><img src="../Images/c0c2b9872d60b15721a0f83d9adbaf4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G1DEhoC7mOrldY-6tsGEpg.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx">Internet Gateway</figcaption></figure><p id="4c09" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj"> 4ã€‚Rouetè¡¨</strong></p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es mn"><img src="../Images/51988442848755f4dfcfb7f53d73da26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iU8V-f6YvWgCycE66ZnHJQ.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx">Route Table</figcaption></figure><p id="eb63" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj"> 5ã€‚å®‰å…¨ç»„</strong></p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es mp"><img src="../Images/fe6c0f89a65b59e09b17b0746eb54428.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gre25hzHQA2_Ia4riCk3pQ.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx">Security Group</figcaption></figure><p id="99ea" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">6ã€‚å¯†é’¥å¯¹</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es mn"><img src="../Images/8e9acd2e943b274dabea7fbb4c936de6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-pbYC21DaMvPA8TdLXef2A.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx">Key Pair</figcaption></figure><p id="b739" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">7ã€‚EC2å®ä¾‹</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es mn"><img src="../Images/223659661787f435c7ffbb61c1f5b151.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bkAbuFTFKfS0HwxEl3TFPw.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx">EC2 Instance</figcaption></figure><p id="9300" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">æ­¥éª¤7:- </strong>éªŒè¯<strong class="jf hj">è¾“å‡º</strong></p><ul class=""><li id="4324" class="kz la hi jf b jg kb jk kc jo ln js lo jw lp ka le lf lg lh bi translated">åœ¨Terraformé…ç½®ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨è¿œç¨‹ä¾›åº”å™¨å®‰è£…dockerï¼Œå¹¶åœ¨å…¶ä¸Šè¿è¡Œdockeræ˜ åƒ</li><li id="ab0e" class="kz la hi jf b jg li jk lj jo lk js ll jw lm ka le lf lg lh bi translated">ä¸ºäº†æ£€æŸ¥è¾“å‡ºï¼Œå¯¼èˆªè‡³<strong class="jf hj"> &lt; public-ip:80 &gt; </strong></li><li id="2733" class="kz la hi jf b jg li jk lj jo lk js ll jw lm ka le lf lg lh bi translated">æ‚¨åº”è¯¥ä¼šçœ‹åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„è¾“å‡º</li></ul><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es mn"><img src="../Images/cc6f1b85058f3d8eca04a90132047640.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XLTsSEeSHMhVrmiOCzjo8w.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx">Output</figcaption></figure><p id="4156" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">ç°åœ¨å°±è¿™æ ·ï¼Œä½ å·²ç»å­¦ä¼šäº†å¦‚ä½•å°†Terraformä¸GitLab CI/CDé›†æˆã€‚æ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨å®ƒå¹¶å¯¹å…¶è¿›è¡Œç›¸åº”çš„ä¿®æ”¹ã€‚</p><p id="0777" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">ä½ å¯ä»¥åœ¨æˆ‘çš„<a class="ae kg" href="https://gitlab.com/dhruvinsoni30/gitlab-terraform" rel="noopener ugc nofollow" target="_blank"> <strong class="jf hj"> GitLab </strong> </a>è´¦å·æ‰¾åˆ°å®Œæ•´çš„ä»£ç ã€‚ä¹Ÿå¯ä»¥éšæ„æŸ¥çœ‹æˆ‘çš„å…¶ä»–åº“ã€‚</p><p id="d169" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">å¦‚æœæ‚¨è§‰å¾—æœ¬æŒ‡å—å¾ˆæœ‰å¸®åŠ©ï¼Œè¯·ç‚¹å‡»ğŸ‘æŒ‰é’®ï¼Œä¹Ÿå¯ä»¥éšæ„å‘è¡¨è¯„è®ºã€‚</p><p id="d3ea" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">å…³æ³¨æ›´å¤šç±»ä¼¼çš„æ•…äº‹ğŸ˜Š</p></div></div>    
</body>
</html>