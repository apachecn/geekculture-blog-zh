<html>
<head>
<title>SRIOV on Mellanox ConnectX-6 Infiniband: Struggles &amp; Learnings</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Mellanox ConnectX-6 Infinibandä¸Šçš„SRIOV:å¥‹æ–—ä¸å­¦ä¹ </h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/geekculture/sriov-on-mellanox-connectx-6-infiniband-struggles-learnings-26fd49db6fc2?source=collection_archive---------4-----------------------#2022-06-05">https://medium.com/geekculture/sriov-on-mellanox-connectx-6-infiniband-struggles-learnings-26fd49db6fc2?source=collection_archive---------4-----------------------#2022-06-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6fdc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘åœ¨å°†è™šæ‹Ÿæœºè¿æ¥åˆ°infinibandåˆ†é…çš„è™šæ‹ŸåŠŸèƒ½çš„è¿‡ç¨‹ä¸­è·å¾—çš„é‡è¦ç»éªŒã€‚</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/81ff2693bf56cda28be4559488d51996.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*8E9wLpAil5KEEk49tO-snw.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx">Image courtesy <a class="ae jp" href="https://www.flaticon.com/free-icon/network_660502?term=network&amp;related_id=660502" rel="noopener ugc nofollow" target="_blank">Flat Icons</a></figcaption></figure><p id="078e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æŒ‰ç…§<a class="ae jp" href="https://docs.nvidia.com/networking/pages/viewpage.action?pageId=39279752#SingleRootIOVirtualization(SRIOV)-ConfiguringSR-IOV(InfiniBand)" rel="noopener ugc nofollow" target="_blank">æ–‡æ¡£</a>åœ¨å¸¦æœ‰Mellanox Infinibandå¡çš„ç³»ç»Ÿä¸Šé…ç½®SRIOVï¼Œé™¤äº†è™šæ‹Ÿæœº&amp; infinibandä¹‹é—´çš„è¿æ¥å› ä¸ºè™šæ‹ŸåŠŸèƒ½çŠ¶æ€ä¸ºdownè€Œæ— æ³•å·¥ä½œä¹‹å¤–ï¼Œä¸€åˆ‡éƒ½æŒ‰é¢„æœŸå·¥ä½œã€‚</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="f624" class="jv jw hi jr b fi jx jy l jz ka">[root@mymy858 ~]# ibstat<br/>CA 'mlx5_0'<br/>        CA type: MT4124<br/>        Number of ports: 1<br/>        Firmware version: 20.28.4512<br/>        Hardware version: 0<br/>        Node GUID: 0x000000<br/>        System image GUID: 0xbbbbbb<br/>        Port 1:<br/>                State: Down<br/>                Physical state: LinkUp<br/>                Rate: 10<br/>                Base lid: 65535<br/>                LMC: 0<br/>                SM lid: 1<br/>                Capability mask: 0x22221<br/>                Port GUID: 0x000000<br/>                Link layer: InfiniBand</span></pre><p id="1cf1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨è™šæ‹Ÿæœºä¸­ï¼Œå¦‚æœæ‚¨è¿è¡Œ<code class="du kb kc kd jr b">ip a</code>ï¼Œæ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°åœ¨è™šæ‹Ÿæœºå†…éƒ¨çœ‹åˆ°çš„ib0é“¾æ¥ä¸Šçš„<code class="du kb kc kd jr b">&lt;NO-CARRIER&gt;</code>ã€‚</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ke"><img src="../Images/34472a4ff7db357099bc63f2d9ffdb3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*WSCpi4EL_qfi3hI-mqmDng.png"/></div></figure><h2 id="0206" class="jv jw hi bd kf kg kh ki kj kk kl km kn iq ko kp kq iu kr ks kt iy ku kv kw kx bi translated">å‘ç°çš„é—®é¢˜</h2><ul class=""><li id="10f3" class="ky kz hi ih b ii la im lb iq lc iu ld iy le jc lf lg lh li bi translated">åœ¨æ­¤ç¯å¢ƒä¸­ï¼Œå¤šä¸ªå­ç½‘ç®¡ç†å™¨(opensm)åœ¨ä¸åŒçš„ç³»ç»Ÿä¸Šè¿è¡Œã€‚</li><li id="5394" class="ky kz hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">å…¶ä¸­ä¸€äº›å­ç½‘ç®¡ç†å™¨æ²¡æœ‰é…ç½®é»˜è®¤çš„<code class="du kb kc kd jr b">priorities</code></li><li id="719e" class="ky kz hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">æˆ‘ä»¬ä¸çŸ¥é“å“ªä¸ªå­ç½‘ç®¡ç†å™¨æ˜¯ä¸»ç®¡ç†å™¨ï¼Œä¹Ÿä¸çŸ¥é“å®ƒæ˜¯å¦å¯ç”¨äº†<code class="du kb kc kd jr b">virtualisation</code>ï¼Ÿ</li></ul><h2 id="2e3e" class="jv jw hi bd kf kg kh ki kj kk kl km kn iq ko kp kq iu kr ks kt iy ku kv kw kx bi translated">å­¦ä¹ </h2><ul class=""><li id="d4a5" class="ky kz hi ih b ii la im lb iq lc iu ld iy le jc lf lg lh li bi translated">ä¸è¦é…ç½®å¤šä¸ªå­ç½‘ç®¡ç†å™¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œmellanoxäº¤æ¢æœºä¸Šå¸¦æœ‰ä¸€ä¸ªSMã€‚å°†æ­¤SMä½œä¸ºæ‚¨çš„ä¸»è¦SMã€‚æ‚¨å¯ä»¥é€šè¿‡äº¤æ¢æœºUIå°†è¯¥SMçš„ä¼˜å…ˆçº§è®¾ç½®ä¸º15(æœ€å¤§å€¼)ã€‚</li><li id="5878" class="ky kz hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">ç¡®å®šæœ‰å¤šå°‘SMæ­£åœ¨è¿è¡Œã€‚è¿è¡Œ<code class="du kb kc kd jr b">ibdiagnet</code>æ¥æ‰¾å‡ºæ­£åœ¨è¿è¡Œçš„SMçš„æ•°é‡ä»¥åŠå“ªä¸ªå…·æœ‰æœ€é«˜ä¼˜å…ˆçº§ã€‚æ‚¨å°†åœ¨<code class="du kb kc kd jr b">ibdiagnet</code>çš„è¾“å‡ºä¸­æ‰¾åˆ°è¿™äº›ä¿¡æ¯ã€‚</li></ul><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="b906" class="jv jw hi jr b fi jx jy l jz ka">Master SM: Port=0 LID=1 GUID=0x0abcdefghijkl devid=123456 Priority:14 Node_Type=SW Node_Description=MF0;switch-bkbkbk:MSB0012/U1<br/>Standby SM : No Standby SM</span></pre><ul class=""><li id="6be8" class="ky kz hi ih b ii ij im in iq lo iu lp iy lq jc lf lg lh li bi translated">åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæœ€å¥½åªè®©ä¸€ä¸ªSMè¿è¡Œï¼Œæœ€å¥½æ˜¯åœ¨äº¤æ¢æœºä¸Šã€‚</li><li id="62c3" class="ky kz hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">é€šè¿‡mellanoxäº¤æ¢æœºæ§åˆ¶å°æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œåœ¨äº¤æ¢æœºä¸Šè¿è¡Œçš„SMä¸Šå¯ç”¨è™šæ‹ŸåŒ–ã€‚</li></ul><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="e7a7" class="jv jw hi jr b fi jx jy l jz ka">ib sm virt enable</span></pre><p id="9464" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æœ€åï¼Œè™šæ‹ŸåŠŸèƒ½é“¾è·¯å¯åŠ¨ï¼Œè™šæ‹Ÿæœºåˆ°infiniband ib0çš„è¿æ¥æ­£å¸¸ğŸª</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="da90" class="jv jw hi jr b fi jx jy l jz ka">[root@mymy858 ~]# ibstat<br/>CA 'mlx5_0'<br/>        CA type: MT4124<br/>        Number of ports: 1<br/>        Firmware version: 20.28.4512<br/>        Hardware version: 0<br/>        Node GUID: 0x000000<br/>        System image GUID: 0xbbbbbb<br/>        Port 1:<br/>                State: Active<br/>                Physical state: LinkUp<br/>                Rate: 100<br/>                Base lid: 11<br/>                LMC: 0<br/>                SM lid: 1<br/>                Capability mask: 0x22221<br/>                Port GUID: 0x000000<br/>                Link layer: InfiniBand</span></pre><h1 id="364f" class="lr jw hi bd kf ls lt lu kj lv lw lx kn ly lz ma kq mb mc md kt me mf mg kw mh bi translated">æ‘˜è¦</h1><p id="091f" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq mi is it iu mj iw ix iy mk ja jb jc hb bi translated">æˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½ä¸ºé™·å…¥è¿™ç§å›°å¢ƒçš„äººæä¾›æœ‰ç”¨çš„æŒ‡å¯¼ã€‚å¦‚æœæ‚¨å¯¹infinibandä¸Šçš„SRIOVæœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·éšæ—¶å‘è¡¨è¯„è®ºã€‚</p><p id="7c08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç¥ä½ å¥½è¿ã€‚</p><p id="0dca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">â€” â€” â€” â€” â€” â€”</p></div></div>    
</body>
</html>