# å°† Express é¡¹ç›®ä¸åˆ° Vercel çš„å¤šæ¡è·¯ç”±ä¸€èµ·éƒ¨ç½²ä¸ºå¤šä¸ªæ— æœåŠ¡å™¨åŠŸèƒ½

> åŸæ–‡ï¼š<https://medium.com/geekculture/deploy-express-project-with-multiple-routes-to-vercel-as-multiple-serverless-functions-567c6ea9eb36?source=collection_archive---------4----------------------->

![](img/824d994dcc01c2840b7faa827ade5491.png)

[Vercel](https://vercel.com/) å‡‰äº†ã€‚å¯¹äºå¼€å‘äººå‘˜æ¥è¯´ï¼Œå°† NextJs åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° Vercel éå¸¸å®¹æ˜“ã€‚å› ä¸ºå¹³å°å°±æ˜¯ä¸ºå®ƒè€Œç”Ÿçš„ã€‚ä½†å¯¹äºä¸€ä¸ªæœ‰å¤šæ¡è·¯çº¿çš„ä¼ ç»Ÿå¿«é€’åº”ç”¨ç¨‹åºï¼Œå¦‚æœä½ æŒ‰ç…§ Vercel çš„æ–‡æ¡£éƒ¨ç½²å¿«é€’åº”ç”¨ç¨‹åºï¼Œå®ƒæœ€ç»ˆå°†è¢«éƒ¨ç½²ä¸ºä¸€ä¸ªå•ä¸€çš„æ— æœåŠ¡å™¨åŠŸèƒ½ã€‚

æ­£å¦‚æˆ‘ä»¬æ‰€çŸ¥ï¼Œè€ƒè™‘åˆ°åœ¨ Vercel å¹³å°ä¸Šå®æ–½çš„[é™åˆ¶](https://vercel.com/docs/platform/limits)ï¼Œç”¨ä¸€ä¸ªå•ä¸€çš„æ— æœåŠ¡å™¨å‡½æ•°æ¥å¤„ç†æ‰€æœ‰è¯·æ±‚å¯¹äºç”Ÿäº§æ¥è¯´å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚

è®©æˆ‘ä»¬ç›´æ¥è¿›å…¥ä½¿ç”¨å¤šæ¡è·¯çº¿éƒ¨ç½² ExpressJS åº”ç”¨ç¨‹åºçš„æ–°æ–¹å¼ã€‚

æ‰€ä»¥ä¸€å¼€å§‹ä½ å¯èƒ½å·²ç»ç”¨ [**å¿«é€Ÿè·¯ç”±å™¨**](https://expressjs.com/en/5x/api.html#router) **å®šä¹‰å¥½äº†æ‰€æœ‰çš„è·¯çº¿ã€‚**

åœ¨ source ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ª *routes* æ–‡ä»¶å¤¹ã€‚ç°åœ¨å°†æ‚¨çš„æ‰€æœ‰è·¯çº¿ç§»åŠ¨åˆ°*è·¯çº¿*æ–‡ä»¶å¤¹ä¸­ã€‚ç„¶ååœ¨æºæ–‡ä»¶å¤¹ä¸­åˆ›å»ºå¦ä¸€ä¸ªæ–‡ä»¶å¤¹ *api* ã€‚

ç°åœ¨ï¼Œæ‚¨çš„ç›®å½•æ¸…å•å°†å¦‚ä¸‹æ‰€ç¤ºã€‚

![](img/eb2a738a45922fbfe427c60dc07fbcec.png)

*routes* æ–‡ä»¶å¤¹å°†ä»¥ä¸åŒè·¯ç”±çš„å½¢å¼åŒ…å«æ‚¨çš„æ‰€æœ‰åº”ç”¨ç¨‹åºé€»è¾‘ã€‚åœ¨ *api* æ–‡ä»¶å¤¹ä¸­ï¼ŒVercel æŸ¥æ‰¾è¦ä½œä¸ºæ— æœåŠ¡å™¨åŠŸèƒ½æ·»åŠ åˆ°å¹³å°ä¸­çš„ api ç«¯ç‚¹ã€‚

æ¥ä¸‹æ¥ï¼Œå¯¹äºåº”ç”¨ç¨‹åºä¸­çš„æ¯æ¡è·¯çº¿ï¼Œæ‚¨å¯ä»¥åœ¨æ‚¨çš„ *api* æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª your-fancy-route-name.js æ–‡ä»¶ï¼Œå‘½åä¸º/api/your-fancy-route-name.jsã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ª/api/user è·¯å¾„ï¼Œæ‚¨å¯ä»¥åœ¨ *api* æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª user.js æ–‡ä»¶ã€‚æ‚¨å¯ä»¥åˆ›å»ºä»»æ„å¤šçš„å‡½æ•°ï¼Œä½†æ˜¯è¯·è®°ä½ï¼Œå¦‚æœæ‚¨ä½¿ç”¨å…è´¹è®¡åˆ’ï¼ŒVercel **ä¸Šçš„æ¯ä¸ªéƒ¨ç½²é™åˆ¶æ˜¯ 12 ä¸ªå‡½æ•°ã€‚**

![](img/5730949d0398f19eaf8b12845060beb3.png)

è¿™é‡Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªç¤ºä¾‹è·¯å¾„ï¼Œåˆ†åˆ«å«åš **/api/book** å’Œ **/api/books** ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦åœ¨æ¯ä¸ªå‡½æ•°ä¸­åˆå§‹åŒ– ExpressJSã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†è½¬åˆ° **/api/book.js** ï¼Œå¹¶å°†è¿™æ®µä»£ç æ”¾åœ¨é‚£é‡Œ:

```
const express = require(â€œexpressâ€);
const app = express();
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨ç¬¬äºŒä¸ªç¤ºä¾‹ API ç«¯ç‚¹ **/api/books ä¸­åšåŒæ ·çš„äº‹æƒ…ã€‚**

# ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ã€‚

å°†è¿™äº›è¡Œæ·»åŠ åˆ° *api* æ–‡ä»¶å¤¹ä¸­çš„æ¯ä¸ªæ–‡ä»¶ä¼šå¸¦æ¥å¤§é‡çš„ä»£ç é‡å¤ã€‚æ‰€ä»¥æˆ‘ä»¬å°†æŠŠå®ƒæ”¾åœ¨ä¸€ä¸ªåä¸º **app.js (** æˆ–è€…ä½ æƒ³å«å®ƒä»€ä¹ˆ)çš„æ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶å°†é©»ç•™åœ¨ä½ çš„æºæ–‡ä»¶å¤¹ä¸­ã€‚

```
const express = require(â€œexpressâ€);
const app = express();module.exports = app;
```

ç°åœ¨åœ¨æˆ‘ä»¬çš„ **/api/books.js** å’Œ **/api/books.js** ä¸­æˆ‘ä»¬å¯ä»¥ç›´æ¥å¯¼å…¥è¿™ä¸ª Express app å®ä¾‹ã€‚

```
const app = require(â€œ../appâ€);
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†è·¯ç”±ä»/routes å¯¼å…¥ç›¸åº”çš„ api ç«¯ç‚¹æ–‡ä»¶ï¼Œä»¥ä¾¿åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å®ƒä»¬ã€‚

åœ¨æˆ‘çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘æœ‰ä¸¤æ¡è·¯çº¿ï¼Œå®ƒä»¬çš„åç§°å°±åƒå®ƒä»¬æ‰€å±çš„è·¯çº¿ä¸€æ ·ã€‚

![](img/7915cffb63351e384387bff5afe50ea1.png)

åœ¨ **/routes/book.js** æ–‡ä»¶ä¸­ï¼Œæˆ‘å°†æ‹¥æœ‰æˆ‘çš„ **/api/books** è·¯å¾„çš„é€»è¾‘ã€‚

```
const book = require("express").Router();book.get("/book", async function (req, res) { const { bookId } = req.query; if (bookId) { res.status(200).send(
           { bookName: "Some Book", bookId: bookId }
       ); } else { res.send("No book ID"); }});book.post("/book", async function (req, res) { const { bookId, bookName } = req.body; //do something res.send("Something done");}); module.exports = book;
```

å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬å°†**å¿«é€Ÿè·¯ç”±å™¨**å¯¼å…¥ä¸º **bookï¼Œç„¶å**å°† GET å’Œ POST æ–¹æ³•æ·»åŠ åˆ° **book** ä¸­ã€‚ç°åœ¨æˆ‘ä»¬æœ‰äº† **/api/book** è·¯å¾„çš„é€»è¾‘ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ **/api/book.js** æ–‡ä»¶ä¸­ä½¿ç”¨è¿™ä¸ªè·¯å¾„ã€‚

ä½ å¯ä»¥åœ¨è¿™é‡Œ æ‰¾åˆ°è¿™ä¸ª **/routes/book.js** æ–‡ä»¶ [**ã€‚**](https://github.com/qnxdev/express-vercel-serverless/blob/master/routes/book.js)

åªéœ€å¯¼å…¥è¿™æ¡è·¯çº¿å¹¶ä½¿ç”¨å®ƒã€‚åœ¨ **/api/book.js**

```
const app = require("../app");
const route = require("../routes/book");app.use("/api/", route);module.exports = app;
```

è¯·æ³¨æ„ï¼Œè¯¥æ–‡ä»¶çš„é»˜è®¤å¯¼å‡ºæ˜¯æˆ‘ä»¬åœ¨å…¶ä¸­ä½¿ç”¨ç›¸åº”çš„è·¯å¾„åä» **app.js** å¯¼å…¥çš„ appã€‚è¿™å°†åœ¨æ‚¨éƒ¨ç½²æ—¶ç”± Vercel NodeJS è¿è¡Œæ—¶è¿è¡Œã€‚

å‚è§æˆ‘çš„ **/api/book.js** æ–‡ä»¶ [**æ­¤å¤„**](https://github.com/qnxdev/express-vercel-serverless/blob/master/api/book.js) ã€‚

## ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬å¯ä»¥å°†é€»è¾‘æ·»åŠ åˆ° *routes* æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰å…¶ä»–è·¯ç”±ï¼Œå¹¶å°†å…¶å¯¼å…¥åˆ° *api* æ–‡ä»¶å¤¹ä¸­çš„ç›¸åº”ç«¯ç‚¹ã€‚

ç°åœ¨æˆ‘ä»¬å®Œæˆäº†è·¯ç”±å’Œ api ç«¯ç‚¹ã€‚

å¦‚æœæ‚¨æƒ³åœ¨ Express åº”ç”¨ç¨‹åºä¸­æ·»åŠ è‡ªå®šä¹‰ä¸­é—´ä»¶ï¼Œæ‚¨å¯ä»¥åœ¨æˆ‘ä»¬é¦–æ¬¡åˆå§‹åŒ– Express åº”ç”¨ç¨‹åºçš„ **app.js** æ–‡ä»¶ä¸­å®Œæˆã€‚å°±åƒè¿™æ ·ç®€å•:

```
const express = require("express");
const cors = require("cors");
const helmet = require("helmet");var corsOptions = {
    //...cors options...
}const app = express();app.use(helmet());
app.use(cors(corsOptions));module.exports = app;
```

ä¸Šé¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•æ·»åŠ ä¸­é—´ä»¶ï¼Œæ¯”å¦‚[**CORS**](https://www.npmjs.com/package/cors)**å’Œ [**å¤´ç›”**](https://www.npmjs.com/package/helmet) ã€‚**

**å‚è§å®Œæ•´çš„ **app.js** æ–‡ä»¶ [**æ­¤å¤„**](https://github.com/qnxdev/express-vercel-serverless/blob/master/app.js) ã€‚**

**å¦‚æœä½ æƒ³æ·»åŠ è·¯ç”±ç‰¹å®šçš„ä¸­é—´ä»¶ï¼Œä½ å¯ä»¥åšåŒæ ·çš„**app . use(your middleware)ï¼›**åœ¨ *api* æ–‡ä»¶å¤¹ä¸­çš„ç‰¹å®šç«¯ç‚¹æ–‡ä»¶ä¸­ã€‚**

# **ä¸‡å²ï¼ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»ä¸ºæˆ‘ä»¬çš„ Express åº”ç”¨ç¨‹åºè®¾ç½®äº†å¤šæ¡è¦åœ¨ Vercel ä¸Šéƒ¨ç½²çš„è·¯çº¿ã€‚**

## **ä½†æ˜¯ç­‰ç­‰ã€‚è¿˜æœ‰æ›´å¤š..**

**ç”±äºæˆ‘ä»¬å·²ç»ä¿®æ”¹äº†æˆ‘ä»¬çš„è·¯ç”±ï¼Œæˆ‘ä»¬å¯èƒ½å·²ç»å®Œå…¨æä¹±äº†æˆ‘ä»¬çš„æœ¬åœ°å¼€å‘æœåŠ¡å™¨é…ç½®ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‰ä¸ªæ­¥éª¤è§£å†³è¿™ä¸ªé—®é¢˜ã€‚**

## ****1ã€‚æ·»åŠ ä¸€ä¸ªå¸¸ç”¨çš„ routes.js æ–‡ä»¶****

**![](img/8419fefbe15e6924743d4cacdf36cc92.png)**

**å¦‚ä½ æ‰€è§ï¼Œåœ¨*è·¯ç”±*æ–‡ä»¶å¤¹ä¸­æœ‰ä¸€ä¸ª **router.js** ã€‚æ‚¨å¯ä»¥åœ¨æ‚¨çš„ *routes* æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ **routes.js** æ–‡ä»¶ã€‚**

**åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†ä¸ºå¼€å‘æœåŠ¡å™¨å®šä¹‰è·¯ç”±é€»è¾‘ã€‚**

```
const routes = require("express").Router();const book = require("./book");
const books = require("./books");routes.get("/", async function (req, res) { 
      res.send(`Reached home!`); 
});routes.use("/", book);
routes.use("/", books);module.exports = routes;
```

**è¿™é‡Œæˆ‘ä»¬å¯¼å…¥å¿«é€Ÿè·¯ç”±å™¨ï¼Œå¹¶å°†å…¶åˆ†é…ç»™**æ¡è·¯ç”±ã€‚æœ‰ä¸€ä¸ªä¸º`/'å®šä¹‰çš„ GET è·¯ç”±ï¼Œå®ƒå°†æœåŠ¡äºå­—ç¬¦ä¸²â€œåˆ°è¾¾å®¶ï¼â€å¯¹äºæ¯ä¸ªè¯·æ±‚`/`ã€‚****

**è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å·²ç»åœ¨è¿™é‡Œå¯¼å…¥äº†æˆ‘ä»¬çš„ç¤ºä¾‹ **book** route å’Œ **books** routeï¼Œå¹¶å°†å…¶ç”¨äº **routesã€‚****

**ä½ å¯ä»¥åœ¨è¿™é‡Œ **æ‰¾åˆ°å®Œæ•´çš„ **/routes/router.js** æ–‡ä»¶ [**ã€‚**](https://github.com/qnxdev/express-vercel-serverless/blob/master/routes/router.js)****

## **2.ä¸ºæœ¬åœ°å¼€å‘æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ª devServer.js**

**åœ¨æºæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ **devServer.js** æˆ–è€…ä»»ä½•ä½ æƒ³æ·»åŠ åˆ°æœ¬åœ°æœåŠ¡å™¨çš„æ–‡ä»¶åã€‚åœ¨è¯¥æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†ä» **app.js** æ–‡ä»¶ä¸­å¯¼å…¥ä¹‹å‰å®šä¹‰çš„ Express App åˆå§‹åŒ–ã€‚**

```
const app = require(â€œ./appâ€);
```

**ç„¶åå¯¼å…¥æˆ‘ä»¬åœ¨æ­¥éª¤ 1 ä¸­åˆ›å»ºçš„**è·¯çº¿**ï¼Œå¹¶ä¸ app ä¸€èµ·ä½¿ç”¨ã€‚**

```
const app = require("./app");
const routes = require("./routes/router");app.use("/", routes);app.listen(3000,function () {
      console.log("Server started. Go to http://localhost:3000/");
});
```

**æ­£å¦‚ä½ åœ¨ä¸Šä¸€éƒ¨åˆ†çœ‹åˆ°çš„ï¼Œæˆ‘åœ¨ç«¯å£ 3000 å¯åŠ¨äº†æœåŠ¡å™¨ã€‚**

## **3.å°†è¿è¡Œè„šæœ¬æ·»åŠ åˆ° **package.json****

**åœ¨ä½ çš„ ***package.json*** ä¸­ä½ å¯ä»¥æ·»åŠ è¿™ä¸ªè„šæœ¬**

```
"scripts": {
    "dev": "nodemon devServer.js"
},
```

**æ˜¯çš„ï¼Œä½ éœ€è¦ nodemon æ¥å®Œæˆè¿™é¡¹å·¥ä½œ**

```
npm i nodemon//*then*npm run dev
```

**æœ€ç»ˆçš„ç›®å½•ç»“æ„å°†çœ‹èµ·æ¥åƒè¿™æ ·..**

**![](img/d406fdd4719bad2a661b9f603211b056.png)**

**ä½ å¯ä»¥åœ¨ Github ä¸Šæ‰¾åˆ°è¿™ä¸ªé¡¹ç›®**

> **[***https://github.com/qnxdev/express-vercel-serverless***](https://github.com/qnxdev/express-vercel-serverless)**

**è·Ÿç€æˆ‘*æ— å¤„å¯å»*ğŸ˜**

## **å¥½å§ã€‚æ˜¯çš„ã€‚å®Œæˆäº†ã€‚å®Œç¾ã€‚å–èŒ¶æ—¶é—´åˆ°äº†ã€‚â˜•ï¸**

## **å†è§**