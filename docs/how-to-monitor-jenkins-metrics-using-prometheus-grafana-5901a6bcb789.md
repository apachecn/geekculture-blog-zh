# å¦‚ä½•ä½¿ç”¨ Prometheus & Grafana ç›‘æ§ Jenkins æŒ‡æ ‡ï¼Ÿ

> åŸæ–‡ï¼š<https://medium.com/geekculture/how-to-monitor-jenkins-metrics-using-prometheus-grafana-5901a6bcb789?source=collection_archive---------1----------------------->

**æ™®ç½—ç±³ä¿®æ–¯æ˜¯ä»€ä¹ˆï¼Ÿ** Prometheus æ˜¯ä¸€æ¬¾å¼€æºç›‘æ§å·¥å…·ï¼Œä¸»è¦ç”¨äºæŒ‡æ ‡ç›‘æ§ã€äº‹ä»¶ç›‘æ§ã€å‘Šè­¦é…ç½®ç­‰ã€‚Prometheus è®¾è®¡ç”¨äºç›‘æ§ç›®æ ‡ã€æœåŠ¡å™¨ã€æ•°æ®åº“ã€ç‹¬ç«‹è™šæ‹Ÿæœºç­‰ã€‚Prometheus ä½¿ç”¨ä¸€ç§å«åš**â€œPromQLâ€çš„å¼ºå¤§æŸ¥è¯¢è¯­è¨€ã€‚**

![](img/05a0535988b46f67d72d0eb87ea9d95f.png)

Prometheus Logo

**æ™®ç½—ç±³ä¿®æ–¯é…ç½®æ–‡ä»¶å’Œç»„ä»¶:**

*   **prometheus.yml:-** è¿™æ˜¯ prometheus çš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­å¯¹ Prometheus çš„é…ç½®è¿›è¡Œæ‰€æœ‰æ›´æ”¹ã€‚
*   **Promtool:-** å®ƒæ˜¯ç”¨äºéªŒè¯ Prometheus é…ç½®çš„å‘½ä»¤è¡Œå®ç”¨å·¥å…·ã€‚
*   **PromQL:-** å®ƒæ˜¯ Prometheus ä½¿ç”¨çš„å¼ºæŸ¥è¯¢è¯­è¨€ã€‚

**Grafana æ˜¯ä»€ä¹ˆï¼ŸGrafana æ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æºå¯è§†åŒ–å·¥å…·ï¼Œå®ƒä¸ºç‰¹å®šçš„æ•°æ®æºæä¾›äº†å„ç§ä»ªè¡¨æ¿ã€å›¾è¡¨ã€å›¾å½¢å’Œè­¦å‘Šã€‚Grafana å…è®¸æˆ‘ä»¬æŸ¥è¯¢ã€å¯è§†åŒ–ã€æ¢ç´¢æŒ‡æ ‡å¹¶ä¸ºæ•°æ®æºè®¾ç½®è­¦æŠ¥ã€‚æˆ‘ä»¬è¿˜å¯ä»¥åˆ›å»ºè‡ªå·±çš„åŠ¨æ€ä»ªè¡¨æ¿è¿›è¡Œå¯è§†åŒ–å’Œç›‘æ§ã€‚æˆ‘ä»¬å¯ä»¥ä¿å­˜ä»ªè¡¨æ¿ï¼Œå¹¶ä¸å…¶ä»–æˆå‘˜å…±äº«ã€‚æˆ‘ä»¬è¿˜å¯ä»¥å¯¼å…¥å¤–éƒ¨ä»ªè¡¨æ¿ã€‚**

![](img/b60dae6b7260cc627b0b5e177756ea67.png)

Grafana Logo

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ **Prometheus** å’Œ**Grafana**æ¥ç›‘æ§å„ç§ **Jenkins** æŒ‡æ ‡ï¼Œå¹¶åœ¨ Grafana ä¸­åˆ›å»ºä»ªè¡¨æ¿

![](img/f1e3d6ac21b5b127d08d08520e5d6614.png)

Jenkins + Prometheus + Grafana

**å…ˆå†³æ¡ä»¶:-**

*   **æ™®ç½—ç±³ä¿®æ–¯** & **æ ¼æ‹‰å¤«çº³**çš„åŸºæœ¬æ¦‚å†µ
*   AWS å¸æˆ·
*   å®‰è£…äº†**è©¹é‡‘æ–¯**çš„æœåŠ¡å™¨

**æ­¥éª¤ 1:-åˆ›å»ºæœåŠ¡å™¨**

*   åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘å·²ç»åˆ›å»ºäº† Ubuntu 20.04 AMI çš„æœåŠ¡å™¨
*   åœ¨ **AWS** ä¸­åˆ›å»º **Ubuntu 20.04** æœåŠ¡å™¨ã€‚åœ¨è¿™ä¸ªæœåŠ¡å™¨ä¸­ï¼Œæˆ‘ä»¬å°†å®‰è£…æ™®ç½—ç±³ä¿®æ–¯
*   å¯¹äº **Prometheus & Grafana** æœåŠ¡å™¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸º SSH æ‰“å¼€**9090**&**3000**port&port**22**

![](img/ab806765b7648de7571582f99c4c8949.png)

Servers

**æ­¥éª¤ 2:-å®‰è£…æ™®ç½—ç±³ä¿®æ–¯**

*   ä»è¿™ä¸ª [**é“¾æ¥**ä¸‹è½½ Prometheus å¹¶å®‰è£…åœ¨æœåŠ¡å™¨ä¸Šã€‚](https://prometheus.io/download/#node_exporter)
*   ä¸ºäº†å¯åŠ¨æ™®ç½—ç±³ä¿®æ–¯ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ™®ç½—ç±³ä¿®æ–¯ç›®å½•ä¸­è¿è¡Œ`./prometheus`
*   æˆ‘ä»¬å¯ä»¥åœ¨ **<å…¬å…± IP:9090 >** æŸ¥çœ‹**æ™®ç½—ç±³ä¿®æ–¯**çš„ UI

![](img/31573030d1a65a61fbd5e375cc6c1f55.png)

Prometheus UI

**æ­¥éª¤ 3:-å®‰è£… Grafana**

*   ä»è¿™ä¸ª [**é“¾æ¥**](https://prometheus.io/download/#node_exporter) ä¸‹è½½ Grafana å¹¶å®‰è£…åœ¨æˆ‘ä»¬å®‰è£… Prometheus çš„åŒä¸€å°æœåŠ¡å™¨ä¸Š
*   ä¸ºäº†å¯åŠ¨ Grafanaï¼Œæˆ‘ä»¬éœ€è¦ä» Grafana ç›®å½•è¿è¡Œ`./bin/grafana-server`å‘½ä»¤
*   å½“ä½ ç¬¬ä¸€æ¬¡æ‰“å¼€ Grafana çš„ç”¨æˆ·ç•Œé¢æ—¶ï¼Œå®ƒä¼šè¦æ±‚è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚é»˜è®¤ç”¨æˆ·åå’Œå¯†ç æ˜¯ **adminã€‚**æ‚¨å¯ä»¥åœ¨ä»¥åæ›´æ”¹å¯†ç 
*   æˆ‘ä»¬å¯ä»¥åœ¨ **<å…¬å…± IP: 3000 >** æŸ¥çœ‹ Grafana çš„ UI

![](img/f81c47d0138adcf9fcd40c410746e0f9.png)

Grafana UI

**æ­¥éª¤ 4:-åœ¨ Jenkins ä¸­å®‰è£… Prometheus æ’ä»¶**

*   æˆ‘ä»¬éœ€è¦åœ¨ Jenkins ä¸­å®‰è£… Prometheus çš„æ’ä»¶ï¼Œè¿™æ · Prometheus å°±å¯ä»¥æ”¶é›† Jenkins çš„æ‰€æœ‰æŒ‡æ ‡
*   åœ¨ Jenkins ä¸­ï¼Œç‚¹å‡»ç®¡ç†æ’ä»¶ï¼Œæœç´¢ **Prometheus metrics æ’ä»¶**ï¼Œç„¶åç‚¹å‡»å®‰è£…

![](img/461329f1bc2e25e887ab53a4f1e5aef1.png)

Prometheus Metrics Plugin

*   Jenkins æŒ‡æ ‡çš„é»˜è®¤è·¯å¾„æ˜¯**<Public-IP:8080/Prometheus>**

![](img/a4fe1c0edb5b13db069e6c25925745af.png)

Jenkins Metrics

*   æˆ‘ä»¬è¿˜å¯ä»¥æ›´æ”¹ Jenkins æŒ‡æ ‡çš„é»˜è®¤è·¯å¾„ã€‚ç‚¹å‡»**ç®¡ç†è©¹é‡‘æ–¯- >é…ç½®ç³»ç»Ÿ- >æœç´¢æ™®ç½—ç±³ä¿®æ–¯**å¹¶æ›´æ”¹è·¯å¾„ã€‚

![](img/89678c3a89cc052d533f89e41f432192.png)

Default Path

**æ­¥éª¤ 5:-ä¿®æ”¹æ™®ç½—ç±³ä¿®æ–¯çš„é…ç½®æ–‡ä»¶**

*   Prometheus ç®¡ç†åä¸º **prometheus.yml** çš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­å®šä¹‰å„ç§é…ç½®ï¼Œå¦‚ **alertsã€scrape_configs** ç­‰ã€‚
*   ä¸ºäº†è®© Prometheus æ”¶é›† Docker èŠ‚ç‚¹çš„æŒ‡æ ‡ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ **scrape_configs** èŠ‚ä¸‹çš„ **prometheus.yml** ä¸­å®šä¹‰ä»¥ä¸‹ä»£ç 

```
- job_name: "Jenkins Job"
  static_configs:
    - targets: ["<Public IP of Jenkins Node:8080"]
```

*   æ·»åŠ ä»£ç åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Prometheus ä¸­å°†æˆ‘ä»¬çš„èŠ‚ç‚¹ä½œä¸ºç›®æ ‡è¿›è¡Œæ£€æŸ¥ã€‚Prometheus éœ€è¦ä¸€äº›æ—¶é—´æ¥æ”¶é›†æ‰€æœ‰æŒ‡æ ‡å¹¶æ˜¾ç¤ºèŠ‚ç‚¹åˆ°**åˆ°**çš„çŠ¶æ€ã€‚

![](img/76cdd39d61392669ee0649c7fd79ff0f.png)

Targets

**æ­¥éª¤ 6:-åœ¨ Grafana ä¸­æ·»åŠ æ•°æ®æº**

*   ç°åœ¨ï¼Œåœ¨ Grafana ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ  Prometheus ä½œä¸ºæ•°æ®æº
*   ä¹‹åï¼Œåœ¨çš„ URL éƒ¨åˆ†æˆ‘ä»¬éœ€è¦è¾“å…¥ Prometheus æœåŠ¡å™¨çš„ IP åœ°å€å’Œ **9090** ç«¯å£

![](img/9a38b0c4a48a5364f6605fe14cc9fb65.png)

Data Source

**ç¬¬ 7 æ­¥:-åˆ›å»ºä»ªè¡¨æ¿**

*   åœ¨ Grafana ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦åˆ›å»ºå„ç§ä»ªè¡¨æ¿
*   å› æ­¤ï¼Œåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåŒ…å« 4 ä¸ªé¢æ¿çš„ä»ªè¡¨æ¿
*   ç¬¬ä¸€ä¸ªé¢æ¿å°†æ˜¾ç¤º**æ´»åŠ¨æ’ä»¶æ•°é‡ï¼Œ**ç¬¬äºŒä¸ªé¢æ¿å°†æ˜¾ç¤º**éœ€è¦æ›´æ–°çš„æ’ä»¶æ•°é‡ï¼Œ**ç¬¬ä¸‰ä¸ªé¢æ¿å°†æ˜¾ç¤º**éæ´»åŠ¨æ’ä»¶æ•°é‡ï¼Œ**æœ€åä¸€ä¸ªé¢æ¿å°†æ˜¾ç¤º**å¤±è´¥æ’ä»¶æ•°é‡ã€‚**
*   ç‚¹å‡»**åˆ›å»º** - >æ·»åŠ **é¢æ¿**
*   åœ¨â€œæŒ‡æ ‡æµè§ˆå™¨â€éƒ¨åˆ†ï¼Œåœ¨ä¸‹é¢æ·»åŠ æŸ¥è¯¢ã€‚ä»¥ä¸‹æŸ¥è¯¢å°†è·å–**ä¸ªæ´»åŠ¨æ’ä»¶**çš„æ•°é‡

```
jenkins_plugins_active{}
```

![](img/754f270993d3efdf4de134f6a30dc4ac.png)

Active Plugins

*   æ‚¨å¯ä»¥å°†å¯è§†åŒ–æ›´æ”¹ä¸º**çŠ¶æ€**
*   ç‚¹å‡»**æ·»åŠ é¢æ¿**æ·»åŠ ç¬¬äºŒä¸ªé¢æ¿
*   åœ¨â€œæŒ‡æ ‡æµè§ˆå™¨â€éƒ¨åˆ†ï¼Œåœ¨ä¸‹é¢æ·»åŠ æŸ¥è¯¢ã€‚ä»¥ä¸‹æŸ¥è¯¢å°†è·å–**éæ´»åŠ¨æ’ä»¶**çš„æ•°é‡

```
jenkins_plugins_inactive{}
```

![](img/43733d14f455de77fc4802bd5f29dcbd.png)

Inactive Plugins

*   ç‚¹å‡»**æ·»åŠ é¢æ¿**æ·»åŠ ç¬¬ä¸‰ä¸ªé¢æ¿
*   åœ¨â€œæŒ‡æ ‡æµè§ˆå™¨â€éƒ¨åˆ†ï¼Œåœ¨ä¸‹é¢æ·»åŠ æŸ¥è¯¢ã€‚ä»¥ä¸‹æŸ¥è¯¢å°†è·å–**å¤±è´¥æ’ä»¶**çš„æ•°é‡

```
jenkins_plugins_failed{}
```

![](img/277b6fb582f88ea59f0c4977be8a03c6.png)

Failed Plugins

*   åœ¨â€œæŒ‡æ ‡æµè§ˆå™¨â€éƒ¨åˆ†ï¼Œåœ¨ä¸‹é¢æ·»åŠ æŸ¥è¯¢ã€‚ä»¥ä¸‹æŸ¥è¯¢å°†è·å–éœ€è¦æ›´æ–°çš„**æ’ä»¶çš„æ•°é‡**

```
jenkins_plugins_withUpdate{}
```

![](img/d76c5d09355ae4cfeb6b41793456ce1c.png)

Update required Plugins

*   å•å‡»â€œä¿å­˜ä»ªè¡¨æ¿â€æŒ‰é’®ä¿å­˜ä»ªè¡¨æ¿ï¼Œå¹¶ä¸ºå…¶é€‰æ‹©ä¸€ä¸ªåç§°
*   ä»ªè¡¨æ¿çš„æœ€ç»ˆç»“æœå°†å¦‚ä¸‹æ‰€ç¤º:

![](img/0fc13b656daec01fdaf62c4ee2b13107.png)

Dashboard

*   æ‚¨å¯ä»¥æ›´æ”¹ä»ªè¡¨æ¿è‡ªåŠ¨åŠ è½½çš„æ—¶é—´é¢‘ç‡ã€‚åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œæˆ‘å°†å®ƒè®¾ç½®ä¸º 5mã€‚
*   å°±æ˜¯è¿™æ ·ã€‚ä½ å·²ç»å­¦ä¼šäº†å¦‚ä½•ä½¿ç”¨ **Prometheus** å’Œ **Grafana** ç›‘æ§ Jenkins æŒ‡æ ‡ã€‚

ä½ å¯ä»¥é€šè¿‡è®¿é—®ä¸‹é¢çš„ç½‘å€æ¥æ¢ç´¢æ›´å¤šå…³äºæ™®ç½—ç±³ä¿®æ–¯å’Œ T21 çš„ä¿¡æ¯ã€‚

*   [https://prometheus.io/docs/introduction/overview/](https://prometheus.io/docs/introduction/overview/)
*   [https://grafana.com/](https://grafana.com/)

å¦‚æœæ‚¨å‘ç°æ­¤æŒ‡å—æœ‰å¸®åŠ©ï¼Œè¯·ç‚¹å‡»ğŸ‘æŒ‰é’®ï¼Œä¹Ÿå¯ä»¥éšæ„å‘è¡¨è¯„è®ºã€‚

å…³æ³¨æ›´å¤šç±»ä¼¼çš„æ•…äº‹ğŸ˜Š