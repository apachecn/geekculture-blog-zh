<html>
<head>
<title>Scaleable Authorization Management Made Easy With CASL.JS ğŸ˜€</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CASLä½¿å¯æ‰©å±•çš„æˆæƒç®¡ç†å˜å¾—ç®€å•ã€‚å°„æµç ”ç©¶â€¦ğŸ˜€</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/geekculture/scaleable-authorization-management-made-easy-with-casl-js-bbfb75d18868?source=collection_archive---------19-----------------------#2021-03-22">https://medium.com/geekculture/scaleable-authorization-management-made-easy-with-casl-js-bbfb75d18868?source=collection_archive---------19-----------------------#2021-03-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/6e5f3d86305446b4b082481d49877571.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7rvkwW0E1NQ88vch"/></div></div></figure><h1 id="5a42" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">ä»‹ç»</h1><p id="86bd" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated"><a class="ae km" href="https://casl.js.org/v5/en/" rel="noopener ugc nofollow" target="_blank"> CASLã€‚JS </a>çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªåŒæ„æˆæƒJavaScriptåº“â€ã€‚ğŸ¤”</p><blockquote class="kn ko kp"><p id="7616" class="jo jp kq jq b jr kr jt ju jv ks jx jy kt ku kb kc kv kw kf kg kx ky kj kk kl hb bi translated"><em class="hi">â€œåŒæ„â€è¿™ä¸ªæœ‰è¶£çš„è¯æ„å‘³ç€ä½ å¯ä»¥ä»¥å®Œå…¨ç›¸åŒçš„æ–¹å¼åœ¨å‰ç«¯å’Œåç«¯ä½¿ç”¨è¿™ä¸ªåº“ã€‚</em>â€”â€”<em class="hi">å¡å°”å‰Â·æ–¯æ‰˜èŒ¨åŸº</em></p><p id="01ff" class="jo jp kq jq b jr kr jt ju jv ks jx jy kt ku kb kc kv kw kf kg kx ky kj kk kl hb bi translated">CASL(è¯»ä½œ/ËˆkÃ¦sÉ™l/ï¼Œåƒä¸€åº§åŸå ¡)æ˜¯ä¸€ä¸ªåŒæ„çš„æˆæƒJavaScriptåº“ï¼Œå®ƒé™åˆ¶äº†ç»™å®šå®¢æˆ·ç«¯å¯ä»¥è®¿é—®çš„èµ„æºã€‚å®ƒè¢«è®¾è®¡æˆå¯å¢é‡é‡‡ç”¨çš„ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç®€å•çš„åŸºäºå£°æ˜çš„å’Œå…¨åŠŸèƒ½çš„åŸºäºä¸»é¢˜å’Œå±æ€§çš„æˆæƒä¹‹é—´è½»æ¾æ‰©å±•ã€‚å®ƒä½¿å¾—è·¨UIç»„ä»¶ã€APIæœåŠ¡å’Œæ•°æ®åº“æŸ¥è¯¢ç®¡ç†å’Œå…±äº«æƒé™å˜å¾—å®¹æ˜“ã€‚</p></blockquote><p id="9ac5" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">CASLæ˜¯å¤šåŠŸèƒ½çš„ï¼Œæ‚¨å¯ä»¥ä»ç®€å•çš„åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶å¼€å§‹ï¼Œå¹¶æ‰©å±•æ‚¨çš„åº”ç”¨ç¨‹åºï¼Œä»¥åŒ…æ‹¬å…¨åŠŸèƒ½çš„åŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ã€‚</p><p id="7f19" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">CASLæ˜¯å£°æ˜æ€§çš„ï¼Œå®ƒå…è®¸æ‚¨ä½¿ç”¨å‡ ä¹é€å­—åŒ¹é…æ‚¨çš„ä¸šåŠ¡éœ€æ±‚çš„é¢†åŸŸç‰¹å®šè¯­è¨€æ¥å®šä¹‰æœåŠ¡å™¨ç«¯å†…å­˜ä¸­çš„æƒé™ã€‚</p><p id="6ba7" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">CASLæ˜¯ç±»å‹å®‰å…¨çš„ï¼Œå®ƒæ˜¯ç”¨ç±»å‹è„šæœ¬ç¼–å†™çš„ï¼Œè¿™ä½¿å¾—åº”ç”¨ç¨‹åºæ›´å®‰å…¨ï¼Œå¼€å‘è€…ä½“éªŒæ›´æ„‰å¿«ã€‚</p><p id="0409" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">CASLå¾ˆå°ï¼Œåªæœ‰4.5KBå·¦å³ï¼Œè¿˜å¯ä»¥æ›´å°ï¼Œå¤šäºäº†æ‘‡æ ‘ï¼æœ€å°å¤§å°çº¦ä¸º1.5KBã€‚</p><h1 id="369c" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">èƒŒæ™¯</h1><p id="8c82" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">å› æ­¤ï¼Œåœ¨å·¥ä½œä¸­ä½¿ç”¨Nodejsåº”ç”¨ç¨‹åºæ—¶ï¼›è¯¥å›¢é˜ŸèŠ±äº†æ•°å‘¨æ—¶é—´ç ”ç©¶å’Œå¼€å‘ä¸€ä¸ªæ··åˆè®¿é—®æ§åˆ¶æ¡†æ¶ï¼Œè¯¥æ¡†æ¶æ—¢å¯æ‰©å±•ï¼Œåˆå¯æ ¹æ®ä¸šåŠ¡éœ€æ±‚åŠ¨æ€å˜åŒ–ã€‚</p><p id="85d3" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">æœ€è¿‘çš„å‘å±•è¡¨æ˜ï¼ŒåŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶(ABAC)å¯ä»¥åœ¨åŠ¨æ€åˆ†å¸ƒå¼ç³»ç»Ÿå’Œä¼ä¸šåº”ç”¨ç¨‹åºä¸­æä¾›çµæ´»å’Œç»†ç²’åº¦çš„è®¿é—®æ§åˆ¶ã€‚ç”±äºåªè€ƒè™‘ä¸»ä½“ã€å®¢ä½“å’Œç¯å¢ƒçš„å±æ€§ï¼Œå…¸å‹çš„åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶(ABAC)æ–¹æ¡ˆçš„å¤§å¤šæ•°å½“å‰è§£å†³æ–¹æ¡ˆä¸èƒ½ä¸ºå…·æœ‰ä¸åŒå±æ€§çš„ä¸€ç³»åˆ—ç”¨æˆ·æ‰©å±•å¯¹èµ„æºçš„è®¸å¯ã€‚</p><p id="72d7" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">åŒæ ·åœ¨(ABAC)æ¡†æ¶ä¸­ï¼Œç›®æ ‡å±æ€§ç”±èµ„æºæœ¬èº«åœ¨ç‰¹å®šæ¡ä»¶ä¸‹è·å¾—æˆ–å®šä¹‰ï¼Œä¾‹å¦‚æ—¶é—´ã€ä½ç½®ã€IPåœ°å€ç­‰</p><p id="f135" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">å› æ­¤ï¼Œåœ¨æ··åˆè®¿é—®æ§åˆ¶æ¡†æ¶ä¸­ï¼Œå¯¹èµ„æºçš„è®¸å¯è·¨å¹³å°ä¸Šç”¨æˆ·çš„è§’è‰²ã€å£°æ˜ã€å±æ€§è¿›è¡Œå»ºæ¨¡ï¼›ä¾‹å¦‚ç”±ç®€æ¡£æ‰€æœ‰è€…æŒ‡å®šçš„ç”¨æˆ·å®šä¹‰çš„å±æ€§ï¼Œä¾‹å¦‚æ€§åˆ«ã€å§“åã€å·¥ä½œã€å®¶ä¹¡ã€çˆ±å¥½ç­‰ã€‚</p><p id="e6db" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">æ„å»ºä¸€ä¸ªå®šåˆ¶çš„æ··åˆè®¿é—®æ§åˆ¶æ¡†æ¶ï¼Œå°±åƒä¸Šé¢è®¨è®ºçš„é‚£æ ·å¤šæ‰å¤šè‰ºï¼Œå¯èƒ½ä¼šè€—è´¹å¤§é‡èµ„æºï¼Œå°¤å…¶æ˜¯å¯¹äºå°å‹å›¢é˜ŸğŸ™„ã€‚</p><p id="327c" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">æˆ‘ä»¬å‘ç°<a class="ae km" href="https://github.com/stalniy/casl" rel="noopener ugc nofollow" target="_blank"> CASL JS </a>æˆæƒåº“éå¸¸æ£’ï¼Œæ˜“äºé‡‡ç”¨ï¼Œç»´æŠ¤é‡å¤§ï¼Œå¹¶ä¸”èƒ½å¤Ÿæœ‰æ•ˆåœ°éšä¸šåŠ¡æ‰©å±•ï¼Œä»¥åŠ¨æ€ç®¡ç†å¯¹èµ„æºçš„è®¸å¯ğŸ˜ƒã€‚</p><p id="8165" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">å‡è®¾</strong>ã€‚æˆ‘å‡è®¾ä½ å·²ç»å¯¹<a class="ae km" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Nodejs </a>å’Œé€šè¿‡å£°æ˜æˆ–è§’è‰²ç®¡ç†åº”ç”¨ç¨‹åºä¸­çš„æƒé™æœ‰æ‰€äº†è§£ğŸ˜Œã€‚</p><h1 id="2744" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">å¼€å§‹è¡ŒåŠ¨â€”â€”ç©ºè°ˆæ˜¯å»‰ä»·çš„ğŸ˜†</h1><p id="79f9" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">1).å°†<a class="ae km" href="https://hashnode.com/@casl" rel="noopener ugc nofollow" target="_blank">@ casl</a>/èƒ½åŠ›ä½œä¸ºä¸€ä¸ªä¾èµ–é¡¹å®‰è£…åœ¨ä½ çš„Nodejsåº”ç”¨ç¨‹åºä¸­:</p><p id="4ce9" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><code class="du kz la lb lc b">npm i @casl/ability</code></p><p id="0a3e" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">2).å®šä¹‰èƒ½åŠ›</p><p id="75fc" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">æœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥å®šä¹‰èƒ½åŠ›:</p><pre class="ld le lf lg fd lh lc li lj aw lk bi"><span id="358a" class="ll ir hi lc b fi lm ln l lo lp">- using defineAbility function<br/>- using AbilityBuilder class<br/>- using JSON objects</span></pre><p id="a350" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<code class="du kz la lb lc b">defineAbility function</code></p><p id="528f" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">è¿™ä¸ªå‡½æ•°å…è®¸ä½¿ç”¨canå’Œcannotæ–¹æ³•åˆ›å»ºä¸€ä¸ªèƒ½åŠ›å®ä¾‹ã€‚å®ƒå…è®¸åœ¨ä¸å†™å¤ªå¤šä»£ç çš„æƒ…å†µä¸‹å®šä¹‰å’Œä½¿ç”¨èƒ½åŠ›å®ä¾‹ã€‚</p><pre class="ld le lf lg fd lh lc li lj aw lk bi"><span id="98d1" class="ll ir hi lc b fi lm ln l lo lp">//ability/defineAbility.js</span><span id="15f9" class="ll ir hi lc b fi lq ln l lo lp">const { AbilityBuilder, Ability } = require("<a class="ae km" href="http://twitter.com/casl/ability" rel="noopener ugc nofollow" target="_blank">@casl/ability</a>");</span><span id="498a" class="ll ir hi lc b fi lq ln l lo lp">/**<br/> * <a class="ae km" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> user contains details about logged in user: its id, name, email, etc<br/> */<br/>// Define abilities for subjects here</span><span id="84a7" class="ll ir hi lc b fi lq ln l lo lp">// permissions on Organization<br/>exports.defineAbilitiesOnOrganizationFor = (user) =&gt; {<br/>  const { can, cannot, rules } = new AbilityBuilder(Ability);</span><span id="bb87" class="ll ir hi lc b fi lq ln l lo lp">// condition == True<br/>  if (user.isAdmin) {<br/>    // can manage (i.e., do anything) own Oganization<br/>    can(<br/>      "manage", // can do everything<br/>      "Oganization", //  Organization collection<br/>      ["email",<br/>        "phone",<br/>        "password",<br/>        "firstName", // feilds that can be managed<br/>        "lastName"<br/>      ],<br/>      { _id: user._id } // condition , if OrgId=user.Id (belongs to an Org)<br/>    );</span><span id="1941" class="ll ir hi lc b fi lq ln l lo lp">// But cannot delete Oganization<br/>    cannot(<br/>      "delete", // cannot delete Organization any Organization<br/>      "Organization" // collection Organization<br/>    );<br/>  }</span><span id="ceb9" class="ll ir hi lc b fi lq ln l lo lp">if (user.isSuperAdmin) {<br/>    // define the abilities for superAdmin on organization(subject)<br/>    can(<br/>      "manage",<br/>      "Organization"<br/>    );<br/>  }</span><span id="5620" class="ll ir hi lc b fi lq ln l lo lp">return new Ability(rules);<br/>};</span></pre><p id="21b8" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">åœ¨ä¸Šé¢çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬ä¸ºâ€œç®¡ç†å‘˜â€å’Œâ€œè¶…çº§ç®¡ç†å‘˜â€å®šä¹‰äº†æƒé™ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥ä¸ºç»„ç»‡è®¾ç½®äº†æ¡ä»¶ï¼Œä½¿å…¶æˆä¸ºå¯ç”±ä¸¤ä¸ªç”¨æˆ·ç®¡ç†çš„èµ„æºã€‚</p><p id="eda8" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">CASLåœ¨èƒ½åŠ›çº§åˆ«ä¸Šæ“ä½œï¼Œè¿™æ˜¯ç”¨æˆ·åœ¨åº”ç”¨ç¨‹åºä¸­å®é™…å¯ä»¥åšçš„äº‹æƒ…ã€‚èƒ½åŠ›æœ¬èº«å–å†³äº4ä¸ªå‚æ•°(æœ€å3ä¸ªæ˜¯å¯é€‰çš„):</p><p id="eb36" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">ç”¨æˆ·åŠ¨ä½œ</strong>æè¿°äº†ç”¨æˆ·åœ¨appä¸­å®é™…å¯ä»¥åšçš„äº‹æƒ…ã€‚ç”¨æˆ·åŠ¨ä½œæ˜¯ä¸€ä¸ªä¾èµ–äºä¸šåŠ¡é€»è¾‘çš„è¯(é€šå¸¸æ˜¯åŠ¨è¯)(ä¾‹å¦‚ï¼Œå»¶é•¿ã€è¯»å–)ã€‚å®ƒé€šå¸¸æ˜¯æ¥è‡ªCRUDçš„å•è¯åˆ—è¡¨â€”â€”åˆ›å»ºã€è¯»å–ã€æ›´æ–°å’Œåˆ é™¤ã€‚</p><p id="66aa" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">ä¸»é¢˜</strong>è¦æ£€æŸ¥ç”¨æˆ·æ“ä½œçš„ä¸»é¢˜æˆ–ä¸»é¢˜ç±»å‹ã€‚é€šå¸¸ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸šåŠ¡(æˆ–åŸŸ)å®ä½“(ä¾‹å¦‚ï¼Œè®¢é˜…ã€æ–‡ç« ã€ç”¨æˆ·ã€ç»„ç»‡)ã€‚ä¸»é¢˜å’Œä¸»é¢˜ç±»å‹ä¹‹é—´çš„å…³ç³»ä¸å¯¹è±¡å®ä¾‹å’Œå®ƒçš„ç±»ä¹‹é—´çš„å…³ç³»ç›¸åŒã€‚</p><p id="e438" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">å­—æ®µ</strong>å¯ç”¨äºå°†ç”¨æˆ·æ“ä½œä»…é™äºåŒ¹é…ä¸»é¢˜çš„å­—æ®µ(ä¾‹å¦‚ï¼Œå…è®¸ç®¡ç†å‘˜æ›´æ–°èµ„æºçš„å­—æ®µï¼Œä¸å…è®¸æ›´æ–°æŸäº›å­—æ®µ)</p><p id="a82c" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><strong class="jq hj">æ¡ä»¶</strong>å°†ç”¨æˆ·æ“ä½œä»…é™äºåŒ¹é…ä¸»é¢˜çš„æ ‡å‡†ã€‚å½“æ‚¨éœ€è¦æˆäºˆç‰¹å®šä¸»é¢˜çš„æƒé™æ—¶(ä¾‹å¦‚ï¼Œå…è®¸ç”¨æˆ·ç®¡ç†ä»–ä»¬è‡ªå·±çš„ç®€æ¡£å¸æˆ·)ï¼Œè¿™å¾ˆæœ‰ç”¨</p><p id="c9b9" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">æœ‰ï¼›ä¸šåŠ¡éœ€æ±‚å¯ä»¥å¾ˆå®¹æ˜“åœ°è½¬åŒ–ä¸ºCASLè§„åˆ™ğŸ¤©ã€‚</p><p id="76c2" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">3).æ•°æ®åº“é›†æˆCASLæœ‰ä¸€ä¸ªè¡¥å……åŒ…[<a class="ae km" href="https://hashnode.com/@casl" rel="noopener ugc nofollow" target="_blank">@ casl</a>/mongose]ï¼Œå®ƒæä¾›äº†ä¸MongoDBå’Œ[mongose]çš„è½»æ¾é›†æˆã€‚</p><p id="75ec" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">å®‰è£…ä¾èµ–å…³ç³»:<code class="du kz la lb lc b">npm install @casl/mongoose</code></p><pre class="ld le lf lg fd lh lc li lj aw lk bi"><span id="d243" class="ll ir hi lc b fi lm ln l lo lp">// Organization.js</span><span id="9d24" class="ll ir hi lc b fi lq ln l lo lp">import { AbilityBuilder } from '<a class="ae km" href="http://twitter.com/casl/ability" rel="noopener ugc nofollow" target="_blank">@casl/ability</a>';<br/>import { accessibleRecordsPlugin } from '<a class="ae km" href="http://twitter.com/casl/mongoose" rel="noopener ugc nofollow" target="_blank">@casl/mongoose</a>';<br/>import mongoose from 'mongoose';<br/>import {defineAbilitiesOnOrganizationFor} from 'ability/defineAbility.js'</span><span id="6a78" class="ll ir hi lc b fi lq ln l lo lp">mongoose.plugin(accessibleRecordsPlugin);</span><span id="522a" class="ll ir hi lc b fi lq ln l lo lp">const user = getUserLoggedInUser(); // app specific function</span><span id="2e2c" class="ll ir hi lc b fi lq ln l lo lp">const ability = defineAbilitiesOnOrganizationFor(user);</span><span id="9eaf" class="ll ir hi lc b fi lq ln l lo lp">const Organization = mongoose.model('Organization', mongoose.Schema({<br/>  email: String,<br/>  isAdmin: Boolean, <br/>  phone: Number,<br/>  password: String,<br/>  content: String,<br/>  createdAt: Date,<br/>  firstName: String,<br/>  lastName: String</span><span id="9efe" class="ll ir hi lc b fi lq ln l lo lp">}))</span><span id="7aed" class="ll ir hi lc b fi lq ln l lo lp">Organization.plugin(accessibleRecordsPlugin)</span><span id="f7bb" class="ll ir hi lc b fi lq ln l lo lp">module.exports = mongoose.model('Organization', Organization)</span></pre><p id="0e9e" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">4).æ£€æŸ¥èƒ½åŠ›</p><pre class="ld le lf lg fd lh lc li lj aw lk bi"><span id="51a7" class="ll ir hi lc b fi lm ln l lo lp">// ../controllers/organizationController.js</span><span id="aa58" class="ll ir hi lc b fi lq ln l lo lp">const { NotFound, Unauthorized, InternalServerError } = require("http-errors");<br/>const Organizations = require("../models/organization");</span><span id="8c61" class="ll ir hi lc b fi lq ln l lo lp">async function permissionChecker(model, defineAbilitiesOnSubjectFor, userId) {<br/>  try {</span><span id="6b40" class="ll ir hi lc b fi lq ln l lo lp">// get user and all attributes<br/>    const user = await model.findOne({ _id: userId });<br/>    if (!user) {<br/>      throw new NotFound("user not found");<br/>    }<br/>    // get ability<br/>    const ability = defineAbilitiesOnSubjectFor(user);<br/>     return ability;</span><span id="078a" class="ll ir hi lc b fi lq ln l lo lp">} catch (error) {<br/>    throw new Unauthorized(error.message);<br/>  }<br/>}</span><span id="4dbb" class="ll ir hi lc b fi lq ln l lo lp">let action = "update" // specify the type of action on the resource, to check for<br/>let subject = "Organization"  // resource that needs permission and access control</span><span id="f8e7" class="ll ir hi lc b fi lq ln l lo lp">// check for permission using the permission checker<br/>    const ability = await permissionChecker(<br/>      Organization,<br/>      defineAbilitiesOnOrganizationFor,<br/>      user<br/>    );</span><span id="ffa2" class="ll ir hi lc b fi lq ln l lo lp">if(ability) {<br/>   try {<br/>        const organization = new Organization();<br/>        organization.set(data); // app specific data<br/>        ForbiddenError.from(ability).throwUnlessCan(action, organization);<br/>        await organization.save();<br/>   }catch(error){<br/>      throw new Unauthorized(error.message);<br/>   }<br/>} else{<br/>   throw new InternalServerError(error.message);<br/>}</span></pre><p id="0f3c" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">æ˜¯çš„ï¼Œåœ¨ä½ çš„<a class="ae km" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Nodejs </a>åº”ç”¨ä¸­ç”¨CASLå®ç°å¯ä¼¸ç¼©çš„å†…å­˜æƒé™ç®¡ç†å’Œèµ„æºæˆæƒå°±æ˜¯è¿™ä¹ˆç®€å•ğŸ˜Šã€‚</p><p id="12b6" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">CASLçš„é€‚åº”æ€§è¶Šæ¥è¶Šå¼ºï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥ä»ç®€å•çš„åŸºäºè§’è‰²çš„æˆæƒå¼€å§‹æ‚¨çš„é¡¹ç›®ï¼Œå¹¶åœ¨ä»¥åéšç€æ‚¨çš„åº”ç”¨ç¨‹åºåŠŸèƒ½çš„å‘å±•è€Œå‘å±•ã€‚</p><p id="e075" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated">æ„Ÿè°¢è§‚ä¼—ï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ğŸ¤—ã€‚ä½ å¯ä»¥éšæ—¶åœ¨Githubã€T2ã€æ¨ç‰¹å’ŒT4çš„LinkedInä¸Šè”ç³»æˆ‘ã€‚ä¸€å®šè¦ç‚¹èµã€è¯„è®ºå’Œåˆ†äº«ğŸ˜Œã€‚</p><h1 id="834a" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">äº†è§£æ›´å¤šä¿¡æ¯</h1><ul class=""><li id="8ead" class="lr ls hi jq b jr js jv jw jz lt kd lu kh lv kl lw lx ly lz bi translated"><a class="ae km" href="https://casl.js.org/" rel="noopener ugc nofollow" target="_blank"> CASL JSæ–‡æ¡£</a></li></ul></div><div class="ab cl ma mb gp mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="hb hc hd he hf"><p id="6a2b" class="pw-post-body-paragraph jo jp hi jq b jr kr jt ju jv ks jx jy jz ku kb kc kd kw kf kg kh ky kj kk kl hb bi translated"><em class="kq">æœ€åˆå‘å¸ƒäº</em><a class="ae km" href="https://blog.nextwebb.tech/scaleable-authorization-management-made-easy-with-casljs/" rel="noopener ugc nofollow" target="_blank"><em class="kq">https://blog . next Webb . tech</em></a><em class="kq">ã€‚</em></p></div></div>    
</body>
</html>