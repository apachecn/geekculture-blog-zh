# è‡ªåŠ¨åŒ–â€”â€”ä½¿ç”¨ Ansible é€šè¿‡ AWS åœ¨ Kubernetes å¤šèŠ‚ç‚¹é›†ç¾¤ä¸Šéƒ¨ç½² WordPress

> åŸæ–‡ï¼š<https://medium.com/geekculture/automation-wordpress-deployment-on-kubernetes-multi-node-cluster-launched-over-aws-using-ansible-cb6707906af2?source=collection_archive---------10----------------------->

![](img/56351b406426c9cd3ff2a6a36a184c04.png)

Created by Akanksha

## ä½¿ç”¨ WordPress éƒ¨ç½²ç½‘ç«™æ˜¯ä¸€é¡¹ç®€å•çš„ä»»åŠ¡ï¼Œä½†å½“æ¶‰åŠåˆ°é«˜å¯ç”¨æ€§å’Œå¿«é€Ÿéƒ¨ç½²ä»¥åŠç¼–æ’å’Œè‡ªåŠ¨ä¾›åº”è®¾æ–½æ—¶ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯åŸºäºäº‘çš„ MNAã€‚

è‘—åçš„ç½‘ç«™å’Œåšå®¢æ„å»ºå·¥å…· WordPressï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Ansible çš„ Automation åœ¨ Kubernetes ä¸Šéƒ¨ç½²ã€‚é—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦è¿™ç§éƒ¨ç½²ï¼Œåˆ›å»º POD çš„å¿…è¦æ€§æ˜¯ä»€ä¹ˆï¼Ÿ

è±†èšæ˜¯ Kubernetes ç®¡ç†å‘¨æœŸçš„æœ€å°å•ä½ã€‚å¦‚æœæˆ‘ä»¬çœ‹åˆ°å®˜æ–¹å®šä¹‰â€”â€”**åŠèˆ±**æ˜¯ **Kubernetes** ä¸­æœ€å°ã€æœ€åŸºæœ¬çš„å¯å±•å¼€ç‰©ä½“ã€‚ä¸€ä¸ª **Pod** ä»£è¡¨é›†ç¾¤ä¸­æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„ä¸€ä¸ªå®ä¾‹ã€‚**pod**åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ï¼Œä¾‹å¦‚ç å¤´é›†è£…ç®±ã€‚å½“ä¸€ä¸ª **Pod** è¿è¡Œå¤šä¸ªå®¹å™¨æ—¶ï¼Œè¿™äº›å®¹å™¨ä½œä¸ºå•ä¸ªå®ä½“è¿›è¡Œç®¡ç†ï¼Œå¹¶å…±äº« **Pod çš„**èµ„æºã€‚

å½“æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„å®¹å™¨ä¸Šéƒ¨ç½²æˆ‘ä»¬çš„ WordPress æ¥å¯åŠ¨ä¸€ä¸ªç½‘ç«™æ—¶ï¼Œä½¿ç”¨ WordPress éƒ¨ç½²ç½‘ç«™æ˜¯ä¸€é¡¹ç®€å•çš„ä»»åŠ¡ï¼Œä½†å½“æ¶‰åŠåˆ°é«˜å¯ç”¨æ€§å’Œå¿«é€Ÿéƒ¨ç½²ä»¥åŠç¼–æ’å’Œè‡ªåŠ¨ä¾›åº”è®¾æ–½æ—¶ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯åŸºäºè‡ªåŠ¨åŒ–çš„äº‘çš„ MNAï¼Œä»¥å®ç°å‡ºè‰²çš„æ•æ·è®¾ç½®ï¼Œåªéœ€å‡ ç§’é’Ÿå³å¯å®Œæˆéƒ¨ç½²å’Œç«¯ç‚¹åˆ†å‘ã€‚

è®©æˆ‘å¸¦ä½ å»çœ‹çœ‹è¿™äº›æŠ€æœ¯å’Œå®ƒä»¬çš„éœ€æ±‚ï¼Œå‡ å¤©å‰æˆ‘å†™äº†ä¸€ç¯‡å…³äº**â€œä½¿ç”¨ ANSIBLE åœ¨ AWS ä¸Šè‡ªåŠ¨åŒ– KUBERNETES é›†ç¾¤â€**çš„åšå®¢ã€‚

[](https://akanksha77.medium.com/automate-kubernetes-cluster-over-aws-using-ansible-3a1b3f78cfee) [## ä½¿ç”¨ ANSIBLE åœ¨ AWS ä¸Šè‡ªåŠ¨åŒ– KUBERNETES é›†ç¾¤

### ğŸ¤”KUBERNETES é›†ç¾¤ï¼ï¼è¿™æ˜¯ä»€ä¹ˆï¼ï¼ŸKubernetes æ˜¯ä¸€ä¸ªç¼–æ’å·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©ç®¡ç†æœåŠ¡å®¹å™¨â€¦

akanksha77.medium.com](https://akanksha77.medium.com/automate-kubernetes-cluster-over-aws-using-ansible-3a1b3f78cfee) 

# Kubernetes:

Kubernetes æ˜¯ä¸€ä¸ªç›‘æ§å’Œç®¡ç†å®¹å™¨çš„ç¼–æ’å·¥å…·ã€‚å®ƒæ˜¯ç”±è°·æ­Œåœ¨ 2014 å¹´è®¾è®¡çš„ï¼Œæ˜¯ä¸€ä¸ªå¼€æºå·¥å…·ã€‚Kubernetes æ˜¯ä¸ºå®¹å™¨çš„éƒ¨ç½²ã€ç»´æŠ¤å’Œæ‰©å±•è€Œå»ºç«‹çš„ï¼Œä»¥ç»´æŠ¤ç‰¹å®šçš„çŠ¶æ€ï¼Œå¹¶é€šè¿‡å„ç§åŠŸèƒ½ä¸ºç¯å¢ƒæä¾›æŒç»­æ”¯æŒï¼Œè¿™äº›åŠŸèƒ½åŒ…æ‹¬ podã€æ ‡ç­¾ã€é€‰æ‹©å™¨ã€æ§åˆ¶å™¨ã€å¤åˆ¶æ§åˆ¶å™¨ã€éƒ¨ç½²æ§åˆ¶å™¨ã€å‰¯æœ¬é›†å’ŒæœåŠ¡ã€‚Kubernetes ä½¿ç”¨å£°æ˜æ€§æ–¹æ³•è¿›è¡Œç¼–æ’ï¼Œå› æ­¤ä½¿ç”¨å£°æ˜æ€§è¯­è¨€ï¼Œå³ YAML æˆ–â€¦..([å‚è€ƒæˆ‘ä¹‹å‰åœ¨ Kubernetes ä¸Šçš„åšå®¢](/linuxworld-informatics-pvt-ltd/in-this-article-i-will-explain-that-how-industries-use-orchestration-tool-to-minimize-server-a3fb7c88cf72))

[](/linuxworld-informatics-pvt-ltd/in-this-article-i-will-explain-that-how-industries-use-orchestration-tool-to-minimize-server-a3fb7c88cf72) [## åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è§£é‡Šè¡Œä¸šå¦‚ä½•ä½¿ç”¨ç¼–æ’å·¥å…·æ¥æœ€å°åŒ–æœåŠ¡å™¨â€¦

### slackâ€”â€”èŠå¤©æœºå™¨äººã€ç¾¤ç»„æ¶ˆæ¯å’Œå¹¿æ’­é¢‘é“çš„åº”ç”¨ç¨‹åºä¹Ÿä½¿ç”¨ Kubernetes è¿›è¡Œäº‹ä»¶é€šçŸ¥â€¦

medium.com](/linuxworld-informatics-pvt-ltd/in-this-article-i-will-explain-that-how-industries-use-orchestration-tool-to-minimize-server-a3fb7c88cf72) 

# Ansible:

è‡ªåŠ¨åŒ–åœ¨ IT é¢†åŸŸå·²ç»å­˜åœ¨äº†å‡ åå¹´ï¼Œä½† Ansible ä¸»è¦æ˜¯ä¸ºâ€œé…ç½®ç®¡ç†â€è€Œè®¾è®¡çš„ï¼Œè¯¥å·¥å…·ä»¥é«˜åº¦å¯ä¼¸ç¼©æ€§å’Œå¯åŠ¨ä¸šåŠ¡çš„èƒ½åŠ›è¿›å…¥å¸‚åœºï¼Œæ— éœ€å‘å‘˜å·¥æ”¯ä»˜é«˜é¢å·¥èµ„ï¼Œåªéœ€ç¼–å†™è„šæœ¬æ¥ç»§ç»­é…ç½®ç”±è´Ÿè½½å¹³è¡¡å™¨å¯åŠ¨çš„æ¯ä¸ªèŠ‚ç‚¹ã€‚ç°åœ¨é—®é¢˜æ¥äº†ï¼ŒAnsible ä½œä¸ºè‡ªåŠ¨åŒ–æä¾›äº†ä»€ä¹ˆï¼Œæˆ‘ä»¬èƒ½ä¾èµ–å®ƒæ¥å®Œæˆé…ç½®ç®¡ç†çš„æ‰€æœ‰æ­¥éª¤å—ï¼Ÿâ€¦â€¦( [å‚è€ƒæˆ‘ä¹‹å‰åœ¨ Ansible](https://akanksha77.medium.com/this-article-will-give-you-an-idea-that-how-advancement-and-automation-made-the-configuration-of-62b15ad680ea) ä¸Šçš„åšå®¢)

[](https://akanksha77.medium.com/this-article-will-give-you-an-idea-that-how-advancement-and-automation-made-the-configuration-of-62b15ad680ea) [## æœ¬æ–‡å°†è®©æ‚¨äº†è§£è¿›æ­¥å’Œè‡ªåŠ¨åŒ–æ˜¯å¦‚ä½•ä½¿é…ç½®â€¦

### è‡ªåŠ¨åŒ–åœ¨ IT é¢†åŸŸå·²ç»å­˜åœ¨å‡ åå¹´äº†ï¼Œä½† Ansible ä¸»è¦æ˜¯ä¸ºâ€œé…ç½®ç®¡ç†â€è€Œè®¾è®¡çš„ã€‚

akanksha77.medium.com](https://akanksha77.medium.com/this-article-will-give-you-an-idea-that-how-advancement-and-automation-made-the-configuration-of-62b15ad680ea) 

# AWS:

AWS (Amazon Web Services)æä¾›é«˜æ°´å¹³çš„æœåŠ¡ï¼Œå› æ­¤å®ƒæ˜¯ä¸–ç•Œä¸Šæœ€å—æ¬¢è¿çš„å…¬å…±äº‘ã€‚æ ¹æ®æœ€è¿‘çš„ Gartner æŠ¥å‘Šï¼ŒAWS åœ¨æä¾›æœ€å…·å¯ç”¨æ€§å’Œå®‰å…¨æ€§çš„èµ„æºå’ŒæœåŠ¡æ–¹é¢æ’åä¸–ç•Œç¬¬ä¸€ã€‚AWS æä¾›äº†ä¸€ç»„å®Œå…¨æ‰˜ç®¡çš„æœåŠ¡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥æ„å»ºå’Œè¿è¡Œæ— æœåŠ¡å™¨åº”ç”¨ç¨‹åºã€‚æ— æœåŠ¡å™¨åº”ç”¨ä¸éœ€è¦ä¸ºåç«¯ç»„ä»¶(å¦‚è®¡ç®—ã€æ•°æ®åº“ã€å­˜å‚¨ã€æµå¤„ç†ã€æ¶ˆæ¯æ’é˜Ÿç­‰)æä¾›ã€ç»´æŠ¤å’Œç®¡ç†æœåŠ¡å™¨ã€‚([å‚è€ƒæˆ‘åœ¨ AWS ä¸Šçš„åšå®¢)](https://www.linkedin.com/pulse/serverless-computing-cola-company-case-study-akanksha-singh/)

[](https://akanksha77.medium.com/this-article-will-give-you-an-idea-that-how-advancement-and-automation-made-the-configuration-of-62b15ad680ea) [## æœ¬æ–‡å°†è®©æ‚¨äº†è§£æŠ€æœ¯è¿›æ­¥å’Œè‡ªåŠ¨åŒ–æ˜¯å¦‚ä½•ä½¿â€¦

### è‡ªåŠ¨åŒ–åœ¨ IT é¢†åŸŸå·²ç»å­˜åœ¨å‡ åå¹´äº†ï¼Œä½† Ansible ä¸»è¦æ˜¯ä¸ºâ€œé…ç½®ç®¡ç†â€è€Œè®¾è®¡çš„ã€‚

akanksha77.medium.com](https://akanksha77.medium.com/this-article-will-give-you-an-idea-that-how-advancement-and-automation-made-the-configuration-of-62b15ad680ea) 

# WordPress:

WordPress (WP)æ˜¯ä¸€ä¸ªç”¨ PHP ç¼–å†™çš„å…è´¹å¼€æºå†…å®¹ç®¡ç†ç³»ç»Ÿ(CMS ),é…æœ‰ MySQL æˆ– MariaDB æ•°æ®åº“ã€‚å®ƒéå¸¸çµæ´»ï¼Œæœ‰æ•°ä»¥åƒè®¡çš„ä¸»é¢˜ã€æ’ä»¶å’Œç½‘ç«™å¼€å‘æ”¯æŒé€‰é¡¹ï¼Œè®©[äº†è§£æ›´å¤šå…³äº WordPress çš„ä¿¡æ¯ï¼ï¼](https://www.wp101.com/tutorial/what-is-wordpress/)

# åœ¨ç»§ç»­è¿›è¡Œä¹‹å‰ï¼Œè®©æˆ‘ä»¬ç®€è¦ä»‹ç»ä¸€ä¸‹æˆ‘ä»¬çš„è®¡åˆ’:

1.  æˆ‘ä»¬æ€»å…±æœ‰å››ä¸ª EC2 å®ä¾‹å’Œä¸€ä¸ªæœ¬åœ°ç³»ç»Ÿï¼Œå®ƒæ˜¯ä¸€ä¸ªæ§åˆ¶å™¨èŠ‚ç‚¹(*RHEL æ“ä½œç³»ç»Ÿä½äºåŸºç¡€æ“ä½œç³»ç»Ÿ)ï¼Œæˆ‘ä»¬å°†ä»è¿™é‡Œè¿è¡Œè§’è‰²ï¼Œåªéœ€ç‚¹å‡»ä¸€ä¸‹é¼ æ ‡å°±å¯ä»¥è®¾ç½®å¥½ä¸€åˆ‡ã€‚
2.  å®ä¾‹å°†ç”±â€œEC2 è§’è‰²â€æä¾›
3.  ä¸»èŠ‚ç‚¹è®¾ç½®æ˜¯å°†é€šè¿‡è¿è¡Œâ€œK8s_masterâ€å‘ç”Ÿçš„ä¸‹ä¸€ä¸ªä»»åŠ¡
4.  ä¸‹ä¸€æ­¥æ˜¯ä½¿ç”¨â€œK8s_slaveâ€éƒ¨ç½²å’Œé…ç½®ä»èŠ‚ç‚¹å¹¶å‘ä¸»èŠ‚ç‚¹æ³¨å†Œ
5.  æ¥ä¸‹æ¥ï¼ŒNFS æœåŠ¡å™¨å°†å¼€å§‹æä¾›ç›®å½•ã€‚
6.  ç„¶åæ˜¯ç”¨äº Wordpress pod è®¾ç½®å’Œ PVC å£°æ˜çš„ kube_wordpress è§’è‰²ã€‚
7.  æœ€åæ˜¯è¿è¡Œæ‰€æœ‰è§’è‰²çš„è®¾ç½®æ–‡ä»¶ã€‚

***ç¬¬ä¸€æ­¥:åˆ›å»ºå¯è¡Œçš„é…ç½®æ–‡ä»¶:***

Ansible æ˜¯ä¸€ä¸ªæ— ä»£ç†çš„è‡ªåŠ¨åŒ–å·¥å…·ï¼Œå®ƒéœ€è¦æ§åˆ¶å™¨èŠ‚ç‚¹ä¸Šçš„æ¸…å•æ–‡ä»¶ï¼Œæˆ‘å·²ç»æåˆ°è¿™æ˜¯æˆ‘ä»¬çš„æœ¬åœ°ç³»ç»Ÿã€‚æ¸…å•æ–‡ä»¶å¯ä»¥åœ¨è·¯å¾„(/etc/ansible/ansible.cfg)ä¸­çš„æ§åˆ¶å™¨èŠ‚ç‚¹å†…å…¨å±€åˆ›å»ºï¼Œä¹Ÿå¯ä»¥åœ¨æˆ‘ä»¬å°†è¦è¿è¡Œå‰§æœ¬/è§’è‰²çš„å·¥ä½œåŒºä¸­åˆ›å»ºã€‚

*ä¸ºæ­¤é¡¹ç›®åˆ›å»ºå·¥ä½œåŒº:*

```
**# mkdir kube-ansible
# cd kube-ansible
# mkdir roles
# vim ansible.cfg**
```

ansible.cfg

[æœ‰å…³ä¸Šè¿°æ–‡ä»¶çš„è§£é‡Šï¼Œè¯·è®¿é—®ï¼](https://docs.ansible.com/ansible/latest/reference_appendices/config.html#ansible-configuration-settings-locations)

***æ­¥éª¤ 2:ä¸º AWS ç™»å½•å’ŒéªŒè¯å®ä¾‹åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶:***

1.  ä¸€ä¸ªåä¸º`cred.yml`çš„å®‰å…¨åº“æ–‡ä»¶ï¼ŒåŒ…å« IAM è®¿é—®æƒé™å’Œç”¨äºéªŒè¯æ‚¨çš„ AWS å¸æˆ·çš„å¯†é’¥ã€‚åœ¨æ‚¨çš„ç›®å½•â€œmy-wsâ€ä¸­ä½¿ç”¨`ansible-vault create cred.yml`åˆ›å»º(ç»™å‡ºå¯†ç )

```
*file format:* access_key: GUJGWDUYGUEWVVFEWGVFUYV 
secret_key: huadub7635897^%&hdfqt57gvhg
```

2.åˆ›å»ºåä¸º`ansible.pem`çš„æ–‡ä»¶ï¼Œè¿™æ˜¯æˆ‘ä»¬ç”¨æ¥é€šè¿‡ AWS å¸æˆ·è¿œç¨‹åˆ›å»º ec2 å®ä¾‹çš„å¯†é’¥å¯¹ã€‚

# æ­¥éª¤:

> *1ã€‚è½¬åˆ° AWS ç®¡ç†æ§åˆ¶å°*
> 
> *2ã€‚EC2 ä»ªè¡¨æ¿*
> 
> *3ã€‚æˆå¯¹é’¥åŒ™*
> 
> *4ã€‚åˆ›å»ºæ–°çš„å¯†é’¥å¯¹*
> 
> *5ã€‚èµåä¸º* `*ansible*`
> 
> 6ã€‚é€‰æ‹©ã€‚â€œPEMâ€æ–‡ä»¶æ ¼å¼
> 
> 7ã€‚å°†å¯†é’¥ä¸‹è½½åˆ°æ‚¨çš„æœ¬åœ°ç³»ç»Ÿ
> 
> *8ã€‚å°†å¯†é’¥è½¬ç§»åˆ°æ‚¨çš„è§’è‰²ä¸º* `*kube-ansible*`çš„åŒä¸€ç›®å½•ä¸‹çš„è´£ä»»æ§åˆ¶å™¨èŠ‚ç‚¹

***ç¬¬ä¸‰æ­¥:åˆ›å»ºèŒè´£è§’è‰²:***

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä¸ºè‡ªåŠ¨åŒ–åˆ›å»ºäº”ä¸ªä¸»è¦è§’è‰²ï¼Œé¦–å…ˆæˆ‘ä»¬å°†åˆ›å»º NFS æœåŠ¡å™¨ï¼Œç„¶åæ˜¯å…¶ä½™å››ä¸ª EC2 å®ä¾‹ï¼ŒåŒ…æ‹¬ä¸€ä¸ªä¸»æœåŠ¡å™¨ã€ä¸¤ä¸ªä»æœåŠ¡å™¨å’Œä¸€ä¸ªå®¢æˆ·ç«¯ Kubernetes è®¾ç½®ã€‚

```
**# mkdir role
# cd role
# ansible-galaxy init ec2
# ansible-galaxy init k8s_master
# ansible-galaxy init k8s_slave
# ansible-galaxy init k8s_client
# ansible-galaxy init nfs-server**
```

ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†æ‰€æœ‰çš„ä»»åŠ¡ã€æ¨¡æ¿ã€å˜é‡æ–‡ä»¶*å’Œå…¶ä»–åŸºäºå·²çŸ¥æ–‡ä»¶ç»“æ„*çš„å¯è§£æå·¥ä»¶ï¼Œå®ƒä»¬éƒ½è¢«é¢„åµŒå…¥åˆ°è§’è‰²ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡åŒ…å«æ¨¡å—å’Œ jinja å±æ€§æ³¨é‡Šæ¥ç¼–å†™æˆ‘ä»¬æ‰€éœ€è¦çš„æ‰€æœ‰ä¸œè¥¿çš„å£°æ˜/æè¿°(ç”¨ YAML è¯­è¨€)ã€‚

è¦äº†è§£æ›´å¤šè§’è‰²ä¿¡æ¯ï¼Œè¯·è®¿é—®ï¼

***æ­¥éª¤ 4:ä¸ºå­˜å‚¨ç±»è®¾ç½®ç¼–å†™ NFS-æœåŠ¡å™¨è§’è‰²:***

![](img/3d8dac3749fdce5989a1e319aa0f7d57.png)

NFS-Server Setup

åœ¨æˆ‘ä»¬çš„ Kubernetes å¤šèŠ‚ç‚¹è®¾ç½®ä¸­ï¼Œæ­¤æœåŠ¡å™¨çš„ä¸»è¦ç”¨é€”æ˜¯ç”¨äºå­˜å‚¨ç±»ï¼Œå› ä¸º PV æ˜¯æ³¨å†Œçš„ï¼ŒPVC æ‰¹å‡†ä»…åœ¨æ­¤å­˜å‚¨ä¸­å®Œæˆã€‚æˆ‘ä»¬å·²å°† EBS å·åˆ†é…ç»™æ­¤æœåŠ¡å™¨ï¼Œè¿›ä¸€æ­¥çš„å·åˆ†é…ç”±ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿå®Œæˆã€‚è¯¥è§’è‰²æœ¬èº«è¡¨æ˜å®ƒæ„å‘³ç€å°†å­˜å‚¨å…±äº«ä¸ºç›®å½•ï¼Œå¹¶åœ¨ä»¥ååœ¨ PVC ä¸ŠæŒ‚è½½å…±äº«æ–‡ä»¶å¤¹(æ°¸ä¹…å·å£°æ˜)ã€‚

ğŸ¤”**PVC æœ‰ä»€ä¹ˆç”¨ï¼Ÿ**
æˆ‘ä»¬çš„ WordPress ä¾èµ–äº SQL å­˜å‚¨ï¼Œå› ä¸ºå®ƒä¸ºå®¢æˆ·ç«¯ç™»å½• WordPress æä¾›æ•°æ®åº“ã€‚æ­¤å¤–ï¼Œå½“æˆ‘ä»¬ä¿è¯æ²¡æœ‰åœæœºè®¾ç½®æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»æœ‰ä¸€ä¸ªæŒä¹…çš„æ•°æ®å­˜å‚¨ï¼Œä»¥ä¾¿ç”±äºä»»ä½•ç§ç±»çš„ POD æˆ–èŠ‚ç‚¹ SPOFï¼Œæˆ‘ä»¬çš„æ•°æ®ä¸èƒ½ä¸¢å¤±ï¼Œå®¢æˆ·ç«¯ä¸èƒ½å› æ­¤è€Œå­˜æ´»ã€‚ç°åœ¨é—®é¢˜æ¥äº†ï¼Œå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿæˆ‘ä»¬å¦‚ä½•å°†åŒä¸€ä¸ª PVC è¿æ¥åˆ°å¦ä¸€ä¸ª PODï¼Ÿ â€”ç­”æ¡ˆæ˜¯æˆ‘ä»¬åœ¨ Kubernetes ä¸­æœ‰æ ‡è®°çš„æ¦‚å¿µï¼Œé€šè¿‡å®ƒæˆ‘ä»¬å¯ä»¥é“¾æ¥åˆ°æˆ‘ä»¬çš„èµ„æºå’ŒæœåŠ¡ã€‚æˆ‘ä»¬éœ€è¦ç»™å‡ºçš„æ˜¯èµ„æºç§ç±»ï¼Œä»¥åŠç”± etcd(å†…éƒ¨ Kubernetes æ•°æ®åº“)ç®¡ç†å’Œå­˜å‚¨çš„å…ƒæ•°æ®ã€‚PVC æ˜¯æŒ‡å®¢æˆ·è¯·æ±‚æ‰¹å‡†å¹¶ä»æœ¬åœ°æˆ–å¤–éƒ¨(ç½‘ç»œ)å­˜å‚¨ä¸­æä¾›æ‰€è¯·æ±‚å­˜å‚¨ã€‚

```
**# cd role/nfs-server/tasks
# vim main.yml**
```

task.yml

æˆ‘ä»¬æœ‰å˜é‡æ–‡ä»¶ï¼Œå®ƒåŒ…å«åœ¨è§’è‰²æ‰§è¡Œæ—¶å°†è¢«ç›´æ¥è°ƒç”¨/æ›¿æ¢çš„å€¼ã€‚å®ƒåŒ…æ‹¬â€œå…±äº«ç›®å½•â€å˜é‡ã€‚åˆ†åˆ«ä¸º WordPress å’Œ MySQL Pods å‘½åä¸ºâ€œ/wpâ€å’Œâ€œ/mysqlâ€çš„ä¸¤ä¸ªç›®å½•ã€‚

```
**# cd role/nfs-server/vars
# vim main.yml**
```

var.yml

![](img/543446914ad8b1e54dd37a33163f81b7.png)

ec2-ansible-role

***ç¬¬äº”æ­¥:ä¸ºè®¾ç½®ç¼–å†™ EC2 è§’è‰²:***

ä¸ºäº†åœ¨ AWS EC2 ä¸­å¯åŠ¨å®ä¾‹ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹ aws-ec2 è§’è‰²ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›ç™»å½• aws å¸æˆ·çš„å‡­è¯ã€‚ç„¶åæˆ‘ä»¬å°†çœ‹åˆ°è§’è‰²æ˜¯å¦‚ä½•ç¼–å†™çš„:

```
**# cd role/ec2/tasks
# vim main.yml**
```

task.yml

æˆ‘ä»¬åœ¨è¿™ä¸ª ec2 è§’è‰²ä¸­è¿è¡Œå…«ä¸ªä»»åŠ¡ï¼Œä¸€ä¸ªæ˜¯å®‰è£… boto3 for AWS API ä»¥è¿›è¡Œè¿æ¥ï¼Œç„¶åæ˜¯å®‰å…¨ç»„ï¼Œä¹‹åæ˜¯ EC2 å®ä¾‹åˆ›å»ºï¼Œç„¶åä½¿ç”¨ ansible add_host æ¨¡å—åˆ›å»ºåŠ¨æ€æ¸…å•ã€‚æœ€åï¼Œåˆ‡æ¢åˆ°ä¸æ‰€æœ‰å®ä¾‹çš„ ssh è¿æ¥ã€‚

æˆ‘ä»¬æœ‰å˜é‡æ–‡ä»¶ï¼Œå®ƒåŒ…å«åœ¨è§’è‰²æ‰§è¡Œæ—¶å°†è¢«ç›´æ¥è°ƒç”¨/æ›¿æ¢çš„å€¼ã€‚æˆ‘ä»¬æœ‰å››ä¸ª **instance_tags** ï¼Œä¸¤ä¸ª **python_pkgs** å˜é‡å’Œ **sg_name** ï¼Œ **region_name** ï¼Œ **subnet_name** ï¼Œ **ami_id** ï¼Œ **keypair** ï¼ŒI**instance _ flavor**ï¼Œå¹¶æ ¹æ®æ‚¨çš„å¸æˆ· ARN(äºšé©¬é€Šèµ„æºåç§°)æˆ–äºšé©¬é€Š id ç»™å‡ºå€¼ã€‚

```
**# cd role/ec2/vars
# vim main.yml**
```

var.yml

![](img/d9c7d8707184e8b4d7138363c1dfb52d.png)

k8s-master-role

***ç¬¬äº”æ­¥:ç¼–å†™ k8s_master è§’è‰²:*** å¯¹äº Kubernetes ä¸»èŠ‚ç‚¹è®¾ç½®è§’è‰²æè¿°å¦‚ä½•åœ¨ kube_master è§’è‰²çš„ tasks æ–‡ä»¶å¤¹ä¸­è¿›è¡Œé…ç½®ã€‚vars æ–‡ä»¶å¤¹ä¹ŸåŒ…å«ä¸€äº›å˜é‡å€¼:

```
**# cd role/k8s_master/tasks
# vim main.yml**
```

task.yml

æˆ‘ä»¬åœ¨è¿™é‡Œæœ‰ 11 ä¸ªä»»åŠ¡ï¼ŒåŒ…æ‹¬å®‰è£… **kubeadm** ã€ **kubelet** å’Œ **kubectl** å‘½ä»¤ï¼Œç„¶åä» **dockerhu** b ä¸­æå–æ‰€æœ‰ç®¡ç†æ˜ åƒï¼Œéšåæ˜¯å®ƒä»¬çš„ pod åˆ›å»ºå’Œç½‘ç»œè¦†ç›–ï¼Œä»¥åŠ**å®ˆæŠ¤ç¨‹åºé©±åŠ¨ç¨‹åºè®¾ç½®**ï¼Œæœ€åæˆ‘ä»¬ä½¿ç”¨ flunnel CNI ä¸ºä»èŠ‚ç‚¹è¿æ¥åˆ›å»ºä¸€ä¸ªæ³¨å†Œå¯†é’¥ã€‚

æˆ‘ä»¬æœ‰å˜é‡æ–‡ä»¶ï¼Œå®ƒåŒ…å«åœ¨è§’è‰²æ‰§è¡Œæ—¶å°†è¢«ç›´æ¥è°ƒç”¨/æ›¿æ¢çš„å€¼ã€‚å®ƒåŒ…æ‹¬åä¸º service_name å˜é‡ï¼Œå¹¶åŒ…å«ä»¥ä¸‹å€¼:

Docker:å®¹å™¨å¼•æ“ç¨‹åºï¼Œå¸®åŠ©å¯åŠ¨å®¹å™¨ï¼Œç„¶å POD é€šè¿‡æ ‡è®°å’Œæ ‡ç­¾é€‰æ‹©æ–¹æ³•ç®¡ç†å®¹å™¨ã€‚Docker éœ€è¦å®‰è£…åœ¨ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹ä¸Šï¼Œå› ä¸ºåå°çš„ kubelet ç¨‹åºè¿æ¥åˆ° docker å¼•æ“å¹¶å¯åŠ¨å®¹å™¨ã€‚

kube let:**kube let**æ˜¯è¿è¡Œåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„ä¸»è¦â€œèŠ‚ç‚¹ä»£ç†â€,å®ƒç®¡ç†è¿è¡Œåœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šçš„å®¹å™¨ã€‚

```
**# cd role/k8s_master/vars
# vim main.yml**
```

![](img/7ccd13810902c8fe16fb9f623499a05b.png)

k8s-slave-role

***ç¬¬å…­æ­¥:ç¼–å†™ k8s_slave è§’è‰²:***

ç°åœ¨è®©æˆ‘ä»¬åœ¨ tasks æ–‡ä»¶å¤¹ä¸­ä¸º kube_slave è§’è‰²ç¼–å†™å‰§æœ¬ï¼Œç„¶ååœ¨ vars æ–‡ä»¶å¤¹ä¸­æåˆ°å˜é‡å€¼ã€‚ä¸ Kubernetes ä¸»æœºç›¸åŒï¼Œä»æœºçš„å…ˆå†³æ¡ä»¶æ˜¯ä¸‰ä¸ªè½¯ä»¶ï¼Œå³ Dockerã€Kubeadm å’Œ ip-tablesã€‚æˆ‘ä»¬å¿…é¡»æ›´æ–°åœ¨ slave ä¸­ä½¿ç”¨äº†/etc/sysctl.d/k8s.conf æ–‡ä»¶çš„ ip è¡¨ã€‚

ä»èŠ‚ç‚¹å‘ä¸»èŠ‚ç‚¹çš„æ³¨å†Œ/åŠ å…¥åªèƒ½é€šè¿‡ä¸»èŠ‚ç‚¹åœ¨æ•´ä¸ªè®¾ç½®å’Œåˆå§‹åŒ–ä¹‹åæä¾›çš„å¯†é’¥æ¥å®Œæˆã€‚æˆ‘ä»¬éœ€è¦åœ¨ä»èŠ‚ç‚¹ä¸­å¤åˆ¶å¯†é’¥ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨äº†ä»¤ç‰Œã€‚

```
**# cd role/k8s_slave/tasks
# vim main.yml**
```

task.yml

```
**# cd role/k8s_master/vars
# vim main.yml**
```

var.yml

![](img/56a99a6793be9613eb6369a5b07a14d7.png)

kube-wordpress-role

***ç¬¬ä¸ƒæ­¥:ç¼–å†™ kube_wordpress è§’è‰²:***

è¿™é‡Œæˆ‘ä»¬å¤åˆ¶äº† pod /æœåŠ¡è®¾ç½®çš„ YAML ä»£ç ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è§’è‰²çš„ä¸‰ä¸ªç»„æˆéƒ¨åˆ†ï¼Œå³ä»»åŠ¡ã€æ–‡ä»¶å’Œæ¨¡æ¿(jinja2 æ ¼å¼ä»£ç æ–‡ä»¶)ã€‚

```
**# cd role/kube_wordpress/tasks
# vim main.yml**
```

task.yml

æˆ‘ä»¬æœ‰è¿™ä¸ªæ¨¡æ¿æ–‡ä»¶ï¼Œç”¨äºåœ¨å¤„ç†åå°† Jinja2 æ–‡ä»¶å¤åˆ¶åˆ°æˆ‘ä»¬çš„ä»èŠ‚ç‚¹ï¼Œä»¥ä¾¿ä¸ºæˆ‘ä»¬çš„ WordPress å’Œ MySQL èŠ‚ç‚¹è¯·æ±‚å’Œå®‰è£… PV:

```
**# cd role/k8s_master/vars
# vim storage.yml.j2**
```

storage.yml.j2

æˆ‘ä»¬ä¹Ÿæœ‰è¿™ä¸ªè§’è‰²çš„æ–‡ä»¶ï¼Œå…¶ä¸­ 4 ä¸ªæ–‡ä»¶å‘½åä¸ºâ€œ [kustomization.yml](https://github.com/akankshaS77/WordPress-on-Kubernetes-AWS-Ansible/blob/main/kube-ansible/roles/kube-wordpress/files/K8s-WordPress/kustomization.yml) â€ã€â€œ [mysql-deploy.yml](https://github.com/akankshaS77/WordPress-on-Kubernetes-AWS-Ansible/blob/main/kube-ansible/roles/kube-wordpress/files/K8s-WordPress/mysql-deploy.yml) â€ã€â€œ [secret.yml](https://github.com/akankshaS77/WordPress-on-Kubernetes-AWS-Ansible/blob/main/kube-ansible/roles/kube-wordpress/files/K8s-WordPress/secret.yml) â€ã€â€œ [wordpress-deploy.yml](https://github.com/akankshaS77/WordPress-on-Kubernetes-AWS-Ansible/blob/main/kube-ansible/roles/kube-wordpress/files/K8s-WordPress/wordpress-deploy.yml) â€ï¼Œå®ƒä»¬å°†åˆ›å»º podsã€‚

ä»¥ä¸‹æ˜¯æ‰€æœ‰çš„å››ä¸ªæ–‡ä»¶ï¼ŒYAML ä»£ç åˆ›å»ºçš„åŸºæœ¬æ¦‚å¿µä¸ Kubernetes çš„ reourcesï¼Œkindï¼ŒapiVersion å…³é”®å­—ç¼–å†™:

```
**# cd role/kube_wordpress/files
# vim kustomization.yml
# vim mysql-deploy.yml
# vim secret.yml
# vim wordpress-deploy.yml**
```

Kustomization.yml

mysql-deploy.yml

secret.yml

wordpress-deploy.yml

***æ­¥éª¤ 8:åˆ›å»ºè®¾ç½®è¡ŒåŠ¨æ‰‹å†Œä»¥è¿è¡Œæ‰€æœ‰è§’è‰²å¹¶åˆ›å»º AWS é›†ç¾¤:***

æœ€åï¼Œç¼–å†™æˆ‘ä»¬çš„ Setup.yml æ–‡ä»¶ï¼Œé€šè¿‡è°ƒç”¨è¿™äº›è§’è‰²æ¥è‡ªåŠ¨å®Œæˆæ‰€æœ‰çš„ä»»åŠ¡ã€‚æˆ‘ä»¬éœ€è¦åœ¨ä¸»å·¥ä½œåŒºå†…åˆ›å»ºæ–‡ä»¶ï¼Œå³ kube_ansible:

```
**# cd kube_ansible/
# vim setup.yml**
```

setup.yml

**æ­¥éª¤ 9:è¿è¡Œå‰§æœ¬ Setup.yml**

ä½¿ç”¨ ansible-playbook å‘½ä»¤è¿è¡Œå‰§æœ¬ï¼Œå¹¶æä¾› vault å¯†ç ä»¥éªŒè¯å’Œç™»å½• AWS å¸æˆ·ã€‚

```
**# ansible-playbook setup.yml -ask-vault-pass**
```

å› æ­¤æˆ‘ä»¬å·²ç»å®ç°äº†æˆ‘ä»¬çš„ç›®æ ‡â€œè‡ªåŠ¨åŒ–â€”â€”ä½¿ç”¨ Ansible åœ¨ AWS ä¸Šå¯åŠ¨çš„ Kubernetes å¤šèŠ‚ç‚¹é›†ç¾¤ä¸Šçš„ WordPress éƒ¨ç½²â€ã€‚

ä½ å¯ä»¥åœ¨æˆ‘çš„ GitHub ä¸Šæ‰¾åˆ°è¿™ä¸ªé¡¹ç›®ï¼Œåªè¦ fork å’Œ let ä½¿è¿™ä¸ªé¡¹ç›®å¯¹å®¢æˆ·æ¥è¯´æ›´åŠ ç³»ç»Ÿç‹¬ç«‹å’Œå¯é ã€‚

[](https://github.com/akankshaS77/WordPress-on-Kubernetes-AWS-Ansible.git) [## akankshas 77/WordPress-on-Kubernetes-AWS-ansi ble

### ä½¿ç”¨ Ansible Automation åœ¨ AWS EC2 å®ä¾‹ä¸Šæä¾› Kubernetes å¤šèŠ‚ç‚¹é›†ç¾¤ï¼Œå¹¶åœ¨â€¦ä¸Šéƒ¨ç½² Wordpress

github.com](https://github.com/akankshaS77/WordPress-on-Kubernetes-AWS-Ansible.git) 

å¦‚æœæ‚¨æƒ³ä¸ºè¿™ä¸ªé¡¹ç›®åšå‡ºè´¡çŒ®ï¼Œæˆ–è€…æœ‰è¿›ä¸€æ­¥çš„ç–‘é—®æˆ–æ„è§ï¼Œæ‚¨å¯ä»¥é€šè¿‡ LinkedIN è”ç³»æˆ‘:

[](https://www.linkedin.com/in/akanksha-singh-as/) [## é˜¿åº·æ²™Â·è¾›æ ¼-æˆåŠŸè´Ÿè´£äºº@ ARTH -æŠ€æœ¯å­¦é™¢- LinuxWorld Informatics Pvt æœ‰é™å…¬å¸â€¦

### åœ¨å…¨çƒæœ€å¤§çš„èŒä¸šç¤¾åŒº LinkedIn ä¸ŠæŸ¥çœ‹é˜¿åº·æ²™Â·è¾›æ ¼çš„ä¸ªäººèµ„æ–™ã€‚é˜¿åº·æ²™æœ‰ 3 ä¸ªå·¥ä½œåˆ—åœ¨â€¦

www.linkedin.com](https://www.linkedin.com/in/akanksha-singh-as/) 

## æ„Ÿè°¢é˜…è¯»ã€‚å¸Œæœ›è¿™ä¸ªåšå®¢ç»™ä½ ä¸€äº›æœ‰ä»·å€¼çš„è¾“å…¥ï¼ï¼