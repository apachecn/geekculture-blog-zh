# å¯¹ä¸­å‹åº”ç”¨ç¨‹åºè¿›è¡Œé€†å‘å·¥ç¨‹

> åŸæ–‡ï¼š<https://medium.com/geekculture/reverse-engineering-the-medium-app-6c4009bbf28a?source=collection_archive---------13----------------------->

## é€†å‘å·¥ç¨‹

![](img/474fa1f7c407c33bb639ecc4af682179.png)

photo by [thesaurus.plus](https://thesaurus.plus/img/antonyms/639/dismantle.png)

é€†å‘å·¥ç¨‹ï¼Œåˆ†è§£äº§å“ä»¥ç¡®å®šå…¶åŠŸèƒ½ã€‚

åœ¨æˆ‘è¿›ä¸€æ­¥è¯´ä¹‹å‰ï¼Œè®©æˆ‘è§£é‡Šä¸€ä¸‹æˆ‘æ˜¯å¦‚ä½•èµ°åˆ°è¿™ä¸€æ­¥çš„ã€‚åœ¨ä¸€ä½å®‰å…¨åˆ†æå¸ˆæœ€è¿‘è¡¨ç¤ºï¼Œæˆ‘å¼€å‘çš„ä¸€ä¸ªåº”ç”¨ç¨‹åºå¾ˆå®¹æ˜“è¢«é€†å‘å·¥ç¨‹ä»¥è¯»å–/å†™å…¥ä»£ç å¹¶çªƒå–é‡è¦ä¿¡æ¯ä¹‹åï¼Œé€†å‘å·¥ç¨‹å¼•èµ·äº†æˆ‘çš„æ³¨æ„ã€‚

æˆ‘åƒå¾€å¸¸ä¸€æ ·å‘æˆ‘çš„æœç´¢å¼•æ“æŸ¥è¯¢åŒæ ·çš„äº‹æƒ…ï¼Œå¥¹æä¾›äº†é«˜å±‚æ¬¡çš„ç†ç”±ã€‚æˆ‘å¼€å§‹æœç´¢è¿™ä¸€åˆ‡æ˜¯å› ä¸ºï¼Œä½œä¸ºä¸€ä¸ªæ™®é€šäººï¼Œæˆ‘æ²¡æœ‰ä¸€ä¸‹å­å¾—åˆ°å®ƒã€‚

æœ€ç»ˆèƒ½å¤Ÿå¯¹è½¯ä»¶è¿›è¡Œé€†å‘å·¥ç¨‹æ¥è¯»å–ä»£ç ã€‚

å—¯ï¼ï¼æˆ‘çŒœä½ æƒ³çŸ¥é“â€œå†™â€éƒ¨åˆ†å‘ç”Ÿäº†ä»€ä¹ˆã€‚

æˆ‘ä¼šè¯´åˆ°è¿™ä¸€ç‚¹ï¼Œä½†ä½ ç†Ÿæ‚‰è¿™ä¸€éƒ¨åˆ†å—ï¼Ÿå½“æ‚¨ä½¿ç”¨æˆ–åˆ›å»ºè½¯ä»¶æ—¶ï¼Œæœ‰å¤šå°‘ä»£ç å¿…é¡»è¢«å‹ç¼©å¹¶ç¿»è¯‘æˆå¦ä¸€ç§è¯­è¨€æ‰èƒ½è¿è¡Œï¼Ÿ

ç”±ç³»ç»Ÿæ„å»ºã€è¿è¡Œæˆ–ç¼–è¯‘çš„ç¨‹åºç¡®å®è¦ç»è¿‡ç¼–è¯‘æ­¥éª¤ã€‚

# ç¼–è¯‘ç¨‹åº

å¯¹äººç±»å¯è¯»ä»£ç å¦‚ä½•è¿›å…¥æˆ‘ä»¬çš„ CPU ç†è§£çš„å­—èŠ‚åºåˆ—çš„é«˜çº§æ¦‚è¿°ã€‚

*   **é¢„å¤„ç†é˜¶æ®µ:**éå†æºä»£ç ï¼Œæ‰§è¡Œæ³¨é‡Šç§»é™¤ã€å®å±•å¼€ã€æ¡ä»¶ç§»é™¤ã€åŒ…å«å±•å¼€ã€‚
*   **ç¼–è¯‘é˜¶æ®µ:**å°†ä»»æ„è¯­è¨€(pythonã€javaã€kotlinã€HTMLã€dartã€C)ç¼–å†™çš„æºä»£ç è½¬æ¢æˆæ±‡ç¼–è¯­è¨€ã€‚
*   **æ±‡ç¼–é˜¶æ®µ:**æ±‡ç¼–å™¨å°†æ±‡ç¼–ä»£ç è½¬æ¢æˆäºŒè¿›åˆ¶æ“ä½œç /ç›®æ ‡ä»£ç ã€‚
*   **é“¾æ¥é˜¶æ®µ:**å…¥å£ç‚¹ï¼Œåœ¨è¿™é‡Œæ‰€æœ‰çš„ç›®æ ‡ä»£ç å¾—åˆ°ä¸€ä¸ªå†…å­˜æ¥è§£å†³ã€‚

äº’è”ç½‘ä¸Šæœ‰è¶³å¤Ÿå¤šçš„å·¥å…·å¯ä»¥å¸®åŠ©å¯¹è½¯ä»¶è¿›è¡Œé€†å‘å·¥ç¨‹ï¼Œå¦‚ Ghidraã€x64dbgã€OllyDbgã€apktoolã€jadx ç­‰

ç†è®ºåˆ°æ­¤ä¸ºæ­¢ã€‚è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘æ˜¯å¦‚ä½•ç ´è§£ Medium åº”ç”¨ç¨‹åºçš„ã€‚

# ä¸­å‹ APK

ä¸ºäº†åç¼–è¯‘æºä»£ç ï¼Œæˆ‘ä½¿ç”¨äº†ä¸€äº›å·¥å…·ï¼Œæ¯”å¦‚ [apktool](https://ibotpeaches.github.io/Apktool/) (ç”Ÿæˆ**[**Smali**](https://github.com/JesusFreke/smali/wiki/Registers)**æ–‡ä»¶**)ï¼Œ [Jadx](https://github.com/skylot/jadx) (è¯•å›¾ä¸ºé‚£äº›ç¾å‘³çš„ Java æ–‡ä»¶ä»˜å‡ºé¢å¤–çš„åŠªåŠ›)ã€‚ç„¶åï¼Œæˆ‘å¯ä»¥é€šè¿‡å°†åº”ç”¨ç¨‹åºåç¼–è¯‘æˆ Dalvik å­—èŠ‚ç ï¼Œç„¶åå°†å…¶ç¿»è¯‘æˆç²—ç•¥ä¼°è®¡çš„ Java ä»£ç æ¥æ£€æŸ¥åŠŸèƒ½ã€‚**

**å¯¹ä»‹è´¨ apk è¿›è¡Œåå‘å·¥ç¨‹æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå…¶ä¸­åŒ…å«ä¸å…¶ç›¸å…³çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚**

**![](img/98ced914784bd9f5af5914b183d80a92.png)**

**image by author**

**smali ç±»ä¸­çš„ä»£ç ç±»ä¼¼äºä¸‹å›¾**

**![](img/41094a6bddc980eb42ba1069aaf822b0.png)**

**smali code â€” image by author**

**[**æ–¯é©¬åˆ©**](https://github.com/JesusFreke/smali/wiki/Registers)**â€”â€”**ç”±äºäºŒè¿›åˆ¶ä»£ç å¾ˆéš¾è§£é‡Šæˆ–ç¼–è¾‘ï¼Œå› æ­¤æœ‰ä¸€äº›å·¥å…·å¯ä»¥ç”¨æ¥ä¸äººç±»å¯è¯»çš„è¡¨ç¤ºå½¢å¼è¿›è¡Œç›¸äº’è½¬æ¢ã€‚Smali æ˜¯æœ€å…¸å‹çš„äººç±»å¯è¯»æ ¼å¼ã€‚**

**ä¸‹å›¾æ˜¾ç¤ºäº† Smali åœ¨ JAVA ä¸­çš„è¡¨ç°ã€‚**

**![](img/381aa28e93b74539d177c42930091326.png)**

**smali to java**

# **å…è´¹åˆ¶ä½œæ‰€æœ‰æ•…äº‹**

**æˆ‘æœ‰åª’ä½“çš„æ‰€æœ‰æºä»£ç ï¼Œæ‰€ä»¥è¯•å›¾è®©æ‰€æœ‰çš„æ•…äº‹å…è´¹ï¼Œå› ä¸ºåª’ä½“æ¯æœˆåªå…è´¹æä¾› 3 ä¸ªæ•…äº‹æ¥é˜…è¯»ä¼šå‘˜è¦æ±‚çš„æ•…äº‹ã€‚**

**åœ¨åº”ç”¨ç¨‹åºçš„æºä»£ç ä¸­æ¸¸äº†ä¸€å¤œä¹‹åï¼Œæˆ‘å¼„æ¸…æ¥šäº†ä»å¯åŠ¨å±å¹•åˆ°æ•…äº‹é¢„è§ˆæµç¨‹çš„åŠŸèƒ½ã€‚**

```
The main root for membership verification was within this path***medium\smali_classes3\com\medium\android\common\metrics***And there where i made the changes to the code
```

**![](img/ecef7981a8eb3077eb20ae5189b9e197.png)****![](img/dd8512e0079d3b52d38414a4b83fc9e9.png)**

**left image edited java code, right image edited smali code**

**æˆ‘ä»¬æ— æ³•å®Œå…¨è·å¾— Java åº”ç”¨ç¨‹åºçš„æºä»£ç ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨æ±‡ç¼–çº§åˆ«è¿›è¡Œä»»ä½•å¿…è¦çš„æ›´æ”¹ï¼Œä»¥ä¾¿èƒ½å¤Ÿé‡æ–°ç¼–è¯‘æˆ‘ä»¬çš„åº”ç”¨ç¨‹åº(æˆ‘ä»¬æœ‰åº”ç”¨ç¨‹åºçš„å®Œæ•´æ±‡ç¼–æºä»£ç )ã€‚**

**ä¿®æ”¹æ±‡ç¼–æ–‡ä»¶å¬èµ·æ¥å¯èƒ½å¾ˆå¯æ€•ï¼Œä½†ä¹Ÿæ²¡é‚£ä¹ˆç³Ÿç³•ã€‚ç‰¹åˆ«æ˜¯å¦‚æœæˆ‘ä»¬åœ¨è®¨è®º Java å­—èŠ‚ç æ±‡ç¼–(Java è™šæ‹Ÿæœºå’Œ Dalvik è™šæ‹Ÿæœºéƒ½æœ‰ç›¸å¯¹é«˜çº§çš„æŒ‡ä»¤é›†ï¼Œè¿™é‡Œä¸æ˜¯ LC-3 æˆ– x86)ã€‚**

**åœ¨å°†è¿™äº›è¡Œæ·»åŠ åˆ°åº”ç”¨ç¨‹åºä»£ç ä¹‹åï¼Œæˆ‘ä»¬å¿…é¡»é‡æ–°ç¼–è¯‘æ‰€æœ‰å†…å®¹ã€‚æˆ‘ä»¬å°†å†æ¬¡åˆ©ç”¨ Apktool ä» Smali æ–‡ä»¶æ„å»ºä¸€ä¸ª APKã€‚æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªæ”¹å˜äº†çš„ APKã€‚**

**è¿˜æ²¡å®Œï¼Œå®‰å“è®¾å¤‡ä¸å…è®¸è¢«ç¯¡æ”¹çš„ apk å®‰è£…ï¼Œé™¤éç™»å½•ã€‚**

> **å°½ç®¡æˆ‘å°½äº†æœ€å¤§åŠªåŠ›ï¼Œä½†æˆ‘è§‚å¯Ÿåˆ°ä»‹è´¨è¶³å¤Ÿèªæ˜ï¼Œå¯ä»¥éªŒè¯ cookie æ¥éªŒè¯æˆå‘˜èµ„æ ¼ã€‚åœ¨é‚£é‡Œï¼Œæˆ‘æ²¡æœ‰é‡åˆ°**

**å½“æˆ‘å­¦ä¹ é€†å‘å·¥ç¨‹æ—¶ï¼Œè¿™ä¸ªèµ„æºå¯¹æˆ‘å¸®åŠ©å¾ˆå¤§ã€‚é‚£å°±æ˜¯ YouTube ç³»åˆ—çš„ **HackadayU** ä¸Šçš„[**ä¸ Ghidra**](https://www.youtube.com/watch?v=d4Pgi5XML8E&list=PLcSbrXYDkKywrtGtuo4OMV7QMHuiV6JHV&index=1&t=907s) çš„é€†å‘å·¥ç¨‹**

# **å‚è€ƒ**

*   **[**è¾¾å°”ç»´å…‹æ“ä½œç **](http://pallergabor.uw.hu/androidblog/dalvik_opcodes.html)**
*   **[**æ–¯é©¬åˆ©**](https://github.com/JesusFreke/smali)**
*   **[**åè½¬ä¸€ä¸ªä½¿ç”¨äº† Flutter**](https://cryptax.medium.com/reversing-an-android-sample-which-uses-flutter-23c3ff04b847) çš„ Android æ ·æœ¬**
*   **[**æŸæœ¨é©¬åŒ–åŒ»ç–— app çš„ç°åœºé€†å‘å·¥ç¨‹â€”â€”Android/Joker**](https://cryptax.medium.com/live-reverse-engineering-of-a-trojanized-medical-app-android-joker-632d114073c1)**
*   **[**å®‰å“åº”ç”¨çš„é€†å‘å·¥ç¨‹**](/@parfaitayassor/reverse-engineering-of-android-applications-6e25460a48c8)**

**è¯·ä¸è¦èµ·è¯‰åª’ä½“ğŸ™ğŸ™ğŸ™è¿™ä¸€åˆ‡éƒ½æ˜¯å‡ºäºæ•™è‚²ç›®çš„ã€‚**

***æ„Ÿè°¢æ‚¨èŠ±æ—¶é—´é˜…è¯»æœ¬æ–‡ã€‚å¦‚æœä½ è§‰å¾—è¿™ä¸ªå¸–å­æœ‰ç”¨åˆæœ‰è¶£ï¼Œè¯·é¼“æŒæ¨èã€‚***

**å¦‚æœæˆ‘åšé”™äº†ä»€ä¹ˆï¼Œè¯·åœ¨è¯„è®ºä¸­æå‡ºæ¥ã€‚æˆ‘å¾ˆæƒ³è¿›æ­¥ã€‚**